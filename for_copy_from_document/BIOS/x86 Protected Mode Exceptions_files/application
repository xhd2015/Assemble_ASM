var microsoft=microsoft||{},portalCommon,pc,WLSPHIP1,app,awasaServicesSettings,WLSPHIP0;microsoft.support=microsoft.support||{};microsoft.support.client=microsoft.support.client||{};microsoft.support.client.web=microsoft.support.client.web||{};microsoft.support.client.web.chat=microsoft.support.client.web.chat||{};microsoft.support.client.web.chat.constants=microsoft.support.client.web.chat.constants||{},function(){var n=microsoft.support.client.web.chat.constants;n.flagKeys={surveyType:"surveyType"}}();portalCommon="portalCommon";pc=angular.module(portalCommon,["ngSanitize","ngRoute","ngCookies","ngAria","ui.bootstrap","ngMessages","ngFileUpload"]);pc.value("clientConfig",{});pc.value("authConfiguration",{}),function(){var n=microsoft.support.client.web.chat;n.surveyTypes={DEFAULT:"DEFAULT",NONE:"NONE"}}(),function(n){n.directive("avPartnerRender",["contentApiService",function(n){return{templateUrl:"/PartialViews/Antivirus/AvPartnerTemplate.html",restrict:"A",scope:{os:"@avPartnerRender"},link:function(t){function i(n){return n.replace(/\s/g,"").toLowerCase()}function r(n){for(var t=n.length,i,r;t>0;)i=Math.floor(Math.random()*t),t--,r=n[t],n[t]=n[i],n[i]=r;return n}t.updating=!0;n.getCompassContentForPage("antivirus").then(function(n){t.vendors=n.data.antiVirusInformation.vendors}).catch(function(){t.updating=!1});t.$watchCollection("vendors",function(){if(t.vendors&&t.vendors.length>0){var n=t.vendors.filter(function(n){return n.operatingSystem.filter(function(n){return angular.equals(i(n),i(t.os))?!0:!1}).length>0});t.filteredVendors=r(n);t.updating=!1}})}}}])}(angular.module(portalCommon)),function(n){n.service("browserService",["$window",function(n){var i,t={Android:function(){return n.navigator.userAgent.match(/Android/i)},BlackBerry:function(){return n.navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return n.navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return n.navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return n.navigator.userAgent.match(/IEMobile/i)},Other:function(){return n.navigator.userAgent.indexOf("Mobi")>=0},any:function(){return t.Android()||t.BlackBerry()||t.iOS()||t.Opera()||t.Windows()||t.Other()}};this.getBrowser=function(){return i};this.isMobile=function(){return!!t.any()};this.determineBrowser=function(){var i=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,r,u,n,f,e,o,s,t,h;return i?"opera":(r=typeof InstallTrigger!="undefined",r)?"firefox":(u=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,u)?"safari":(n=!1,f=!!document.documentMode&&document.documentMode==11,f)?(n=!0,"ie11"):(e=!!document.documentMode&&document.documentMode==10,e)?(n=!0,"ie10"):(o=!!document.documentMode&&document.documentMode==9,o)?(n=!0,"ie9"):(s=!n&&!!window.StyleMedia,s)?"edge":(t=!!window.chrome&&!!window.chrome.webstore,t)?"chrome":(h=(t||i)&&!!window.CSS,h)?"blink":"Other"};i=this.determineBrowser()}])}(angular.module(portalCommon)),function(n){n.directive("compile",["$compile","$sanitize",function(n){return{restrict:"A",transclude:!0,scope:{compile:"="},link:function(t,i){t.$watch(function(n){return n.compile},function(r){if(r)try{i.html(r);n(i.contents())(t)}catch(u){console.log("Does not compile",u)}})}}}])}(angular.module(portalCommon)),function(n){n.directive("debug",["$routeParams",function(n){return{restrict:"A",scope:{debug:"="},link:function(t,i,r){t.enabled=n.debug;t.name=r.debug},template:'<pre ng-if="enabled"> {{name}}: {{debug | json}}<\/pre>'}}])}(angular.module(portalCommon)),function(n){n.service("getScriptService",["$timeout","$q","clientConfig",function(n,t,i){function e(){r.readyState&&r.readyState!="complete"||(r.onload=r.onreadystatechange=null,n.cancel(f),u.resolve())}function o(){r.onload=r.onreadystatechange=null;n.cancel(f);u.reject()}var u=t.defer(),f,r;this.addScript=function(t,s){var h=s&&s.element?s.element:angular.element("head");return r=document.createElement("script"),f=n(function(){u.reject({status:504})},i.ChatConfig.ChatDefaultTimeout),h.append(r),r.onload=r.onreadystatechange=e,r.onerror=o,r.src=t,u.promise}}])}(angular.module(portalCommon)),function(n){n.factory("httpAppOptionsInterceptor",["$rootScope","$cookies","$routeParams","authConfiguration",function(n,t,i,r){function f(n,t){n.params?angular.extend(n.params,t):n.params=t}var u={};return u.request=function(u){var o,e;return u.httpAppOptions&&(e={},u.httpAppOptions.cacheBust&&(e.iecbust=(new Date).getTime()),u.httpAppOptions.allowPreview&&(i.preview||t.get("smc_preview")||n.preview)&&(e.preview=!0),(e.iecbust||e.preview)&&f(u,e)),r&&r.protectedEndpoints&&(o=!1,r.protectedEndpoints.every(function(n){return n&&u.url&&u.url.toLowerCase().indexOf(n.toLowerCase())>-1?(o=!0,!1):!0}),o&&(e={},e.iecbust=(new Date).getTime(),f(u,e))),u},u}])}(angular.module(portalCommon)),function(n){n.filter("icon",[function(){return function(n){return typeof n=="string"&&(n.indexOf("0x")===-1&&(n="0x"+n),n=String.fromCharCode(n)),n}}])}(angular.module(portalCommon)),function(n){n.directive("loadingSpinner",["$rootScope","$timeout",function(n,t){return{restrict:"A",templateUrl:"/PartialViews/Common/LoadingSpinner.html",scope:{content:"=",deferred:"="},link:function(i,r,u){function s(){u.timeout&&(e=t(c,u.timeout));u.delay?o=t(h,u.delay):i.isStarted=!0;u.type==="bar"?l():a()}function h(){i.isStarted=!0}function c(){u.message&&(n.$broadcast(u.message,i.content),n.$broadcast("QoS",{operation:"/app/"+u.message}))}function l(){i.barClasses["indeterminate-bar"]=!0;i.indicatorClasses["indeterminate-indicator"]=!0;i.isBar=!0}function a(){i.progressClasses.ring=!0;i.indicatorClasses["indeterminate-ring"]=!0;u.size==="small"||(u.size==="large"?(i.indicatorClasses["indeterminate-large"]=!0,i.progressClasses["ring-large"]=!0):(i.indicatorClasses["indeterminate-medium"]=!0,i.progressClasses["ring-medium"]=!0))}function f(){e&&(t.cancel(e),e=null);o&&(t.cancel(o),o=null);i.isStarted=!1}i.isStarted=!1;i.progressClasses={};i.barClasses={};i.indicatorClasses={};i.isBar=!1;var e,o;i.$watch("deferred",function(){i.deferred&&i.deferred.then&&(f(),s(),i.deferred.then(f,f))});i.$on("$destroy",f);r.on("$destroy",f);u.deferred||s()}}}])}(angular.module(portalCommon)),function(n){n.service("localStorageService",["$window","$log","clientConfig","currentLanguageService",function(n,t,i,r){var f="cacheConfigKey",u=n&&n.navigator&&n.navigator.cookieEnabled&&n.localStorage,e,o;try{n.localStorage.setItem("storageTest","");n.localStorage.removeItem("storageTest","")}catch(s){u=!1}u||t.error("Local storage not supported");e=function(){var n={};return n.language=r.getLang().toLowerCase(),i&&i.SiteContentConfig&&i.SiteContentConfig.BuildVersion&&(n.buildVersion=i.SiteContentConfig.BuildVersion),n};o=function(){var t,r,i;if(u&&n.localStorage[f]){t=JSON.parse(n.localStorage[f]);r=e();for(i in t)if(t[i]!=r[i])return!1;return!0}return!1};this.getCacheContent=function(t){if(u&&n.localStorage[t]){if(!o())return this.invalidateCache(),null;var r=JSON.parse(n.localStorage[t]),f=(new Date).getTime()-new Date(r.timestamp);return!r.noExpiration&&f>i.SiteContentConfig.ClientCompassCacheTimeout?(localStorage.removeItem(t),null):r.data}return null};this.commit=function(t,r){if(u&&i.SiteContentConfig&&i.SiteContentConfig.ClientCompassCachingEnabled&&i.SiteContentConfig.ClientCompassCacheTimeout){var o={data:r,timestamp:(new Date).getTime()};n.localStorage.setItem(f,JSON.stringify(e()));n.localStorage.setItem(t,JSON.stringify(o))}};this.commitWithoutExpiration=function(t,i){if(u){var r={data:i,timestamp:(new Date).getTime(),noExpiration:!0};n.localStorage.setItem(f,JSON.stringify(e()));n.localStorage.setItem(t,JSON.stringify(r))}};this.invalidateCache=function(){var n,r,t;if(u&&i.SiteContentConfig&&i.SiteContentConfig.ClientCompassCachingEnabled&&i.SiteContentConfig.ClientCompassCacheTimeout)for(n=0,r=localStorage.length;n<r;++n)t=localStorage.key(n),t&&t.indexOf("adal")===-1&&localStorage.removeItem(localStorage.getItem(t))}}])}(angular.module(portalCommon)),function(n){n.service("locationService",["$window","$location","$route","$anchorScroll","$rootScope","$timeout",function(n,t,i,r,u,f){this.getQueryStringParameters=function(n){for(var i={},r=n.substring(n.indexOf("?")+1),u=/([^&=]+)=([^&]*)/g,t;t=u.exec(r);)i[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return i};this.getCurrentPath=function(){return t.url().replace(t.hash(),"")};this.setPathAndReload=function(t){n.location=t||this.getCurrentPath()};this.switchLocale=function(n,i){i=i||t.path();var r=i.split("/");return r.length>1&&r[1]!==n?(r[1]=n,r.join("/")):i};this.pathNoReload=function(n){var r=i.current,f=u.$on("$locationChangeSuccess",function(){i.current=r;f()});return t.path(n)};this.scrollTo=function(n,i){f(function(){var i=t.hash();t.hash(n);r();t.hash(i)},i)};this.appendCurrentRouteParams=function(n){var i=t.search(),r;if(Object.keys(i).length>0&&n){(r=n.indexOf("?")<0)?n+="?":r<n.length-1&&(n+="&");for(query in i)n+=query+"="+i[query]+"&";n=n.slice(0,-1)}return n};this.getPathSubset=function(n,i,r){return r=r?r.split("?")[0]:t.path(),r.split("/").slice(n,i).join("/")};this.getPathLength=function(n){n||(n=t.path());var i=n[0]==="/"?1:0,r=n[n.length-1]==="/"?-1:undefined;return n.split("/").slice(i,r).length};this.getReferrerDomain=function(){var t=/\/\/(.*?)(\/|$|\?)/;return n.document.referrer&&t.test(n.document.referrer)?n.document.referrer.match(t)[1]:null}}])}(angular.module(portalCommon)),function(n){n.service("osService",["$window",function(n){var i,r={"Windows 2000":["Windows NT 5.0"],"Windows XP":["Windows NT 5.1"],"Windows 2003":["Windows NT 5.2"],"Windows Vista":["Windows NT 6.0"],"Windows 7":["Windows NT 6.1","Windows 7"],"Windows 8":["Windows NT 6.2","Windows 8"],"Windows 8.1":["Windows NT 6.3","Windows 8"],"Windows 10":["Windows NT 10"],Mac:["Mac"],X11:["Unix"],Linux:["Linux"],"Windows 10 Mobile":["Windows Phone 10"],"Windows 8.1 Mobile":["Windows Phone 8","Windows Phone 8.1"]},t={Android:function(){return n.navigator.userAgent.match(/Android/i)},BlackBerry:function(){return n.navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return n.navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return n.navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return n.navigator.userAgent.match(/IEMobile/i)},Other:function(){return n.navigator.userAgent.indexOf("Mobi")>=0},any:function(){return t.Android()||t.BlackBerry()||t.iOS()||t.Opera()||t.Windows()||t.Other()}};this.getOS=function(){return i};this.isMobile=function(){return!!t.any()};this.determineOS=function(){var f=n.navigator.platform,u=n.navigator.userAgent,t,i;for(t in r)if(i=r[t].filter(function(n){return u.indexOf(n)>-1}),i.length)return t;return"Other"};this.isWindows=function(){return n.navigator.platform.indexOf("Win")>=0};this.is64bitWindows=function(){return n.navigator.userAgent.indexOf("WOW64")>-1||n.navigator.platform=="Win64"};i=this.determineOS();this.isCorsEnabled=function(){return n.navigator.userAgent.indexOf("MSIE 8.0")>-1||n.navigator.userAgent.indexOf("MSIE 9.0")>-1?!1:!0}}])}(angular.module(portalCommon)),function(n){n.directive("scrollTo",["$location","$anchorScroll","$log","$timeout",function(n,t,i,r){return{restrict:"A",link:function(i,u,f){u.bind("click",function(){r(function(){f&&f.location&&(n.hash(f.location),t())})})}}}])}(angular.module(portalCommon)),function(n){n.directive("searchableDropdown",["$timeout",function(n){return{restrict:"AE",scope:{items:"=",prompt:"@",display:"@",modelObject:"=",onSelect:"&",preserveInput:"=?",resetOnClear:"=?"},templateUrl:"/PartialViews/Common/SearchableDropdownTemplate.html",link:function(t){t.setCurrent=function(n){t.current=n};t.onItemSelected=function(i){t.model=i[t.display];t.modelObject=i;t.current=0;t.selected=!0;n(function(){t.onSelect();t.preserveInput&&t.preserveInput===!0||(t.model=null)})};t.actionOnKeyDown=function(n){if(n.keyCode==38&&t.current>0)t.current--;else if(n.keyCode==40&&t.current<t.filtered.length-1)t.current++;else if(n.keyCode==13)t.onItemSelected(t.filtered[t.current])};t.$watch("modelObject",function(n){t.selected&&t.modelObject==n||(t.current=0,t.selected=!1)});t.preserveInput&&t.preserveInput===!0&&(t.preserveInput&&t.preserveInput===!0&&t.modelObject&&(t.model=t.modelObject[t.display],t.selected=!0),t.resetOnClear&&t.resetOnClear===!0&&t.$watch("model",function(){t.model||(t.modelObject="",t.current=0,t.onSelect())}))}}}])}(angular.module(portalCommon)),function(n){n.service("sessionStorageService",["$window","$log",function(n,t){var i=!1;try{i=n&&n.sessionStorage;n.sessionStorage.setItem("storageTest","");n.sessionStorage.removeItem("storageTest","")}catch(r){i=!1}i||t.error("Local storage not supported");this.get=function(t){return i&&n.sessionStorage.getItem(t)?JSON.parse(n.sessionStorage.getItem(t)):null};this.set=function(t,r){i&&n.sessionStorage.setItem(t,JSON.stringify(r))}}])}(angular.module(portalCommon)),function(n){n.directive("asset",["$compile","$location","$document","$filter","assetService",function(n,t,i,r,u){return{restrict:"A",transclude:!0,scope:{asset:"=",preview:"=?",assetObjectToPreview:"="},link:function(t,i,f){function e(){var e,o,l,a;if(t.data&&t.data.details){t.assetId=t.data.details.id?t.data.details.id:0;switch(t.data.details.assetType){case"image":var s="",h="",c=0,u=null;if(f.props){t.props=JSON.parse(f.props);switch(t.props.size){case"half":h="width:50%;";break;case"quarter":h="width:25%;"}switch(t.props.float){case"right":s="pull-right";break;case"left":s="pull-left"}switch(t.props.padding){case"small":c=10;break;case"medium":c=20}t.props.link&&(e=t.props.link,e.article&&e.article.details&&e.article.details.type&&e.article.details.id?u='<a managed-link href="" data-content-type="'+e.article.details.type+'" data-content-id="'+e.article.details.id:e.target&&(u='<a managed-link href="'+e.target),u&&e.newWindow&&(u=u+'" target="_blank'),u=u?u+'">':null)}o="";l="";s&&s!="none"&&(o+='<div style="overflow: hidden">',l+="<\/div>");a=t.data.altText||t.data.details.title||"";o+='<div style="'+h+';" class="imageAsset '+s+'">';o+='<img style="padding:'+c+'px;" src="'+t.data.fileUrl+'" alt="'+a+'" />';t.data.details.published||(o+='<div class="caption" ng-include=\'"/PartialViews/Asset/ImagePreview.html"\'><\/div>',o+="<\/div>");o+=l;t.content=o;u&&(t.content=u+t.content+"<\/a>");break;case"video":t.data&&t.data.url&&(t.content='<div class="responsive-iframe-16-9"><iframe src="'+t.data.url+'" frameborder="0" allowfullscreen="true"><\/iframe><\/div>');break;case"sideNav":t.content="<side-nav-render links='data.links'><\/side-nav-render>";break;case"htmlSnippet":t.content='<div content-section-list="data.renderHtml"><\/div>';break;case"inlineContent":i.html(t.data.renderHtml);break;case"imageTextBlock":t.content="<div ng-include=\"'/PartialViews/Asset/ImageTextBlock.html'\"><\/div>";break;case"faq":t.content="<div ng-include=\"'/PartialViews/Asset/Faq.html'\"><\/div>";t.faq={showAllIsActive:!0,links:angular.copy(t.data.links)};t.updateExpandAll=function(n){n.isCollapsed=!n.isCollapsed;t.faq.showAllIsActive=r("filter")(t.faq.links,{isCollapsed:!0}).length>0};t.showOrHideAll=function(){angular.forEach(t.faq.links,function(n){n.isCollapsed=!t.faq.showAllIsActive});t.faq.showAllIsActive=!t.faq.showAllIsActive};break;case"contentIndex":t.content="<side-nav-render links='data.links'><\/side-nav-render>"}i.html(t.content);n(i.contents())(t)}}t.data={details:null};t.$watch("asset",function(){t.asset&&!t.assetObjectToPreview&&u.getAsset(t.asset).then(function(n){t.data=n.data;e()},function(){i.html("Asset not found")})});t.$watch("assetObjectToPreview",function(){t.data=t.assetObjectToPreview;e()},!0)}}}])}(angular.module(portalCommon)),function(n){n.service("assetService",["$rootScope","$injector","$cookies","$q","contentApiService","flightService","clientConfig",function(n,t,i,r,u,f,e){var o={},h=this,s=n.preview?null:t.get("authService"),c=f.isUserInFlight("aad-1");this.getAsset=function(n){if(o&&o[n])return o[n];if((e.InternalContentConfig&&e.InternalContentConfig.AllowInternalContent||i.get("smc_preview"))&&s&&c){var t=r.defer();return s.resolveAuthState().then(function(){t.resolve(h.getAssetPormise(n))}),t.promise}return this.getAssetPormise(n)};this.getAssetPormise=function(n){var t=u.getAsset(n);return o[n]=t,t}}])}(angular.module(portalCommon)),function(n){n.filter("compassFormat",["languageService",function(n){return function(t,i){var r=t,u,f;if(r=r&&r.replace(/{lang-locale}/g,n.langLocale()),!r||!angular.isObject(i))return r;for(u in i)while(r.indexOf("{"+u+"}")>=0)f=new RegExp("\\{"+u+"\\}","g"),(i[u]===null||i[u]===undefined)&&(r=r.replace(f,"")),r=r.replace(f,i[u]);return r}}])}(angular.module(portalCommon)),function(n){n.service("compassService",["$q","$log","$rootScope","$cookies","contentApiService","currentLanguageService","clientConfig","localStorageService","locationService",function(n,t,i,r,u,f,e,o){function a(n){var t=h(n);return t||h("commercial"),t}function h(n,t){return t&&s&&s[n]&&s[n][t]?s[n][t]:!t&&s&&s[n]?s[n]:null}function c(n,t){var r;return v[n]?r=v[n]:(r=n!="allproducts/"&&n.indexOf("products/")>-1?u.getCompassContentForProductPages(n):u.getCompassContentForPage(n),v[n]=r,r.then(function(n){if(n){if(n.data){if(t)t(n.data);else for(var r in n.data)s[r]=n.data[r];o.commit(b(),s)}i.$broadcast("CompassContentReady")}else i.$broadcast("500Error",{reason:"Failed to load compass content",response:n})},function(n){n&&n.status&&n.status==404&&i.$broadcast("404Error",{reason:"Compass content not found",response:n})})["finally"](function(){v[n]&&(v[n]=null)})),r}function b(){return w.compassContentKey}function g(t){return s[t.key]?n.when(s[t.key]):c(t.url).then(function(n){return n.data[t.key]})}var s={},v={},w={compassContentKey:"CompassContent",contentNodes:[{condition:"",key:"search",url:""},{condition:"menu",key:"menus",url:"menu/"},{condition:"contactus",key:"landingPage",url:"contactus/"},{condition:"chat",key:"chat",url:"menu/"},{condition:"callback",key:"callback",url:"menu/"},{condition:"schedulecallback",key:"callback",url:"menu/"},{condition:"form",key:"form",url:"menu/"},{condition:"allproducts",key:"allProducts",url:"allproducts/"},{condition:"products",key:"productHubPage",url:"products/"},{condition:"search",key:"searchResults",url:"searchresults/"},{condition:"enterprise",key:"menus",url:"menu/"},{condition:"partner",key:"menus",url:"menu/"},{condition:"rat-phone",key:"menus",url:"menu/"},{condition:"commercial",key:"commercial",url:"commercial/"},{condition:"premier",key:"commercial",url:"commercial/"},{condition:"devices",key:"devices",url:"devices/"},{condition:"kinectadapter",key:"devices",url:"kinectadapter/"},{condition:"virtual-agent",key:"virtualAgent",url:"virtual-agent/"},{condition:"lifecycle",key:"lifecycle",url:"lifecycle/"},{condition:"answerdesk",key:"answerdesk",url:"answerdesk/"},{condition:"enterpriseanswerdesk",key:"enterpriseanswerdesk",url:"enterpriseanswerdesk/"},{condition:"enterpriseanswerdeskv2",key:"enterpriseanswerdesk",url:"enterpriseanswerdeskv2/"},{condition:"verifyme",key:"verifyme",url:"verifyme/"}]},y="productMenus",l="productHubPages",p="contactus",k="answerdesk",d="enterpriseanswerdesk";this.getContentNodes=function(){return w.contentNodes};this.clearCache=function(){s={};v={};o.invalidateCache()};this.fetchContent=function(n){var o,h,e,u;for(r.get("smc_preview")&&(t.info("Preview mode: cache wiped for new fetch"),this.clearCache()),o=f.getLang(),pathParts=n.split("/"),o&&pathParts[0].toUpperCase()===o.toUpperCase()&&pathParts.shift(),h="",h=n.indexOf("products/")>-1?n:pathParts&&pathParts.length>=1?pathParts[0]:null,e=0;e<w.contentNodes.length;e++)if(u=w.contentNodes[e],u&&h===u.condition){s&&s[u.key]?(t.info("Cache hit for node",u),i.$broadcast("CompassContentReady")):(t.info("fetchContent internalFetch:"+n),c(u.url));break}s&&s.search||c("")};this.getContent=function(n){return h(n)};this.getPageInfo=function(){return h("basePage")};this.getMenu=function(t){return h("menus",t)?n.resolve(h("menus",t)):c("menu").then(function(){return h("menus",t)})};this.getContactUsHeader=function(){return s.contactUsHeader?n.resolve(s.contactUsHeader):c(p).then(function(n){return n.data.contactUsHeader})};this.getVirtualAgent=function(){return g({key:"virtualAgent",url:"virtual-agent/"})};this.getVirtualAgentEntry=function(){return s&&s.virtualAgentEntry};this.getAccessibilityView=function(){return s.accessibilityView?n.when(s.accessibilityView):c(k).then(function(n){return n.data.accessibilityView})};this.getEnterpriseAccessibilityView=function(){return s.enterpriseAccessibilityView?n.resolve(s.enterpriseAccessibilityView):c(d).then(function(n){return n.data.enterpriseAccessibilityView})};this.getEnterpriseAccessibilityV2View=function(){return s.enterpriseAccessibilityV2View?n.resolve(s.enterpriseAccessibilityV2View):c("enterpriseanswerdeskv2").then(function(n){return n.data.enterpriseAccessibilityV2View})};this.getHoursOfOperationView=function(){return s.hoursOfOperationView?n.resolve(s.hoursOfOperationView):c(p).then(function(n){return n.data.hoursOfOperationView})};this.getMLProblemClassificationSupportedLocales=function(){return s.mLProblemClassificationSupportedLocales?n.resolve(s.mLProblemClassificationSupportedLocales):c(p).then(function(n){return n.data.mLProblemClassificationSupportedLocales})};this.getContactUsView=function(){return s.contactUsView?n.resolve(s.contactUsView):c(p).then(function(n){return n.data.contactUsView})};this.getContactUsProducts=function(){return s.landingPage?n.resolve(s.landingPage):c(p).then(function(n){return n.data.landingPage})};this.getContactUsMenu=function(t){if(t==="contactus/")return this.getContactUsProducts();var i=h(y,t);return i?n.resolve(i):c(t,function(n){var t=n[y];s[y]||(s[y]={});for(contactusProductPage in t)s[y][contactusProductPage]=t[contactusProductPage]}).then(function(){return h(y,t)})};this.getContactUsMenuLinks=function(n){return this.getContactUsMenu(n).then(function(n){return n.links&&n.links.length>0?n.links:null})};this.getMenuExtras=function(){var n=h("menuExtras");return n&&n.menuExtras?{icon:n.menuExtraIcon,extras:n.menuExtras.links}:null};this.getPageSubjectId=function(n){var t=n&&n.subjectId,r,i,u;if(t&&t>=0)return t;for(r=0;r<n.links.length;r++)if(i=n.links[r].link.linkUrl,(i.indexOf("/chat/")>-1||i.indexOf("/callback/")>-1||i.indexOf("/phone/")>-1||i.indexOf("/form/")>-1)&&(u=i.split("/"),u.length>=3&&u[2]!=="{subject-id}")){if(t=parseInt(u[2],10),isNaN(t))continue;return t}return undefined};this.getMenuOptionsForId=function(n){return this.getMenu().then(function(t){var i,r;if(t)for(r in t)if(i=t[r],i.hasModality&&this.getPageSubjectId(i)===n)return i.links;return null}.bind(this))};this.getChat=function(){return h("chat")};this.getChatSurvey=function(){return h("chat","survey")};this.getCallback=function(){return h("callback")};this.getWaitTimeText=function(){return this.getContactUsView().then(function(n){return n&&{singular:n.waitTimeSingular,plural:n.waitTimePlural,connecting:n.connectingWait}})};this.getSupportedLocales=function(){return h("callback","supportedLocales")};this.getUnauthForm=function(){return h("form")};this.getServiceAgreement=function(){var n=h("serviceAgreement"),t=h("serviceAgreementLink");return n&&t?{serviceAgreement:n,serviceAgreementLink:t}:null};this.getComingSoon=function(){return h("comingSoon")};this.getContactHeader=function(){return h("contactHeader")};this.getStepConfig=function(){return h("stepListConfig")};this.getContactSupportIcon=function(){return h("contactSupportIcon")};this.getPasscode=function(){return h("passcode")};this.getMicrosoftLogo=function(){return h("microsoftLogo")};this.getMicrosoftLogoAlt=function(){return h("microsoftLogoAlt")};this.getNavigationInterrupted=function(){return h("navigationInterrupted")};this.getSearchView=function(){return h("search")};this.getSearchResultsView=function(){return h("searchResults")};this.getProductView=function(){return h("products")};this.getProductHubPage=function(){return h("products")};this.getProductsMasterList=function(){return h("productsMasterList")};this.getDevicesView=function(){return h("devicesView")};this.getlifecycleHomepageView=function(){return s.lifecycleHomepageView?n.when(s.lifecycleHomepageView):c("lifecycle").then(function(n){return n.data.lifecycleHomepageView})};this.getlifecycleSearchPageView=function(){return s.lifecycleSearchPageView?n.when(s.lifecycleSearchPageView):c("lifecycle").then(function(n){return n.data.lifecycleSearchPageView})};this.getVerifyMePageView=function(){return s.verifymePageView?n.when(s.verifymePageView):c("verifyme").then(function(n){return n.data.verifymePageView})};this.getOrdersView=function(){return h("ordersView")};this.getDeviceRegistrationView=function(){return h("deviceRegistrationView")};this.getLinkFarm=function(){return h("linkFarm")};this.getCommercialHubView=function(){return a("commercialHub")};this.getCommercialIncidentsHub=function(){return a("commercialIncidentsHub")};this.getCreateIncidentsHub=function(){return a("createIncidentsHub")};this.getIncidentDetailHub=function(){return a("incidentDetailHub")};this.getPremierHomeView=function(){return a("premierHomepage")};this.getPremierHomeView2=function(){return a("premierHomepage2")};this.getManageAccountHub=function(){return a("manageAccountHub")};this.getCommercialContactsHub=function(){return a("commercialContactsHub")};this.getBackText=function(){return h("basePage","contactSupportBack")};this.getCloseText=function(){return h("basePage","contactSupportClose")};this.getLanguageSelectorTitle=function(){return h("basePage","languageSelectorTitle")};this.getLanguages=function(){return h("basePage","languages")?n.resolve(h("basePage","languages")):c("").then(function(){return h("basePage","languages")})};this.getFeedbackCtrl=function(){return h("basePage","feedback")};this.getF1Footer=function(){return h("basePage","f1Footer")};this.getSelfhostFeedback=function(){return h("basePage","selfHostFeedbackView")};this.getOfflineMessage=function(){return h("basePage","offlineMessage")};this.getNotificationBanner=function(){return h("basePage","notificationBanner")};this.getNotificationBannersList=function(){return h("basePage","notificationBannersList")};this.getAllProducts=function(){return h("allProducts")};this.getProductPage=function(){return h("productHubPage")};this.getProductPageCommonView=function(){return h("productPagesCommonView")};this.getProductDetails=function(n){var u=langLocale="/"+f.getLang().toLowerCase()+"/"+n,t=h(l,n),r=!1;return t?r=!0:(t=h(l,u),t?r=!0:(r=!1,c(n,function(t){var i=t[l],u;s[l]||(s[l]={});for(ProductHubPage in i)u={ProductHubPages:i[ProductHubPage],ProductCommonView:t.productPagesCommonView},s[l][ProductHubPage]=u,n==ProductHubPage&&(r=!0)}))),s[l]&&Object.keys(s[l]).length>1&&!r&&t!==null&&i.$broadcast("404Error",{reason:"Compass content not found",response:"404 Error - Compass Content Not Found"}),t};this.getFrePage=function(t){var i=n.defer();return s&&s.fre&&s.fre[t]?i.resolve(s.fre[t]):c("fre/"+t).then(function(n){s.fre=s.fre||{};s.fre[t]=n.data;i.resolve(n.data)},function(n){i.reject(n)}),i.promise};this.getContentSurvey=function(){return h("contentView","contentSurvey")};this.getContentProperties=function(){return h("contentView","contentProperties")};this.getContentProductPicker=function(){return h("contentView","contentProductPicker")};this.getContentMediaWidget=function(){return h("contentView","contentMediaWidget")};this.getKbReferenceText=function(){return h("contentView","kbReference")};this.getMachineTranslation=function(){return h("contentView","machineTranslation")};this.getProductList=function(){var t=n.defer();return s.productsInformation&&s.productsInformation.products?t.resolve(s.productsInformation.products):c("productsConfig").then(function(n){n&&n.data&&n.data.productsInformation&&n.data.productsInformation.products?t.resolve(n.data.productsInformation.products):t.reject("Products missing from compass config")}),t.promise};this.getProduct=function(t){var i=n.defer();return this.getProductList().then(function(n){var r=n.filter(function(n){return n&&n.ecoId==t});r.length==1?i.resolve(r[0]):i.reject("Product not found")}),i.promise};this.getLocaleMapping=function(){var t=n.defer();return s.mappingRules?t.resolve(s.mappingRules):c("localeMapping").then(function(n){n&&n.data&&n.data.mappingRules?t.resolve(n.data.mappingRules):t.reject("Locale mappings list not found")}),t.promise};this.getCollapsibleContentProperties=function(){return h("contentView","collapsibleContentProperties")};this.getInternalContentProperties=function(){return h("contentView","internalContentProperties")};this.getKbBanners=function(){return h("contentView","kbBanners")};this.getContentIframe=function(){return h("contentView","contentIframe")};s=e.SiteContentConfig&&e.SiteContentConfig.ClientCompassCachingEnabled&&e.SiteContentConfig.ClientCompassCacheTimeout?o.getCacheContent(b())||{}:{}}])}(angular.module(portalCommon)),function(n){n.service("contentApiService",["$rootScope","$http","$cookies","$routeParams","clientConfig","$q","$rootScope","currentLanguageService",function(n,t,i,r,u,f,n,e){var h={},s=typeof microsoft!="undefined"&&microsoft.support&&microsoft.support.prefetchedArticle;s&&s.details.id&&s.details.locale&&(h[s.details.locale+"/"+s.details.id]=s);var c="/api/content/",o=function(n,i){var u=c+n,r={httpAppOptions:{cacheBust:!0,allowPreview:!0}};return i?angular.extend(i,r):i=r,t.get(u,i)},l=function(n,i,r){var f=n+i,u={httpAppOptions:{cacheBust:!0,allowPreview:!0}};return r?angular.extend(r,u):r=u,t.get(f,r)};this.getAgentById=function(n){return o("GetAgent/"+n)};this.getCompassContentForPage=function(n){return o("GetCompassContentForPage/"+n)};this.getCompassContentForProductPages=function(n){return o("GetCompassContentForProductPages/"+n)};this.getKbArticle=function(n,t){var r="kb/"+n,i=null;return t!=null&&t.kbPreview!=null&&t.kbPreview==="true"&&(i={kbPreview:!0}),o(r,i).then(function(n){return{kbArticle:n.data,noIndex:n.headers("x-kb-noindex")}},function(n){return f.reject(n)})};this.getGwtArticle=function(n){return o("Gwt/"+n)};this.getGenericArticle=function(n){return o("Article/"+n)};this.getHelpArticle=function(n,t){var i=h[t+"/"+n];return i?f.when(i):o("Help/"+n).then(function(n){var t=n.data;return t&&t.details.locale&&t.details.id&&(h[t.details.locale+"/"+t.details.id]=t),t})};this.getInstantAnswer=function(n){return o("InstantAnswers/"+n)};this.getAsset=function(n){return u.AuthoringConfig&&u.AuthoringConfig.PreviewAssetApi?l("/authoring/api/content/","asset/"+n+"/"+e.getLang().toLowerCase(),null):o("Asset/"+n)};this.getOneSiteResources=function(){return u&&u.SiteContentConfig&&u.SiteContentConfig.OneSiteEnabled?o("OneSite"):null};this.getDevices=function(){return o("devices/")}}])}(angular.module(portalCommon)),function(n){n.directive("contentNotice",["compassService","$routeParams","$location",function(n){return{scope:{},templateUrl:"/PartialViews/Content/ContentNotice.html",link:function(t){var i=function(){var i=n.getContentIframe();i&&(t.logo=i.iframeNoticeIcon.url,t.notice=i.iframeNoticeText)};t.$on("CompassContentReady",function(){i()});i()}}}])}(angular.module(portalCommon)),function(n){n.directive("contentProperties",["$filter","compassService","productsService","flightService",function(n,t,i,r){return{restrict:"A",templateUrl:"/PartialViews/Content/contentProperties.html",scope:{},link:function(u,f,e){var s=function(){var n=t.getContentProperties();n&&(u.contentProperties=n)},o;u.$on("CompassContentReady",function(){s()});s();u.articleId=e.articleId;u.lastModified=n("date")(e.lastModified);u.revision=e.revision;u.products=e.products?JSON.parse(e.products):[];u.keywords=e.keywords?JSON.parse(e.keywords):null;u.appliesTo=e.appliesTo?JSON.parse(e.appliesTo):[];u.products.length>0&&(r.isUserInFlight("shps-1")?(o=u.products.filter(Number).join().trim(),o&&i.getProductList(o).then(function(n){for(var t,i=0;i<u.products.length;i++)for(t=0;t<n.length;t++)u.products[i]==n[t].gdsId&&u.appliesTo.push(n[t].name)})):angular.forEach(u.products,function(n){t.getProduct(n).then(function(n){u.appliesTo.push(n.name)})}))}}}])}(angular.module(portalCommon)),function(n){n.directive("contentSection",["compassService","productsService","flightService",function(n,t,i){return{restrict:"A",scope:{contentSection:"="},templateUrl:"/PartialViews/Content/Section.html",link:function(r){function e(){r.internalProperties=n.getInternalContentProperties()}var f=i.isUserInFlight("shps-1"),u;r.contentSection&&r.contentSection.meta&&r.contentSection.meta.products&&r.contentSection.meta.products.length>0&&(f?(u=r.contentSection.meta.products.filter(Number).join().trim(),u&&t.getProductList(u).then(function(n){r.products=n})):n.getProductList().then(function(n){r.products=n.filter(function(n){for(var t=0;t<r.contentSection.meta.products.length;t++)if(n&&n.ecoId===r.contentSection.meta.products[t])return!0;return!1})}));r.applicableProducts=function(){var t=[],n;if(r.products)for(n=0;n<r.products.length;n++)r.products[n].name&&t.push(f?r.products[n].gdsId:r.products[n].ecoId);return t};r.getStyleClass=function(){var n=[];if(r.contentSection&&r.contentSection.meta)switch(r.contentSection.meta.type){case"single-column":n=["col-xs-24"];break;case"two-column":n=["col-sm-24 col-md-12"];break;case"three-column":n=["col-sm-24 col-md-8"];break;case"four-column":n=["col-sm-24 col-md-6"]}return n};r.isInternalSection=function(){return r.contentSection&&r.contentSection.meta&&(r.contentSection.meta.isInternalContent===!0||r.contentSection.meta.isInternalContent==="true")};r.$on("CompassContentReady",function(){e()});e()}}}])}(angular.module(portalCommon)),function(n){n.directive("contentSectionList",[function(){return{restrict:"A",templateUrl:"/PartialViews/Content/SectionList.html",scope:{contentSectionList:"="},link:function(n){typeof n.contentSectionList=="string"&&(n.isString=!0)}}}])}(angular.module(portalCommon)),function(n){n.component("internalContent",{templateUrl:"/PartialViews/Content/InternalContent.html",controller:["$rootScope","compassService",function(n,t){function i(){r.internalProperties=t.getInternalContentProperties()}var r=this;n.$on("CompassContentReady",i);i()}],controllerAs:"ic"})}(angular.module(portalCommon)),function(n){n.component("kbBanners",{templateUrl:"/PartialViews/Content/KbBanners.html",bindings:{products:"<"},controller:["$rootScope","compassService",function(n,t){function r(){i.kbBanners===null&&(i.kbBanners=t.getKbBanners(),i.kbBanners&&u())}function u(){for(var r,t,u,n=0;n<i.kbBanners.length;n++){r=i.kbBanners[n];t:for(t=0;t<i.products.length;t++)if(u=i.products[t],r.appliesTo.some(function(n){return f(n,u)})){i.articleBanners.push(r.banner);break t}}}function f(n,t){return t.gdsId==n.ecoId||t.parentId==n.ecoId||n.directChildren.length>0&&(n.directChildren.split(",").indexOf(t.gdsId)>=0||n.directChildren.split(",").indexOf(t.parentId)>=0)}var i=this;i.kbBanners=null;i.articleBanners=[];n.$on("CompassContentReady",r);r()}],controllerAs:"kbb"})}(angular.module(portalCommon)),function(n){n.directive("managedLink",["compassService","languageService","locationService",function(n,t,i){return{restrict:"A",link:function(r,u,f){function e(n,t,i){var u=t,f,r;for(f in i)if(r=i[f],n&&n.indexOf(r.domain)>=0){u=r.outgoingLocales[t]||t;break}return u}function o(){var s,r,o;if(f.contentType&&f.contentId){s=null;switch(f.contentType){case"gwt":s="/help/"+f.contentId;break;case"article":s="/help/"+f.contentId}f.bookmarkId&&f.bookmarkId!="undefined"&&(s+="#"+f.bookmarkId);s&&u.attr("href","/"+t.langLocale()+s)}else if(f.bookmarkId&&f.bookmarkId!="undefined")u.on("click",function(n){i.scrollTo(f.bookmarkId);n.preventDefault()});else f.href?(r=u.attr("href"),r&&r.indexOf("{lang-locale}")>=0&&(o=t.langLocale(),u.addClass("disabled"),n.getLocaleMapping().then(function(n){o=e(r,o,n);u.attr("href",r.replace(/{lang-locale}/g,o));u.removeClass("disabled")})),u.attr("target")||u.attr("target","_self")):f.link&&(r=f.link,r&&r.indexOf("{lang-locale}")>=0&&(o=t.langLocale(),u.addClass("disabled"),n.getLocaleMapping().then(function(n){o=e(r,o,n);u.attr("href",r.replace(/{lang-locale}/g,o));u.removeClass("disabled")})),f.chat&&f.chat=="true"&&u.click(function(){var n=f.link;window.open(n,"contactSupport","width=420,height=630,scrollbars=yes,resize=yes",!0)}))}o()}}}])}(angular.module(portalCommon)),function(n){n.directive("mediaWidget",["$rootScope","$location","compassService","$filter",function(n,t,i,r){return{restrict:"A",templateUrl:"/PartialViews/Content/MediaWidget.html",scope:{title:"@"},link:function(u,f,e){function s(){u.emailHref=r("compassFormat")(o,{url:u.url,title:u.title})}function h(){var t=i.getContentMediaWidget(),n;t&&(n=t,o="mailto:?subject="+n.emailTitle+"&body="+n.emailBody,u.emailHref=r("compassFormat")(o,{url:u.url,title:u.title}),u.emailCaption=n.emailCaption,u.printCaption=n.printCaption)}n.$broadcast("UpdateTitle",u.title);u.printCaption=e.printCaption;u.emailCaption=e.emailCaption;u.url=t.absUrl();var o="mailto:?subject="+e.emailTitle+"&body="+e.emailBody;s();e.title&&e.$observe("title",function(){u.title=e.title;n.$broadcast("UpdateTitle",u.title);s()});e.emailTitle&&e.emailBody&&e.emailCaption&&e.printCaption||(h(),u.$on("CompassContentReady",function(){h()}))}}}])}(angular.module(portalCommon)),function(n){n.directive("productPicker",["assetService","compassService","osService","$location","productsService","flightService",function(n,t,i,r,u,f){return{restrict:"A",templateUrl:"/PartialViews/Content/ProductPicker.html",scope:{productPicker:"=",articleSections:"=?"},link:function(n){function s(){var i=t.getContentProductPicker();i&&(n.productPickerStrings=i)}var e,o;n.os=i.getOS();switch(n.os){case"Windows XP":n.thisPc="1173";case"Windows 7":n.thisPc="14019";break;case"Windows 8":case"Windows 8.1":n.thisPc="17655";break;case"Windows 10":n.thisPc="18474"}n.productPickerStrings=t.getContentProductPicker();n.hasPicker=function(){var t=$(".content-article [applies-to-products]");return t.filter(":not([applies-to-products='[]'])").length>0&&n.productPicker.length>0};n.$on("CompassContentReady",function(){s()});n.products=[];n.selectedProduct=null;f.isUserInFlight("shps-1")?(e=n.productPicker.filter(Number).join().trim(),e&&u.getProductList(e).then(function(t){angular.forEach(t,function(t){n.products.push({id:t.gdsId,name:t.name})})})):angular.forEach(n.productPicker,function(i){t.getProduct(i).then(function(t){n.products.push({id:t.ecoId,name:t.name})})});o=r.hash();o&&angular.forEach(n.articleSections,function(t){t.meta.id&&t.meta.id===o&&t.meta.products&&t.meta.products.length>0&&(n.selectedProduct=$.inArray(t.meta.products[0],n.products)?t.meta.products[0]:null)});n.selectedProduct===null&&$.inArray(n.thisPC,n.products)&&(n.selectedProduct=n.thisPc);n.$watchCollection(function(){return $(".content-article [applies-to-products]").filter(":not([applies-to-products*='"+n.selectedProduct+"'])").filter(":not([applies-to-products='[]'])")||n.selectedProduct},function(t,i){if($("[applies-to-products]").show(),t!=i&&n.selectedProduct){var r=$(".content-article [applies-to-products]"),u=r.filter(":not([applies-to-products*='"+n.selectedProduct+"'])").filter(":not([applies-to-products='[]'])");r.length!=u.length&&u.hide()}})}}}])}(angular.module(portalCommon)),function(n){n.service("productsService",["$http","$q","$log","sessionStorageService","clientConfig","currentLanguageService",function(n,t,i,r,u,f){function o(n){var t=[];return n&&n.length&&e&&!angular.equals(e,{})&&angular.forEach(n,function(n){n&&e[n.controlType]&&t.push(n)}),t}var e={textArea:!0,textBox:!0};this.getSupportTopics=function(i){var o=f.getLang(),u="supportTopics,"+o+","+i,e=r.get(u);return e?t.when(e):n.get("/api/products/"+i+"/topics",{httpAppOptions:{cacheBust:!0,qosOperation:{name:"ProductsService.GetSupportTopics",description:"Get support topics for a product"}}}).then(function(n){var t=n.data;return r.set(u,t),t})};this.getScopingQuestions=function(i,u){var s,e,a=f.getLang(),h,c,l;return u&&(s=e=u[0].id,u[1]&&(e=u[1].id)),h="scopingQuestions,"+a+","+s+","+e,c=r.get(h),c?t.when(c):(l="/api/products/"+i+"/topics/"+s+"/subtopics/"+e+"/questions",n.get(l,{httpAppOptions:{cacheBust:!0,qosOperation:{name:"ProductsService.GetScopingQuestions",description:"Get support topics for a product"}}}).then(function(n){var t=n.data;return t=o(t),r.set(h,t),t}))};this.getCustomScopingQuestions=function(i){var c=f.getLang(),e="customScopingQuestions,"+c+","+i,s=r.get(e),l,h;return s?t.when(s):(l=u.ProductsServiceConfig.BaseUrl,h="/api/customsq/"+i,n.get(h,{httpAppOptions:{cacheBust:!0,qosOperation:{name:"ProductsService.GetCustomScopingQuestions",description:"Get custom scoping questions"}}}).then(function(n){var t=n.data;return t=o(t),r.set(e,t),t}))};this.getDiagnosticMetadata=function(i,e){var c=f.getLang(),o="diagnosticMetadata,"+c+","+i+","+e,s=r.get(o),l,h;return s?t.when(s):(l=u.ProductsServiceConfig.BaseUrl,h="/api/products/"+i+"/topics/"+e+"/assets",n.get(h,{httpAppOptions:{cacheBust:!0,qosOperation:{name:"ProductsService.GetDiagnosticMetadata",description:"Get diagnostic metadata"}}}).then(function(n){var t=n.data,i=t&&t.diagnostic;return r.set(o,i),i}))};this.getProductList=function(i){var e=f.getLang(),o="productList,"+e+","+i,s=r.get(o);return s?t.when(s):n.get(u.ProductsServiceConfig.BaseUrl+"/api/"+e+"/products/gds?gdsid="+i,{httpAppOptions:{cacheBust:!0,qosOperation:{name:"ProductsService.GetProductsList",description:"Get products list by Ids"}}}).then(function(n){var t=n.data;return r.set(o,t),t},function(){return t.reject("ProductsService - Unable to retrieve product list")})};this.getAllProducts=function(){var s=f.getLang(),e="allproducts",o=r.get(e);return o?t.when(o):u&&u.ProductsServiceConfig&&u.ProductsServiceConfig.BaseUrl?n.get(u.ProductsServiceConfig.BaseUrl+"/api/"+s+"/products/gds",{httpAppOptions:{cacheBust:!0,qosOperation:{name:"ProductsService.GetAllProducts",description:"Get All known products"}}}).then(function(n){var t=n.data;return t&&t.length>0&&r.set(e,t),t},function(){return t.reject("ProductsService - Unable to retrieve all product list")}):(i.warn("no product service configuration found"),t.when([]))}}])}(angular.module(portalCommon)),function(n){n.component("sideNavRender",{templateUrl:"/PartialViews/Asset/SideNav.html",bindings:{links:"<"},controller:["$location","languageService",function(n,t){function s(n,t){var i=null;switch(t){case"gwt":i="/help/"+n;break;case"article":i="/help/"+n}return i?f+i:null}var u={},o=n.absUrl(),f=t.langLocale(),e,i,r;this.selectedLink={};this.navLinks=[];for(i in this.links)e=angular.copy(this.links[i]),this.navLinks.push(e);angular.forEach(this.navLinks,function(n){n.articleId&&n.articleType&&(n.link=s(n.articleId,n.articleType));n.level===1?u=n.id:n.parentId=u});for(i in this.navLinks)r=null,this.navLinks[i].link.indexOf("{lang-locale}")>=0?r=this.navLinks[i].link.replace(/{lang-locale}/g,f):this.navLinks[i].link.indexOf(this.navLinks[i].articleId)>=0&&(r=this.navLinks[i].link),o.indexOf(r)>=0&&["https://","http://","",null].indexOf(r)===-1&&(this.selectedLink=this.navLinks[i],this.selectedLink.parentId||(this.selectedLink.expandChildId=this.selectedLink.id))}],controllerAs:"nav"})}(angular.module(portalCommon)),function(n){n.directive("faqPanelContent",[function(){return{scope:{panel:"=faqPanelContent"},templateUrl:"/PartialViews/Content/FaqPanel.html",require:"^?faqSection",link:function(n,t,i,r){n.$watch("panel.isOpen",function(){n.panel.class=n.panel.isOpen?"win-icon-ChevronUpSmall":"win-icon-ChevronDownSmall"});n.toggle=function(){n.panel.isOpen=!n.panel.isOpen;r.update()}}}}])}(angular.module(portalCommon)),function(n){n.directive("faqSection",["$filter","compassService",function(n,t){return{restrict:"A",template:'<div class="faq-section"><div class="spacer-12-bottom"><a ng-if="items.length > 1" ng-click="showOrHideAll()" role="button" href=""> {{ allExpanded ? props.hideAllLabel : props.showAllLabel }} <\/a><\/div><div class="faq-panel" ng-repeat="item in items" faq-panel-content="item"><\/div><\/div>',transclude:!0,scope:{},replace:!0,controller:["$scope",function(n){this.update=function(){n.update()}}],link:function(i,r,u,f,e){function o(){i.props=t.getCollapsibleContentProperties()}e(function(n){i.items=[];angular.forEach(n,function(n){var t=angular.element(n).find("[faq-panel-heading]"),r=t.text(),u=angular.element(n).find("[faq-panel-body]").html(),f=t.attr("faq-panel-id");i.items.push({title:r,body:u,panelId:f,isOpen:!1})})});i.update=function(){i.allExpanded=n("filter")(i.items,{isOpen:!1}).length==0};i.showOrHideAll=function(){angular.forEach(i.items,function(n){n.isOpen=!i.allExpanded});i.update()};i.$on("CompassContentReady",function(){o()});o()}}}])}(angular.module(portalCommon)),function(n){n.service("flightService",["$cookies",function(n){var t={flightCookie:"smc_f",flightSeparator:"|"};this.isUserInFlight=function(i,r){var u,f;return n&&typeof n.get(t.flightCookie)=="string"&&(r||typeof i=="string")?(u=n.get(t.flightCookie).toLowerCase(),f=u.split(t.flightSeparator),f.some(function(n){return r?n.match(new RegExp(i)):n.toLowerCase()===i.toLowerCase()})):!1};this.isUserInAnyFlight=function(n){var t=this;return n.some(function(n){return t.isUserInFlight(n)})}}])}(angular.module(portalCommon)),function(n){n.controller("GenericArticleController",["$scope","$routeParams","$location","contentApiService",function(n,t,i,r){n.reset=function(){t.articleId!=null&&r.getGenericArticle(t.articleId,i.search()).then(function(t){n.article=t.data;n.article&&n.article.details&&n.article.details.noIndex&&$rootScope.$broadcast("NoIndex")})};n.reset()}])}(angular.module(portalCommon)),function(n){n.controller("GwtController",["$rootScope","$scope","$location","$routeParams","gwtService",function(n,t,i,r,u){t.reset=function(){r.articleId!=null&&u.getGwtArticle(r.articleId,i.search()).then(function(i){t.article=i.data;t.article&&t.article.details&&t.article.details.noIndex&&n.$broadcast("NoIndex")})};t.reset()}])}(angular.module(portalCommon)),function(n){n.service("gwtService",["contentApiService",function(n){this.getGwtArticle=function(t,i){return n.getGwtArticle(t,i)}}])}(angular.module(portalCommon)),function(n){n.directive("genericArticle",["compassService",function(){return{restrict:"A",templateUrl:"/PartialViews/GenericArticle/Container.html",scope:{article:"=",iframe:"=?"},link:function(n){var t="/PartialViews/GenericArticle/BasicArticle.html";n.getTemplateUrl=function(){if(n.article&&n.article.details&&n.article.details.subType)switch(n.article.details.subType){case"side-nav":return"/PartialViews/GenericArticle/SideNavArticle.html";default:return t}else return t}}}}])}(angular.module(portalCommon)),function(n){n.directive("gwt",[function(){return{restrict:"A",templateUrl:"/PartialViews/Gwt/Container.html",scope:{article:"=",container:"@?",iframe:"=?"},link:function(n){n.article&&n.article.panes&&(n.paneList=[n.article.panes[0]],n.paneContext=[])},controller:["$scope","$timeout","linkTaggingService","$document",function(n,t,i){var r=this;this.appendPane=function(u,f,e){var o=this.getPane(f);o&&(u>0&&u<n.paneList.length&&(n.paneList=n.paneList.slice(0,u),n.paneContext=n.paneContext.slice(0,u-1)),n.paneList.push(o),n.paneContext.push(e),t(function(){var t="step-"+(n.paneContext.length+1)+"-pane-"+f+r.getEndpoint(f);i.tagContainerLinks("[id='"+t+"']","pane-"+f);n.container&&$(n.container).animate({scrollTop:angular.element("[id='"+t+"']").offset().top},"medium")}))};this.getPane=function(t){for(var i=0;i<n.article.panes.length;i++)if(t==n.article.panes[i].id)return n.article.panes[i];return null};this.getEndpoint=function(n){var t=n?r.getPane(n):null;return t?t.isEndpoint&&t.endpoint?"-endpoint:"+t.endpoint:"":""};n.$watch(function(){return n.article&&n.article.panes&&n.article.panes[0]},function(t,i){t!==i&&(n.paneList=[n.article.panes[0]],n.paneContext=[])});n.article.panes&&n.article.panes[0]&&t(function(){var r,t;for(i.tagContainerLinks("#step-1-pane-"+n.article.panes[0].id,"pane-"+n.article.panes[0].id),r=".gwt-all-panes-list #pane-",t=0;t<n.article.panes.length;t++)i.tagContainerLinks(r+(t+1),"pane-"+(t+1))},100)}]}}])}(angular.module(portalCommon)),function(n){n.directive("gwtPane",[function(){return{require:"^gwt",restrict:"A",templateUrl:"/PartialViews/Gwt/Pane.html",transclude:!0,scope:{pane:"=",paneList:"=",paneContext:"=",stepIndex:"=",article:"=",preview:"=?"},link:function(n,t,i,r){n.state={};n.state.selectedAction="";n.actions=[];n.$watchCollection("paneList",function(){var i,t;if(n.stepIndex>=n.paneList.length-1&&(n.state.selectedAction=""),n.pane&&n.pane.actions)for(n.actions=[],i=0;i<n.pane.actions.length;i++)for(t=0;t<n.article.actions.length;t++)n.pane.actions[i]==n.article.actions[t].id&&n.actions.push(n.article.actions[t])});var u=n.preview?"":n.paneContext.slice(0,n.stepIndex).join(".");n.prevContext=u?"-context:"+u:"";n.getEndpoint=r.getEndpoint;n.appendPane=function(t,i,u){currentContext="s"+u+"p"+n.pane.id+"a"+i;r.appendPane(u,t,currentContext)}}}}])}(angular.module(portalCommon)),function(n){n.controller("HelpArticleController",["$rootScope","$scope","$routeParams","$location","compassService","contentApiService","locationService","productsService","flightService","authService","clientConfig","$cookies",function(n,t,i,r,u,f,e,o,s,h,c,l){var v=s.isUserInFlight("aad-1"),y=i.preview||l.get("smc_preview")||n.preview,a;t.reset=function(){function h(n,t){return{name:n,content:t}}t.isGwt=!1;t.isGenericArticle=!1;var c="eADQi",l="XVcnh";i.articleId!=null&&f.getHelpArticle(i.articleId,i.langLocale).then(function(f){var a,v,p,y;t.article=f;switch(t.article.details.type){case"gwt":t.isGwt=!0;break;case"article":t.isGenericArticle=!0}if(t.article&&t.article.details){if((t.article.details.noIndex||i.preview)&&n.$broadcast("NoIndex"),a=[],t.article.details.locale&&a.push(h("contentLocale",t.article.details.locale)),t.article.details.keywords&&(a.push(h("keywords",t.article.details.keywords.join(","))),a.push(h("search.keywords",t.article.details.keywords.join(",")))),t.article.details.description&&(a.push(h("description",t.article.details.description)),a.push(h("search.description",t.article.details.description))),t.article.details.products&&t.article.details.products.length>0)if(v=t.article.details.products.filter(Number).join().trim(),a.push(h("search.products",v)),a.push(h("ms.product",v)),s.isUserInFlight("shps-1"))v&&o.getProductList(v).then(function(i){if(i){t.article.gdsProducts=i;var r=i.map(function(n){return h("search.product",c+n.name+l)});n.$broadcast("AddMetaTags",r)}});else for(p in t.article.details.products)u.getProduct(t.article.details.products[p]).then(function(t){var i=h("search.product",c+t.name+l);n.$broadcast("AddMetaTags",[i])});t.article.details.os&&t.article.details.os.length>0&&(a.push(h("search.ossku",t.article.details.os.join(" "))),a.push(h("search.supportedos",t.article.details.os.join(" "))));a.push(h("msh.id",t.article.details.id));t.article.details.isInternalContent&&a.push(h("msh.internal"));n.$broadcast("AddMetaTags",a);y=r.hash();y&&e.scrollTo(y);n.$broadcast("PageResourcesDownloaded")}})};v&&(c.InternalContentConfig.AllowInternalContent||y)?(a=h.getSupportedIDP(),h.setPagePreference([a.AAD]),h.resolveAuthState().then(function(n){n===a.AAD?t.reset():h.isIframe()?c.InternalContentConfig.AllowInternalContent||t.reset():h.login()})):t.reset()}])}(angular.module(portalCommon)),function(n){n.directive("hipScript",["clientConfig","languageService","getScriptService",function(n,t,i){function r(){return Math.floor(Math.random()*1e11)}var u=function(u,f){var e=n.HipConfig.WebEndpoint+"/GetHIP/GetHipObject/"+f+"?mkt="+t.langLocale()+"&fid="+r()+"&id="+n.HipConfig.PartnerId+"&type=visual&rnd="+r();i.addScript(e,{element:u})};return{restrict:"A",compile:function(n,t){u(n,t.objectName)}}}])}(angular.module(portalCommon)),function(n){n.directive("compileHtml",["$compile","$parse",function(n){return{restrict:"A",link:function(t,i,r){var u=!1;r.content==null||u||(u=!0,t.$watch(function(n){return n[r.content]},function(){t.kbArticle!=null&&(i.html(t.kbArticle),n(i.contents())(t))},!0))}}}])}(angular.module(portalCommon)),function(n){n.directive("contentSurvey",["$rootScope","compassService","flightService",function(n,t){return{restrict:"A",templateUrl:"/PartialViews/Kb/survey.html",scope:{},link:function(i){var r=function(){var n=t.getContentSurvey();n&&(i.contentSurvey=n)};i.$on("CompassContentReady",function(){r()});r();i.showSurvey=!0;i.choiceCaptionClass="choice-caption";i.OnSubmit=function(){i.type!=null?(n.$broadcast("KbSurvey",{type:i.type,suggestion:i.suggestion}),i.showSurvey=!1):i.choiceCaptionClass+=" alert alert-error"};i.showButtons=!0;i.showTextBox=!1;i.onYesNoSomewhatClick=function(n){i.type=n;i.showButtons=!1;i.showTextBox=!0}}}}])}(angular.module(portalCommon)),function(n){n.directive("fixIt",["$window",function(n){return{restrict:"A",templateUrl:"/PartialViews/Kb/fixIt.html",scope:{},link:function(t,i,r){t.link=r.link;t.caption=r.caption;t.text=r.text;t.nav=function(t){n.location.href=t}}}}])}(angular.module(portalCommon)),function(n){n.directive("guidedWalkThrough",["languageService",function(n){return{restrict:"A",templateUrl:"/PartialViews/kb/guidedWalkThrough.html",scope:{},link:function(t,i,r){var u=n.lang();t.gwt={link:"//support2.microsoft.com/common/survey.aspx?scid=sw;"+u+";"+r.gwtid+"&showpage=1",linkcaption:r.linkcaption,description:r.description}}}}])}(angular.module(portalCommon)),function(n){n.directive("hdabs",[function(){return{restrict:"A",templateUrl:"/PartialViews/kb/hdabs.html",scope:{},transclude:!0,link:function(n,t,i){n.hdabs={graphicSrc:i.graphicSrc,graphicAlt:i.graphicAlt}}}}])}(angular.module(portalCommon)),function(n){n.directive("kbBanner",[function(){return{restrict:"A",templateUrl:"/PartialViews/Kb/banner.html",scope:{},link:function(n,t,i){n.title=i.title;n.description=i.description;n.imageUrl=i.imageUrl;n.linkText=i.linkText;n.linkUrl=i.linkUrl}}}])}(angular.module(portalCommon)),function(n){n.directive("kbBingCtfWidget",["$document","$location","$log","$rootScope",function(n,t,i){var r=null,f=function(){r.mtLoading=!0;$(".kb-article").hide()},u=function(){r.mtLoading=!1;$(".kb-article").show()},e=function(){var r="",n=t.path(),i;return n.charAt(n.length-1)=="/"&&(n=n.substr(0,n.length-1)),i=n.match(/[0-9]*$/),i&&(r=i[0]),r},o=function(n,t){var o,s,h;$("#bing-translate").length===0&&angular.isString(n)&&n.length>0&&angular.isString(t)&&t.length>0&&(o=e(),f(),s="https://ssl.microsofttranslator.com/ajax/v2/widget.aspx?siteData="+encodeURIComponent(t)+"&mode=manual&from=en&layout=ts&to="+n+"&originalDocument=/api/content/kbctf/"+o+"&category=e9b9dd63-c277-4572-9d08-fd459d9b844d_tech",h=Date.now(),$.getScript(s).done(function(){i.info("translator script element was loaded.");var n=Date.now();r.$apply(u)}).fail(function(){r.$apply(u)}))};return{restrict:"A",link:function(n,t,i){r=n;o(i.requestedlang,i.widgetsitedata)}}}])}(angular.module(portalCommon)),function(n){n.directive("detectOperatingSystem",["osService",function(n){return{restrict:"A",templateUrl:"/PartialViews/Kb/DetectOS.html",scope:{},link:function(t,i,r){t.os32bitCaption=r.os32bitCaption;t.os64bitCaption=r.os64bitCaption;t.osOtherCaption=r.osOtherCaption;t.currentOS=n.isWindows()?n.is64bitWindows()?t.os64bitCaption:t.os32bitCaption:t.osOtherCaption}}}])}(angular.module(portalCommon)),function(n){n.directive("kbMetaTag",["$rootScope",function(n){return{restrict:"A",link:function(t,i,r){n.$broadcast("UpdateMetaTag",{name:r.name,value:r.value});t.$on("$destroy",function(){n.$broadcast("RemoveMetaTag",{name:r.name})})}}}])}(angular.module(portalCommon)),function(n){n.directive("kbMsnSurvey",["$rootScope","$timeout","$window",function(){return{restrict:"A",templateUrl:"/PartialViews/Kb/msnsurvey.html",scope:{},link:function(n,t,i){n.caption=i.caption;n.yesCaption=i.yesCap;n.noCaption=i.noCap;n.yesTarget=i.yesTarget;n.noTarget=i.noTarget}}}])}(angular.module(portalCommon)),function(n){n.directive("kbProductPicker",[function(){return{restrict:"A",templateUrl:"/PartialViews/Kb/productPicker.html",scope:{},link:function(n,t,i){n.products=n.$eval(i.products);n.products.unshift({BookMark:"all",ProductName:i.allProductsLabel});n.selectedProduct=n.products[0];n.$watch("selectedProduct",function(){n.scrollTo(n.selectedProduct.BookMark)});n.scrollTo=function(n){if(angular.isString(n))if(n=="all")$(".what-to-try").show();else{$(".what-to-try").hide();var t="."+n;$(t).show()}}}}}])}(angular.module(portalCommon)),function(n){n.directive("kbMachineTranslated",[function(){return{restrict:"A",template:"<h4 class='kb-machine-translation-notice'>{{notice}}<\/h4>",scope:{},link:function(n,t,i){n.notice=i.caption}}}])}(angular.module(portalCommon)),function(n){n.directive("mats",["$compile","$parse","$sce",function(n,t,i){return{restrict:"A",templateUrl:"/PartialViews/Kb/mats.html",scope:{},link:function(n,t,r){n.mats={htmlCurr:i.trustAsHtml(r.matsHtml),learnMore:r.learnMore,learnMoreCaption:r.learnMoreCaption,runNow:r.runNow,runNowCaption:r.runNowCaption}}}}])}(angular.module(portalCommon)),function(n){n.controller("MsnSurveyController",["$scope","$rootScope","$window",function(n,t,i){n.positiveSurvey=function(){i.location.href=n.yesTarget;t.$broadcast("KbMsnSurvey",{response:"yes"})};n.negativeSurvey=function(){n.noTarget&&(i.location.href=n.noTarget);t.$broadcast("KbMsnSurvey",{response:"no"})}}])}(angular.module(portalCommon)),function(n){n.directive("thirdParty",["$compile","$parse","languageService",function(n,t,i){return{restrict:"A",templateUrl:"/PartialViews/Kb/thirdParty.html",scope:{},link:function(n,t,r){n.thirdParty={tooltip:r.tooltip,tplink:r.tplink,tpcaption:r.tpcaption,thirdPartyImage:"http://support.microsoft.com/library/images/support/"+i.langLocale()+"/thirdparty.png"}}}}])}(angular.module(portalCommon)),function(n){n.service("currentLanguageService",["$document","$log","clientConfig","locationService",function(n,t,i){this.setLang=function(n){var i,t;return(i=n==null?location.pathname.substring(1):n.locale,t=h(i),t!=null?r("SMCsiteLang",t):r("SMCsiteLang",n.locale),e(n.direction),t!=null)?t:n.locale};this.getLang=function(){return u("SMCsiteLang")||"en-US"};this.getDirection=function(){return u("SMCsiteDir")||"ltr"};this.setDirection=function(n){return e(n)};this.getFallbackLocaleReverseLookup=function(n){var t=o();for(var i in t)if(t[i].Fallback==n)return t[i].Locale;return null};var s="."+window.location.host,f="; Domain="+s+";expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/",r=function(i,r){n[0].cookie=i+"="+r+f;t.info("Set Cookie to:"+i+"="+r+f)},u=function(t){return!t||!n[0]?null:decodeURIComponent(n[0].cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},e=function(n){var t=u("SMCsiteDir");return(r("SMCsiteDir",n),n!=t)?!0:!1},h=function(n){var t=o();for(var i in t)if(t[i].Locale==n)return t[i].Fallback;return null},o=function(){if(i&&i.SupportedLocalesConfig&&i.SupportedLocalesConfig.LanguageFallbacks)return i.SupportedLocalesConfig.LanguageFallbacks}}])}(angular.module(portalCommon)),function(n){n.service("languageService",["$rootScope","$routeParams","$location","$q","currentLanguageService","compassService","locationService","clientConfig",function(n,t,i,r,u,f,e,o){var s={},l="displayName",h="",c;this.set=function(n,t){var i=u.getLang().toLowerCase(),r=u.setLang(n),f;i!=r&&(e.getCurrentPath().indexOf(i)==-1&&(i=u.getFallbackLocaleReverseLookup(i)),f=e.getCurrentPath().replace(i.toLowerCase(),r).toLowerCase(),t||e.setPathAndReload(f))};this.redirectWithLocale=function(n){n==this.langLocale()||u.getFallbackLocaleReverseLookup(n)||i.path("/"+this.langLocale()+i.path()).replace()};this.langLocale=function(){return u.getLang().toLowerCase()};this.currentDirection=function(){return u.getDirection().toLowerCase()};this.currentLanguage=function(){var n=this.langLocale().toLowerCase();if(s[n])return s[n][l]};this.getLanguageInfo=function(n){var t,i;return!n||Object.keys(s).length===0||!(t=s[n.toLowerCase()])?null:(i=t.displayName.split("-"),angular.extend({country:i[0].trim(),language:i[1].trim()},t))};this.lang=function(){var t=this.langLocale(),n=t.split("-");return n.length>1&&n.pop(),n.join("-")};this.locale=function(){var t=this.langLocale(),n=t.split("-");return n[n.length-1]};this.languages=function(){return s[0]?r.resolve(s):f.getLanguages().then(function(n){return s=n})};this.languageSelectorTitle=function(){return h||(h=f.getLanguageSelectorTitle()),h};this.getSupportedLanguageForGivenCountry=function(n){var i=c(),r,t;for(r in i)if(t=i[r].Locale.split("-"),t[t.length-1].toLowerCase()==n.toLowerCase())return t[0];return null};c=function(){if(o&&o.SupportedLocalesConfig&&o.SupportedLocalesConfig.LanguageFallbacks)return o.SupportedLocalesConfig.LanguageFallbacks};t.langLocale&&this.set(t.langLocale)}])}(angular.module(portalCommon)),function(n){n.directive("textDirection",["currentLanguageService",function(n){return{restrict:"A",compile:function(t){var i=n.getDirection();t.removeAttr("text-direction");t.attr("dir",i);i==="rtl"&&t.addClass("css-rtl")}}}])}(angular.module(portalCommon)),function(n){n.component("locationBlock",{templateUrl:"/PartialViews/LocationServices/LocationBlockTemplate.html",bindings:{},controller:["locationBlockService","contentApiService",function(n,t){this.pageUpdating=!0;var i=this;t.getCompassContentForPage("location-block").then(function(n){i.content=n.data.locationBlockPageContent}).finally(function(){i.pageUpdating=!1});this.submitMacId=function(t){this.resultUpdating=!0;this.status=null;var r=n.removeMacIdUsingHip(t).then(function(){i.status=!0}).catch(function(){i.status=!1}).finally(function(){i.resultUpdating=!1})}}],controllerAs:"lb"})}(angular.module(portalCommon));WLSPHIP1={error:0,cssSet:{cssCdHIPInput:"form-control"},holder:"ispHIPHIP",scriptHolder:"ispHIPScript",type:"visual",postLoad:function(){},getSolution:function(){},reloadHIP:function(){},switchHIP:function(){},setFocus:function(){},clientValidation:function(){},verify:function(){}},function(n){n.value("hipObject",WLSPHIP1);n.service("locationBlockService",["$rootScope","$http","hipObject","$q",function(n,t,i,r){var u={baseUrl:"/api/LocationServices/"};this.removeMacIdUsingHip=function(n){var f=r.defer();return i.verify(function(n,r,e){if(!n.trim())return f.reject("UnAuthorized"),i.reloadHIP(),f.promise;var o={macId:e,hip:{solution:n,token:r,datacenter:i.dataCenter,flowId:i.urlFid}};t.post(u.baseUrl+"locationblockusinghip/",JSON.stringify(o)).then(function(n){f.resolve(n)},function(n){f.reject(n);i.reloadHIP()})},n),f.promise}}])}(angular.module(portalCommon)),function(n){n.directive("logMeIn",["$location","$rootScope","contentApiService",function(n,t,i){return{templateUrl:"/PartialViews/LogMeIn/LogMeIn.html",restrict:"A",scope:{},link:function(r){function o(n,i){if(i.LogMeInRescueResponse){var o=i.LogMeInRescueResponse.toLowerCase(),e=!1;switch(o){case"pincode_missing":r.content.pinCodeText=n.pinCodeMissingText;e=!0;break;case"pincode_expired":r.content.pinCodeText=n.pinCodeExpiredText;e=!0;break;case"pincode_invalid":r.content.pinCodeText=n.pinCodeInvalidText;e=!0;break;case"pincode_alreadyused":r.content.pinCodeText=n.pinCodeAlreadyUsedText;e=!0;break;case"pincode_error":r.content.pinCodeText=n.pinCodeErrorText;e=!0;break;default:r.content.pinCodeText=n.pinCodeErrorText}e&&(u(!0),f());t.$broadcast("LMIPincodeError",o)}}function u(n){r.showLogMeInForm=n}function e(n){r.showEulaAcceptReject=n}function f(){r.disableEulaAccept=!0;r.disableEulaReject=!0}function s(){r.disableSubmit=!0}r.pincode={value:""};e(!1);u(!1);i.getCompassContentForPage("logmein").then(function(t){r.content=t.data;e(!0);o(r.content,n.search())},function(n){t.$broadcast("500Error",{reason:"Failed to load compass content for logmein page",response:n})});r.acceptEula=function(){f();t.$broadcast("LMIEulaAccept");u(!0)};r.rejectEula=function(){f();t.$broadcast("LMIEulaReject");n.path("/")};r.onSubmit=function(){var n,i,u,f;t.$broadcast("LMIEulaFormSubmit");n=document.createElement("form");n.method="post";n.action="https://secure.logmeinrescue-enterprise.com/Customer/Code.aspx";n.hidden=!0;i=document.createElement("input");i.type="text";i.name="Code";i.value=r.pincode.value.trim();n.appendChild(i);u=document.createElement("input");u.type="hidden";u.name="hostederrorhandling";u.value=1;n.appendChild(u);f=document.getElementById("logmein");f.appendChild(n);n.submit();s()}}}}])}(angular.module(portalCommon)),function(n){n.directive("sarValueRender",["sarValueService",function(n){return{templateUrl:"/PartialViews/SarValue/SarValueTemplate.html",restrict:"A",scope:{},link:function(t){t.updating=!0;n.getCountryLanguage().then(function(n){t.countries=n.Countries;t.languages=n.Languages;t.updating=!1}).catch(function(){t.updating=!1});t.onCountrySelected=function(){t.updating=!0;n.getDevices(t.countrySelected.Id).then(function(n){t.devices=n;t.updating=!1}).catch(function(){t.updating=!1})};t.onDeviceSelected=function(){var i={countryId:t.countrySelected.Id,languageCode:t.languageSelected.Code,deviceModel:t.deviceSelected.Model};t.updating=!0;n.getSarValueDetail(i).then(function(n){t.sarValueDetail=n;t.updating=!1}).catch(function(){t.updating=!1})}}}}])}(angular.module(portalCommon)),function(n){n.service("sarValueService",["$http","$document","$rootScope",function(n){function t(){return n.get("/api/sar/getcountrylanguageasync").then(function(n){return n.data})}function i(t){var i={params:{countryId:t}};return n.get("/api/sar/getdevicesasync",i).then(function(n){return n.data})}function r(t){var i={params:{countryId:t.countryId,languageCode:t.languageCode,deviceModel:t.deviceModel}};return n.get("/api/sar/getsarvaluedetailasync",i).then(function(n){return n.data})}this.getCountryLanguage=t;this.getDevices=i;this.getSarValueDetail=r}])}(angular.module(portalCommon)),function(n){n.service("linkTaggingService",["$document",function(n){this.tagContainerLinks=function(t,i){i=i?i+"-":"";angular.forEach(n.find(t+" a"),function(n,t){angular.element(n).attr("id",i+"link-"+(t+1))})}}])}(angular.module(portalCommon));microsoft=microsoft||{};microsoft.support=microsoft.support||{};microsoft.support.config=microsoft.support.config||{};microsoft.support.config.authInfo=microsoft.support.config.authInfo||{},function(n){n.authState=2;n.isLoggedIn=function(){return n.puid!=null};n.authStatus=function(){return n.authState};n.userSignedIn=function(t){n.puidAsHex=t.puidAsHex;n.displayName=t.displayName;n.puid=t.puid;n.firstName=t.firstName;n.lastName=t.lastName;n.cid=t.cid;n.authState=1;i();r()};n.userSignedOut=function(){n.puidAsHex=null;n.displayName=null;n.puid=null;n.firstName=null;n.lastName=null;n.cid=null;n.authState=0;i();u()};var r=function(){var n=t();n&&n.$broadcast("UserSignedIn")},u=function(){var n=t();n&&n.$broadcast("UserSignedOut")},i=function(){var n=t();n&&n.$broadcast("AuthStatusChange")},t=function(){var n=angular.element(document.body),t=n&&n.scope();return t&&t.$root};return n}(microsoft.support.config.authInfo);try{document.domain="microsoft.com"}catch(e){}microsoft=microsoft||{};microsoft.support=microsoft.support||{};microsoft.support.moduleName="SelfAssistWeb";microsoft.support.config=microsoft.support.config||{};microsoft.support.serverInfo=microsoft.support.serverInfo||{};typeof console=="undefined"&&(console={});typeof console.log=="undefined"&&(console.log=function(){});app=angular.module(microsoft.support.moduleName,["portalCommon","ngSanitize","ngRoute","ngCookies","ngAria","ui.bootstrap","ngMessages","ngFileUpload","AdalAngular"]);app.value("clientConfig",microsoft.support.config);app.value("serverInfo",microsoft.support.serverInfo);app.run(["$rootScope","$timeout","$anchorScroll","$location",function(n,t,i,r){t(function(){n.$broadcast("AngularJsReady")},10);r&&r.hash&&r.hash()&&t(function(){i()},2e3)}]);app.config(["$httpProvider","adalAuthenticationServiceProvider","authConfigurationProvider",function(n,t,i){var r=i.$get(),u=window.location.hostname,f=function(){return u&&(u===r.prodHost||u===r.uatHost||u===r.stagingHost||u===r.internalProdHost||u===r.internalUatHost||u===r.internalDevHost||u===r.inProdHost||u===r.partnersHost)},e=f()?r.prodInstance:r.ppeInstance;t.init({instance:e,tenant:r.tenant,clientId:r.clienId,redirectUri:"https://"+u+"/",protectedEndpoints:r.protectedEndpoints,endpoints:r.endpoints},n)}]),function(n){n.component("internalSignin",{templateUrl:"PartialViews/InternalSignin/InternalSigninTemplate.html",bindings:{},controller:["$window","contentApiService",function(n,t){this.pageUpdating=!0;var i=this;t.getCompassContentForPage("internal-signin").then(function(n){i.content=n.data.internalSigninPageContent}).finally(function(){i.pageUpdating=!1});this.signIn=function(){n.open("/signin","_blank")}}],controllerAs:"aad"})}(angular.module(microsoft.support.moduleName)),function(n){n.factory("errorInterceptor",["$rootScope","$q",function(n,t){function u(n){return r.filter(function(t){return n&&n.config&&n.config.url.match(t)!==null}).length>0}function f(n){return!n||!n.config||!n.config.params?!0:n.config.params.shouldRequestErrorCrashExperience===!1?!1:!0}var i={},r=[/api\/search/i,/api\/content\/kb/i,/api\/content\/gwt/i,/api\/content\/article/i,/api\/content\/help/i,/api\/content\/instantanswers/i,/api\/content\/getcompasscontentforpage(?!(\/partnerconfig|\/widgetconfig|\/contactus\/.+))/i];return i.responseError=function(i){if(!f(i))return t.reject(i);var r=u(i);return r&&i.status===404?n.$broadcast("404Error"):r&&n.$broadcast("500Error",{reason:"Http request failed",response:i}),t.reject(i)},i}])}(angular.module(microsoft.support.moduleName));app.config(["$provide",function(n){n.decorator("$exceptionHandler",["$delegate","$injector",function(n,t){return function(i,r){var u={},f=t.get("qosTelemetryService");u.message=i.message||"";u.stack=i.stack||"";u.context=i&&JSON.stringify(i)||"";f.createEvent(f.eventTypes.app.exception).reject(JSON.stringify(u));n(i,r)}}])}]);app.service("navigationOverrideService",["$rootScope","$location","$route","$routeParams","$window","compassService","breadcrumbsService",function(n,t,i,r,u,f,e){function o(){var n=t.search().flighting;n&&(u.document.cookie="smc_f="+decodeURIComponent(n)+";path=/;domain="+u.location.host)}n.$on("$routeChangeSuccess",function(i,r){f.fetchContent(t.path().substring(1));r&&r.data&&r.data.noIndex===!0&&n.$broadcast("NoIndex")});n.$on("$routeChangeStart",function(){o()});n.$on("$routeChangeSuccess",function(){e.generateBreadcrumbs(i,r)});o()}]),function(){function t(n){return n!==null&&typeof n=="object"}var n=function(n){var i,r;if(n&&n.data)try{try{i=t(n.data)?n.data:JSON.parse(n.data)}catch(u){console.info("Received cross-frame message, was unable to parse event.data: "+u);return}i.type==="$broadcast"&&i.name&&angular.element(document)&&angular.element(document).injector()&&(r=angular.element(document).injector().get("$rootScope"),r.$broadcast(i.name,i.args,n.source),r.$digest())}catch(u){console.error("Error parsing message as JSON: "+u)}};window.addEventListener?window.addEventListener("message",n,!1):window.attachEvent("onmessage",n)}(),function(n){n.service("ParentWindowBroadcaster",["$rootScope","$window","$log",function(n,t){function i(i){n.$on(i,function(n,r,f){t.window!==f&&u(i,r)})}function r(i,r){i.$on(r,function(i,u,f){t.window!==f&&n.$broadcast(r,u)})}function u(n,i){t.parent&&t.parent.postMessage(JSON.stringify({type:"$broadcast",name:n,args:i}),"*")}this.init=function(n,u){n.forEach(i);try{if(t&&t.parent&&t.parent.angular&&t.parent.angular.element(t.frameElement)){var f=t.parent.angular.element(t.frameElement).scope();f&&u.forEach(function(n){r(f,n)})}}catch(e){}};this.init([],[])}]).run(["ParentWindowBroadcaster",function(){}])}(angular.module(microsoft.support.moduleName));app.config(["$routeProvider","$locationProvider","$compileProvider",function(n,t,i){var r,e,o;if(html5mode=!!(window.history&&window.history.pushState),i.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|blob|ms-([a-zA-Z-]+)|bing([a-zA-Z]+)|calculator|microsoft\.windows\.camera|microsoft-edge|mswindowsmusic|fb|feedback-hub|outlookcal|outlookmail|onenote-cmd|C:\\Program Files\\Internet Explorer\\iexplore\.exe|skype|lync15|%windir%\\system32\\snippingtool\.exe|dlna-playsingle|xbox|avatars):/),r={MSA:"MSA",AAD:"AAD"},!html5mode&&window.location.hash.charAt(1)!=="!"){e=document.getElementsByTagName("base")[0].href;o=location.href.replace(e,"").replace(location.hash,"");window.location.replace(window.location.pathname+"/#!"+o+window.location.search+window.location.hash);return}var f=["$route","$location","chatStateService","clientConfig","nativeAppService",function(n,t,i){if(i.isReconnectValid()&&i.getChatEstablished()&&(n.current.params.subject||i.getSubject())){var r=n.current.params.subject?n.current.params.subject:i.getSubject();i.setSubject(r);t.path("/contact/chat/"+r+"/")}}],u={commercialNonFlightRedirect:["$location","$route","flightService",function(n,t,i){i.isUserInFlight("commercial-incident-mgmt-1")||n.url(t.current.params.langLocale).replace()}]},s=["authenticationHelperService","$q",function(n,t){var i=t.defer();return n.signIn(i.resolve),i.promise}];microsoft.support.ignoreMvcRouting||n.when("/enterprise/",{resolve:{isChatInProgress:f},controller:"SupportMenuController",templateUrl:"/PartialViews/SupportMenu/Container.html",data:{noIndex:!0,isLandingPage:!0}}).when("/virtual-agent/",{controller:"VirtualAgentController",templateUrl:"/PartialViews/VirtualAgent/VirtualAgent.html",requireLogin:[r.MSA],reloadOnSearch:!1}).when("/menu/",{resolve:{isChatInProgress:f},controller:"SupportMenuController",templateUrl:"/PartialViews/SupportMenu/Container.html",data:{noIndex:!0,isLandingPage:!0}}).when("/menu/:issueType?/:product?/:issue?/",{resolve:{isChatInProgress:f},controller:"SupportMenuController",templateUrl:"/PartialViews/SupportMenu/Container.html",data:{noIndex:!0}}).when("/partner/:partner/menu/",{resolve:{isChatInProgress:f},controller:"SupportMenuController",templateUrl:"/PartialViews/SupportMenu/Container.html",data:{noIndex:!0,isLandingPage:!0}}).when("/hoops/:channelType/:subject/",{controller:"HoopsController",templateUrl:"/PartialViews/Contact/HoursOfOperation/HoursOfOperation.html",data:{noIndex:!0}}).when("/chat/:subject/",{controller:"ChatController",templateUrl:"/PartialViews/Contact/Chat/Container.html",data:{noIndex:!0}}).when("/callback/:subject/",{template:'<div id="callback-container" callback is-schedule-callback="false"><\/div>',data:{noIndex:!0}}).when("/schedulecallback/:subject/",{template:'<div id="schedule-callback-container" callback is-schedule-callback="true"><\/div>',data:{noIndex:!0}}).when("/form/:id/:name/:modality?/",{controller:"UnauthFormController",templateUrl:"/PartialViews/Contact/UnauthForm/Container.html",data:{noIndex:!0},requireLogin:[r.MSA]}).when("/rat-phone",{controller:"PhoneScreenShareController",templateUrl:"/PartialViews/RATOverPhone/PhoneScreenShare.html",data:{noIndex:!0}}).when("/:langLocale/kb/:articleId",{controller:"KbController",templateUrl:"/PartialViews/KB/Index.html",reloadOnSearch:!1,data:{hasSkylightEntry:!0}}).when("/:langLocale/contactus/:product/:issuetype/",{controller:"ContactUsController",templateUrl:"/PartialViews/ContactUs/V2.html",reloadOnSearch:!1,data:{fluidContainer:!0,hideSearch:!0,noIndex:!0}}).when("/:langLocale/contactus/products/",{controller:"ContactUsController",templateUrl:"/PartialViews/ContactUs/V2.html",reloadOnSearch:!1,data:{fluidContainer:!0,hideSearch:!0,showProductsList:!0}}).when("/:langLocale/contactus/:product/",{controller:"ContactUsController",templateUrl:"/PartialViews/ContactUs/V2.html",reloadOnSearch:!1,data:{fluidContainer:!0,hideSearch:!0,noIndex:!0}}).when("/:langLocale/contactus/",{controller:"ContactUsController",templateUrl:"/PartialViews/ContactUs/V2.html",reloadOnSearch:!1,data:{fluidContainer:!0,hideSearch:!0}}).when("/:langLocale/premier",{resolve:u,reloadOnSearch:!1,data:{isDefaultPremier:!0,isCommercial:!0,enablePremierAlert:!0,returnUrl:"/:langLocale/premier"},requireLogin:[r.MSA]}).when("/:langLocale/commercial/incidents/create",{resolve:u,controller:"IncidentCreationController",templateUrl:"/PartialViews/Commercial/IncidentCreation/index.html",reloadOnSearch:!1,data:{isCommercial:!0,returnUrl:"/:langLocale/premier"},requireLogin:[r.MSA]}).when("/:langLocale/commercial/incidents",{resolve:u,controller:"IncidentsHubController",templateUrl:"/PartialViews/Commercial/IncidentsHub.html",reloadOnSearch:!1,data:{breadcrumb:{parent:"/:langLocale/commercial",text:"incidentList"},isCommercial:!0,returnUrl:"/:langLocale/premier"},requireLogin:[r.MSA]}).when("/:langLocale/commercial/incidents/:incidentId",{resolve:u,templateUrl:"/PartialViews/Commercial/IncidentHub.html",reloadOnSearch:!1,data:{breadcrumb:{parent:"/:langLocale/commercial/incidents",text:":incidentId"},isCommercial:!0,returnUrl:"/:langLocale/premier"},requireLogin:[r.MSA]}).when("/:langLocale/premier/access",{resolve:u,templateUrl:"/PartialViews/Commercial/CommercialAccountHub.html",controller:"commercialAccountController",reloadOnSearch:!1,data:{breadcrumb:{parent:"/:langLocale/commercial",text:"accounts"},isCommercial:!0,returnUrl:"/:langLocale/premier"},requireLogin:[r.MSA]}).when("/:langLocale/premier/contacts",{resolve:u,templateUrl:"/PartialViews/Commercial/PremierContacts.html",controller:"premierContactsController",reloadOnSearch:!1,data:{isCommercial:!0,returnUrl:"/:langLocale/premier"},requireLogin:[r.MSA]}).when("/:langLocale/kinectadapter",{resolve:{kinectAdapterNonFlightRedirect:["$location","$route","flightService",function(n,t,i){i.isUserInFlight("fka-1")||n.url(t.current.params.langLocale)}]},templateUrl:"/PartialViews/Devices/KinectAdapter.html",controller:"KinectAdapterController",reloadOnSearch:!1,requireLogin:[r.MSA]}).when("/:langLocale/devices/addpayment/:piid?/:errorCode?",{resolve:{devicesNonFlightRedirect:["$location","$route","flightService",function(n,t,i){i.isUserInFlight("odc-1")||n.url(t.current.params.langLocale)}]},templateUrl:"/PartialViews/Devices/AddPayment.html",controller:"AddPaymentController",reloadOnSearch:!1,requireLogin:[r.MSA]}).when("/:langLocale/devices",{resolve:{devicesNonFlightRedirect:["$location","$route","flightService",function(n,t,i){i.isUserInFlight("odc-1")||n.url(t.current.params.langLocale)}]},templateUrl:"/PartialViews/Devices/MyDevices.html",reloadOnSearch:!1,requireLogin:[r.MSA]}).when("/:langLocale/devices/:deviceId",{templateUrl:"/PartialViews/Devices/Device.html",reloadOnSearch:!1,requireLogin:[r.MSA],data:{returnUrl:"/:langLocale/devices"}}).when("/:langLocale/lifecycle/selectindex",{controller:"LifecycleController",templateUrl:"/PartialViews/Lifecycle/Index.html",data:{fluidContainer:!0,isLifeSelectIndex:!0}}).when("/:langLocale/lifecycle",{resolve:{lifecycleSearchRedirect:["$location","$route","flightService",function(n){var r=n.search(),t={},i;angular.forEach(r,function(n,i){t[i.toLowerCase()]=n});i=t.p1||t.c2||t.alpha;i&&n.path("/lifecycle/search/").search(t)}]},controller:"LifecycleController",templateUrl:"/PartialViews/Lifecycle/Index.html",data:{fluidContainer:!0,isLifeSelectIndex:!1}}).when("/lifecycle/search/:gdsId?",{resolve:{lifecycleSearchLocaleRedirect:["$location","$route","languageService",function(n,t,i){var r=n.path().split("/")[1];i.redirectWithLocale(r)}]},controller:"LifecycleSearchController",templateUrl:"/PartialViews/Lifecycle/LifecycleSearch.html"}).when("/:langLocale/lifecycle/search/:gdsId?",{controller:"LifecycleSearchController",templateUrl:"/PartialViews/Lifecycle/LifecycleSearch.html"}).when("/:langLocale/answerdesk/accessibility",{resolve:{accessibilityNonFlightRedirect:["$location","$route","flightService",function(n,t,i){i.isUserInFlight("dad-1")||n.url(t.current.params.langLocale)}]},templateUrl:"/PartialViews/Accessibility/Index.html",controller:"AccessibilityController",reloadOnSearch:!1,data:{fluidContainer:!0,hideSearch:!0}}).when("/:langLocale/accessibility/enterprise-answer-desk",{resolve:{accessibilityNonFlightRedirect:["$location","$route","flightService",function(n,t,i){i.isUserInFlight("edad-1")||n.url(t.current.params.langLocale)}]},templateUrl:"/PartialViews/Accessibility/EnterpriseAccessibility.html",controller:"EnterpriseAccessibilityController",reloadOnSearch:!1,data:{fluidContainer:!0,hideSearch:!0}}).when("/:langLocale/verifyme",{controller:"VerifymeController",templateUrl:"/PartialViews/Verifyme/Index.html",requireLogin:[r.MSA]}).when("/:langLocale/gwt/:articleId",{controller:"GwtController",templateUrl:"/PartialViews/Gwt/Index.html",data:{hasSkylightEntry:!0}}).when("/:langLocale/help/:articleId",{controller:"HelpArticleController",templateUrl:"/PartialViews/HelpArticle/Index.html",data:{hasSkylightEntry:!0}}).when("/:langLocale/help/:articleId/:title",{controller:"HelpArticleController",templateUrl:"/PartialViews/HelpArticle/Index.html",data:{hasSkylightEntry:!0}}).when("/:langLocale/instantanswers/:iaId",{controller:"InstantAnswerController",templateUrl:"/PartialViews/InstantAnswer/Index.html",data:{hasSkylightEntry:!0}}).when("/:langLocale/instantanswers/:iaId/:title",{controller:"InstantAnswerController",templateUrl:"/PartialViews/InstantAnswer/Index.html",data:{hasSkylightEntry:!0}}).when("/:langLocale/fre/:productId",{controller:"FreController",templateUrl:"/PartialViews/Fre/Index.html",resolve:{noChrome:["$location",function(n){n.search().nochrome||n.search("nochrome")}]}}).when("/:langLocale/article/:articleId",{controller:"GenericArticleController",templateUrl:"/PartialViews/GenericArticle/Index.html",data:{hasSkylightEntry:!0}}).when("/:langLocale/allproducts",{controller:"AllProductsController",templateUrl:"/PartialViews/AllProducts/Index.html",data:{hasSkylightEntry:!0}}).when("/:langLocale/search",{controller:"SearchResultsController",templateUrl:"/PartialViews/Search/Results.html",resolve:{log:[function(){console.log("search invoked")}]},data:{noIndex:!0,hasSkylightEntry:!0}}).when("/:langLocale/products/:productfamily/:product/:subproduct",{controller:"ProductHubController",templateUrl:"/PartialViews/Products/ProductPages.html",data:{hasSkylightEntry:!0}}).when("/:langLocale/products/:productfamily/:product",{controller:"ProductHubController",templateUrl:"/PartialViews/Products/ProductPages.html",data:{hasSkylightEntry:!0}}).when("/:langLocale/products/:productfamily",{controller:"ProductHubController",templateUrl:"/PartialViews/Products/ProductPages.html",data:{hasSkylightEntry:!0}}).when("/:langLocale/topics/:productfamily",{controller:"ProductHubController",templateUrl:"/PartialViews/Products/ProductPages.html",data:{hasSkylightEntry:!0}}).when("/:langLocale/products",{data:{hasSkylightEntry:!0},resolve:{AllProductsRedirect:["$location","$route","languageService",function(n,t,i){n.path(i.langLocale()+"/allproducts").replace()}]}}).when("/:langLocale/locations/:product",{controller:"StoreLocationsController",templateUrl:"/PartialViews/StoreLocations/Index.html",data:{hasSkylightEntry:!0}}).when("/:langLocale/answerdesk/:action",{controller:"AnswerDeskController",templateUrl:"/PartialViews/AnswerDesk/Index.html",data:{noIndex:!0},requireLogin:[r.MSA]}).when("/signin",{controller:"AccountSignInController",templateUrl:"/PartialViews/Common/SignIn.html",data:{hideSearch:!0,noIndex:!0},resolve:{signinNonFlightRedirect:["$location","$route","flightService",function(n,t,i){i.isUserInFlight("aad-1")||n.url("/")}]}}).when("/signout",{controller:"AccountSignOutController",templateUrl:"/PartialViews/Common/SignOut.html",data:{hideSearch:!0,noIndex:!0},resolve:{signoutNonFlightRedirect:["$location","$route","flightService",function(n,t,i){i.isUserInFlight("aad-1")||n.url("/")}]}}).when("/signout/:accountType",{controller:"AccountSignOutController",templateUrl:"/PartialViews/Common/SignOut.html",data:{hideSearch:!0,noIndex:!0},resolve:{signoutNonFlightRedirect:["$location","$route","flightService",function(n,t,i){i.isUserInFlight("aad-1")||n.url("/")}]}}).when("/silentauth",{templateUrl:"/PartialViews/Common/SilentAuth.html",data:{noIndex:!0},resolve:{silentAuthNonFlightRedirect:["$location","$route","flightService",function(n,t,i){i.isUserInFlight("aad-1")||n.url("/")}]}}).when("/:langLocale/internalsignin",{template:"<internal-signin><\/internal-signin>"}).when("/",{resolve:{homeRedirect:["$location","languageService",function(n,t){n.url(t.langLocale())}]}}).when("/errors",{resolve:{error:["$rootScope",function(n){n.$broadcast("500Error",{reason:"Hit errors route"})}]},data:{noIndex:!0}}).when("/:langLocale",{templateUrl:"/PartialViews/Index.html",resolve:{langRedirect:["$location","$route","languageService",function(n,t,i){i.redirectWithLocale(t.current.params.langLocale)}]},data:{isLandingPage:!0,hasSkylightEntry:!0}}).otherwise({resolve:{refresh:["$route","$rootScope","$location","$log","languageService","locationService",function(n,t,i,r,u){var f=i.path().split("/")[1];u.redirectWithLocale(f);t.$broadcast("404Error",{location:i.url()});r.log("hit otherwise statement for route: ",n)}]}});t.html5Mode(html5mode).hashPrefix("!")}]),function(n){n.service("seoService",["$http","$rootScope","$window","$timeout",function(n,t,i,r){function c(){u=u||n.pendingRequests.length;u&&!n.pendingRequests.length&&r(function(){u&&!n.pendingRequests.length&&(i.callPhantom(),h())},200)}function s(n,t){var r=t&&t.reason||"Page not found";i.callPhantom({error:!0,reason:r});h()}function h(){f();e();o()}var u=!1,f,e,o;typeof i.callPhantom=="function"&&(f=t.$watch(function(){return n.pendingRequests.length},c),e=t.$on("500Error",s),o=t.$on("404Error",s))}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("AccessibilityController",["$scope","compassService","compassFormatFilter","windowService",function(n,t,i,r){function u(){t.getAccessibilityView().then(function(t){n.view=t;n.waitingOnCompass=!1;n.view&&n.view.defelctionSection&&n.view.defelctionSection.answerdeskLink&&n.view.defelctionSection.visitAnswerdesk&&n.view.defelctionSection.answerDeskAnchorFormat&&(n.visitAnswerdeskLink=i(n.view.defelctionSection.visitAnswerdesk,{"answer-desk-link-html":i(n.view.defelctionSection.answerDeskAnchorFormat,{"contactus-url":n.view.defelctionSection.answerdeskLink.linkUrl})}),f(t))})}n.waitingOnCompass=!0;var f=function(t){var i,r;t&&t.metaTagsList&&t.metaTagsList.metaTags&&(i=metatagService.fetchMetaTags(t.metaTagsList.metaTags),i&&(r=i.metaTagTitle||n.pageTitle,r&&$rootScope.$broadcast("UpdateTitle",r),i.pageMetaTags&&$rootScope.$broadcast("AddMetaTags",i.pageMetaTags)))};n.LaunchChat=function(n){r.openPopupCenter(n,"contactSupport")};n.$on("AccessibilityPageLoadTimeout",function(){n.waitingOnCompass=!1;$rootScope.$broadcast("500Error",{reason:"Timeout occurred on a lifecycle landing page load",data:{}})});u()}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("EnterpriseAccessibilityController",["$scope","$rootScope","$compile","$window","compassService","metatagService","flightService",function(n,t,i,r,u,f,e){function s(){var i=window.navigator.appName;n.waitingOnCompass=!0;t.isEnterprisePage=!0;n.informationText="";e.isUserInFlight("edad-2")?(n.loadV2=!0,u.getEnterpriseAccessibilityV2View().then(function(t){o(t);n.waitingOnCompass=!1;n.view=t})):e.isUserInFlight("edad-1")&&(n.loadV2=!1,u.getEnterpriseAccessibilityView().then(function(t){var i=h(t);i=c(t);o(t);n.waitingOnCompass=!1;n.view=i}))}var h=function(t){var f,u,e,r;if(t&&t.informationSection&&t.informationSection.informationContent&&t.informationSection.informationContent.informationText&&(n.informationText="",f=t.informationSection.informationContent.informationText,t&&t.informationSection&&t.informationSection.informationContent&&t.informationSection.informationContent.informationLinks)){for(u=t.informationSection.informationContent.informationLinks,e="link",r=0;r<u.length;r++){var o=r+1,s="{"+e+o+"}",h="<a id=edad-infosection-"+u[r].htmlId+" ng-href="+u[r].linkUrl+" target='_self' >"+u[r].linkText+"<\/a>";f=f.replace(s,h)}n.informationText="<div>"+f+"<\/div>"}return i(n.informationText)(n).appendTo(angular.element("#informationSectionWithLinks")),t},c=function(t){if(t&&t.heroSection&&t.heroSection.footer&&t.heroSection.answerDeskUrl){n.heroText="";var r=t.heroSection.footer,u="<a id=edad-herolink"+t.heroSection.answerDeskUrl.htmlId+" class='more-action' ng-href="+t.heroSection.answerDeskUrl.linkUrl+" target='_self'>"+t.heroSection.answerDeskUrl.linkText+"<\/a>";r=r.replace("{link}",u);n.heroText="<div>"+r+"<\/div>"}return i(n.heroText)(n).appendTo(angular.element("#heroSectionWithLink")),t},o=function(i){var r,u;i&&i.metaTagsList&&i.metaTagsList.metaTags&&(r=f.fetchMetaTags(i.metaTagsList.metaTags),r&&(u=r.metaTagTitle||n.pageTitle,u&&t.$broadcast("UpdateTitle",u),r.pageMetaTags&&t.$broadcast("AddMetaTags",r.pageMetaTags)))};n.browseto=function(n){r.location.href=n};n.$on("EnterpriseAccessibilityPageLoadTimeout",function(){n.waitingOnCompass=!1;t.$broadcast("500Error",{reason:"Timeout occurred on a lifecycle landing page load",data:{}})});s()}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("AnswerDeskController",["$location","$rootScope","$timeout","$scope","$sce","$routeParams","$window","answerDeskService","authenticationHelperService","clientConfig","contentApiService","languageService","locationService","flightService","authService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){function it(){b=w.busy;c.getCompassContentForPage("answerdeskpurchase").then(function(n){n&&n.data&&n.data.assurePurchase&&(r.view=n.data.assurePurchase,k=n.data.errors,r.isCurrentState(w.busy)&&r.offer&&(b=w.showOffer))})}function nt(){p={};b=w.none;r.view=null;r.uiState=w;r.accountInfo={name:"",email:"",address:{}};it()}function rt(){var t=h.CommercePlatformConfig.MSStorePcsIFrameUrlFormat,i=t.replace(/hostUrlToReplace/g,n.host());return i.replace(/cpLocaleToReplace/g,l.langLocale())}function ut(n){switch(n){case g.unauthed:y.loginWithSAPIPolicy(!1);case g.canceled:break;default:t.$broadcast("500Error",{errorContent:k.genericError,error:{errorCode:n,message:"Unknown error from pcs iframe"}})}}function d(){var n=f.action||"";switch(n){case"purchase":ft()}}function ft(){if(!f.oguid||!f.aid){t.$broadcast("500Error",{errorContent:k.notFound});nt();return}p.offerGuid=f.oguid;p.agentPuid=f.aid;b=w.busy;o.getOfferDetails(p.offerGuid).then(function(n){n?(r.offer=n,b=w.showOffer):t.$broadcast("500Error",{errorContent:k.notFound})},function(n){t.$broadcast("500Error",{errorContent:k.genericError,error:n})})}function et(n){b=w.showOffer;p={};var i=a.getQueryStringParameters(n);i.errorCode&&ut(i.errorCode);t.$apply()}function ot(n){var i=a.getQueryStringParameters(n);p.accountId=i.accountid;p.piId=i.piid;b=w.busy;o.confirmPurchase(p.accountId,p.piId,p.agentPuid,p.offerGuid).then(function(n){var i,u,f,e;n.accountInfo&&n.pricingInfo&&n.pi?(i=n.accountInfo,r.accountInfo.name=i.FirstName&&i.LastName?i.FirstName+" "+i.LastName:i.FirstName||i.LastName||i.FriendlyName,u=i.AddressList[0]||{},r.accountInfo.address={street1:u.Street1||"",street2:u.Street2||"",street3:u.Street3||"",city:u.City||"",state:u.State||"",zipcode:u.PostalCode||""},r.accountInfo.email=i.Email,f=parseFloat(n.pricingInfo.TotalPriceWithoutTax),e=parseFloat(n.pricingInfo.TotalTax),r.pricingInfo={amount:parseFloat(n.pricingInfo.Amount),totalWithoutTax:f,totalTax:e,total:f+e,currency:n.pricingInfo.Currency},r.pi={lastFour:n.pi.AccountNumberLastFour,cardType:n.pi.CardType,expiration:n.pi.ExpirationDate},b=w.showOrderReview):t.$broadcast("500Error",{errorContent:k.genericError})},function(n){t.$broadcast("500Error",{errorContent:k.genericError,error:n})});t.$apply()}var tt=v.isUserInFlight("aad-1"),b="",p={},k={},w={none:0,showOffer:1,showOrderReview:2,showOrderConfirmation:4,showPi:8,processingOrder:16,busy:32},g={unauthed:"20",canceled:"10"};r.getMicrosoftAccountLink=function(){return'<a id="answer-desk-microsoft-account-link" target="_blank" href="'+r.view.microsoftAccountLink.linkUrl+'">'+r.view.microsoftAccountLink.linkText+"<\/a>"};r.isCurrentState=function(n){return!!(b&n)};r.offerAccepted=function(){b=w.showPi;r.pcsIframePath=u.trustAsResourceUrl(rt())};r.placeOrder=function(){b=w.busy|w.processingOrder;o.completePurchase(p.accountId,p.piId,p.agentPuid,p.offerGuid).then(function(n){var t=parseFloat(n.TotalPriceWithoutTax),i=parseFloat(n.TotalTax);r.pricingInfo={amount:parseFloat(n.Amount),totalWithoutTax:t,totalTax:i,total:t+i,transactionId:n.PurchaseId,currency:n.Currency};b=w.showOrderConfirmation},function(n){t.$broadcast("500Error",{errorContent:k.transactionFailed,error:n})})};r.$on("CancelPurchase",function(n,t){et(t)});r.$on("ConfirmPurchase",function(n,t){ot(t)});r.$on("$routeChangeSuccess",function(){tt?y.resolveAuthState().then(function(n){var t=y.getSupportedIDP();n===t.MSA?d():y.loginWithSAPIPolicy(!1)}):h.authInfo.isLoggedIn()?d():s.signIn(d)});nt()}])}(angular.module(microsoft.support.moduleName)),function(){window!==window.top&&(window.location.pathname.indexOf("cancelpurchase")>=0?window.parent.postMessage(JSON.stringify({type:"$broadcast",name:"CancelPurchase",args:window.location.search}),"*"):window.location.pathname.indexOf("confirmpurchase")>=0&&window.parent.postMessage(JSON.stringify({type:"$broadcast",name:"ConfirmPurchase",args:window.location.search}),"*"))}(),function(n){n.service("answerDeskService",["$http",function(n){this.confirmPurchase=function(t,i,r,u){return n.get("/api/answerdesk/confirmpurchase/",{params:{accountId:t,piId:i,agentPuid:r,offerGuid:u}}).then(function(n){return n.data})};this.completePurchase=function(t,i,r,u){return n.post("/api/answerdesk/completepurchase/",{accountId:t,piId:i,agentPuid:r,offerGuid:u}).then(function(n){return n.data})};this.getOfferDetails=function(t){return n.get("/api/answerdesk/getofferdetails/",{params:{offerGuid:t}}).then(function(n){return n.data})}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("AccountSignInController",["$location","authService",function(n,t){t.resolveAuthState().then(function(i){var r=t.getSupportedIDP();i===r.NONE?t.login():n.path("/")})}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("AccountSignOutController",["$scope","$location","$routeParams","authService",function(n,t,i,r){function u(){var n=r.getSupportedIDP();r.checkMSAFedSignOn()?r.logout(n.AAD):r.isAuthenticatedAAD()?r.logout(n.AAD):r.isAuthenticatedMSA()?r.logout(n.MSA):t.path("/")}u()}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("F1FooterController",["$rootScope","$scope","compassService",function(n,t,i){function r(){var n=i.getF1Footer();n&&(t.viewlinkfarm=n.f1FooterView)}t.reset=function(){r()};t.reset();t.$on("CompassContentReady",function(){r()})}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("FeedbackController",["$rootScope","$scope","$timeout","compassService",function(n,t,i,r){t.feedbackWizard={};t.feedbackText={};t.feedbackWizard.reset=function(){t.feedbackWizard.show=!1;t.feedbackWizard.type="suggestion";t.feedbackWizard.comment=""};t.feedbackWizard.reset();t.feedbackWizard.toggle=function(){t.feedbackWizard.show=!t.feedbackWizard.show;t.feedbackWizard.show&&i(function(){$("#feedback-wizard textarea").first().focus()})};t.feedbackWizard.submit=function(i){i&&(n.$broadcast("SiteFeedback",t.feedbackWizard),t.feedback.$setPristine());t.feedbackWizard.reset()};var u=function(){var n=r.getFeedbackCtrl();n&&(t.feedbackText=n)};u();t.$on("CompassContentReady",function(){u()})}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("L0HeaderController",["$rootScope","$scope","$window","$location","$sce","$cookies","clientConfig","compassService","flightService","authenticationHelperService","authService","authConfiguration",function(n,t,i,r,u,f,e,o,s,h,c,l){var a=s.isUserInFlight("aad-1"),v=!1,y=function(){a?c.init():t.signInLink=u.trustAsHtml(e.RpsSignInInfo.SignInLink);t.userDisplayName=null;t.$on("UserSignedIn",function(){a||(t.userDisplayName=e.authInfo.displayName,t.signInLink=u.trustAsHtml(e.RpsSignInInfo.SignOutLink))});t.$on("UserSignedOut",function(){a||(t.userDisplayName=null,t.signInLink=u.trustAsHtml(e.RpsSignInInfo.SignInLink))})};n.$on("ProcessUserSignIn",function(n,t){a&&(v=t||!1,c.processUserSignIn(v,r.path()))});t.$on("UserSignedIn",function(){if(!a&&i&&i.msCommonShell){var t=i.msCommonShell,n=h.getShellOptions();n.meControlOptions.userData.firstName=e.authInfo.firstName;n.meControlOptions.userData.lastName=e.authInfo.lastName;n.meControlOptions.userData.memberName=e.authInfo.displayName;n.meControlOptions.userData.cid=e.authInfo.cid;n.meControlOptions.userData.authenticatedState=t.AuthState.SignedIn;t.load(n)}});t.$on("UserSignedOut",function(){if(!a&&i&&i.msCommonShell){var n=i.msCommonShell;n.load(h.getShellOptions())}});y();t.signInText="Sign in";t.signOutText="Sign out";t.isSignedIn=!1;t.userInFlight=a;t.login=function(){a&&c.processUserSignIn(v,r.path())};t.logout=function(){a&&r.path(l.signOutUri)};n.$on(l.userSignedInMSAEvent,function(){if(a){var n=c.getUserInfo();n&&n.email&&(t.userDisplayName=n.email);t.isSignedIn=!0}});n.$on(l.userSignedInAADEvent,function(){if(a){var n=c.getUserInfo();n&&n.email&&(t.userDisplayName=n.email);t.isSignedIn=!0}});n.$on(l.userNotSignedInEvent,function(){a&&(t.userDisplayName=null,t.isSignedIn=!1)})}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("languaugeselector",["$rootScope",function(){return{restrict:"A",link:function(n){$(document).ready(function(){$('a[id="locale-picker-link"]').on("click",function(){n.$broadcast("languageSelectorClicked");n.$digest()})})}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("SelfHostFeedbackController",["$scope","$window","$http","$location","clientConfig","compassService","surveyCookieService",function(n,t,i,r,u,f,e){var o=function(){var u=e.setSurveyCookie(),t=f.getSelfhostFeedback(),i;t&&(n.viewfeedback=t,i=t.selfHostFeedbackEmailBody,i=i.replace(/(\n)+/g,"%0D%0A"),t.selfHostFeedbackEmailBody=i,n.currentUrl="%0D%0AUrl: "+r.absUrl(),n.icon=String.fromCharCode("0x"+t.selfHostFeedbackIcon))};o();n.$on("CompassContentReady",function(){o()})}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("surveyCookieService",["$document",function(n){this.setSurveyCookie=function(){var t=this.getCookie("msresearch"),n="",i=(new Date).getTime(),r="",u,f,e;return(t?(u={},t.split(",").forEach(function(n){var t=n.split(":"),i;t[1]&&(u[t[0]]=t[1]);i=t[0].toString();i.indexOf("lastinvited")>-1&&(r=t[1])}),f='"lastinvited":'+r+",",e='"lastinvited":'+i+",",n=t.replace(f,e),this.setCookie("msresearch",n)):(n='"lastinvited":'+i+",",n='{ "version": "5.0", "state": { "name": "IDLE", "url": undefined, "timestamp": '+i+' }, "lastinvited": '+i+', "userid": "", "vendorid": 1, "surveys": [""], "graceperiod": 5, "trackertimestamp": 0 }',this.setCookie("msresearch",n)),n!=t)?!0:!1};this.getSurveyCookie=function(){return this.getCookie("msresearch")||""};this.setCookie=function(t,i){n[0].cookie=t+"="+i+";expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/"};this.getCookie=function(t){return t?decodeURIComponent(n[0].cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("commercialAccountController",["$scope","$uibModal","$q","authenticationHelperService","clientConfig","compassService","languageService","entitlementsService","commercialInfoService","commercialMessageModalService","messageBannerManagerService","correlationVectorService","flightService","authService","dateFilter",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){function g(t){return n.accessIdError=k(t)?!1:!0,!n.accessIdError}function nt(t){return n.passwordError=k(t)?!1:!0,!n.passwordError}function k(n){return typeof n=="string"&&n.length>3}function tt(t){var i=null,u,r,f;if(t&&t.data&&t.data.error&&(i=t.data.error),!i)return null;if(i.details&&i.details.length&&i.details.length>0)for(u=0;u<i.details.length;u++)for(r=0;r<n.homeView.metisErrorCodes.length;r++)for(f=0;f<n.homeView.metisErrorCodes[r].codes.length;f++)if(n.homeView.metisErrorCodes[r].codes[f]==i.details[u].code)return n.homeView.metisErrorCodes[r].message;return null}function it(){w?v.resolveAuthState().then(function(n){var t=v.getSupportedIDP();n!==t.MSA?v.loginUsingAccountType(t.MSA):d()}):ft()?d():r.signIn()}function d(){var r=f.getManageAccountHub(),t,i;r&&(t=f.getCommercialIncidentsHub(),t)&&(i=f.getPremierHomeView2(),i)&&(n.tableSortDisabled=!0,n.accountView=r.manageAccountContent,n.incidentsViewModel=t,n.homeView=i,n.tableConfig={disableSorting:!0,disableSpinner:!0,columns:[{columnName:n.accountView.removeColumnHeading,propertyName:"removeChecked",defaultColumn:!0,defaultColumnOrder:0,checkBoxControl:!0},{columnName:n.accountView.accessIdColumnHeading,propertyName:"accessId",defaultColumn:!0,defaultColumnOrder:1},{columnName:n.accountView.scheduleNameColumnHeading,propertyName:"scheduleName",defaultColumn:!0,defaultColumnOrder:2},{columnName:n.accountView.expirationColumnHeading,propertyName:"endDate",defaultColumn:!0,defaultColumnOrder:3,format:"dateTimeFormat"},{columnName:n.accountView.statusColumnHeading,propertyName:"status",defaultColumn:!0,defaultColumnOrder:4}]},p())}function p(){o.getEntitlements().then(function(t){var i=[],r={};t.incidentSubmitContracts&&b(t.incidentSubmitContracts,r,i);t.viewOnlyContracts&&b(t.viewOnlyContracts,r,i);t.invalidContracts&&b(t.invalidContracts,r,i);n.tableContracts=i;n.viewReady=!0},function(){n.viewReady=!0;n.viewError=!0;c.notifyBanner("premierAccountsMessages",{type:"warning",id:"get-entitlements-error-acknowledge",title:n.incidentsViewModel.generalServiceErrorAlert.title,body:n.incidentsViewModel.generalServiceErrorAlert.body,cv:l.getValue()})})}function b(n,t,i){var r,u;if(n&&n.length)for(r=0;r<n.length;r++)u=rt(n[r]),n[r].removeChecked=!1,u&&!t[u]&&(i.push(n[r]),t[u]=!0)}function rt(n){var t="";return n&&n.accessId&&n.scheduleId&&n.clarifyInstallationSiteId&&(t=n.accessId+";"+n.scheduleId+";"+n.clarifyInstallationSiteId),t}function ut(n){var t=w?v.getUserInfo().email:u.authInfo.displayName;return n.replace(/\{0\}/,t)}function ft(){if(!w)return u.authInfo.authStatus()!==2&&u.authInfo.isLoggedIn()}var w=a.isUserInFlight("aad-1");n.accessIdError=null;n.passwordError=null;n.viewReady=!1;n.viewError=!1;n.registerForm={};n.$on("CompassContentReady",function(){it()});n.submitRegisterForm=function(t,i){var r=g(t),u=nt(i);r&&u&&o.registerEntitlement({AccessId:t,ContractId:i}).then(function(){n.registerForm={};p();h.showStandardMessageModal({id:"register-access-id-acknowledge",message:ut(n.accountView.addAccessIdSuccessMessageTemplate),dismissCaption:n.accountView.dialogBoxDismissButtonCaption})},function(t){var i=tt(t),r=i!=null?i:n.accountView.addAccessIdFailureGeneralMessage;h.showStandardMessageModal({id:"register-access-id-failure-acknowledge",message:r,dismissCaption:n.accountView.dialogBoxDismissButtonCaption})})};n.submitRemoveForm=function(){for(var f,u,e,r=[],t=0;t<n.tableContracts.length;t++)if(n.tableContracts[t].removeChecked){for(f=!1,u=0;u<r.length;u++)if(r[u].accessId==n.tableContracts[t].accessId&&r[u].contractId==n.tableContracts[t].contractId){f=!0;break}if(f)continue;r.push({accessId:n.tableContracts[t].accessId,contractId:n.tableContracts[t].contractId})}if(!(r.length<1)){for(e=[],t=0;t<r.length;t++)e.push(o.unregisterEntitlement({AccessId:r[t].accessId,ContractId:r[t].contractId}));i.all(e).then(function(){h.showStandardMessageModal({id:"remove-access-id-acknowledge",message:n.accountView.accessIdRemovedMessage,dismissCaption:n.accountView.dialogBoxDismissButtonCaption});p()},function(){h.showStandardMessageModal({id:"remove-access-id-fail-acknowledge",message:n.accountView.accessIdNotRemovedMessage,dismissCaption:n.accountView.dialogBoxDismissButtonCaption});p()})}};n.elementChanged=function(t,i,r,u){if(i&&i==="removeChecked")for(var f=0;f<n.tableContracts.length;f++)n.tableContracts[f].accessId===t.accessId&&(n.tableContracts[f].removeChecked=u)};n.disableRemoveButton=function(){if(n.tableContracts&&n.tableContracts.length)for(var t=0;t<n.tableContracts.length;t++)if(n.tableContracts[t].removeChecked==!0)return!1;return!0};n.formatData=function(n,t){var i=n,r;return t=="dateTimeFormat"&&(r=new Date(n),i=y(r,"shortDate")),i}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("commercialContactService",["$http","$location","$q","commercialInfoService",function(n,t,i,r){this.getPremierContacts=function(){var t=r.premierContacts(),u;return t?i.when(t):(u="api/commercialcontacts/audiences/premier",n.get(u,{httpAppOptions:{cacheBust:!0,qosOperation:{name:"CommercialContactsService.GetPremierContacts",description:"Get all contacts for premier customers"}}}).then(function(n){return r.premierContacts(n.data),n.data}))};this.getRegionalContacts=function(){var t=r.regionalContacts(),u;return t?i.when(t):(u="api/commercialcontacts/regions",n.get(u,{httpAppOptions:{cacheBust:!0,qosOperation:{name:"CommercialContactsService.GetRegionalContacts",description:"Get regional CSS contacts"}}}).then(function(n){return r.regionalContacts(n.data),n.data}))}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("CommercialHubController",["$rootScope","$scope","$sce","clientConfig","authenticationHelperService","compassService","flightService","authService","metatagService",function(n,t,i,r,u,f,e,o,s){function c(){var n=f.getPremierHomeView2(),u;n&&(t.view=n,t.isPremier=!0,t.view.stringTable.premierSupportDescription=i.trustAsHtml(t.view.stringTable.premierSupportDescription),n.metaTags&&(u=s.fetchMetaTags(n.metaTags),u&&y(u)),t.viewReady=!0,h?(t.isAuthenticated=null,o.resolveAuthState().then(function(n){var t=o.getSupportedIDP();n===t.MSA?a():l()})):t.isAuthenticated=r.authInfo.authStatus()==v?null:r.authInfo.isLoggedIn())}function y(t){t.metaTagTitle&&n.$broadcast("UpdateTitle",t.metaTagTitle);t.pageMetaTags&&n.$broadcast("AddMetaTags",t.pageMetaTags)}function l(){t.isAuthenticated=!1}function a(){t.isAuthenticated=!0}var h=e.isUserInFlight("aad-1"),v=2;t.viewReady=!1;t.isAuthenticated=null;h||t.$on("UserSignedIn",function(){a()});t.$on("UserSignedOut",function(){l()});t.$on("CompassContentReady",function(){c()});t.signIn=function(){if(h){var n=o.getSupportedIDP();o.loginUsingAccountType(n.MSA)}else u.signIn()};c()}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("incidentDetail",["$route","$q","incidentsService","dateFilter","orderByFilter","messageBannerManagerService","clientConfig","authenticationHelperService","compassFormatFilter","fileUploaderService","compassService","commercialMessageModalService","commercialTelemetryService","flightService","authService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){return{templateUrl:"/PartialViews/Commercial/IncidentDetails.html",link:function(p){function g(){var n=c.getIncidentDetailHub(),t;n&&(p.fileSelectionError=!1,p.view=n.incidentDetailContent,p.supportRequestLabel=s(p.view.titleFormat,{"incident-id":""}),p.incidentNumber=w,p.detailTabs=[p.view.incidentDetailSummaryContent.subtitle,p.view.incidentDetailEngineerNotesTitle,p.view.incidentDetailMessagesContent.incidentDetailMessagesSubtitle],t=s(p.view.incidentDetailMessagesContent.incidentDetailMessageDetailPrivacyStatementLinkFormat,{"privacy-link-url":p.view.incidentDetailMessagesContent.incidentDetailMessageDetailPrivacyStatementLinkUrl}),p.messageUpdatePrivayStatement=s(p.view.incidentDetailMessagesContent.incidentDetailMessageDetailPrivacyStatementFormat,{"privacy-link":t}))}function nt(n){if(p.canUpdate)p.displayMessageForm=!0,n!=undefined&&n>=0?p.messageSubject=p.communications[n].subject:p.currentCommunicationIndex=-1;else{var t=k();f.notifyBanner(b,{type:"info",title:s(p.view.incidentDetailMessagesContent.noPermissionToUpdateIncidentAlert.title,{email:t}),body:p.view.incidentDetailMessagesContent.noPermissionToUpdateIncidentAlert.body})}}function tt(){p.canUpdate=!1;p.canView=!1;p.gettingIncident=!0;i.getIncident(n.current.params.incidentId).then(function(n){p.incident=n;var t=parseInt(p.incident.incident.userIncidentPermission,10);p.canUpdate=t==2;p.canView=t>0;t>0&&rt(p.incident.incident)},function(n){if(n.status===403){var t=k();f.notifyBanner(b,{type:"warning",title:p.view.noPermissionToViewIncidentAlert.title,body:s(p.view.noPermissionToViewIncidentAlert.body,{email:t})})}else f.notifyBanner(b,{type:"warning",title:p.view.generalServiceErrorAlert.title,body:p.view.generalServiceErrorAlert.body})})["finally"](function(){p.gettingIncident=!1});et(w,function(n){p.attachments=n.data},function(){p.attachments=[]})}function rt(n){var f=[],i=[],e,s,h,o,t;p.currentCommunicationIndex=-1;n&&(n.notes&&(s=0,n.notes.forEach(function(n){n&&n.logs&&n.logs.forEach(function(n){n&&(f.push(n),s++,(!e||n.createdDateTime>e.createdDateTime)&&(e=n))})}),e&&(n.lastUpdatedNote=e,n.numberOfNotes=s)),n.communications=n.communications&&n.communications.length?n.communications:[],typeof n.hasDescriptionCommunication=="undefined"&&(h=ut(n),n.communications.push(h),n.hasDescriptionCommunication=!0),n.communications.forEach(function(n){n&&n.isCustomerViewable===!0&&n.subject&&(i.push(n),(!o||n.createdDateTime>o)&&(o=n.createdDateTime))}),o&&(n.lastUpdatedDateForCommunications=o));t=null;f.length>0&&(f=u(f,"createdDateTime",!0),f.forEach(function(n){if(n){t==null&&(t={});var i=r(n.createdDateTime,p.view.incidentDetailSummaryContent.incidentCreateDateShortFormat);t.hasOwnProperty(i)?t[i].push(n):t[i]=[n]}}));p.engineerNotes=t;i&&i.length>0&&(p.isCommunicationDateDesc=!0,i=u(i,"createdDateTime",p.isCommunicationDateDesc));p.communications=i}function ut(n){var t={};return t.sender=n.primaryContact.primaryEmailAddress,t.directionCode=p.config.messageDirectionCode.incoming,t.subject=n.title,t.createdDateTime=n.createdDateTime,t.isCustomerViewable=!0,t.body=n.description,t}function ft(n,i){return i&&i.length?h.getIncidentWorkspace(n).then(function(r){return h.getWorkspaceFiles(r.data.workspaceId).then(function(r){var u=r.data,o=[],f,s,e,c;if(u&&u.length)for(f=0;f<i.length;f++)for(s=i[f],e=0;e<u.length;e++)c=u[e],s.name==c.fileName&&o.push(s);return o.length>0?(console.log("rejecting attachment upload due to conflicting files"),t.reject({conflictingFiles:o})):(console.log("no conflicting files found so uploading files"),h.uploadToWorkspace(i,n))})},function(r){return r.status=="404"?(console.log("fileUploaderService.getIncidentWorkspace did not return a workspace"),h.uploadToWorkspace(i,n)):t.reject("fileUploaderService.getIncidentWorkspace returned unexpected error")}):t.when([])}function et(n,t,i){return h.getIncidentWorkspace(n).then(function(n){return h.getWorkspaceFiles(n.data.workspaceId).then(function(n){t(n)})},function(n){i(n)})}function ot(n){var t=[];return n&&n.length&&n.length>0?angular.forEach(n,function(n){t.push(n.data)}):n&&!angular.isArray(n)&&t.push(n.data),t}function k(){return d?y.getUserInfo().email:e.authInfo.displayName}var w=n.current.params.incidentId,d=v.isUserInFlight("aad-1"),it,b;d?y.resolveAuthState().then(function(n){var t=y.getSupportedIDP();n===t.MSA?tt():y.loginUsingAccountType(t.MSA)}):o.signIn(tt);it=-1;b="incidentServiceMessages";p.sectionUrls=["/PartialViews/Commercial/IncidentSummary.html","/PartialViews/Commercial/IncidentNotes.html","/PartialViews/Commercial/IncidentMessages.html"];p.selectedTabIndex=0;p.sectionUrl=p.sectionUrls[0];p.newMessageForm={};p.maxFileSizeBytes=e.DtmWorkspaceConfiguration.FileUploadMaxBytes;p.maxFileCount=e.DtmWorkspaceConfiguration.FileUploadMaxFiles;p.hideMetadataInSmall=!0;p.showOnlyLatestNote=!0;p.displayMessageForm=!1;p.config=p.config||{};p.config.messageDirectionCode={incoming:"0",outgoing:"1"};p.lessMessageLimit=10;p.messageDisplayLimit=p.lessMessageLimit;g();p.$on("CompassContentReady",function(){g()});p.loadSection=function(n){p.selectedTabIndex=n;p.sectionUrl=p.sectionUrls[n];p.currentCommunicationIndex=-1;p.hasMessageSendingError=!1};p.toggleCommunicationsOrder=function(){p.isCommunicationDateDesc=!p.isCommunicationDateDesc;p.communications=u(p.communications,"createdDateTime",p.isCommunicationDateDesc)};p.viewCommunicationDetail=function(n){p.currentCommunicationIndex>=0&&n==p.currentCommunicationIndex?p.currentCommunicationIndex=-1:(p.currentCommunicationIndex=n,p.currentCummunication=p.communications[n]);p.cancelMessageUpdate()};p.viewAllCommunications=function(){p.currentCommunicationIndex=-1};p.getPreviousMessage=function(){p.currentCommunicationIndex--;p.currentCummunication=p.communications[p.currentCommunicationIndex]};p.getNextMessage=function(){p.currentCommunicationIndex++;p.currentCummunication=p.communications[p.currentCommunicationIndex]};p.replyMessage=function(n){nt(n)};p.createNewMessage=function(){nt()};p.cancelMessageUpdate=function(){p.displayMessageForm=!1;p.hasMessageSendingError=!1;p.newMessageForm={}};p.sendMessageUpdate=function(n){p.isSendingMessage=!0;p.hasMessageSendingError=!1;n.subject=n.subject||p.messageSubject;var r=(new Date).getTime(),t=null;ft(w,n.attachments).then(function(r){t=ot(r);var u=k();return i.updateIncident(w,n.subject,n.body,u,t)}).then(function(n){a.logUpdateIncident(w,(new Date).getTime()-r,t&&t.length&&t.length>0?t.length:0,!0);p.attachments=p.attachments||[];p.attachments=p.attachments.concat(t);p.newMessageForm={};var i=n;return p.communications.unshift(i),p.currentCommunicationIndex=-1,p.displayMessageForm=!1,p.currentCummunication=p.communications[0],p.incident.incident.lastUpdatedDateForCommunications=new Date,n},function(n){var u,i;a.logUpdateIncident(w,(new Date).getTime()-r,t&&t.length&&t.length>0?t.length:0,!1);p.hasMessageSendingError=!0;n.status===403?(u=k(),f.notifyBanner(b,{type:"info",title:s(p.view.incidentDetailMessagesContent.noPermissionToUpdateIncidentAlert.title,{email:u}),body:p.view.incidentDetailMessagesContent.noPermissionToUpdateIncidentAlert.body})):n.conflictingFiles?(i=[],angular.forEach(n.conflictingFiles,function(n){i.push(n.name)}),l.showStandardMessageModal({id:"update-incident-error-acknowledge",title:p.view.filesAlreadyUploadedAlert.title,message:p.view.filesAlreadyUploadedAlert.body+i.join(", "),dismissCaption:p.view.alertDialogDismissButtonCaption,cv:correlationVectorService.getValue()})):f.notifyBanner(b,{type:"warning",title:p.view.generalServiceErrorAlert.title,body:p.view.generalServiceErrorAlert.body,dismissCaption:p.view.alertDialogDismissButtonCaption,cv:correlationVectorService.getValue()})})["finally"](function(){p.isSendingMessage=!1})};p.removeFile=function(n,t){if(t&&t.length&&t.length>0)for(var i=0;i<t.length;i++)if(t[i].name===n.name){t.splice(i,1);break}};p.enableTooltips=function(){$('[data-toggle="tooltip"]').tooltip()};p.fileUploadBeforeModelChange=function(n){p.fileSelectionError=h.validateUploadFiles(p.newMessageForm.attachments,n,p.maxFileCount)};p.toggleMetadata=function(){p.hideMetadataInSmall=!p.hideMetadataInSmall};p.toggleShowNotes=function(){p.showOnlyLatestNote=!p.showOnlyLatestNote};p.toggleShowMessages=function(){p.messageDisplayLimit=p.messageDisplayLimit!=p.lessMessageLimit?p.lessMessageLimit:p.communications.length}}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("commercialInfoService",["clientConfig","$rootScope",function(n,t){function u(){n.authInfo.commercialUserInfo||(n.authInfo.commercialUserInfo={})}function o(t){return u(),n.authInfo.commercialUserInfo[t]!=null?n.authInfo.commercialUserInfo[t]:null}function e(t){return u(),n.authInfo.commercialUserInfo[t]==null&&(n.authInfo.commercialUserInfo[t]={}),n.authInfo.commercialUserInfo[t]}function s(t,i){return u(),n.authInfo.commercialUserInfo[t]=i}function h(t){u();n.authInfo.commercialUserInfo[t]=null}function i(n,t,i){if(i){h(n);return}if(!t)return o(n);s(n,t)}function c(t){u();n.authInfo.commercialUserInfo[t]={}}function r(n,t,i,r){if(r){c(n);return}var u=e(n);u[t]=i}function f(n,t){var i=e(n);return i[t]!=null?i[t]:null}t.$on("ProcessUserSignOut",function(){n.authInfo&&(n.authInfo.commercialUserInfo={})});this.incidentList=function(n,t){return i("incidentList",n,t)};this.saveIncident=function(n,t){if(t){r("incident",null,null,t);return}r("incident",n.incident.id,n,t)};this.getIncident=function(n){return n?f("incident",n):null};this.contracts=function(n,t){return i("contracts",n,t)};this.getProductContracts=function(n){return n?f("product-contracts",n):null};this.saveProductContracts=function(n,t,i){r("product-contracts",n,t,i)};this.getProductContractsPromise=function(n){return n?f("product-contracts-promise",n):null};this.saveProductContractsPromise=function(n,t,i){r("product-contracts-promise",n,t,i)};this.productContractsPromise=function(n,t,r){return i("product-contracts-promise:"+n,t,r)};this.incidentTableColumnConfig=function(n,t){return i("incidentTableColumnConfig",n,t)};this.incidentTableFilterConfig=function(n,t){return i("incidentTableFilterConfig",n,t)};this.accessIdProducts=function(n,t){return i("accessIdProducts",n,t)};this.tamInfo=function(n,t,r){return i("tamInfo"+n,t,r)};this.premierContacts=function(n,t){return i("premierContacts",n,t)};this.regionalContacts=function(n,t){return i("regionalContacts",n,t)};this.supportTopics=function(n,t,r,u){return i("supportTopics,"+n+","+t,r,u)};this.scopingQuestions=function(n,t,r,u,f){return i("scopingQuestions,"+n+","+t+","+r,u,f)};this.customScopingQuestions=function(n,t,r,u){return i("customScopingQuestions,"+n+","+t,r,u)};this.diagnosticMetadata=function(n,t,r,u,f){return i("diagnosticMetadata,"+n+","+t+","+r,u,f)};this.saveThirdTierCompCode=function(n,t){if(t){r("3rdTierComponentCode",null,null,t);return}r("3rdTierComponentCode",n.componentCode,n,t)};this.getThirdTierCompCode=function(n){return n?f("3rdTierComponentCode",n):null};this.saveHidenAlert=function(n,t){return i("siteAlerts:"+n,!0,t)};this.getHidenAlert=function(n){if(n)return i("siteAlerts:"+n)}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("commercialMessageModalService",["$uibModal",function(n){this.showStandardMessageModal=function(t,i,r){var u=n.open({templateUrl:"/PartialViews/Commercial/standardModal.html",backdropClass:"smc-modal-backdrop",windowClass:"commercial-modal-window",resolve:{displayContent:function(){return t}},controller:["$scope","$uibModalInstance","displayContent",function(n,t,i){n.registerMessage=i;n.dismiss=function(){t.close()}}]});u.result.then(function(){if(typeof i=="function")return i()},function(){typeof r=="function"&&r()})}}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("emailListValidator",[function(){var n=/^.+@.+\..+$/i;return{restrict:"A",require:"ngModel",link:function(t,i,r,u){u&&u.$validators&&(u.$validators.emailList=function(t,i){var f,s,h,e,o;if(u.$isEmpty(i)||(f=i.trim().split(/\s*;\s*/),f==undefined||f.length==0))return!0;for(s=0,h=r.maxEmailLimit&&parseInt(10,r.maxEmailLimit)||10,o=0;o<f.length;o++)if((e=f[o],e&&!n.test(e))||e&&(s++,s>h))return!1;return!0})}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("entitlementsService",["$http","$q","$location","commercialInfoService","incidentsService",function(n,t,i,r,u){function c(n){n.userContractState=f.Authenticated;n&&n.isPremier&&(n.incidentSubmitContracts&&n.incidentSubmitContracts.length?n.userContractState=f.Full:n.viewOnlyContracts&&n.viewOnlyContracts.length&&(n.userContractState=f.ReadOnly))}function l(){r.contracts(null,!0);r.saveProductContracts(null,null,!0);r.saveProductContractsPromise(null,null,!0);a.getEntitlements()}var e=!1,s=null,o=!1,h=null,f={Unauthenticated:0,Authenticated:1,ReadOnly:2,Full:3},a=this;this.userContractState=function(){return f};this.getEntitlements=function(){var i;return r.contracts()?t.when(r.contracts()):(i=this,r.incidentList(null,!0),r.accessIdProducts(null,!0),r.tamInfo(null,!0),u.getIncidents(),e||(s=n.get("/api/entitlements",{httpAppOptions:{cacheBust:!0,qosOperation:{name:"EntitlementsService.GetAllEntitlements",description:"get all entitlements for a user"}}}).then(function(n){c(n.data);r.contracts(n.data);var t=[];return angular.forEach(n.data.incidentSubmitContracts,function(n){t.push(n.accessId)}),t.length>0&&(i.getAccessIdProducts(t),i.getTamInfo(t[0])),n.data})["finally"](function(){e=!1}),e=!0),s)};this.getProductEntitlements=function(i){var u;return r.getProductContracts(i)?t.when(r.getProductContracts(i)):r.getProductContractsPromise(i)?r.getProductContractsPromise(i):(u=n.get("/api/entitlements",{params:{productId:i},httpAppOptions:{cacheBust:!0,qosOperation:{name:"EntitlementsService.GetUserEntitlementsForProductId",description:"get a user's entitlements filtered by productId"}}}).then(function(n){return c(n.data),r.saveProductContracts(i,n.data),n.data},function(n){r.saveProductContractsPromise(i,null);t.reject(n)}),r.saveProductContractsPromise(i,u),u)};this.getAccessIdProducts=function(i){var f,u,e;return r.accessIdProducts()?(f=t.defer(),f.resolve(r.accessIdProducts()),f.promise):(o||(u=null,i!=null&&i.length&&(u=i.join(",")),e={httpAppOptions:{cacheBust:!0,qosOperation:{name:"EntitlementsService.GetDisplayProductsForAccessIds",description:"get products that can be displayed to a user filtered by access IDs associated with their account"}}},u!=null&&(e.params={accessIds:u}),h=n.get("/api/entitlements/displayproducts",e).then(function(n){return r.accessIdProducts(n.data),n.data})["finally"](function(){o=!1}),o=!0),h)};this.disclaimerForPesId=function(t){return n.get("api/Entitlements/DisplayProducts/Disclaimers/"+t,{httpAppOptions:{cacheBust:!0,qosOperation:{name:"EntitlementsService.GetDisclaimersForPesId",description:"Get disclaimers for a specific product"}}})};this.registerEntitlement=function(t){return t.Action="Add",n.post("/api/entitlements",t,{headers:{"Content-Type":"application/json"},httpAppOptions:{qosOperation:{name:"EntitlementsService.RegisterAccessId",description:"register a new entitlement for a user"}}}).then(function(n){return l(),n})};this.unregisterEntitlement=function(t){return t.Action="Remove",n.post("/api/entitlements",t,{headers:{"Content-Type":"application/json"},httpAppOptions:{qosOperation:{name:"EntitlementsService.RemoveAccessId",description:"unregister entitlement for a user"}}}).then(function(n){return l(),n})};this.getTamInfo=function(i){var u;return r.tamInfo(i)?(u=t.defer(),u.resolve(r.tamInfo(i)),u.promise):(u=t.defer(),n.get("/api/entitlements/"+i+"/taminfo",{httpAppOptions:{cacheBust:!0,qosOperation:{name:"EntitlementsService.GetTamInfo",description:"Fetch TAM information for a user's access ID"}}}).then(function(n){angular.forEach(n.data.tamContactInfo,function(t){r.tamInfo(t.accessId,n.data)});u.resolve(n.data)}),u.promise)};this.getThirdTierComponentCode=function(i){var u;return r.getThirdTierCompCode(i)?(u=t.defer(),u.resolve(r.getThirdTierCompCode(i)),u.promise):promise=n.get("/api/entitlements/thirdtiercomponentcodes/"+i,{httpAppOptions:{cacheBust:!0,qosOperation:{name:"EntitlementsService.GetThirdTierComponentCode",description:"Fetch component code information for a third tier component code"}}}).then(function(n){return r.saveThirdTierCompCode(n.data),n.data})}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("fileUploaderService",["$http","$q","$log","Upload",function(n,t,i,r){function u(n,i){var f={name:"FileUploaderService.DoFileUpload",description:"Upload a single file to the DTM Workspace"},u=[];return angular.forEach(i,function(t){var i="/api/Incidents/Assets/FileWorkspaces/"+n+"/Files";u.push(r.upload({url:i,file:t,httpAppOptions:{qosOperation:f}}))}),t.all(u)}this.uploadToNewWorkspace=function(t){return n.post("api/Incidents/Assets/FileWorkspaces",null,{headers:{"Content-Type":"application/json"},httpAppOptions:{qosOperation:{name:"FileUploaderService.UploadToNewWorkspace",description:"Create a new DTM workspace for an incident and upload files to the workspace"}}}).then(function(n){return u(n.data.workspaceId,t)})};this.uploadToWorkspace=function(t,i){return n.post("api/Incidents/Assets/FileWorkspaces",{incidentId:i},{headers:{"Content-Type":"application/json"},httpAppOptions:{qosOperation:{name:"FileUploaderService.UploadToWorkspace",description:"Find or create DTM workspace for an incident and upload files to the workspace"}}}).then(function(n){return u(n.data.workspaceId,t)})};this.uploadFiles=function(n,t){return u(n,t)};this.setWorkspaceIncidentIdProperty=function(t,r){var u="/api/Incidents/Assets/FileWorkspaces/"+t+"/Properties",f={workspaceId:t,incidentId:r};return i.info("DTM worksapce with id "+t+" associated with incident "+r),n.post(u,f,{headers:{"Content-Type":"application/json"},httpAppOptions:{qosOperation:{name:"FileUploaderService.SetWorkspaceIncidentProperty",description:"Set the METIS incident ID on DTM workspace"}}})};this.getIncidentWorkspace=function(t){return n.get("/api/Incidents/Assets/FileWorkspaces",{params:{incidentId:t},httpAppOptions:{cacheBust:!0,qosOperation:{name:"FileUploaderService.GetIncidentWorkspace",description:"Get DTM file workspace for user specified incident ID"}}})};this.getWorkspaceFiles=function(t){return n.get("/api/Incidents/Assets/FileWorkspaces/"+t+"/Files",{httpAppOptions:{cacheBust:!0,qosOperation:{name:"FileUploaderService.GetWorkspaceFiles",description:"Get DTM workspace files for a user specified workspace id"}}})};this.validateUploadFiles=function(n,t,i){var u=!1,r;if(n&&n.length&&n.length>0&&t&&t.length&&t.length>0&&t.length>i){for(t.splice(0,t.length),r=0;r<n.length;r++)t.push(n[r]);u=!0}return u}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("filterController",[function(){var i={open:2,closed:3},n=this,t=function(n){var t=n;return n instanceof Date||(t=new Date(n)),t},r=function(n){var i=t(n);return i.setHours(23,59,59,999),i},u=function(n){var i=t(n);return i.setHours(0,0,0,0),i},f=function(n){n.openBegin&&(n.openBegin=u(n.openBegin));n.openEnd&&(n.openEnd=r(n.openEnd));n.lastUpdateBegin&&(n.lastUpdateBegin=u(n.lastUpdateBegin));n.lastUpdateEnd&&(n.lastUpdateEnd=r(n.lastUpdateEnd))},e=function(t){return n.filter.searchResultIsSet?t.isSearchResult:!0},o=function(t){return n.filter.openCheckbox&&t.filterableStatus===i.open||n.filter.closedCheckbox&&t.filterableStatus===i.closed},s=function(i){var f=!1,e=!1,r=i.incident.createdDateTime?t(i.incident.createdDateTime):null,u=i.incident.lastModifiedDateTime?t(i.incident.lastModifiedDateTime):null;return f=n.filter.openBegin&&n.filter.openEnd?r!=null&&r>=n.filter.openBegin&&r<=n.filter.openEnd:n.filter.openBegin?r!=null&&r>=n.filter.openBegin:n.filter.openEnd?r!=null&&r<=n.filter.openEnd:!0,e=n.filter.lastUpdateBegin&&n.filter.lastUpdateEnd?u!=null&&u>=n.filter.lastUpdateBegin&&u<=n.filter.lastUpdateEnd:n.filter.lastUpdateBegin?u!=null&&u>=n.filter.lastUpdateBegin:n.filter.lastUpdateEnd?u!=null&&u<=n.filter.lastUpdateEnd:!0,f&&e};this.validateAndSetFilter=function(t){return t!=null?(f(t),t.openBegin&&t.openEnd&&t.openEnd<=t.openBegin)?!1:t.lastUpdateBegin&&t.lastUpdateEnd&&t.lastUpdateEnd<=t.lastUpdateBegin?!1:(n.filter=t,!0):!1};this.checkFilter=function(t){if(n.filter)return e(t)&&o(t)&&s(t);throw"invalid operation-filter has not been set";}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("incidentSeverityService",["$http","$q","currentLanguageService",function(n,t,i){this.getSeverityConfig=function(t,r,u){var f={marketServiceId:r.serviceId,localeOverride:i.getLang(),pesId:t.pesId};return u&&(f.region=u.isoRegionCode),n.get("/api/Incidents/severityoptions/"+r.contractTypeName,{params:f,httpAppOptions:{cacheBust:!0,qosOperation:{name:"IncidentSeverityService.GetSeverityConfig",description:"Get severity configuration for an incident request"}}})}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("IncidentsHubController",["$scope","$location","$timeout","$locale","incidentsService","entitlementsService","languageService","compassService","commercialInfoService","objectTableApi","clientConfig","authenticationHelperService","commercialMessageModalService","messageBannerManagerService","correlationVectorService","filterController","flightService","authService","dateFilter",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){function bt(){n.showFilters=!1;n.isFilterOpen=!1;n.showColumnPicker=!1;n.isColumnPickerOpen=!1;n.filterSelection={};n.columnSelection={};n.selectedSortColumn=ht;n.selectedSortOrder=wt;n.visibleIncidentCount=et;n.searchQuery="";n.entitlements=null;var t=o.getCommercialIncidentsHub();t&&(n.viewContent=t,n.objectTable=t.incidentsTable,n.viewLengthCaption=t.stringTable.showMoreCaption,n.viewAll=!1,ni(),at(),kt())}function kt(){f.getEntitlements().then(function(t){n.entitlements=t;n.hasEntitlements=t&&t.userContractState&&t.userContractState>f.userContractState().Authenticated;n.hasCreateEntitlements=t&&t.userContractState&&t.userContractState>f.userContractState().ReadOnly;n.hasEntitlements?gt():(n.hasIncidents=!1,n.viewReady=!0)},function(){n.hasIncidents=!1;n.hasErrors=!0;n.viewReady=!0;v.notifyBanner("incidentsHubMessages",{type:"warning",id:"get-entitlements-service-error",title:n.viewContent.generalServiceErrorAlert.title,body:n.viewContent.generalServiceErrorAlert.body,cv:y.getValue()})})}function dt(){n.viewReady=!1;pt?b.resolveAuthState().then(function(n){var t=b.getSupportedIDP();n===t.MSA?ct():b.loginUsingAccountType(t.MSA)}):l.signIn(ct)}function ct(){bt()}function gt(){u.getIncidents().then(function(t){angular.forEach(t,function(n){n.visible=!0});t&&t.length&&t.length>0?(n.hasIncidents=!0,n.allIncidents=t,ft(n.selectedSortOrder,n.selectedSortColumn,n.allIncidents),tt(),it(n.visibleIncidentCount)):n.hasIncidents=!1},function(){n.userIncidents=[];n.hasErrors=!0;v.notifyBanner("incidentsHubMessages",{type:"warning",id:"get-incidents-service-error",title:n.viewContent.generalServiceErrorAlert.title,body:n.viewContent.generalServiceErrorAlert.body,cv:y.getValue()})})["finally"](function(){n.viewReady=!0})}function ni(){var t,i;if(s.incidentTableColumnConfig())for(n.columnSelection=s.incidentTableColumnConfig(),t=0;t<n.objectTable.columns.length;t++)i=lt(n.objectTable.columns[t].columnId),n.objectTable.columns[t].defaultColumn=n.columnSelection[i]?n.columnSelection[i].selected:!1;else{for(t=0;t<n.objectTable.columns.length;t++)i=lt(n.objectTable.columns[t].columnId),n.columnSelection[i]={selected:n.objectTable.columns[t].defaultColumn===!0?!0:!1,name:n.objectTable.columns[t].columnName},n.objectTable.columns[t].active=n.objectTable.columns[t].propertyName==ht?!0:!1;s.incidentTableColumnConfig(n.columnSelection)}}function lt(n){return n=n.toLowerCase(),n.replace(/ /g,"")}function at(){s.incidentTableFilterConfig()?nt(n.filterSelection,s.incidentTableFilterConfig()):(nt(n.filterSelection,ut),s.incidentTableFilterConfig(nt({},ut)))}function nt(n,t){return n.searchResultIsSet=t.searchResultIsSet,n.openCheckbox=t.openCheckbox,n.closedCheckbox=t.closedCheckbox,n.openBegin=t.openBegin,n.openEnd=t.openEnd,n.lastUpdateBegin=t.lastUpdateBegin,n.lastUpdateEnd=t.lastUpdateEnd,n}function it(t){for(var r=[],u=Math.min(t,n.allIncidents.length),i=0;i<n.allIncidents.length&&r.length<u;i++)n.allIncidents[i].visible===!0&&r.push(n.allIncidents[i]);n.userIncidents=r}function ti(){n.filterSelection&&s.incidentTableFilterConfig(nt({},n.filterSelection))}function ii(){var t=s.incidentTableFilterConfig();t!=null&&nt(n.filterSelection,t)}function ot(){s.incidentTableFilterConfig(nt({},ut));nt(n.filterSelection,ut);tt()}function tt(){var u=!1,t={},r,i;if(t.openCheckbox=n.filterSelection.openCheckbox,t.closedCheckbox=n.filterSelection.closedCheckbox,t.openBegin=n.filterSelection.openBegin,t.openEnd=n.filterSelection.openEnd,t.lastUpdateBegin=n.filterSelection.lastUpdateBegin,t.lastUpdateEnd=n.filterSelection.lastUpdateEnd,!p.validateAndSetFilter(t)){ii();a.showStandardMessageModal({id:"incident-view-invalid-filter",title:n.viewContent.stringTable.filterIncidentsFilterInvalidTitle,message:n.viewContent.stringTable.filterIncidentsFilterInvalidBody,dismissCaption:n.viewContent.stringTable.alertDialogDismissButtonCaption});return}if(ti(),angular.forEach(n.allIncidents,function(n){n.visible=!1;n.isSearchResult=!1;u=!0}),n.searchResults)for(t.searchResultIsSet=!0,r=0;r<n.searchResults.length;r++)for(i=0;i<n.allIncidents.length;i++)if(n.searchResults[r].incident.id==n.allIncidents[i].incident.id){n.allIncidents[i].isSearchResult=!0;break}t.openCheckbox=n.filterSelection.openCheckbox;t.closedCheckbox=n.filterSelection.closedCheckbox;t.openBegin=n.filterSelection.openBegin;t.openEnd=n.filterSelection.openEnd;t.lastUpdateBegin=n.filterSelection.lastUpdateBegin;t.lastUpdateEnd=n.filterSelection.lastUpdateEnd;p.validateAndSetFilter(t);angular.forEach(n.allIncidents,function(n){n.visible=p.checkFilter(n)})}function ri(n,t,i,r){var u=h.objectByString(r,t),f=h.objectByString(i,t);return n?u-f:f-u}function ui(n,t,i,r){var u=new Date(h.objectByString(r,t)),f=new Date(h.objectByString(i,t));return n?f-u:u-f}function fi(n,t,i,r){var f=h.objectByString(r,t),e=h.objectByString(i,t),u=e.localeCompare(f);return n?u:u*-1}function ei(n,t,i,r){var u=h.getJoinProperty(r,t),f=h.getJoinProperty(i,t);return n?u<f?-1:u>f?1:0:u<f?1:u>f?-11:0}function ft(n,t,i){var r=t.indexOf(h.joinToken)==0?h.joinToken:t;switch(r){case"incident.id":i.sort(function(i,r){return ri(n.sortDescending===!1,t,i,r)});break;case"incident.status":case"incident.title":case"incident.severity":case"incident.productName":i.sort(function(i,r){return fi(n.sortDescending===!1,t,i,r)});break;case"incident.createdDateTime":case"incident.lastModifiedDateTime":case"incident.closedDateTime":i.sort(function(i,r){return ui(n.sortDescending===!1,t,i,r)});break;case h.joinToken:i.sort(function(i,r){return ei(n.sortDescending===!1,t,i,r)})}}function vt(n){var t=new Date(n);return result=k(t,"shortDate")}function g(n){return n!=null&&n!==undefined&&typeof n=="string"||n instanceof String}function st(n){if(n!=null&&n!==undefined){var t=n instanceof Date?vt(n):n;if(g(t))return t}return null}function yt(){n.searchResults=null;ot();tt();it(n.visibleIncidentCount)}function oi(t){n.searchResults=si(t);ot();tt();it(n.visibleIncidentCount)}function d(n,t){var i=n.toLocaleUpperCase(),r=t.toLocaleUpperCase(),u=r.indexOf(i);return u>=0}function si(t){for(var i,e,u,r=[],f=0;f<n.allIncidents.length;f++)i=n.allIncidents[f],i.incident&&(g(i.incident.id)&&d(t,i.incident.id)&&r.push(i),g(i.incident.status)&&d(t,i.incident.status)&&r.push(i),g(i.incident.severity)&&d(t,i.incident.severity)&&r.push(i),g(i.incident.productName)&&d(t,i.incident.productName)&&r.push(i),g(i.incident.title)&&d(t,i.incident.title)&&r.push(i),i.incident.primaryContact&&g(i.incident.primaryContact.firstName)&&d(t,i.incident.primaryContact.firstName)&&r.push(i),i.incident.primaryContact&&g(i.incident.primaryContact.lastName)&&d(t,i.incident.primaryContact.lastName)&&r.push(i),i.incident.primaryContact&&g(i.incident.primaryContact.firstName)&&i.incident.primaryContact&&g(i.incident.primaryContact.lastName)&&(e=i.incident.primaryContact.firstName+" "+i.incident.primaryContact.lastName,d(t,e)&&r.push(i)),u=st(i.incident.createdDateTime),u&&d(t,u)&&r.push(i),u=st(i.incident.lastModifiedDateTime),u&&d(t,u)&&r.push(i),u=st(i.incident.closedDateTime),u&&d(t,u)&&r.push(i));return r}var pt=w.isUserInFlight("aad-1"),et=5,wt={sortDescending:!0},ht="incident.lastModifiedDateTime",ut={searchResultIsSet:!1,openCheckbox:!0,closedCheckbox:!0,openBegin:null,openEnd:null,lastUpdateBegin:null,lastUpdateEnd:null},rt;n.viewReady=!1;n.showingMore=!1;n.hasIncidents=!1;n.hasEntitlements=!1;n.hasCreateEntitlements=!1;n.hasErrors=!1;n.toggleFilterControls=function(t){n.showFilters=!n.showFilters;n.isFilterOpen=!t;n.showColumnPicker=n.showFilters?!1:n.showColumnPicker};n.toggleViewControls=function(t){n.showColumnPicker=!n.showColumnPicker;n.isColumnPickerOpen=!t;n.showFilters=n.showColumnPicker?!1:n.showFilters};n.applyFilter=function(){n.showFilters=!1;tt();it(n.visibleIncidentCount)};n.cancelFilter=function(){n.showFilters=!1;at()};n.resetFilter=function(){n.showFilters=!1;ot()};n.applyColumPicker=function(){var i,r,u,t;n.showColumnPicker=!1;for(i in n.columnSelection)for(r=n.columnSelection[i].selected,u=n.columnSelection[i].name,t=0;t<n.objectTable.columns.length;t++)n.objectTable.columns[t].columnName==u&&(n.objectTable.columns[t].defaultColumn=r);s.incidentTableColumnConfig(n.columnSelection)};n.cancelColumPicker=function(){var t,i;if(n.showColumnPicker=!1,t=s.incidentTableColumnConfig(),t)for(i in t)n.columnSelection[i].selected=t[i].selected,n.columnSelection[i].name=t[i].name};n.sortData=function(t,i){n.selectedSortOrder=t;n.selectedSortColumn=i;ft(n.selectedSortOrder,n.selectedSortColumn,n.userIncidents)};n.formatData=function(n,t){var i=n;return t=="dateTimeFormat"&&(i=n?vt(n):""),i};n.viewLengthClicked=function(){n.showingMore=!0;i(function(){n.viewAll=!n.viewAll;n.viewLengthCaption=n.viewAll?n.viewContent.stringTable.showLessCaption:n.viewContent.stringTable.showMoreCaption;n.viewAll?(n.visibleIncidentCount=n.allIncidents.length,ft(n.selectedSortOrder,n.selectedSortColumn,n.allIncidents),tt(),it(n.allIncidents.length)):(n.visibleIncidentCount=et,ft(n.selectedSortOrder,n.selectedSortColumn,n.allIncidents),tt(),it(et));n.showingMore=!1},1e3)};n.incidentSearchClicked=function(n){oi(n)};n.resetSearch=function(){yt()};n.searchModelChanged=function(n){(typeof n=="string"&&n.length==0||typeof n!="string")&&yt()};n.setPathToUrl=function(n){t.path(n)};n.newIncident=function(i){n.hasCreateEntitlements?t.path(i):a.showStandardMessageModal({id:"create-incident-no-permission",title:n.viewContent.stringTable.createIncidentPermissionErrorTitle,message:n.viewContent.stringTable.createIncidentPermissionErrorBody,dismissCaption:n.viewContent.stringTable.alertDialogDismissButtonCaption})};n.shortDateFormat=r.DATETIME_FORMATS.shortDate;rt={formatYear:"yyyy",maxDate:new Date,minDate:new Date(1980,0,0),startingDay:1,showWeeks:!1};n.openDateBeginningFilterOptions=rt;n.openDateBeginningFilter={opened:!1};n.openOpenDateBeginningFilter=function(){n.openDateBeginningFilter.opened=!0};n.openDateEndingFilterOptions=rt;n.openDateEndingFilter={opened:!1};n.openOpenDateEndingFilter=function(){n.openDateEndingFilter.opened=!0};n.updateDateBeginningFilterOptions=rt;n.updateDateBeginningFilter={opened:!1};n.openUpdateDateBeginningFilter=function(){n.updateDateBeginningFilter.opened=!0};n.updateDateEndningFilterOptions=rt;n.updateDateEndningFilter={opened:!1};n.openUpdateDateEndningFilter=function(){n.updateDateEndningFilter.opened=!0};dt()}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("incidentsService",["Upload","$http","$q","commercialInfoService","fileUploaderService","productsService","clientConfig","commercialTelemetryService",function(n,t,i,r,u,f,e,o){function c(n){return n.incidentDescriptionAndQuestions.files&&n.incidentDescriptionAndQuestions.files.length&&n.incidentDescriptionAndQuestions.files.length>0}function a(n){var t;return n&&n.incidentDescriptionAndQuestions&&n.incidentDescriptionAndQuestions.uploadedFiles&&n.incidentDescriptionAndQuestions.uploadedFiles.length&&n.incidentDescriptionAndQuestions.uploadedFiles.length>0&&(t=n.incidentDescriptionAndQuestions.uploadedFiles[0].workspaceId),t}function v(n){var r={name:"IncidentsService.DoSubmitRequest",description:"Create a new incident in METIS"},i={confirmation:{locale:n.primaryContact.primaryLanguage,incidentTitle:n.incidentDescriptionAndQuestions.title,productName:n.selectedProduct.name,severity:n.selectedSeverity.label,responseTime:n.selectedSeverity.sla,customerEmail:n.primaryContact.email,customerPhone:n.primaryContact.phoneNumber,contactPreference:n.primaryContact.preferredContactMethod.label,alternateRecipients:n.primaryContact.additionalEmails,primaryLanguageDisplay:n.primaryContact.primaryLanguageDisplay,secondaryLanguageDisplay:n.primaryContact.secondaryLanguageDisplay,timeZoneOffset:n.primaryContact.timeZone.offset},customerCountry:n.userRegion.isoRegionCode,description:n.incidentDescriptionAndQuestions.formattedDescription,entitlement:{entitlementId:n.selectedContract.accessId,entitlementType:n.selectedContract.entitlementTypeName,extendedProperties:[{key:"clarifyInstallationSiteId",value:n.selectedContract.clarifyInstallationSiteId+""},{key:"contractLineItemId",value:n.selectedContract.lineItemId+""},{key:"productServicePackageSku",value:n.selectedContract.sku},{key:"serviceLevel",value:n.selectedContract.contractTypeName}]},primaryContact:{firstName:n.primaryContact.firstName,lastName:n.primaryContact.lastName,preferredContactMethod:n.primaryContact.preferredContactMethod.preference,primaryEmailAddress:n.primaryContact.email,primaryPhoneNumber:n.primaryContact.phoneNumber,timeZoneId:n.primaryContact.timeZone.id,language:n.primaryContact.primaryLanguage,alternateEmailAddress:n.primaryContact.additionalEmails},productId:n.selectedProduct.pesId,severity:n.selectedSeverity.metisValue,title:n.incidentDescriptionAndQuestions.title};return n.primaryContact.secondaryLanguage&&(i.primaryContact.alternateLanguage=n.primaryContact.secondaryLanguage),n.supportTopics&&n.supportTopics.length&&(i.supportTopicId=n.supportTopics[n.supportTopics.length-1].id),n.incidentDescriptionAndQuestions&&(i.fileLinks=l(n.incidentDescriptionAndQuestions.uploadedFiles)),y(n.selectedProduct.pesId,n.supportTopics).then(function(n){return i.diagnosticMetadata=n,t.post("/api/incidents/",i,{headers:{"Content-Type":"application/json"},httpAppOptions:{qosOperation:r}}).then(function(n){return n.data})})}function y(n,t){return n&&t&&t.length?f.getDiagnosticMetadata(n,t[t.length-1].id).then(function(i){return i?i:t.length>1?f.getDiagnosticMetadata(n,t[0].id).then(function(n){return n},function(){return""}):""},function(){return""}):i.when("")}function l(n){return n&&n.length?[{path:e.DtmWorkspaceConfiguration.AgentFacingUrl+n[0].workspaceId}]:[]}function p(n,t){var i=r.getIncident(n);i&&(i.incident.communications.push(t),r.saveIncident(i))}var s=!1,h=null;this.getIncidents=function(){var n;return r.incidentList()?(n=i.defer(),n.resolve(r.incidentList()),n.promise):(s||(h=t.get("/api/incidents",{httpAppOptions:{cacheBust:!0,qosOperation:{name:"IncidentsService.GetIncidents",description:"Get all incidents for a user from METIS"}}}).then(function(n){return r.incidentList(n.data),n.data},function(n){return i.reject(n)})["finally"](function(){s=!1}),s=!0),h)};this.getIncident=function(n){var e=r.getIncident(n),u;return e?(u=i.defer(),u.resolve(e),u.promise):t.get("/api/incidents/"+n,{httpAppOptions:{cacheBust:!0,qosOperation:{name:"IncidentsService.GetIncident",description:"Get a single incident by its incident id"}}}).then(function(n){return r.saveIncident(n.data),n.data}).then(function(n){var t=n.incident,i,u;return t&&t.supportTopicId?(i=t.supportTopicId.split("\\"),u="",i&&i.length&&(u=i[i.length-1]),f.getSupportTopics(t.productId).then(function(i){var o,f,e;if(i&&i.length)for(o=0;o<i.length;o++){if(f=i[o],f.id==u)return t.supportTopicName=f.name,r.saveIncident(n),n;if(f.subtopics&&f.subtopics.length)for(e=0;e<f.subtopics.length;e++)if(f.subtopics[e].id==u)return t.supportTopicName=f.subtopics[e].name,r.saveIncident(n),n}return n})):n})};this.updateIncident=function(n,i,r,u,f){var e={communications:[{subject:i,body:r,sender:u,isCustomerViewable:!0}],fileLinks:l(f)};return t.patch("/api/incidents/"+n,e,{headers:{"Content-Type":"application/json"},httpAppOptions:{qosOperation:{name:"IncidentsService.UpdateIncident",description:"Update an incident in METIS"}}}).then(function(){var t={communicationType:0,createdDateTime:(new Date).getTime(),directionCode:"0",modifiedDateTime:(new Date).getTime(),sentDateTime:(new Date).getTime(),subject:e.communications[0].subject,body:e.communications[0].body,sender:e.communications[0].sender,isCustomerViewable:!0};return p(n,t),t})};this.submitIncident=function(n){var r=i.defer(),h=(new Date).getTime(),f=0,e=null,t,s;return c(n)?u.uploadToNewWorkspace(n.incidentDescriptionAndQuestions.files).then(function(t){var i=[];t&&t.length&&t.length>0?(angular.forEach(t,function(n){i.push(n.data)}),f=t.length):t&&(i.push(t.data),f=1);n.incidentDescriptionAndQuestions.uploadedFiles=i;r.resolve(n)},function(){r.reject()}):r.resolve(n),t=i.defer(),s=null,r.promise.then(function(i){s=a(i);v(i).then(function(i){e=i.incidentId;c(n)?u.setWorkspaceIncidentIdProperty(s,i.incidentId).then(function(){t.resolve(i)}):t.resolve(i)},function(n){t.reject(n)})},function(n){t.reject(n)}),t.promise.then(function(n){return o.logCreateIncident(e,(new Date).getTime()-h,f,!0),n},function(n){return o.logCreateIncident(e,(new Date).getTime()-h,f,!1),i.reject(n)})}}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("linkFarm",[function(){return{restrict:"A",templateUrl:"/PartialViews/Commercial/LinkFarm.html",scope:{linkSectionList:"="}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("premierContactsController",["$scope","$location","clientConfig","authenticationHelperService","commercialContactService","compassService","languageService","entitlementsService","commercialMessageModalService","messageBannerManagerService","correlationVectorService","flightService","authService","dateFilter",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){function it(){n.viewModel!=null&&n.viewModel.stringTable!=null&&(n.tableConfig={disableSorting:!0,columns:[{columnName:n.viewModel.stringTable.tableHeadingTamName,propertyName:"tamName",defaultColumn:!0,disableSorting:!0,defaultColumnOrder:0},{columnName:n.viewModel.stringTable.tableHeadingTamEmail,propertyName:"tamEmail",defaultColumn:!0,defaultColumnOrder:1,eMail:"tamEmail",disableSorting:!0,eMailCaption:"tamEmail"},{columnName:n.viewModel.stringTable.tableHeadingSchedule,propertyName:"scheduleName",defaultColumn:!0,disableSorting:!0,defaultColumnOrder:2},{columnName:n.viewModel.stringTable.tableHeadingAccessId,propertyName:"accessId",defaultColumn:!0,disableSorting:!0,defaultColumnOrder:3},{columnName:n.viewModel.stringTable.tableHeadingExpirationDate,propertyName:"endDate",defaultColumn:!0,defaultColumnOrder:4,disableSorting:!0,format:k}]})}function rt(){if(b)n.isAuthenticated=null,a.resolveAuthState().then(function(t){var i=a.getSupportedIDP();n.isAuthenticated=t===i.MSA?!0:!1;n.isAuthenticated==null||n.isAuthenticated!=null&&n.isAuthenticated===!1?a.loginUsingAccountType(i.MSA):y()});else{if(n.isAuthenticated=i.authInfo.authStatus()==nt?null:i.authInfo.isLoggedIn(),n.isAuthenticated==null||n.isAuthenticated!=null&&n.isAuthenticated==tt){r.signIn(y);return}y()}}function y(){var i=f.getCommercialContactsHub(),t;i&&(t=f.getCommercialIncidentsHub(),t)&&(n.viewModel=i,n.incidentsViewModel=t,it(),u.getPremierContacts().then(function(t){n.premierContacts=t&&t.phoneContacts&&t.phoneContacts.length?t.phoneContacts:[];p()},function(){n.premierContactsError=!0;n.showAltContacts=!0;p()}),u.getRegionalContacts().then(function(t){if(t&&t.length&&t.length>0){var i=ot(t);i&&(n.selectedRegionalContact=i,n.defaultPhoneNumber=ut(i))}n.regionalContacts=t;p()},function(){n.regionalContactsError=!0;n.showRegions=!0;p()}),o.getEntitlements().then(function(t){var f,i,r,u;if(n.tamInformation=[],n.entitlementsChecked=!0,n.hasEntitlements=t&&t.userContractState&&t.userContractState>o.userContractState().Authenticated,n.hasCreateEntitlements=t&&t.userContractState&&t.userContractState>o.userContractState().ReadOnly,f={},t.incidentSubmitContracts&&t.incidentSubmitContracts.length)for(i=0;i<t.incidentSubmitContracts.length;i++)r=t.incidentSubmitContracts[i],u=w(r),u&&!f[u]&&r&&(n.tamInformation.push(r),f[u]=!0);if(t.viewOnlyContracts&&t.viewOnlyContracts.length)for(i=0;i<t.viewOnlyContracts.length;i++)r=t.viewOnlyContracts[i],u=w(r),u&&!f[u]&&r&&(n.tamInformation.push(r),f[u]=!0);if(t.invalidContracts&&t.invalidContracts.length)for(i=0;i<t.invalidContracts.length;i++)r=t.invalidContracts[i],u=w(r),u&&!f[u]&&r&&(n.tamInformation.push(r),f[u]=!0);n.hasEntitlements?(n.tamInfosReceived=0,angular.forEach(n.tamInformation,function(n){o.getTamInfo(n.accessId).then(function(t){d(n,t.tamContactInfo,!1)},function(){d(n,null,!0)})})):n.tamInfosResolved=!0},function(){n.tamInformation=[];n.entitlementsChecked=!0;n.tamInfosResolved=!0;n.viewReady=!0;n.hasErrors=!0;h.notifyBanner("premierContactsMessages",{type:"warning",id:"get-entitlements-error-acknowledge",title:n.incidentsViewModel.generalServiceErrorAlert.title,body:n.incidentsViewModel.generalServiceErrorAlert.body,cv:c.getValue()})}))}function d(t,i,r){var f,u;if(n.tamInfosReceived++,et(t,i,r),n.tamInfosReceived==n.tamInformation.length){for(n.tamInfosResolved=!0,f=[],u=0;u<n.tamInformation.length;u++)st(n.tamInformation[u])&&f.push(n.tamInformation[u]);n.tamInformation=f}}function ut(n){return n.phoneContacts&&n.phoneContacts.length&&n.phoneContacts.length>0&&n.phoneContacts[0].phoneNumbers&&n.phoneContacts[0].phoneNumbers.length&&n.phoneContacts[0].phoneNumbers.length>0?n.phoneContacts[0].phoneNumbers[0].number:""}function p(){n.viewReady=(n.premierContacts||n.premierContactsError)&&(n.regionalContacts||n.regionalContactsError);ft()}function ft(){n.viewReady&&n.viewInitCallback&&typeof n.viewInitCallback=="function"&&n.viewInitCallback()}function et(t,i,r){if(r){n.tamInfoError=!0;return}if(i&&i.length&&i.length>0&&t)for(var u=0;u<i.length;u++)t.accessId!=null&&i[u].accessId!=null&&t.accessId==i[u].accessId&&(t.tamName=i[u].firstName&&i[u].firstName.toLowerCase()!="null"?i[u].firstName&&i[u].firstName:"",i[u].lastName&&i[u].lastName.toLowerCase()!="null"&&(t.tamName?t.tamName+=" "+i[u].lastName:t.tamName=i[u].lastName),t.tamEmail=i[u].email)}function ot(n){var i=null,r,u,t;if(n&&n.length&&n.length>0)for(r=e.langLocale(),u=e.lang(),t=0;t<n.length;t++)if(n[t].region&&n[t].region.toLowerCase()==r.toLowerCase()){i=n[t];break}return i}function w(n){var t="";return n&&n.accessId&&n.scheduleId&&n.clarifyInstallationSiteId&&(t=n.accessId+";"+n.scheduleId+";"+n.clarifyInstallationSiteId),t}function st(n){return n&&n.tamEmail&&n.tamName?!0:!1}var b=l.isUserInFlight("aad-1"),g="roleNameFormat",k="dateTimeFormat",nt=2,tt=0;n.regionalContacts=null;n.premierContacts=null;n.tamInformation=null;n.tamInfosResolved=!1;n.viewReady=!1;n.entitlementsChecked=!1;n.hasEntitlements=!1;n.hasCreateEntitlements=!1;n.showRegions=!1;n.showAltContacts=!1;n.defaultNumber="";n.hasErrors=!1;n.premierContactsError=!1;n.regionalContactsError=!1;n.tamInfoError=!1;n.isAuthenticated=null;n.$on("CompassContentReady",function(){rt()});n.formatData=function(t,i){var u=t,f,r;if(i==k)f=new Date(t),u=v(f,"shortDate");else if(i==g&&n.viewModel&&n.viewModel.roleDisplayInfo)for(r=0;r<n.viewModel.roleDisplayInfo.length;r++)if(n.viewModel.roleDisplayInfo[r].roleKey==t){u=n.viewModel.roleDisplayInfo[r].roleDisplayName;break}return u};n.addAccessId=function(n){t.path(n)};n.newIncident=function(i){n.hasCreateEntitlements?t.path(i):s.showStandardMessageModal({id:"create-incident-no-permission",title:n.incidentsViewModel.stringTable.createIncidentPermissionErrorTitle,message:n.incidentsViewModel.stringTable.createIncidentPermissionErrorBody,dismissCaption:n.incidentsViewModel.stringTable.alertDialogDismissButtonCaption})};n.setPathToUrl=function(){};b?n.$on("UserSignedInMSA",function(){n.isAuthenticated=!0}):n.$on("UserSignedIn",function(){n.isAuthenticated=!0});y()}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("siteAlert",["commercialInfoService","compassService",function(n,t){return{restrict:"A",scope:{messages:"="},templateUrl:"/PartialViews/Common/MessageBanner.html",link:function(i,r,u){function e(){i.isFullWidth=!0;f();i.messages&&i.messages.length&&(i.messages=o(i.messages));i.hasIcon=!1;u&&u.hasicon&&(i.hasIcon=u.hasicon.toLowerCase()==="true")}function o(t){var i=[];return angular.forEach(t,function(t){n.getHidenAlert(t.name)||(t.type=t.alertType,i.push(t))}),i}function s(t){t&&t.name&&n.saveHidenAlert(t.name)}function f(){var n=t.getPremierHomeView();n&&(i.view=n)}e();i.$on("CompassContentReady",function(){f()});i.dismissMessage=function(n){if(i.messages&&i.messages.length&&n){var t=i.messages.indexOf(n);t>=0&&(i.messages.splice(t,1),s(n))}}}}}]),function(n){n.controller("IncidentCreationContactStepController",["$scope","stepInstance","clientConfig","compassService","orderByFilter","currentLanguageService","flightService","authService",function(n,t,i,r,u,f,e,o){function c(){n.primaryContactForm={};l()}function l(){var n=r.getCreateIncidentsHub();n&&v(n)}function v(t){var e,r,i;for(n.view=t.content,n.stepView=n.view.contactStepContent,n.timeZones=u(t.content.timeZoneList,"offset"),e=(new Date).getTimezoneOffset()*-1,i=0;i<n.timeZones.length;i++)if(n.timeZones[i].offset==e){n.primaryContactForm.userTimeZone=n.timeZones[i];break}for(n.primaryLanguages=t.configuration.primaryLanguages,n.nameLayout=t.configuration.userNameLayout,r=f.getLang().toLowerCase(),i=0;i<n.primaryLanguages.length;i++)if(n.primaryLanguages[i].locale.toLowerCase()==r){n.primaryContactForm.primaryLanguage=n.primaryLanguages[i];break}if(!n.primaryContactForm.primaryLanguage)for(i=0;i<n.primaryLanguages.length;i++)if(r.indexOf(n.primaryLanguages[i].locale.toLowerCase())==0){n.primaryContactForm.primaryLanguage=n.primaryLanguages[i];break}n.secondaryLanguages=[];n.primaryContactForm.primaryLanguage?angular.forEach(t.configuration.secondaryLanguages,function(t){n.primaryContactForm.primaryLanguage.language!=t.language&&n.secondaryLanguages.push(t)}):n.secondaryLanguages=n.secondaryLanguages.concat(t.configuration.secondaryLanguages)}var s="premierIncidentCreation",h={selectedContactMethod:s+"SelectedContactMethod",userLanguage:s+"UserLanguage"},a=e.isUserInFlight("aad-1");c();n.enterStep=function(){a?(n.primaryContactForm.firstName=n.primaryContactForm.firstName||o.getUserInfo().firstName,n.primaryContactForm.lastName=n.primaryContactForm.lastName||o.getUserInfo().lastName,n.primaryContactForm.lastFirstFullName=n.primaryContactForm.lastFirstFullName||o.getUserInfo().lastName+" "+o.getUserInfo().firstName,n.nameLayout&&n.nameLayout=="LastAndFirstAndPronounce"&&(n.primaryContactForm.kana=n.primaryContactForm.kana||o.getUserInfo().lastName+o.getUserInfo().firstName),n.primaryContactForm.firstName,n.userEmail=o.getUserInfo().email):(n.primaryContactForm.firstName=n.primaryContactForm.firstName||i.authInfo.firstName,n.primaryContactForm.lastName=n.primaryContactForm.lastName||i.authInfo.lastName,n.primaryContactForm.lastFirstFullName=n.primaryContactForm.lastFirstFullName||i.authInfo.lastName+" "+i.authInfo.firstName,n.nameLayout&&n.nameLayout=="LastAndFirstAndPronounce"&&(n.primaryContactForm.kana=n.primaryContactForm.kana||i.authInfo.lastName+i.authInfo.firstName),n.primaryContactForm.firstName,n.userEmail=i.authInfo.displayName);n.primaryContactForm.userPreferedEmail=n.primaryContactForm.userPreferedEmail||n.userEmail};n.exitStep=function(){var i={};i.primaryContact={firstName:n.primaryContactForm.firstName,lastName:n.primaryContactForm.lastName,phoneNumber:n.primaryContactForm.phoneNumber,email:n.primaryContactForm.userPreferedEmail,additionalEmails:n.primaryContactForm.additionalEmails,timeZone:n.primaryContactForm.userTimeZone,primaryLanguage:f.getLang(),secondaryLanguage:n.primaryContactForm.secondaryLanguage?n.primaryContactForm.secondaryLanguage.locale:"",preferredContactMethod:n.primaryContactForm.contactMethod,primaryLanguageDisplay:n.primaryContactForm.primaryLanguage?n.primaryContactForm.primaryLanguage.languageDisplayName:"",secondaryLanguageDisplay:n.secondaryLanguage?n.secondaryLanguage.languageDisplayName:""};n.nameLayout&&(n.nameLayout=="LastFirstFull"?(i.primaryContact.firstName=n.primaryContactForm.lastFirstFullName,i.primaryContact.lastName=n.primaryContactForm.lastFirstFullName):n.nameLayout=="LastAndFirstAndPronounce"&&(i.primaryContact.firstName=n.primaryContactForm.kana,i.primaryContact.lastName=n.primaryContactForm.kanji));t.saveStepResult(i);n.primaryContactForm.contactMethod&&n.$emit(h.selectedContactMethod,n.primaryContactForm.contactMethod.preference);n.primaryContactForm.primaryLanguage&&n.$emit(h.userLanguage,n.primaryContactForm.primaryLanguage.language)};n.isStepComplete=function(){return n.contactForm.$valid};n.refresh=function(){c()};n.$on("CompassContentReady",function(){l()})}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("IncidentCreationController",["$scope","entitlementsService","authenticationHelperService","messageBannerManagerService","compassService","compassFormatFilter","clientConfig","correlationVectorService","flightService","authService",function(n,t,i,r,u,f,e,o,s,h){function a(){var t=u.getCreateIncidentsHub();t&&(n.view=t.content,n.context.view=n.view)}function v(){y()}function y(){n.hasError=!1;n.isAuthorized=!1;t.getEntitlements().then(function(t){if(n.userEntitlements=t,t.isPremier)n.isAuthorized=!0;else{var i=l?h.getUserInfo().email:e.authInfo.displayName;r.notifyBanner(c,{type:"warning",title:n.view.noContractFoundAlert.title,body:f(n.view.noContractFoundAlert.body,{"user-email":i})})}},function(){n.hasError=!0;r.notifyBanner(c,{type:"warning",title:n.view.generalServiceErrorAlert.title,body:n.view.generalServiceErrorAlert.body,cv:o.getValue()})})}var c="workflowServiceMessageBanner",l=s.isUserInFlight("aad-1");l?h.resolveAuthState().then(function(n){var t=h.getSupportedIDP();n===t.MSA?v():h.loginUsingAccountType(t.MSA)}):i.signIn(v());n.context={};a();n.$on("CompassContentReady",function(){a()})}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("IncidentCreationDescriptionStepController",["$scope","$rootScope","$q","stepInstance","productsService","messageBannerManagerService","compassService","clientConfig","correlationVectorService","fileUploaderService","compassFormatFilter",function(n,t,i,r,u,f,e,o,s,h){function y(){n.incidentDescriptionAndQuestions={};n.errorMessages={}}function p(){n.fileSelectionError=!1;var t=e.getCreateIncidentsHub();t&&(n.view=t.content,c=t.configuration,n.stepView=n.view.descriptionStepContent,n.stepView&&(n.clientStrings.errorMessages=n.clientStrings.errorMessages||{},n.clientStrings.errorMessages.maxLengthErrorFormat=n.stepView.maxLengthErrorFormat))}function b(t){var i="";return angular.forEach(n.scopingQuestions,function(r){r&&r.name&&t[r.name]&&(i+=n.stepView.questionLabel+" "+r.label+a,i+=n.stepView.answerLabel+" ",(r.controlType=="textBox"||r.controlType=="textArea")&&(i+=t[r.name]),i+=a)}),i}function k(){n.incidentDescriptionAndQuestions=n.incidentDescriptionAndQuestions||{};d();n.maxFileSizeBytes=o.DtmWorkspaceConfiguration.FileUploadMaxBytes;n.maxFileCount=o.DtmWorkspaceConfiguration.FileUploadMaxFiles}function d(){var f=r.getStepResults(),e=[],s=!1,o;f&&f.supportTopics&&f.supportTopics.length&&f.selectedProduct&&(e.push(u.getScopingQuestions(f.selectedProduct.pesId,f.supportTopics)),s=!0);f&&f.selectedContract&&(o=g(f.selectedContract),o&&e.push(u.getCustomScopingQuestions(o)));e.length?(n.loadingQuestions=!0,n.hasError=!1,i.all(e).then(function(i){i&&i.length?(n.scopingQuestions=[],angular.forEach(i,function(t){n.scopingQuestions=n.scopingQuestions.concat(t)}),s&&i[0].length&&(n.hasStandardScopingQuestions=!0),t.$broadcast(l.scopingQuestionsDisplayed,!0)):t.$broadcast(l.scopingQuestionsDisplayed,!1)},function(t){n.scopingQuestions=[];nt(t)})["finally"](function(){n.loadingQuestions=!1})):(n.hasStandardScopingQuestions=!1,n.scopingQuestions=[],t.$broadcast(l.scopingQuestionsDisplayed,!1))}function g(t){var i,r;if(t&&n.view&&c&&c.marketServiceScopingQuestions&&c.marketServiceScopingQuestions.questionConfigurations&&c.marketServiceScopingQuestions.questionConfigurations.length)for(i=0;i<c.marketServiceScopingQuestions.questionConfigurations.length;i++)if(r=c.marketServiceScopingQuestions.questionConfigurations[i],r&&r.marketServiceId==t.serviceId)return r.scopingQuestionKey;return""}function nt(){n.hasError=!0;f.notifyBanner(w,{type:"warning",title:n.view.generalServiceErrorAlert.title,body:n.view.generalServiceErrorAlert.body,cv:s.getValue()})}var w="workflowServiceMessageBanner",a="\n",c,v="premierIncidentCreation",l={scopingQuestionsDisplayed:v+"ScopingQuestionsDisplayed",fileAttached:v+"FileAttached",fileMaxSizeError:v+"FileMaxSizeError",fileMaxNumberError:v+"FileMaxNumberError"};n.clientStrings=n.clientStrings||{};p();n.$on("CompassContentReady",function(){p()});n.formContainer={};y();n.submitDescription=function(){r.moveToNext()};n.isStepComplete=function(){return n.formContainer.incidentDescriptionForm&&n.formContainer.incidentDescriptionForm.$valid};n.enterStep=function(){k()};n.exitStep=function(){var t={};t.incidentDescriptionAndQuestions=n.incidentDescriptionAndQuestions;t.incidentDescriptionAndQuestions.formattedDescription="";n.hasStandardScopingQuestions||(t.incidentDescriptionAndQuestions.formattedDescription=n.stepView.questionLabel+" "+n.stepView.generalDescriptionLabel+a,t.incidentDescriptionAndQuestions.formattedDescription+=n.stepView.answerLabel+" "+n.incidentDescriptionAndQuestions.description+a);n.incidentDescriptionAndQuestions.questionsAndUserAnswers&&(t.incidentDescriptionAndQuestions.formattedDescription+=b(n.incidentDescriptionAndQuestions.questionsAndUserAnswers));n.incidentDescriptionAndQuestions&&n.incidentDescriptionAndQuestions.files&&n.incidentDescriptionAndQuestions.files.length?n.$emit(l.fileAttached,!0):n.$emit(l.fileAttached,!1);r.saveStepResult(t)};n.$watch("formContainer.incidentDescriptionForm.files.$valid",function(t){t===!1&&n.formContainer.incidentDescriptionForm.files.$error&&(n.formContainer.incidentDescriptionForm.files.$error.maxFiles&&n.$emit(l.fileMaxNumberError,!0),n.formContainer.incidentDescriptionForm.files.$error.maxSize&&n.$emit(l.fileMaxSizeError,!0))});n.refresh=function(){y()};n.removeFile=function(t){if(n.incidentDescriptionAndQuestions.files&&n.incidentDescriptionAndQuestions.files.length&&n.incidentDescriptionAndQuestions.files.length>0)for(var i=0;i<n.incidentDescriptionAndQuestions.files.length;i++)if(n.incidentDescriptionAndQuestions.files[i].name===t.name){n.incidentDescriptionAndQuestions.files.splice(i,1);break}};n.fileUploadBeforeModelChange=function(t){n.fileSelectionError=h.validateUploadFiles(n.incidentDescriptionAndQuestions.files,t,n.maxFileCount)};n.filesChanged=function(){$('[data-toggle="tooltip"]').tooltip()}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("IncidentCreationOptionsStepController",["$scope","stepInstance","osService","entitlementsService","compassService",function(n,t,i,r,u){function e(){var t=u.getCreateIncidentsHub();t&&(n.view=t.content,n.stepView=n.view.optionStepContent)}function o(){f=null;n.contractForm={};s()}function s(){var i=t.getStepResults();f=null;i&&(i.selectedProduct&&i.selectedProduct.pesId?(n.requestingProductEntitlements=!0,r.getProductEntitlements(i.selectedProduct.pesId).then(function(t){f=t;n.groupedEntitlements=h(f)})["finally"](function(){n.requestingProductEntitlements=!1})):(f=i.userEntitlements,n.groupedEntitlements=h(f)))}function h(t){var i={},r;return t&&t.incidentSubmitContracts&&t.incidentSubmitContracts.length&&(r=!1,angular.forEach(t.incidentSubmitContracts,function(t){if(t&&(!r&&(t===n.contractForm.selected||a(t,n.contractForm.selected))&&(n.contractForm.selected=t,r=!0),t.scheduleId&&t.accessId&&t.clarifyInstallationSiteId)){var u=t.scheduleId+";"+t.clarifyInstallationSiteId;i[u]!=undefined?l(i,u,t):(i[u]={name:t.scheduleName,groupedAccessId:{}},i[u].groupedAccessId[t.accessId]=[t])}}),r||(n.contractForm.selected=null)),i}function l(n,t,i){var r=n[t];r.groupedAccessId[i.accessId]!=undefined?r.groupedAccessId[i.accessId].push(i):r.groupedAccessId[i.accessId]=[i]}function a(n,t){return n&&t&&n.accessId==t.accessId&&n.lineItemId==t.lineItemId&&n.clarifyInstallationSiteId==t.clarifyInstallationSiteId?!0:!1}var f,c={selectedEntitlementType:"premierIncidentCreationSelectedEntitlementType"};o();e();n.$on("CompassContentReady",function(){e()});n.enterStep=function(){s()};n.refresh=function(){o()};n.exitStep=function(){var i={};i.selectedContract=n.contractForm.selected;t.saveStepResult(i);n.contractForm.selected&&n.$emit(c.selectedEntitlementType,n.contractForm.selected.contractTypeName)};n.isStepComplete=function(){return f&&n.contractPickerForm&&n.contractPickerForm.$valid};n.isMobile=function(){return i.isMobile()}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("IncidentCreationProductStepController",["$rootScope","$scope","$q","$timeout","$location","entitlementsService","messageBannerManagerService","languageService","productsService","stepInstance","compassService","correlationVectorService",function(n,t,i,r,u,f,e,o,s,h,c,l){function d(){y=i.defer();p=!1;t.productName="";t.productPicker={productName:""};t.selectedProduct?t.selectedProduct.selected=null:t.selectedProduct={selected:null};t.hasMatch=!0;t.selectedPrimaryTopic=null;t.selectedSecondaryTopic=null;t.loadingProducts=!0;t.hasBlockingProductDisclaimer=!1;t.supportTopics=[];ct()}function rt(n,t){return n&&t&&n==t.name?!0:!1}function g(n){t.$emit(v.productPicked,{pesId:n.pesId,elementId:"incident-product-picker"});f.getProductEntitlements(n.pesId);ut(n.disclaimer)}function ut(n){var i=null;n&&(i=ot(n.disclaimerContents));i&&st(i);t.hasBlockingProductDisclaimer||ft(t.selectedProduct.selected.pesId)}function nt(){var n=c.getCreateIncidentsHub();n&&(t.view=n.content,t.stepView=t.view.productStepContent)}function ft(n){p=!1;t.selectedPrimaryTopicId="";t.selectedSecondaryTopicId="";s.getSupportTopics(n).then(function(n){t.primarySupportTopics=n;t.primarySupportTopics&&t.primarySupportTopics.length||(p=!0)},function(n){w(n)})}function et(){t.hasBlockingProductDisclaimer=!1;t.primarySupportTopics=[];t.selectedPrimaryTopic=null;t.selectedSecondaryTopic=null;e.clearBanner(k);e.clearBanner(b)}function ot(n){var r,i;if(!n||!n.length||n.length<1)return null;for(r=o.langLocale(),i=0;i<n.length;i++)if(n[i].applicableRegion&&n[i].applicableRegion.toLowerCase()===r)return n[i];for(i=0;i<n.length;i++)if(n[i].isPremier&&t.userEntitlements.isPremier)return n[i];for(i=0;i<n.length;i++)if(!n[i].isPremier&&!n[i].applicableRegion)return n[i];return null}function st(n){t.hasBlockingProductDisclaimer=n.disclaimerLevel&&n.disclaimerLevel===it.level.blocking;t.$emit(v.disclaimerDisplayed,t.hasBlockingProductDisclaimer?"1":"0");e.notifyBanner(k,{type:t.hasBlockingProductDisclaimer?"warning":"info",title:n.name,body:n.body})}function tt(n){var r=[],i;return n&&t.products.length>0&&(n.sort(function(n,t){return t.length-n.length}),i=[],angular.forEach(n,function(n){var t;try{t=new RegExp("("+n+")","i")}catch(r){}t&&i.push(t)}),i.length&&angular.forEach(t.products,function(n){var t=n.name,f,u;if(t){for(f=!0,u=0;u<i.length;u++)if(t&&i[u].test(t))t=t.replace(i[u],"");else{f=!1;break}f&&r.push(n)}})),t.hasMatch=r.length>0,{suggestions:r}}function ht(n){if(n)return n=n.replace(/([\d\.]+)/g,function(n,t){return" "+t+" "}),n=n.trim(),n.split(/[\s]+/);return[]}function ct(){t.hasError=!1;t.isAuthorized=!1;t.loadingProducts=!0;f.getEntitlements().then(function(n){t.userEntitlements=n;var i=[];angular.forEach(n.incidentSubmitContracts,function(n){i.push(n.accessId)});i.length>0?(f.getAccessIdProducts(i).then(function(n){y.resolve();t.products=n},function(n){y.reject();w(n)})["finally"](function(){t.loadingProducts=!1}),f.getTamInfo(i[0]).then(function(n){n.tamContactInfo&&n.tamContactInfo.length>0&&(t.tamInfo=n.tamContactInfo[0])})):t.loadingProducts=!1},function(n){t.loadingProducts=!1;w(n)})}function w(){t.hasError=!0;e.notifyBanner(b,{type:"warning",title:t.view.generalServiceErrorAlert.title,body:t.view.generalServiceErrorAlert.body,cv:l.getValue()})}var b="workflowServiceMessageBanner",k="productDisclaimerBanner",lt=angular.element("#incident-product-picker"),it={level:{blocking:"blocking",messageOnly:"messageOnly"}},a="premierIncidentCreation",v={productPicked:a+"ProductPicked",noSupportTopicOffered:a+"NoSupportTopicOffered",primarySupportTopicPicked:a+"PrimarySupportTopicPicked",secondarySupportTopicPicked:a+"SecondarySupportTopicPicked",productNotFound:a+"ProductNotFound",disclaimerDisplayed:a+"DisclaimerDisplayed"},y,p;d();nt();t.refresh=function(){d()};t.$on("CompassContentReady",function(){nt()});t.isStepComplete=function(){return t.selectedProduct.selected&&!t.hasBlockingProductDisclaimer&&(p||t.selectedPrimaryTopic&&(!t.selectedPrimaryTopic.subtopics||!t.selectedPrimaryTopic.subtopics.length||t.selectedSecondaryTopic))};t.getCompleteText=function(n){return n.name};t.getSuggestions=function(n){var r=i.defer(),u=ht(n);return u?t.products!=undefined?r.resolve(tt(u)):y.promise.then(function(){r.resolve(tt(u))}):r.reject("empty query"),r.promise.then(function(i){return i&&i.suggestions&&!i.suggestions.length&&t.$emit(v.productNotFound,n),i})};t.primarySearchClicked=function(){et();t.selectedProduct&&t.selectedProduct.selected&&rt(t.productPicker.productName,t.selectedProduct.selected)?g(t.selectedProduct.selected):t.getSuggestions(t.productPicker.productName).then(function(n){n&&n.suggestions&&n.suggestions.length>0?(t.selectedProduct.selected=n.suggestions[0],t.productPicker.productName=n.suggestions[0].name,t.hasMatch=!0,g(t.selectedProduct.selected)):t.hasMatch=!1},function(){t.hasMatch=!1})};t.inputOnBlur=function(){t.isInputFocused=!1};t.inputOnFocus=function(){t.isInputFocused=!0};t.selectedPrimaryTopic;t.selectedPrimaryTopicGetterSetter=function(n){if(n&&(t.selectedPrimaryTopicId!=n&&t.selectedSecondaryTopic&&(t.selectedSecondaryTopic=null,t.selectedSecondaryTopicId=""),t.selectedPrimaryTopicId=n,t.$emit(v.primarySupportTopicPicked,{primarySupportTopicId:n,elementId:"primary-product-topic"}),t.primarySupportTopics&&t.primarySupportTopics.length))for(var i=0;i<t.primarySupportTopics.length;i++)if(t.primarySupportTopics[i].id==n){t.selectedPrimaryTopic=t.primarySupportTopics[i];s.getDiagnosticMetadata(t.selectedProduct.selected.pesId,t.selectedPrimaryTopic.id);break}return t.selectedPrimaryTopicId};t.selectedSecondaryTopic;t.selectedSecondaryTopicGetterSetter=function(n){if(n){if(t.selectedPrimaryTopic&&t.selectedPrimaryTopic.subtopics&&t.selectedPrimaryTopic.subtopics.length)for(var i=0;i<t.selectedPrimaryTopic.subtopics.length;i++)if(t.selectedPrimaryTopic.subtopics[i].id==n){t.selectedSecondaryTopic=t.selectedPrimaryTopic.subtopics[i];s.getDiagnosticMetadata(t.selectedProduct.selected.pesId,t.selectedSecondaryTopic.id);break}t.$emit(v.secondarySupportTopicPicked,{secondarySupportTopicId:n,elementId:"secondary-product-topic"})}return arguments.length?t.selectedSecondaryTopicId=n:t.selectedSecondaryTopicId};t.exitStep=function(){var n={};n.userEntitlements=t.userEntitlements;n.selectedProduct=t.selectedProduct.selected;n.supportTopics=[];t.selectedPrimaryTopic&&n.supportTopics.push(t.selectedPrimaryTopic);t.selectedSecondaryTopic&&n.supportTopics.push(t.selectedSecondaryTopic);t.selectedPrimaryTopic||t.selectedSecondaryTopic||t.$emit(v.noSupportTopicOffered,!0);h.saveStepResult(n)}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("IncidentCreationSeverityStepController",["$scope","stepInstance","languageService","incidentSeverityService","messageBannerManagerService","compassService","correlationVectorService","orderByFilter",function(n,t,i,r,u,f,e,o){function s(){n.severityForm={}}function p(){var i=t.getStepResults(),r=i.selectedProduct,u=i.selectedContract,f;n.severityConfig={};f=i.selectedContract.isoCountryCode;n.severityForm.userRegion=d(f);r&&u&&h(r,u,n.severityForm.userRegion)}function h(t,i,u){n.loadingSeverity=!0;n.hasError=!1;r.getSeverityConfig(t,i,u).then(function(t){n.severityConfig=w(t)},function(n){b(n)})["finally"](function(){n.loadingSeverity=!1})}function c(){var r=f.getCreateIncidentsHub(),t,u;r&&(n.view=r.content,n.stepView=n.view.severityStepContent,n.stepView.regionLabel=n.view.contactStepContent.regionLabel,t=n.view.contactStepContent,u=i.langLocale(),n.regionList=k(t.regionList?t.regionList.regions:[],u))}function w(t){if(t.data&&t.data.severityCollection&&t.data.severityCollection.length){var i=!1,r=t.data.severityCollection;r.sort(function(n,t){return n.metisValue-t.metisValue});angular.forEach(r,function(n){n.sla=n.serviceLevelAgreement;n.value=n.readOnlyOption?{}:{metisValue:n.metisValue,sla:n.serviceLevelAgreement,use24x7Option:!1,label:n.label};i||n.options.length||(i=l(n.value));i||(i=a(n));n.options&&n.options.length&&angular.forEach(n.options,function(t){t.value={metisValue:n.metisValue,sla:n.serviceLevelAgreement,use24x7Option:t.use24x7Option,label:n.label};i||(i=l(t.value));i||(i=a(t))})});i||(n.severityForm.selected=undefined)}return r}function l(t){return n.severityForm.selected&&angular.equals(n.severityForm.selected,t)?(n.severityForm.selected=t,!0):!1}function a(t){return t.defaultSelection&&!n.severityForm.selected?(n.severityForm.selected=t.value,!0):!1}function b(){n.hasError=!0;u.notifyBanner(v,{type:"warning",title:n.view.generalServiceErrorAlert.title,body:n.view.generalServiceErrorAlert.body,cv:e.getValue()})}function k(n,t){var i=[];return n&&n.length>0&&(i=n.filter(function(n){if(n&&n.excludeLocaleList&&n.excludeLocaleList.length)for(var i=0;i<n.excludeLocaleList.length;i++)if(n.excludeLocaleList[i]&&t==n.excludeLocaleList[i].toLowerCase())return!1;return!0}),i=o(i,"displayName")),i}function d(t){if(n.severityForm.userRegion)return n.severityForm.userRegion;if(n.regionList&&n.regionList.length)for(var i=0;i<n.regionList.length;i++)if(t&&t.toLowerCase()==n.regionList[i].isoRegionCode.toLowerCase())return n.regionList[i];return}var v="workflowServiceMessageBanner",y={selectedSeverityValue:"premierIncidentCreationSelectedSeverityValue"};s();c();n.$on("CompassContentReady",function(){c()});n.enterStep=function(){p()};n.exitStep=function(){var i={};i.selectedSeverity=n.severityForm.selected;i.userRegion=n.severityForm.userRegion;t.saveStepResult(i);i.selectedSeverity&&n.$emit(y.selectedSeverityValue,""+i.selectedSeverity.metisValue+i.selectedSeverity.use24x7Option)};n.isStepComplete=function(){return!!n.severityForm.selected&&!angular.equals(n.severityForm.selected,{})};n.refresh=function(){s()};n.updateSeverityOptions=function(){var i=t.getStepResults(),r=i.selectedProduct,u=i.selectedContract;r&&u&&h(r,u,n.severityForm.userRegion)}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("IncidentCreationSubmissionStepController",["$scope","$window","stepInstance","clientConfig","incidentsService","messageBannerManagerService","dateFilter","commercialInfoService","compassService","compassFormatFilter","correlationVectorService","flightService","authService",function(n,t,i,r,u,f,e,o,s,h,c,l){function v(){var t=s.getCreateIncidentsHub();t&&(n.view=t.content,n.stepView=n.view.submitStepContent,n.serviceAgreement=h(n.stepView.acceptAgreementStatementFormat,{"Microsoft-service-link":h(n.stepView.microsoftServiceLinkHtmlFormat,{"service-url":n.stepView.microsoftServiceUrl})}),n.privacyStatement=h(n.stepView.privacyStatementFormat,{"privacy-statement-link":h(n.stepView.privacyStatementLinkHtmlFormat,{"privacy-url":n.stepView.privacyStatementLinkUrl})}))}function y(){n.hasError=!0;f.notifyBanner(a,{type:"warning",title:n.view.generalServiceErrorAlert.title,body:n.view.generalServiceErrorAlert.body,cv:c.getValue()})}var p=l.isUserInFlight("aad-1"),a="workflowServiceMessageBanner";v();n.$on("CompassContentReady",function(){v()});n.enterStep=function(){n.stepResults=i.getStepResults();n.userEmail=n.stepResults.primaryContact.email;n.todayDateInShort=e(new Date,"shortDate")};n.submit=function(){n.isSubmitting=!0;f.clearBanner(a);u.submitIncident(n.stepResults).then(function(n){i.saveStepResult({createdIncident:n});o.incidentList(null,!0);u.getIncidents();i.moveToNext();i.refreshWorkflowBeforeStep()},function(n){y(n)})["finally"](function(){n.isSubmitting=!1})};n.showCommonStepNavi=function(){return!1};n.moveToPrev=function(){return t.history.back()};n.moveToNext=function(){return i.moveToNext()};n.hasPrev=function(){return i.hasPrev()};n.hasNext=function(){return i.hasNext()};n.isStepComplete=function(){return!0}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("IncidentCreationSuccessStepController",["$scope","stepInstance","compassFormatFilter","currentLanguageService","compassService",function(n,t,i,r,u){function o(){var t=u.getCreateIncidentsHub();t&&(n.view=t.content,n.stepView=n.view.confirmationStepContent)}var e="premierIncidentCreation",f={newCaseId:e+"NewCaseId",hasDiagnosticLink:e+"HasDiagnosticLink"};o();n.$on("CompassContentReady",function(){o()});n.showCommonStepNavi=function(){return!1};n.enterStep=function(){var e=t.getStepResults(),u=e.createdIncident;u&&(n.header=i(n.stepView.pageTitleFormat,{"incident-id":u.incidentId}),n.trackOnlineLink=i('<a href={incident-url} id="new-incident-url">{link-text}<\/a>',{"incident-url":"/"+r.getLang()+"/commercial/incidents/"+u.incidentId,"link-text":n.stepView.trackIncidentLink.linkText}),n.$emit(f.newCaseId,u.incidentId),u.sdpResponse==200&&u.sdpSessionLaunchUrl?(n.hasDiagnostic=!0,n.sdpSessionLaunchUrl=u.sdpSessionLaunchUrl,n.$emit(f.hasDiagnosticLink,"true")):n.$emit(f.hasDiagnosticLink,"false"))}}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("questionValidators",["compassFormatFilter",function(n){function e(n,t){var i=t.name;switch(i){case"email":n[i]=o;break;case"cidr-edfsmsbl3":n[i]=s;break;default:c(n,t)}}function o(n,t){return i.test(t)}function s(n,t){return r.test(t)}function h(t,i,r){var u=t.substring(10);return u&&(u=parseInt(u,10),u!=NaN&&(i.label=n(i.label,{"0":u}),!r||r.length<=u))?!0:!1}function c(n,i){var r=i.name;r&&r.indexOf("maxLength-")>=0&&(t=!0,n[r]=function(n,t){return h(r,i,t)})}var i=/^.+@.+\..+$/i,r=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g,t=!1,u=2e3,f=200;return{restrict:"A",require:"ngModel",link:function(n,i,r,o){if(n.question&&n.question.validators&&n.question.validators.length&&angular.forEach(n.question.validators,function(n){n&&n.name&&e(o.$validators,n,o.$modelValue)}),!t&&i&&i.length>0){var s=i[0];s.tagName==="TEXTAREA"?o.$validators.textAreaMaxLength=function(n,t){return!t||t.length<=u?!0:!1}:s.tagName==="INPUT"&&(o.$validators.inputBoxMaxLength=function(n,t){return!t||t.length<=f?!0:!1})}}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("scopingQuestions",[function(){return{restrict:"A",scope:{formCtrl:"=",formModel:"=",questions:"=",strings:"="},templateUrl:"/PartialViews/Commercial/IncidentCreation/ScopingQuestions.html",link:function(n){n.questions&&n.questions.length&&angular.forEach(n.questions,function(n){n&&n.validators&&n.validators.length&&angular.forEach(n.validators,function(t){t&&t.name=="required"&&(n.isRequired=!0)})})}}}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("arrowNav",[function(){function f(t,f){var s=t[0];i=f[0];t.on("keydown",function(n){r(n.keyCode)&&u(s)&&n.preventDefault()});t.on("keyup",function(t){var i;r(t.keyCode)&&u(s)&&(t.preventDefault(),i=t.keyCode===n.upArrow?o():e(),i&&i.focus())})}function r(t){return Object.keys(n).some(function(i){return t===n[i]})}function t(){return i.activeElement}function u(n){var i=t();return i&&i.parentNode===n}function e(){var n=t();return n&&n.nextElementSibling}function o(){var n=t();return n&&n.previousElementSibling}var n={upArrow:38,downArrow:40},i;return{restrict:"A",scope:{},controller:["$element","$document",f]}}]);app=angular.module(microsoft.support.moduleName);app.value("authConfiguration",{tenant:"common",clienId:"fdf9885b-dd37-42bf-82e5-c3129ef5a302",prodHost:"support.microsoft.com",uatHost:"support-uat.microsoft.com",stagingHost:"staging.support.services.microsoft.com",internalProdHost:"internal.support.services.microsoft.com",internalUatHost:"internal-uat.support.services.microsoft.com",internalDevHost:"internal-dev.support.services.microsoft.com",inProdHost:"inprod.support.services.microsoft.com",partnersHost:"partner.support.services.microsoft.com",ppeInstance:"https://login.windows-ppe.net/",prodInstance:"https://login.windows.net/",accountSettingsUrl:"https://portal.office.com/account/",siteUrl:"https://login.microsoftonline.com/",protectedEndpoints:["api/content/help","api/content/asset","api/token/getAADToken","api/token/getAADUserStateCookie"],endpoints:{"https://graph.microsoft.com":"https://graph.microsoft.com"},signInUri:"/signin",signOutUri:"/signout",signOutPersonalUri:"/signout/personal",signOutWorkUri:"/signout/work",userSignedInMSAEvent:"UserSignedInMSA",userSignedInAADEvent:"UserSignedInAAD",userNotSignedInEvent:"UserNotSignedIn",msaFedIDP:"live.com",msaFedParam:"msafed=0",adalPrefix:"adal",whitelistedAADErrorCodes:["AADSTS50058","AADSTS70002","AADSTS50133","AADSTS16000","AADSTS50076","AADSTS_RENEW_TIMEOUT"]}),function(n){n.service("authenticationHelperService",["$q","$window","$rootScope","$location","$timeout","$route","clientConfig","osService","languageService","locationService","nativeAppService","flightService",function(n,t,i,r,u,f,e,o,s,h,c,l){function a(n,t){var i,u,c,a;n?(i=$(e.RpsSignInInfo.SignInLink).attr("href"),u="wreply"):(i=$(e.RpsSignInInfo.SignOutLink).attr("href"),u="ru");var s=h.getQueryStringParameters(i),l=h.getQueryStringParameters(r.absUrl()),v=h.getQueryStringParameters(s[u]);return $.each(v,function(n,t){l[n]=t}),!n&&f&&f.current&&f.current.data&&f.current.data.returnUrl?(c=f.current.data.returnUrl,c=y(c,f.current.params),a=r.protocol()+"://"+r.host()+c+"?"+$.param(l),s[u]=encodeURI(a)):s[u]=encodeURI(r.absUrl().substring(0,r.absUrl().indexOf(r.path())+r.path().length)+"?"+$.param(l)),n&&(o.isMobile()||t)&&(s.pcexp="false"),i.substring(0,i.indexOf("?")+1)+$.param(s)}function v(n,t){if(e.authInfo.authStatus()===2){var r=function(){e.authInfo.isLoggedIn()?n&&n():i.$broadcast("ProcessUserSignIn",t)},f=u(function(){r()},5e3);i.$on("AuthStatusChange",function(){u.cancel(f);r();i.$apply()})}else e.authInfo.authStatus()===1?n&&n():i.$broadcast("ProcessUserSignIn",t)}function y(n,t){return n&&n.indexOf(":")>=0&&t&&(n=n.replace(/:([a-zA-Z]+)/g,function(n,i){return t[i]?t[i]:n})),n}this.getSignInState=function(){function r(){e.authInfo.isLoggedIn()?t.resolve():t.reject()}var t=n.defer(),f,o;return e.authInfo.authStatus()===2?(f=u(r,5e3),o=i.$on("AuthStatusChange",function(){u.cancel(f);r();o()})):e.authInfo.authStatus()===1?t.resolve():t.reject(),t.promise};this.getUpdatedAuthenticationUrl=function(n,t){return a(n,t)};this.signIn=function(n){v(n,!1)};this.mobileSignIn=function(n){v(n,!0)};this.getShellOptions=function(){var n=t.msCommonShell;return{meControlOptions:{rpData:{msaInfo:{signInUrl:jQuery(e.RpsSignInInfo.SignInLink).attr("href"),signOutUrl:jQuery(e.RpsSignInInfo.SignOutLink).attr("href"),meUrl:e.RpsSignInInfo.MeControlLink}},userData:{idp:n.SupportedAuthIdp.MSA,firstName:null,lastName:null,memberName:null,cid:null,authenticatedState:n.AuthState.NotSignedIn},events:{onSignIn:function(){i.$broadcast("ProcessUserSignIn")},onBeforeSignOut:function(){i.$broadcast("ProcessUserSignOut")}}}}};i.$on("ProcessUserSignIn",function(n,i){var u=l.isUserInFlight("aad-1");return u||(c.isNative()?c.signInUser(r.absUrl()):t.location=a(!0,!!i)),!1});i.$on("ProcessUserSignOut",function(){var n=l.isUserInFlight("aad-1");n||u(function(){t.location=a(!1,!1)},0)})}])}(angular.module(microsoft.support.moduleName)),function(n){n.factory("authService",["$rootScope","$window","$location","$q","$cookieStore","$timeout","clientConfig","nativeAppService","osService","languageService","locationService","flightService","qosTelemetryService","adalAuthenticationService","authConfiguration",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y){function ir(){var n=a.createEvent(a.eventTypes.auth.meControlLoad),i,r;try{t&&t.msCommonShell&&(i=t.msCommonShell,r=st(),i.load(r),ut=!0,n.resolve())}catch(u){ut=!1;n.reject(u.message)}}function it(){var n=fr();n===p.NONE?f(function(){ui()},500):n!==d?f(function(){rr(n)},500):(g=!0,d===p.AAD?v.enableProtectedResourceInterceptor():v.disableProtectedResourceInterceptor(),ot(n))}function rr(n){n===p.MSA?hr():n===p.AAD?cr():ui()}function ui(){yt();pt()}function ur(){var n=a.createEvent(a.eventTypes.auth.aadSilentAuth);dt=!0;try{v.silentLoginAAD().then(function(){n.resolve();ct=!0;it()},function(t){t&&!wr(t)?n.reject(t):n.resolve();ct=!0;it()})}catch(t){n.resolve();it()}}function fr(){return k.length===0?er():k.length===1?or():k.length===2?sr():p.NONE}function er(){var n=p.NONE;return tt()&&nt()?n=p.MSA:nt()&&!tt()?n=p.MSA:!nt()&&tt()&&(n=p.AAD),n}function or(){var n=p.NONE;return k[0]===p.MSA?nt()&&(n=p.MSA):k[0]===p.AAD&&tt()&&(n=p.AAD),n}function sr(){var n=p.NONE;return ni()&&(k[0]===p.MSA&&(n=nt()?p.MSA:p.AAD),k[0]===p.AAD&&(n=tt()?p.AAD:p.MSA)),n}function fi(){return yt(),w.firstName=e.authInfo.firstName,w.lastName=e.authInfo.lastName,w.displayName=e.authInfo.firstName+" "+e.authInfo.lastName,w.email=e.authInfo.displayName,w.puid=e.authInfo.puid,w.puidAsHex=e.authInfo.puidAsHex,w.cid=e.authInfo.cid,w}function ei(){return yt(),w.firstName=v.userInfo.profile.given_name,w.lastName=v.userInfo.profile.family_name,w.displayName=v.userInfo.profile.name,w.email=v.userInfo.profile.upn,w.puid=v.userInfo.profile.puid,w}function yt(){w={firstName:"",lastName:"",displayName:"",email:"",puid:"",puidAsHex:"",cid:"",roles:[],sg_groups:[]}}function pt(){if(ut&&t&&t.msCommonShell){var n=t.msCommonShell,i=st(),r={idp:n.SupportedAuthIdp.MSA,firstName:null,lastName:null,displayName:null,memberName:null,cid:null,authenticatedState:n.AuthState.NotSignedIn};wt(n,i,r)}v.disableProtectedResourceInterceptor();d=p.NONE;g=!0;ot(p.NONE)}function hr(){var n,i,r;if(ut&&t&&t.msCommonShell){if(n=t.msCommonShell,i=st(),w=fi(),!w||!w.email||!w.cid)return pt();r={firstName:w.firstName,lastName:w.lastName,displayName:w.displayName,memberName:w.email,cid:w.cid,idp:p.MSA.toLowerCase(),authenticatedState:n.AuthState.SignedIn};wt(n,i,r)}v.disableProtectedResourceInterceptor();d=p.MSA;g=!0;ot(p.MSA)}function cr(){var n,i,r;if(ut&&t&&t.msCommonShell){if(n=t.msCommonShell,i=st(),w=ei(),!w||!w.email)return pt();r={firstName:w.firstName,lastName:w.lastName,displayName:w.displayName,memberName:w.email,idp:p.AAD.toLowerCase(),authenticatedState:n.AuthState.SignedIn};wt(n,i,r)}v.enableProtectedResourceInterceptor();d=p.AAD;g=!0;ot(p.AAD)}function wt(n,i,r){var u=a.createEvent(a.eventTypes.auth.meControlState),f;t.MSA&&t.MSA.MeControl&&t.MSA.MeControl.API?(f=t.MSA.MeControl.API,f.setActiveUser(r),u.resolve()):(i.meControlOptions.rpData.msaInfo.signOutUrl=y.signOutUri,i.meControlOptions.userData.authenticatedState=r.authenticatedState,n.load(i),u.reject())}function ot(t){t&&(t===p.MSA?n.$broadcast(y.userSignedInMSAEvent):t===p.AAD?n.$broadcast(y.userSignedInAADEvent):t===p.NONE&&n.$broadcast(y.userNotSignedInEvent))}function lr(n){if(oi(n))k=n;else throw new Error("Unable to set page preference as invalid idp array values were passed in");}function oi(n){var t=!0;return!n||!n instanceof Array?t=!1:n.length===1&&n[0]!==p.MSA&&n[0]!==p.AAD?t=!1:n.length===2?(n[0]===n[1]&&(t=!1),n[0]!==p.MSA&&n[0]!==p.AAD&&(t=!1),n[1]!==p.MSA&&n[1]!==p.AAD&&(t=!1)):n.length>2&&(t=!1),t}function ar(){var t=r.defer(),i=a.createEvent(a.eventTypes.auth.unknownSilentAuth),u=f(function(){vt()?i.reject("Resolve Auth State Timed out after "+kt+"ms | Is Iframe: "+hi()+" | MSASilentAuthTriggered: "+ht+" | AADSilentAuthTriggered: "+dt+" | AADSilentAuthCompleted: "+ct):(i.resolve(),si(t))},kt);if(vt())var e=n.$on(y.userSignedInMSAEvent,function(){i.resolve();f.cancel(u);t.resolve(p.MSA);e()}),o=n.$on(y.userSignedInAADEvent,function(){i.resolve();f.cancel(u);t.resolve(p.AAD);o()}),s=n.$on(y.userNotSignedInEvent,function(){i.resolve();f.cancel(u);t.resolve(p.NONE);s()});else i.resolve(),f.cancel(u),si(t);return t.promise}function si(n){ft()?n.resolve(p.MSA):et()?n.resolve(p.AAD):n.resolve(p.NONE)}function hi(){try{return t.self!==t.top}catch(n){return!0}}function vr(n,t,i){return n?bt($(e.RpsSignInInfo.SignInLink).attr("href"),t,i,"wreply"):bt($(e.RpsSignInInfo.SignOutLink).attr("href"),t,i,"ru")}function yr(n){return bt(e.RpsSignInInfo.AssureSignInLink,n,null,"wreply")}function bt(n,t,r,u){var f=c.getQueryStringParameters(n),o=c.getQueryStringParameters(f[u]),h=r?r:i.absUrl(),e=c.getQueryStringParameters(h);return $.each(o,function(n,t){e[n]=t}),f[u]=r?encodeURI(r.split("?")[0]+"?"+$.param(e)):encodeURI(i.absUrl().substring(0,i.absUrl().indexOf(i.path())+i.path().length)+"?"+$.param(e)),(s.isMobile()||t)&&(f.pcexp="false"),n.substring(0,n.indexOf("?")+1)+$.param(f)}function st(){var i=t.msCommonShell;return{meControlOptions:{rpData:{msaInfo:{signInUrl:y.signInUri,signOutUrl:y.signOutUri,meUrl:e.RpsSignInInfo.MeControlLink},aadInfo:{signInUrl:y.signInUri,signOutUrl:y.signOutUri,siteUrl:y.siteUrl,appId:y.clienId,accountSettingsUrl:y.accountSettingsUrl}},userData:{idp:i.SupportedAuthIdp.MSA,firstName:null,lastName:null,displayName:null,memberName:null,cid:null,authenticatedState:i.AuthState.NotSignedIn},events:{onSignIn:function(){n.$broadcast("ProcessUserSignIn")},onBeforeSignOut:function(){n.$broadcast("ProcessUserSignOut")}}}}}function ci(){var n=window.navigator.userAgent,t=n.indexOf("MSIE "),r,i;return t>0?parseInt(n.substring(t+5,n.indexOf(".",t)),10):(r=n.indexOf("Trident/"),r>0)?(i=n.indexOf("rv:"),parseInt(n.substring(i+3,n.indexOf(".",i)),10)):!1}function pr(){var n=ci();return n&&typeof n=="number"&&n<10?!0:!1}function wr(n){var t=!1;return y&&y.whitelistedAADErrorCodes&&y.whitelistedAADErrorCodes.every(function(i){return n&&i&&n.toLowerCase().indexOf(i.toLowerCase())>-1?(t=!0,!1):!0}),t}function li(){return i.path().indexOf(y.signInUri)>-1||i.path().indexOf(y.signOutUri)>-1}var b={},p={MSA:"MSA",AAD:"AAD",NONE:"NONE"},w={firstName:"",lastName:"",displayName:"",email:"",puid:"",puidAsHex:"",cid:"",roles:[],sg_groups:[]},rt=!1,br=i.protocol()+"://"+i.host(),k=[],d=p.NONE,kt=3e4,ut=!1,g=!1,ht=!1,dt=!1,ct=!1;n.$on("$routeChangeSuccess",function(n,t,i){if(l.isUserInFlight("aad-1")&&t&&t.$$route){var r=t.$$route;if(r.requireLogin)if(oi(r.requireLogin))k=r.requireLogin;else throw new Error("Unable to set page preference as invalid idp array values were passed in");else k=[];typeof i!="undefined"&&(g=!1,e.authInfo.authStatus()===2||v.loginInProgress()||v.renewActive()||it())}});n.$on("UserSignedIn",function(){ht=!0;l.isUserInFlight("aad-1")&&(li()?it():lt())});n.$on("UserSignedOut",function(){ht=!0;l.isUserInFlight("aad-1")&&(li()?it():lt())});n.$on("adal:stateMismatch",function(n,t){if(t){var i=a.createEvent(a.eventTypes.auth.aadStateMismatch);t==="SUCCESS"?i.resolve():i.reject(t)}});var ai=function(){ir()},vi=function(n,t){o.isNative()?o.signInUser(t):(rt=n?n:!1,gt(n))},yi=function(){ft()?i.path(y.signOutPersonalUri):et()&&i.path(y.signOutWorkUri)},lt=function(){v.loginInProgress()||v.renewActive()||pr()?it():(ci()&&ti()&&v.clearToken(),g=!1,ur())},gt=function(n){o.isNative()?o.signInUser(i.absUrl()):k.length===1&&k[0]===p.MSA?at(p.MSA,n):at(p.AAD,n)},at=function(n,r){o.isNative()?o.signInUser(i.absUrl()):(n||(n=p.NONE),rt=r&&typeof r=="boolean"?r:rt,n===p.MSA?t.location=vr(!0,!!rt):n===p.AAD&&((k&&k.length===1&&k[0]===p.AAD||ii())&&(v.config.extraQueryParameter=y.msaFedParam),v.login()))},pi=function(){t.location=yr(!1,!!rt)},wi=function(n){n||(n=d);n===p.MSA?t.location=$(e.RpsSignInInfo.SignOutLink).attr("href"):n===p.AAD&&v.logOut()},bi=function(){return nt()&&ft()?fi():tt()&&et()?ei():w},vt=function(){return!g},ni=function(){return nt()||tt()},nt=function(){return u.get("smcloggedin")},tt=function(){return ri()?!1:v.userInfo.isAuthenticated},ki=function(){return d},ft=function(){return d===p.MSA&&g===!0},et=function(){return d===p.AAD&&g===!0},di=function(){return d===p.NONE&&g===!0},gi=function(){return p},nr=function(){return ar()},tr=function(n){lr(n)},ti=function(){return hi()},ii=function(){var n=window.location.hostname;return n===y.internalProdHost||n===y.internalUatHost||n===y.internalDevHost},ri=function(){return v&&v.userInfo&&v.userInfo.profile&&v.userInfo.profile.idp&&v.userInfo.profile.idp===y.msaFedIDP};return b.init=ai,b.login=gt,b.logout=wi,b.loginUsingAccountType=at,b.silentLoginAAD=lt,b.loginWithSAPIPolicy=pi,b.processUserSignIn=vi,b.processUserSignOut=yi,b.getSupportedIDP=gi,b.getUserInfo=bi,b.resolveAuthState=nr,b.isAuthStatusUnknown=vt,b.isAuthenticated=ni,b.isAuthenticatedMSA=nt,b.isAuthenticatedAAD=tt,b.isSignedInMSA=ft,b.isSignedInAAD=et,b.isNotSignedIn=di,b.getCurrentSignedInAccountType=ki,b.setPagePreference=tr,b.isIframe=ti,b.isInternalDomain=ii,b.checkMSAFedSignOn=ri,b}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("breadcrumbs",["$rootScope","breadcrumbsService",function(n,t){return{restrict:"EA",scope:{},templateUrl:"/PartialViews/Common/Breadcrumbs.html",link:function(i){i.breadcrumbs=t.getBreadcrumbs();n.$on("$viewContentLoaded",function(){i.breadcrumbs=t.getBreadcrumbs()})}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("breadcrumbsService",[function(){function t(r,u,f){if(r&&r.data&&r.data.breadcrumb&&(n.length||r.data.breadcrumb.parent)){var e=r.data.breadcrumb;n.unshift({url:i(r.originalPath,f),text:i(e.text,f)});t(u[e.parent],u,f)}}function i(n,t){return n&&n.indexOf(":")>=0&&t&&(n=n.replace(/:([a-zA-Z]+)/g,function(n,i){return t[i]?t[i]:n})),n}var n=[];this.generateBreadcrumbs=function(i,r){var u=i.current;n=[];t(u.$$route,i.routes,r)};this.getBreadcrumbs=function(){return n}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("delayService",["$q","$timeout",function(n,t){this.delay=function(i,r){return n.all([i,t(function(){},r)]).then(function(n){return n[0]})}}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("ngElementReady",[function(){return{priority:Number.MIN_SAFE_INTEGER,restrict:"A",link:function(n,t,i){n.$eval(i.ngElementReady)}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("focusContent",["$timeout","focusContentService",function(n,t){return{restrict:"A",scope:{name:"@",condition:"@"},link:function(i,r){function f(t){t===i.name&&u&&n(function(){r[0].focus()})}var u=!1;i.$on("FocusContent",function(n,t){f(t.name)});i.$watch("condition",function(n){u=n&&n.toLowerCase()==="true"||typeof i.condition=="undefined"?!0:!1;f(i.name)});f(t.activeTarget)}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("focusContentService",["$rootScope",function(n){this.activeTarget=null;this.focus=function(t){n.$broadcast("FocusContent",{name:t});this.activeTarget=t}}])}(angular.module(microsoft.support.moduleName)),function(n){n.component("geo",{templateUrl:"/PartialViews/ContactUs/Geo.html",bindings:{view:"<?",path:"@?",onSelection:"&",onContinue:"&"},controller:["$log","$rootScope","$location","geoService","languageService","compassService","widgetService",function(n,t,i,r,u,f,e){var o=this;this.continue=function(t){this.isVisible=!1;this.onContinue?this.onContinue({isUserInitiated:t}):n.log("No onContinue passed in - geo")};this.access=function(t){u.set(t,!0);f.clearCache();this.isVisible=!1;this.onSelection?this.onSelection({language:t}):n.log("No onSelection passed in - geo")};this.$onInit=function(){this.languages=[];this.isReady=!1;u.languages().then(r.getLocationInfo).then(function(n){if(!n.LocationRequestMismatch||!n.LanguageList||n.LanguageList.length===0){o.continue(!1);return}t.$broadcast("GeoOptionsPresented",i.path());o.currentLanguage=u.getLanguageInfo(u.langLocale());o.languages=n.LanguageList.map(function(n){return u.getLanguageInfo(n)}).filter(function(n){return!!n})},function(t){n.error(t);o.continue(!1)})["finally"](function(){o.isReady=!0})};this.$onChanges=function(t){t.view&&t.view.currentValue?(this.componentView=this.view,this.isVisible=!0):e.getWidgetConfig("Geo",this.path).then(function(t){t?(o.componentView=t.view,o.isVisible=!0):(n.error("Geo view not available for this path: "+i.path()),o.continue(!1))},function(t){n.error(t);o.continue(!1)})}}]})}(angular.module(microsoft.support.moduleName)),function(n){n.service("geoService",["$http","$routeParams",function(n,t){var i="/api/geo/location";this.getLocationInfo=function(){var r={};return t.ip&&(r.ip=t.ip),n.get(i,{params:r}).then(function(n){return n.data})}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("guidGenerator",["$window",function(n){this.newGuid=function(){var r=n.crypto||n.msCrypto,t,i;return r&&r.getRandomValues?(t=new Uint16Array(8),r.getRandomValues(t),i=function(n){for(var t=n.toString(16);t.length<4;)t="0"+t;return t},i(t[0])+i(t[1])+"-"+i(t[2])+"-"+i(t[3]&20479)+"-"+i(t[4]&16383|32768)+"-"+i(t[5])+i(t[6])+i(t[7])):"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})}}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).filter("linkify",function(){return function(n){var t,i=n,u,r;if(n&&n.toLowerCase().indexOf("<a")!==-1&&n.toLowerCase().indexOf("<\/a>")!==-1){do if(t=n.match(/<a.*?(?=>)/i),t!==null){if(r=t.toString(),r.toLowerCase().indexOf("target")!==-1){u=n.match(/target\=.*?(?=\s|>)/i);i=i.replace(u,"target='_blank'");n=n.replace(t,"");continue}i=i.replace(t,t+" target='_blank'");n=n.replace(t,"")}while(t!==null)}else if(n)do t=n.match(/^(?:(?:https?):\/\/?|www\.)[a-zA-Z0-9+&@#/%=~_|$?!:.-]*[a-zA-Z0-9+&@#/%=~_|$]/),t!==null&&(r=t.toString(),r.indexOf("http")!==0&&(r="http://"+r),i=i.replace(t,"<a href='"+r+"' target='_blank'>"+t+"<\/a>"),n=n.replace(t,""));while(t!==null);return i}});angular.module(microsoft.support.moduleName).directive("messageBanner",["$sce","messageBannerManagerService","compassService",function(n,t,i){return{restrict:"A",scope:{},templateUrl:"/PartialViews/Common/MessageBanner.html",link:function(r,u,f){function o(){var n=i.getPremierHomeView();n&&(r.view=n)}o();r.$on("CompassContentReady",function(){o()});r.messages=[];r.name=f&&f.name||"messageBanner";var e=!1;f&&f.isstacked&&(e=f.isstacked.toLowerCase()==="true");r.hasIcon=!1;f&&f.hasicon&&(r.hasIcon=f.hasicon.toLowerCase()==="true");r.dismissMessage=function(n){if(r.messages&&n){var t=r.messages.indexOf(n);t>=0&&r.messages.splice(t,1)}};r.clearMessages=function(){r.messages=[]};r.pushMessage=function(t){t&&(t.body&&(t.body=n.trustAsHtml(t.body)),e||!r.messages.length?r.messages.unshift(t):r.messages[0]=t)};t.registerBanner(r.name,r);r.$on("$destroy",function(){t.removeBanner(r.name)});u.on("$destroy",function(){t.removeBanner(r.name)})}}}]),function(n){n.service("messageBannerManagerService",function(){var n={};this.registerBanner=function(t,i){if(n[t]&&n[t].messages&&n[t].messages.length)while(n[t].messages.length)i.pushMessage(n[t].messages.shift());n[t]={scope:i,messages:[]}};this.removeBanner=function(t){n[t]=undefined};this.getBanner=function(t){return n[t]};this.notifyBanner=function(t,i){if(n[t]&&n[t].scope){var r=n[t].scope;r.pushMessage(i)}else n[t]?n[t].messages.push(i):n[t]={messages:[i]}};this.clearBanner=function(t){if(n[t]&&n[t].scope){var i=n[t].scope;i.clearMessages()}}})}(angular.module(microsoft.support.moduleName)),function(n){n.service("metatagService",[function(){this.fetchMetaTags=function(n){var i={},r,t,u,f;if(n){for(r=[],t=0;t<n.length;t++)u=n[t].key,f=n[t].value,r.push({name:u,content:f}),u.toLowerCase()=="title"&&(i.metaTagTitle=f);return i.pageMetaTags=r,i}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("modalService",["$q","$templateRequest","$document","$rootScope","$controller","$compile",function(n,t,i,r,u,f){function e(n){return t(n,!0)}this.open=function(t){function v(){s&&(s.$destroy(),s=null);o!=null&&(o.remove(),o=null)}function a(){return l.resolve(!0),o!=null?(o.modal("hide"),v(),!0):!1}var h;if(!t.templateUrl||!t.controller)throw new Error("templateUrl and controller are required.");t.appendTo=t.appendTo||i.find("body").eq(0);t.id=t.id||"modalDialog";var l=n.defer(),c=n.defer(),o=null,s=null;return h={opened:null,closed:l.promise,result:c.promise,close:function(n){c.resolve(n);a()},dismiss:function(n){c.reject(n);a()}},h.opened=e(t.templateUrl).then(function(n){var c=t.scope||r,l,e;s=c.$new();e={};t.controller&&(e.$scope=s,e.modalInstance=h,l=u(t.controller,e));o=angular.element('<div class="modal" role="dialog" tabindex="-1"><\/div>').attr("aria-describedby",t.id);o.append(angular.element('<div class="modal-dialog" role="document"><\/div>').append(angular.element('<div class="modal-content"><\/div>').attr("id",t.id).html(n)));t.appendTo.append(o);f(o)(s);i.on("hidden.bs.modal",function(){h.dismiss("clickoutside")});o.modal("show")}),h}}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("modelValueChangeWatcher",[function(){return{restrict:"A",require:"ngModel",scope:{modelChangeCallback:"&"},link:function(n,t,i,r){r.$validators.emptyValidator=function(t){return n.modelChangeCallback({newValue:t}),!0}}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.value("contactCommands",{notifyChatStarted:"NotifyChatStarted",notifyChatEnded:"NotifyChatEnded",angularJsReady:"angularjsready",notifyAppClosingComplete:"notifyappclosingcomplete",showtoast:"showtoast",notifychatenqueue:"notifychatenqueue",notifychatdequeue:"notifychatdequeue",signInUser:"signinuser",appStartContext:"appstartcontext",getRelayInfo:"getrelayinfo",forwardToAgent:"forwardtoagent",sharingSessionConnected:"sharingsessionconnected",sharingSessionFailed:"sharingsessionconnectionfailed",notifyAppClosing:"notifyappclosing",signInFailed:"signinfailed",getAppContext:"getappcontext",beginSharing:"beginsharing",endSharing:"endsharing",pauseSharingByAgent:"pausesharingbyagent",resumeSharingByAgent:"resumesharingbyagent",clearCanvas:"clearcanvas",changeBrushColor:"changebrushcolor",changeBrushSize:"changebrushsize",setSharingMode:"setsharingmode",endSharingByUser:"endsharingbyuser",pauseSharingByUser:"pausesharingbyuser",resumeSharingByUser:"resumesharingbyuser"});n.value("contactMessageTypes",{requestResponse:"requestresponse",userRequest:"userrequest"});n.service("nativeAppService",["$log","$window","$rootScope","$cookies","$location","contactCommands","contactMessageTypes","chatStateService","relayService",function(n,t,i,r,u,f,e,o,s){function a(n,t){t&&(n={command:f.forwardToAgent,context:n});v(n,!0)}function v(n,r){n&&n.command&&(r&&n.context?i.$broadcast("ForwardToAgent",JSON.stringify(n.context)):t&&t.external&&"notify"in t.external&&(i.$broadcast("AppActionStart",n.command),t.external.notify(JSON.stringify(n))))}function w(t){switch(t.command){case f.appStartContext:return t.context&&(i.$broadcast("AppStartContext",t.context),ft(t.context.EffectiveCapabilities),o.setAppStartContext(t.context)),!0;case f.forwardToAgent:return nt(t.context)||a(t,!1),b(t.context),!0;case f.signInFailed:return i.$broadcast("NativeSignInFailed"),!0;case f.notifyAppClosing:return i.$broadcast("NativeAppClosing"),!0;default:n.error("Unknown App Command: '"+t.command+"' received")}return!1}function b(t){switch(t.command){case e.userRequest:case e.requestResponse:return tt(t.command,t.context)?it(t.command,t.context):rt(t.command,t.context),!0;default:n.error("Unknown App Message Type: '"+t.command+"' received")}return!1}function k(t){switch(t.command){case f.getAppContext:return h.sendAgentRequestResponse(f.getAppContext,!0,"App start context in custom field","",o.getAppStartContext()),!0;case f.getRelayInfo:return s.getNearestRelay().then(function(n){h.sendAgentRequestResponse(f.getRelayInfo,!0,"Nearest relay information in custom field","",{relayEndpoint:n.data.HostName})},function(n){h.sendAgentRequestResponse(f.getRelayInfo,!1,"Nearest Relay information error in custom field","",{error:n})}),!0;case f.beginSharing:return t.context&&t.context.promptuser?i.$broadcast("ChatScreenShareRequest",t):(i.$broadcast("ChatScreenShareReconnect"),h.sendAppCommand(t)),!0;case f.endSharing:case f.pauseSharingByAgent:case f.resumeSharingByAgent:case f.clearCanvas:case f.changeBrushColor:case f.changeBrushSize:return h.sendAppCommand(t),!0;case f.setSharingMode:return i.$broadcast("SetSharingModeRequest",t.context.sharingmode),h.sendAppCommand(t),!0;default:n.error("Unknown Agent Command: '"+t.command+"' received")}return!1}function d(n){return n&&n.requestname}function g(n){return n&&n.responsename&&n.success}function nt(n){if(n&&n.command&&n.context){var t=y(n.command,n.context);return t===f.sharingSessionFailed}return!1}function tt(n,t){switch(n){case e.userRequest:return d(t)&&h.isUnderstoodCommand(t.requestname);case e.requestResponse:return g(t)&&h.isUnderstoodCommand(t.responsename)}return!1}function y(n,t){switch(n){case e.userRequest:return t.requestname;case e.requestResponse:return t.responsename}return null}function it(n,t){var r=y(n,t);i.$broadcast("AppActionEnd",{command:r,success:!0});switch(r){case f.sharingSessionConnected:return i.$broadcast("ChatScreenShareEstablished"),!0;case f.sharingSessionFailed:return i.$broadcast("ChatScreenShareConnectFailed"),!0;case f.endSharing:case f.endSharingByUser:return i.$broadcast("ChatScreenShareClosed"),!0;case f.pauseSharingByAgent:case f.pauseSharingByUser:return i.$broadcast("ToggleScreenShare",!0),!0;case f.resumeSharingByAgent:case f.resumeSharingByUser:return i.$broadcast("ToggleScreenShare",!1),!0;case f.setSharingMode:return i.$broadcast("SetSharingMode"),!0;case f.beginSharing:case f.clearCanvas:case f.changeBrushColor:case f.changeBrushSize:return!0}return!1}function rt(t,r){var u=y(t,r);i.$broadcast("AppActionEnd",{command:u,success:!1});switch(u){case f.beginSharing:case f.pauseSharingByUser:case f.resumeSharingByUser:return i.$broadcast("ChatScreenShareError",u),n.error("Native Command: "+r.command+" failed with context: "+JSON.stringify(r.context)),!0;case f.endSharing:case f.pauseSharingByAgent:case f.resumeSharingByAgent:case f.clearCanvas:case f.changeBrushColor:case f.changeBrushSize:case f.setSharingMode:return!0}return!1}function ut(){document.cookie=p.nativeCookie+"="+c+";path=/"}function ft(n){n&&n.map(function(n){typeof l[n]!="undefined"&&(l[n]=!0)})}var p={nativeCookie:"isNative"},l={ScreenSharing:!1,Annotation:!1,FullControl:!1,PauseSharing:!1},h=this,c;this.setNative=function(n){var t=c;c=n;c!==t&&i.$broadcast("NativeCookieUpdate");ut()};this.isNative=function(){return u&&u.search()&&typeof u.search().isNative!="undefined"?u.search().isNative:c||!1};this.hasCapability=function(n){return!!l[n]};this.isUnderstoodCommand=function(n){for(var t in f)if(f[t]===n)return!0;return!1};this.receiveCommand=function(n,t){return c&&n&&n.command?t?k(n):w(n):!1};this.signInUser=function(n){v({command:f.signInUser,context:{successUrl:n}},!1)};this.sendAppCommand=function(n){c&&v(n,!1)};this.sendAgentUserRequest=function(n,t){a({command:e.userRequest,context:{requestname:n,data:t||null}},!0)};this.sendAgentRequestResponse=function(n,t,i,r,u){a({command:e.requestResponse,context:{responsename:n,success:t,message:i,errorcode:r,custom:u||null}},!0)};i.$on("CommandMessageReceived",function(n,t){h.receiveCommand(t,!0)});i.$on("ChatSessionEstablished",function(){h.sendAppCommand({command:f.notifyChatStarted})});i.$on("ChatSessionClosed",function(){h.sendAppCommand({command:f.notifyChatEnded})});i.$on("NotifyAppClosingComplete",function(){h.sendAppCommand({command:f.notifyAppClosingComplete})});i.$on("ShowToast",function(n,t){h.sendAppCommand({command:f.showtoast,context:{text:t}})});i.$on("EnqueueChatSuccess",function(){h.sendAppCommand({command:f.notifychatenqueue})});i.$on("ChatDisengageSuccess",function(){h.sendAppCommand({command:f.notifychatdequeue})});i.$on("AngularJsReady",function(){h.sendAppCommand({command:f.angularJsReady})});u.search()&&typeof u.search().isNative!="undefined"?this.setNative(u.search().isNative):c=r.get(p.nativeCookie)}])}(angular.module(microsoft.support.moduleName));window&&(window.selfAssistWeb=window.selfAssistWeb||{},window.selfAssistWeb.receiveCommand=function(n){return angular.element(document).injector().get("nativeAppService").receiveCommand(n,!1).toString()});angular.module(microsoft.support.moduleName).directive("navigationConfirmation",["$window","$rootScope","rccService","chatStateService",function(n,t,i,r){return{restrict:"A",scope:{message:"&",condition:"&"},link:function(t){function u(n){if(t.condition())return(n||window.event).returnValue=t.message(),t.message()}function f(){i.endChat()}function e(){r.getChatEstablished()||i.endChat()}$(n).bind("beforeunload",u);$(n).bind("onbeforeunload",u);$(n).bind("beforeunload",e);$(n).bind("onbeforeunload",e);$(n).bind("unload",f);$(n).bind("onunload",f);t.$on("$destroy",function(){$(n).unbind("beforeunload",u);$(n).unbind("onbeforeunload",u);$(n).unbind("unload",f);$(n).unbind("onunload",f)})}}}]);angular.module(microsoft.support.moduleName).filter("objectOrderBy",function(){return function(n,t,i){var r=[];for(var u in n)n[u]!==undefined&&r.push(n[u]);return r.sort(function(n,i){return n[t]>i[t]?1:-1}),i&&r.reverse(),r}}),function(n){n.service("objectTableApi",[function(){this.joinToken="join:";this.objectByString=function(n,t){var r,i,u;for(t=t.replace(/\[(\w+)\]/g,".$1"),t=t.replace(/^\./,""),r=t.split("."),i=0;i<r.length;++i)if(u=r[i],u in n)n=n[u];else return;return n};this.setObjectProperty=function(n,t,i){var r,u,f,e;for(i=i.replace(/\[(\w+)\]/g,".$1"),i=i.replace(/^\./,""),r=i.split("."),u=n,f=0;f<r.length;f++)if(e=r[f],e in n)u=n,n=n[e];else return;return u&&(u[r[r.length-1]]=t),n};this.getJoinProperty=function(n,t){for(var f,u,e=t.slice(this.joinToken.length).trim().split(","),r=[],i=0;i<e.length;i++)f=this.objectByString(n,e[i]),f&&r.push(f);if(r.length>0){if(r.length==1)return r[0];for(u="",i=0;i<r.length;i++)u+=r[i],i<r.length-1&&(u+=" ");return u}return""}}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("objectTable",["objectTableApi",function(n){return{templateUrl:"/PartialViews/Common/ObjectTable.html",scope:{bindObject:"=",tableConfig:"=",sortFunction:"&",formatFunction:"&",elementChangedFunction:"&"},controller:["$scope","$location","languageService",function(t,i,r){function u(t,i){return i.linkTemplate.replace(/\{[\w.\[\]]+\}/g,function(i){var u=i.substr(1,i.length-2);return u=="langLocale"?r.langLocale():n.objectByString(t,u)})}function f(n){if(t.tableConfig.columns[n]!=null&&t.tableConfig.columns[n].defaultColumn)for(var i=0;i<t.tableConfig.columns.length;i++)i==n?(t.tableConfig.columns[i].style.sortDescending=!t.tableConfig.columns[i].style.sortDescending,t.tableConfig.columns[i].style.active=!0,t.tableConfig.columns[i].style.ascending==!0?(t.tableConfig.columns[i].style.ascending=!1,t.tableConfig.columns[i].style.descending=!0):(t.tableConfig.columns[i].style.ascending=!0,t.tableConfig.columns[i].style.descending=!1)):t.tableConfig.columns[i].style.active=!1}t.getObjectProperty=function(i,r){var u=null;return u=r.propertyName.indexOf(n.joinToken)==0?n.getJoinProperty(i,r.propertyName):n.objectByString(i,r.propertyName),r.format!=null&&r.format.length>0&&t.formatFunction&&(u=t.formatFunction({value:u,format:r.format})),u};t.linkPropertyClicked=function(n,t){return i.url(u(n,t))};t.checkboxPropertyClicked=function(i,r){var u=n.objectByString(i,r.propertyName);n.setObjectProperty(i,!u,r.propertyName);t.elementChangedFunction&&typeof t.elementChangedFunction=="function"&&t.elementChangedFunction({element:i,propName:r.propertyName,oldVal:u,newVal:!u})};t.sortColumn=function(n){f(n);t.sortFunction({sortParams:t.tableConfig.columns[n].style,propertyName:t.tableConfig.columns[n].propertyName})};t.getNumberOfVisibleObject=function(){if(t.bindObject&&t.bindObject.length){var n=0;return angular.forEach(t.bindObject,function(i){t.isObjectVisible(i)&&n++}),n}return 0};t.isObjectVisible=function(n){return n.visible==null||n.visible!=null&&n.visible==!0};t.$watch("tableConfig",function(n){if(n!=null)for(var t=0;t<n.columns.length;t++)n.columns[t].style={sortable:!(n.disableSorting!=="undefined"&&n.disableSorting),ascending:!0,descending:!1,sortDescending:!0,active:n.columns[t].active}})}]}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("OnlineController",["$scope","compassService",function(n,t){function i(){n.offlineMessage=t.getOfflineMessage()}n.$on("CompassContentReady",function(){i()});i()}])}(angular.module(microsoft.support.moduleName));app.run(["$window","$rootScope",function(n,t){t.online=navigator.onLine?!0:!1;n.addEventListener&&(n.addEventListener("online",function(){t.online=!0;t.$apply();t.$broadcast("ClientReconnected")}),n.addEventListener("offline",function(){t.online=!1;t.$apply()}))}]),function(n){n.controller("PageController",["$rootScope","$scope","$window","$location","$route","$routeParams","$timeout","compassService","osService","partnerDataService","languageService","currentLanguageService","flightService","nativeAppService","clientConfig","iframeService","authService","$cookies",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){function k(){t.noChrome=t.iFrame||r.search().nochrome||v.isNative()}function g(){t.iFrame=p.init(document.referrer,parent);t.iFrame==p.noHostsList&&t.$on("CompassContentReady",function(){t.iFrame=p.init(document.referrer,parent);k()})}function nt(n){var i=o.getPageInfo();c.languages().then(function(n){t.languages=n});i&&(t.title=t.title&&n?t.title:i.pageTitle,t.alertBanner=i.alertBanner,i.alertBannerLink&&i.alertBannerLink.linkText&&i.alertBannerLink.linkUrl&&(t.alertBannerLink='<a id="alert-banner-link" href="'+i.alertBannerLink.linkUrl+'">'+i.alertBannerLink.linkText+"<\/a>"),i.alertBannerLink2&&i.alertBannerLink2.linkText&&i.alertBannerLink2.linkUrl&&(t.alertBannerLink2='<a id="alert-banner-link-2" href="'+i.alertBannerLink2.linkUrl+'">'+i.alertBannerLink2.linkText+"<\/a>"))}function tt(){t.skylightEntryView=o.getVirtualAgentEntry()}function rt(){t.errorStatus=i.navigator.cookieEnabled?null:"cookies"}var it=a.isUserInFlight("aad-1"),ut=f.preview||b.get("smc_preview")||n.preview,d;t.title="";t.noIndex=!1;t.isThemeLoaded=!0;t.locale=c.langLocale();t.noChrome=!1;t.iFrame=!1;t.metaTags=[];t.isThemeLoaded=!1;h.loadTheme().then(function(){t.isThemeLoaded=!0},function(){t.isThemeLoaded=!0});t.getCv=function(){return i&&i.Asimov&&i.Asimov.cv?i.Asimov.cv.getValue():null};t.reset=function(){t.isMobile=s.isMobile();nt();tt();rt()};t.$on("UpdateTitle",function(n,i){t.title=i});t.$on("AddMetaTags",function(n,i){var r,u;for(r in i)u=t.metaTags.map(function(n){return n.name}).indexOf(i[r].name),u>=0?t.metaTags[u]=i[r]:t.metaTags.push(i[r])});t.$on("CompassContentReady",function(){nt(!0);tt()});t.$on("NoIndex",function(){t.noIndex=!0});t.$on("500Error",function(n,i){t.errorStatus||(t.errorStatus="500");t.errorContent=i&&i.errorContent});t.$on("404Error",function(n,i){t.errorStatus||i&&i.preventError||(t.errorStatus="404");t.errorContent=i&&i.errorContent});t.$on("$routeChangeStart",function(){t.errorStatus!=="cookies"&&(t.errorStatus=null);t.noIndex=!1});t.$on("$routeChangeSuccess",function(){t.canonicalUrl="https://support.microsoft.com"+r.path();k();t.hideSearch=u.current&&u.current.data&&u.current.data.hideSearch==!0;t.fluidContainer=u.current&&u.current.data&&u.current.data.fluidContainer==!0;t.isDefaultPremier=u.current&&u.current.data&&u.current.data.isDefaultPremier==!0;t.hasSkylightEntry=u.current&&u.current.data&&u.current.data.hasSkylightEntry===!0&&a.isUserInFlight("vac-8")&&!t.noChrome;t.metaTags=[]});it&&w.isInternalDomain()&&y.InternalContentConfig.AllowInternalContent?(d=w.getSupportedIDP(),w.isIframe()?(g(),k(),w.resolveAuthState().then(function(n){n===d.AAD?t.reset():r.path("/"+t.locale+"/internalsignin")})):w.resolveAuthState().then(function(n){n===d.AAD?(k(),t.reset()):w.login()})):(w.isIframe()&&g(),k(),t.reset())}])}(angular.module(microsoft.support.moduleName)),function(n,t){t.service("resourceLoaderService",["$q","$document","qosTelemetryService",function(t,i,r){this.loadCSS=function(u){var f=t.defer(),e=r.createEvent(r.eventTypes.app.downloadCSS);return i[0].createStyleSheet?(i[0].createStyleSheet(u),f.resolve(),e.resolve(),f.promise):(n.element("head").append(n.element('<link rel="stylesheet" type="text/css" />').attr("href",u).on("load",function(){e.resolve();f.resolve()}).on("error",function(){e.reject();f.reject()})),f.promise)}}])}(angular,angular.module(microsoft.support.moduleName)),function(n){n.directive("smoothScroll",["$window","$document","$timeout",function(n,t,i){return{restrict:"A",link:function(r,u,f){function c(t){var f=l(),r=a(t),c=Math.abs(r-f),u=Math.round(c/25),v=Math.round(c/100);if(v>=o&&(v=o),u>=s&&(u=s),c<=h){n.scrollTo(0,r);return}e=i(function y(t){r>f?(t+=u,t>r&&(t=r)):(t-=u,t<r&&(t=r));n.scrollTo(0,t);t!==r&&(e=i(y.bind(this,t),v))}.bind(this,f))}function l(){return n.self.pageYOffset?n.self.pageYOffset:t[0].documentElement&&t[0].documentElement.scrollTop?t[0].documentElement.scrollTop:t[0].body&&t[0].body.scrollTop?t[0].body.scrollTop:0}function a(n){if(n){for(var i=n,r=i.offsetTop;i.offsetParent&&i.offsetParent!==t[0].body;)i=i.offsetParent,r+=i.offsetTop;return r}return 0}var e,o=parseInt(f.maxSpeed,10)||5,h=parseInt(f.minSkipDistance,10)||10,s=parseInt(f.maxStep,10)||15;r.$on("SmoothScroll",function(n,t){f.name===t&&c(u[0])});r.$on("$destroy",function(){i.cancel(e)})}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("smoothScrollService",["$rootScope",function(n){this.scroll=function(t){n.$broadcast("SmoothScroll",t)}}])}(angular.module(microsoft.support.moduleName));app.directive("starRating",["compassService",function(n){function t(){return n.getChatSurvey()}return{restrict:"A",templateUrl:"/PartialViews/Common/StarRating.html",scope:{ratingValue:"=value",scales:"=",name:"@",max:"=?"},link:function(n){n.max=n.max||5;n.stars=new Array(n.max);n.view=t();n.rate=function(t){n.ratingValue=t+1};n.preview=function(t){n.previewValue=t+1}}}}]),function(n){n.service("windowService",["$window","$document","flightService",function(n,t,i){var r=630,u=420;this.openPopupCenter=function(f,e,o){var h,s;o=o||{};o.width=o.width||u;o.height=o.height||r;var c=n.screenLeft!=undefined?n.screenLeft:n.screen.left,l=n.screenTop!=undefined?n.screenTop:n.screen.top,a=n.innerWidth?n.innerWidth:t.documentElement.clientWidth?t.documentElement.clientWidth:n.screen.width,v=n.innerHeight?n.innerHeight:t.documentElement.clientHeight?t.documentElement.clientHeight:n.screen.height;return o.left=a/2-o.width/2+c,o.top=v/2-o.height/2+l,i.isUserInFlight("vac-23")&&(o.left=o.left<0?0:o.left,o.top=o.top<0?0:o.top),h=Object.keys(o).map(function(n){return n+"="+o[n]}).join(","),s=n.open(f,e,h),s.focus&&s.focus(),s}}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("workflow",["$rootScope","workflowManagerService","$route","$location","$window",function(n,t,i,r,u){return{restrict:"A",scope:{context:"="},transclude:!0,templateUrl:function(n,t){return t.templateUrl},controller:["$scope","$element","$attrs",function(n,f,e){function c(n){r.search(l,n+1)}var l="sn",a=i&&i.current,o=e.workflowName,s=parseInt(r.search()[l],10),h;(typeof s!="number"||s<=0)&&c(0);h=t.maxStepCanEnter(o);s-1>h&&c(h>=0?h:0);t.getWorkflow(o)?t.enter(o,s-1):t.registerWorkflow(o);n.$on("$destroy",function(){t.removeWorkflow(o)});n.$on("$routeUpdate",function(){s=parseInt(r.search()[l],10);s=s||1;h=t.maxStepCanEnter(o);s-1>h&&c(h>=0?h:0);t.enter(o,s-1)});this.getWorkflowName=function(){return o};this.getStepTemplateUrl=function(){return e.stepTemplateUrl};this.registerStep=function(n,i){return t.registerStep(o,n,i)};this.canEnter=function(n){return t.canEnter(o,n)};this.isOpen=function(n){return t.isOpen(o,n)};this.moveToNext=function(n){return c(n+1)};this.moveToPrev=function(){return u.history.back()};this.hasPrev=function(n){return t.hasPrev(o,n)};this.hasNext=function(n){return t.hasNext(o,n)};this.totalSteps=function(){return t.totalSteps(o)};this.getContext=function(){return n.context}}]}}]),function(n){n.service("workflowManagerService",["$window",function(n){var t={};this.registerWorkflow=function(n){if(n)if(t[n])throw new Error("workflow name:"+n+" already exists.");else t[n]={steps:[],currentStepIndex:-1,results:{}};else throw new Error("workflow name is required for workflow registration.");};this.refreshWorkflowBeforeStep=function(n,i){if(n&&t[n]&&t[n].steps)for(var r=0;r<=Math.min(i,t[n].steps.length-1);r++)t[n].steps[r].step.refresh()};this.totalSteps=function(n){return t[n]?t[n].steps.length:0};this.getWorkflow=function(n){return n&&t.hasOwnProperty(n)&&t.hasOwnProperty(n)&&t[n]!=undefined?t[n]:null};this.removeWorkflow=function(n){n&&t.hasOwnProperty(n)&&(t[n]=undefined)};this.registerStep=function(n,i,r){if(n&&i&&r){t[n]||this.registerWorkflow(n);var u={step:i,providedScope:r,isOpen:!1},f=t[n],e=f.currentStepIndex;return e<0?(u.isOpen=!0,f.currentStepIndex=0):e==t[n].steps.length&&(u.isOpen=!0),t[n].steps.push(u),t[n].steps.length-1}throw new Error("workflow name, workflow step and providedScope are required for registering steps.");};this.updateStep=function(n,i,r,u){if(n&&r&&u&&i!=undefined){if(t[n]||this.registerWorkflow(n),i<0||i>=t[n].steps.length)throw new Error("stepIndex out of range");var f=t[n].steps[i];r&&(f.step=r);u&&(f.providedScope=u);t[n].steps[i]=f}else throw new Error("workflow name, workflow step, providedScope and stepIndex are required for registering steps.");};this.getCurrentStepIndex=function(n){if(n&&t[n])return t[n].currentStepIndex;throw new Error("Workflow name="+n+' doesn"t exist');};this.canEnter=function(n,i){var r,u;if(t[n]&&t[n].steps.length>0)for(r=0;r<t[n].steps.length;r++)if(u=t[n].steps[r].step,r!=i){if(u.isStepComplete!=undefined&&typeof u.isStepComplete=="function"&&!u.isStepComplete())return!1}else return!0;else return!1};this.maxStepCanEnter=function(n){var i,r;if(t[n]&&t[n].steps.length>0){for(i=0;i<=t[n].steps.length-1;i++)if(r=t[n].steps[i].step,r.isStepComplete!=undefined&&typeof r.isStepComplete=="function"&&!r.isStepComplete())return i;return i>0?Math.min(i,t[n].steps.length-1):0}return-1};this.enter=function(i,r){if(this.canEnter(i,r)){var u=this.getCurrentStepIndex(i);u!=r&&(n.scrollTo(0,0),t[i].steps[u].isOpen=!1,t[i].steps[u].providedScope.exit(),t[i].steps[t[i].currentStepIndex].step.exitStep(),t[i].currentStepIndex=r,t[i].steps[t[i].currentStepIndex].providedScope.enter(),t[i].steps[t[i].currentStepIndex].step.enterStep(),t[i].steps[t[i].currentStepIndex].isOpen=!0)}};this.isOpen=function(n,i){return i!=undefined&&n!=undefined&&t[n]!=undefined?t[n].steps[i].isOpen:!1};this.hasNext=function(n,i){return n!=undefined&&t[n]!=undefined&&t[n].steps.length-1>i&&i>=0?!0:!1};this.hasPrev=function(n,i){return n!=undefined&&t[n]!=undefined&&t[n].steps.length>i&&i>0?!0:!1};this.moveToNext=function(n,t){this.hasNext(n,t)&&this.enter(n,t+1)};this.moveToPrev=function(n,t){this.hasPrev(n,t)&&this.enter(n,t-1)};this.getStepResults=function(n){return t[n]&&t[n].results?t[n].results:{}};this.saveStepResult=function(n,i){t[n]&&t[n].results&&i&&(t[n].results=angular.extend(t[n].results,i))}}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("workflowStep",["$q","workflowStepService",function(n,t){return{restrict:"A",require:"^workflow",scope:{},link:function(n,i,r,u){var f=u.registerStep({},{}),e,s,l,h;n.stepIndex=f;n.totalSteps=function(){return u.totalSteps()};n.stepName=r.stepName||n.stepIndex;n.view=function(){var n=u.getContext();return n?n.view:{}};n.canEnter=function(){return u.canEnter(f)};n.isOpen=function(){return u.isOpen(f)};n.moveToNext=function(){u.moveToNext(f)};n.moveToPrev=function(){u.moveToPrev(f)};n.hasPrev=function(){return u.hasPrev(f)};n.hasNext=function(){return u.hasNext(f)};n.enter=function(){};n.exit=function(){};e=u.getWorkflowName();n.workflowName=e;var c=u.getStepTemplateUrl(),a=r.viewTemplateUrl,v=r.controllerName,o=i[0].querySelector(".workflow-step");o=o?angular.element(o):i;s=r.templateUrl;s!=undefined&&(c=s);l={stepDirectiveTemplateUrl:c,viewTemplateUrl:a,controllerName:v,appendTo:i,workflowName:e,scope:n,stepIndex:f};h=t.create(l);n.showNavi=function(){return h.showCommonStepNavi()};n.isComplete=function(){return h.isStepComplete()}}}}]),function(n){n.service("workflowStepService",["$q","$templateRequest","$rootScope","$controller","$compile","workflowManagerService",function(n,t,i,r,u,f){function e(n){return t(n,!0)}this.create=function(t){var s,c;if(!t.viewTemplateUrl||!t.controllerName||!t.appendTo||!t.workflowName||!t.scope)throw new Error("templateUrl, controllerName, appendTo and workflowName are required.");var h=n.defer(),o=null,i={output:h.promise,complete:function(n){h.resolve(n)},invalidate:function(n){h.reject(n)}};return["moveToNext","moveToPrev","hasPrev","hasNext"].forEach(function(n){i[n]=function(){return f[n](t.workflowName,t.stepIndex)}}),i.getStepResults=function(){return f.getStepResults(t.workflowName)},i.saveStepResult=function(n){return f.saveStepResult(t.workflowName,n)},s=[e(t.viewTemplateUrl)],c=t.stepDirectiveTemplateUrl!==""&&t.stepDirectiveTemplateUrl!==undefined,s=c?s.concat(e(t.stepDirectiveTemplateUrl)):s,i.created=n.all(s).then(function(n){var h=t.scope,p,a,s,l;o=h.$new(c);a={$scope:o,stepInstance:i};p=r(t.controllerName,a);["enterStep","exitStep","refresh"].forEach(function(n){i[n]=function(){if(angular.isFunction(o[n]))return o[n]()}});["isStepComplete","showCommonStepNavi"].forEach(function(n){i[n]=function(){return angular.isFunction(o[n])?o[n]():!0}});i.refreshWorkflowBeforeStep=function(){f.refreshWorkflowBeforeStep(t.workflowName,t.stepIndex)};var w=n[0],v=angular.element(w),e=t.appendTo,y=n[1];y!=undefined&&(s=angular.element(y),u(s)(h),e.append(s),l=e[0].querySelector(".workflow-step"),e=l?angular.element(l):angular.element(s[0]));e.append(v);u(v)(o);f.updateStep(t.workflowName,t.stepIndex,i,h)}),i}}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("callback",["$rootScope","$log","$location","$sanitize","$routeParams","$filter","clientConfig","chatStateService","rccService","languageService","compassService","sessionStorageService","phoneNumberService","waitTimeService","modalityTags","unauthNames","authService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){function b(r){function k(){r.loadingTimes=!0;r.callInfo.times=[];r.callInfo.disableTimeSelect=!0;s.getCallbackTime(r.callInfo.date.toISOString().substring(0,19)+"Z",96,o.getSubject())}function g(n){for(var t=0;t<r.callInfo.availableCountries.length;t++)if(r.callInfo.availableCountries[t].locale.toUpperCase()===n.toUpperCase())return t.toString();return null}function d(){r.callback=c.getCallback();r.status.waitingOnCompass=!r.callback}function u(n){r.callInfo.currentError=n;r.$apply(function(){r.callInfo.templateUrl="/PartialViews/Contact/Callback/Error.html"});r.loadingTimes=!1}function nt(n){var i=[],t,r;for(i.push(new Date),t=1;t<n;t++)r=new Date((new Date).getTime()+t*864e5),r.setHours(0,0,0,0),i.push(r);return i}function tt(n){var f=r.callInfo.date.getDate(),u=[],t,i;for(t in n)i=new Date(n[t]),i.getDate()===f&&u.push({time:n[t],dateobject:i});return u}function b(n,t,i){if(typeof n!="undefined"){var r=parseInt(n,10);i(r)}else return t()}function it(n){r.callInfo.countryCode=a.selectCountryCode(n);r.callInfo.placeholder=a.getCurrentMask();r.getValidNumber()}r.hoops={};r.config={templateUrl:"/PartialViews/Contact/Callback/Callback.html",hoopsEnabled:e.ChatConfig.AllowHoursOfOperation,timeout:e.ChatConfig.ChatDefaultTimeout};r.reset=function(){r.awaitingResponse=!0;r.status={waitingOnHoops:!1,waitingOnRcc:!0,waitingOnCompass:!0};r.callInfo={};r.callInfo.countryCodeProperty=function(n){return b(n,function(){return r.callInfo.countryCodeIndex},function(n){n>=0&&n<r.callInfo.availableCountries.length?(it(r.callInfo.availableCountries[n].locale),r.callInfo.countryCodeIndex=n.toString()):t.error("Index for scope.callInfo.availableCountries is out of bounds. Index: "+n+". Array length: "+r.callInfo.availableCountries.length)})};r.callInfo.dateProperty=function(n){return b(n,function(){return r.callInfo.dateIndex},function(n){n>=0&&n<r.callInfo.availableDates.length?(r.callInfo.date=r.callInfo.availableDates[n],r.callInfo.dateIndex=n.toString(),r.callInfo.availableCountries&&k()):t.error("Index for scope.callInfo.availableDates is out of bounds. Index: "+n+". Array length: "+r.callInfo.availableDates.length)})};r.callInfo.timeProperty=function(n){return b(n,function(){return r.callInfo.timeIndexString},function(n){n>=0&&n<r.callInfo.times.length?(r.callInfo.time=r.callInfo.times[n],r.callInfo.timeIndexString=n.toString()):t.error("Index for scope.callInfo.times is out of bounds. Index: "+n+". Array length: "+r.callInfo.times.length)})};r.callInfo.number=r.phoneNumber||"";r.callInfo.invalidNumber=!1;r.callInfo.times=[];r.callInfo.availableDates=r.isScheduleCallback?nt(7):[];r.callInfo.dateProperty("0");r.callInfo.currentError="";r.callInfo.disableTimeSelect=!0;r.callInfo.number&&r.getValidNumber();var n=!l.get(p.storage),u=w.getSupportedIDP();s.init(n,u.MSA,function(){r.awaitingResponse=!1;r.status.waitingOnRcc=!1;r.config.hoopsEnabled&&!r.isScheduleCallback?(r.status.waitingOnHoops=!0,s.isWithinOperatingHours(o.getSubject(),y.callback).then(function(n){r.status.waitingOnHoops=!1;n[y.callback].isOpen?r.initCallback():i.path("/hoops/callback/"+o.getSubject())})):r.initCallback()});d()};r.initCallback=function(){r.callInfo.availableCountries=a.populateDropdown();r.callInfo.countryCodeProperty(g(h.locale()));r.callInfo.templateUrl=r.config.templateUrl;r.isScheduleCallback&&k()};r.requestCall=function(t){if(r.getValidNumber(),!r.callInfo.invalidNumber){n.$broadcast("ButtonClickedAndDisabled",t);r.awaitingResponse=!0;var i=r.callInfo.countryCode.code+" "+r.callInfo.number;r.isScheduleCallback?s.enqueueCallback(i,o.getSubject(),a.getCurrentLocale(),r.callInfo.time.time):s.enqueueCallback(i,o.getSubject(),a.getCurrentLocale())}};r.goToSuccess=function(){r.isScheduleCallback?(r.callInfo.displayDate=f("date")(r.callInfo.date,"fullDate"),r.callInfo.displayTime=f("date")(r.callInfo.time.dateobject,"shortTime"),r.loadingTimes=!1):v.getCallbackWaitTime().then(function(n){r.callInfo.waitTime=n});r.callInfo.templateUrl="/PartialViews/Contact/Callback/Success.html"};r.checkIfValidNumber=function(){var n=a.checkIfValidNumber(r.callInfo);n||(r.callInfo.invalidNumber=!1)};r.getValidNumber=function(){r.callInfo=a.getValidNumber(r.callInfo)};r.disableConfirm=function(){var n=r.callInfo.invalidNumber||!r.callInfo.number||r.callInfo.number.length===0||r.awaitingResponse;return r.isScheduleCallback&&(n=n||r.loadingTimes||r.callInfo.disableTimeSelect),n};r.$on("CompassContentReady",d);r.$on("CallbackPhoneValidation",function(n,t){t&&!t.isValid&&(r.currentError="invalidPhoneNumber",u())});r.$on("EnqueueCallbackSuccess",function(){r.awaitingResponse=!1;r.goToSuccess()});r.$on("EnqueueCallbackFailure",function(n,t){r.awaitingResponse=!1;t.errorCode==="CHANNEL_CONTACTSCHEDULED"?u("doubleCallback"):t.errorCode==="CHANNEL_CONTACTINVALID"?u("invalidPhoneNumber"):u()});r.$on("EnterCallbackQueueTimeout",function(){r.awaitingResponse=!1;u()});r.$on("CallbackPageTimeout",function(){r.isReady||(r.status.isScheduleCallback=r.isScheduleCallback,n.$broadcast("500Error",{reason:"Timeout occurred on a callback ASAP or schedule callback page",data:r.status}))});r.$on("GetCallbackTimeSuccess",function(n,t){r.callInfo.times=tt(t.slots);r.callInfo.times.length===0?(r.callInfo.disableTimeSelect=!0,r.callInfo.times=[{dateobject:r.callback.scheduleCallback.noTimesAvailable}]):r.callInfo.disableTimeSelect=!1;r.callInfo.timeProperty("0");r.loadingTimes=!1});r.$on("ScheduleCallbackTimesTimeout",function(){r.loadingTimes=!1;r.awaitingResponse=!1;u()});r.$watchCollection("status",function(n){r.isReady=n&&!Object.keys(n).some(function(t){return n[t]})});r.reset()}return{restrict:"A",scope:{isScheduleCallback:"=",phoneNumber:"@?"},templateUrl:"/PartialViews/Contact/Callback/Container.html",link:b}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("phoneNumberService",["$rootScope","rccService","compassService",function(n,t,i){function h(){var n=i.getSupportedLocales()||[s];e!==n.length&&(u=[],angular.copy(n,u),e=n.length,o=!1)}function f(n,i){i||(i="US");var r=t.validateNumber(n,i);return r?r:{isValid:!0,mask:"+1 XXX-XXX-XXXX",formattedContact:n}}var u,e,r,c,o,s={country:"United States",locale:"US"},l=0;this.init=function(){h()};this.getCurrentCountryCode=function(){return r&&r.code?r.code:"+1"};this.getCurrentLocale=function(){return r&&r.locale?r.locale:"US"};this.getCurrentCountry=function(){return r&&r.country?r.country:"United States"};this.getCurrentMask=function(){return r&&r.mask?r.mask:this.getMask("US")};this.getFormattedNumber=function(n,t){var i=f(n,t),e=i.formattedContact.indexOf("+")>-1,r=i.formattedContact.indexOf(" "),u;return e&&r>0&&(u=i.formattedContact.substring(r+1)),u};this.getCountryCode=function(n){var t=f("",n),i=t.mask.indexOf(" ");return i>0?t.mask.slice(0,i):"+1"};this.getMask=function(n){var t=f("",n),i=t.mask.indexOf(" ");return i>0?t.mask.slice(i).trim():"XXX-XXX-XXXX"};this.populateDropdown=function(){var n=this;return o||(u.forEach(function(t,i){t.code=n.getCountryCode(t.locale);t.mask=n.getMask(t.locale);t.display=t.code+" - "+t.country;t.locale==="US"&&(s=t,l=i)}),o=!0),u};this.selectCountryCode=function(n){n=n.toUpperCase();for(var t=0;t<e;t++)if(n===u[t].locale)return r=u[t],c=t,u[t];return s};this.checkIfValidNumber=function(n){return n.number.length!==0&&!f(n.number,this.getCurrentLocale()).isValid};this.getValidNumber=function(n){if(n.number.length<=0)return n;var t=f(n.number,this.getCurrentLocale());return t.isValid?(n.invalidNumber=!1,n.number=this.getFormattedNumber(t.formattedContact,this.getCurrentLocale())):n.invalidNumber=!0,n};n.$on("CompassContentReady",h);this.init()}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("PhoneScreenShareController",["$rootScope","$scope","$timeout","$log","rccService","compassService","flightService","clientConfig","chatStateService","nativeAppService","contactCommands","agentChatService","messageTypes","qosTelemetryService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){function y(){t.content=f.getPasscode();t.content&&(t.status.waitingOnCompass=!1)}function p(){t.reconnectTimer||(t.reconnectTimer=i(function(){(t.showReconnectingMessage||t.showClientReconnectingMessage)&&(t.showReconnectingMessage=!1,t.showClientReconnectingMessage=!1,t.showDisconnectMessage=!0,v.createEvent(v.eventTypes.awasa.chatReconnectTimedOut).reject(),s.clearState(),u.endChat())},t.config.reconnectWaitTime))}function w(){t.showDisconnectMessage||t.showReconnectingMessage||t.showClientReconnectingMessage||t.reconnectTimer&&i.cancel(t.reconnectTimer)}t.config={timeout:o.ChatConfig.ChatDefaultTimeout,reconnectWaitTime:o.ChatConfig.ChatReconnectWaitTime,chatScreenShareEnabled:o.ChatConfig.AllowChatScreenShare&&h.hasCapability("ScreenSharing")};t.reset=function(){t.status={waitingOnRcc:!0,waitingOnCompass:!0};t.isNative=h.isNative();t.hasValidPasscode=!1;t.failedConnect=!1;t.agent=null;t.waitingOnAgent=!1;t.displayChatScreenShare=!1;t.sharingScreen=!1;t.showClientReconnectingMessage=!1;t.showReconnectingMessage=!1;t.showDisconnectMessage=!1;t.messages=[];t.sessionId="";t.subjectId="";y();u.isRatMode()||u.toggleRatMode();u.initLazy(function(){t.status.waitingOnRcc=!1})};t.connectToAgent=function(n){t.agent=n;n&&n.AgentId&&(t.failedConnect=!1,t.waitingOnAgent=!0,s.setAgent(n),s.setSubject(t.subjectId),u.enqueueChat({agentId:t.sessionId,ignoreAvailability:!0}))};t.cancel=function(){s.clearState();n.$broadcast("ChatBack")};t.$on("CompassContentReady",y);t.$on("PasscodeSuccess",function(n,i){t.hasValidPasscode=!0;t.waitingOnAgent=!0;t.sessionId=i.SessionId;t.subjectId=i.SubjectId;l.lookupAgent(i.ViewerId)});t.$on("ChatMessageReceived",function(n,i){(i.chatSender===a.SystemInfo||i.chatSender===a.SystemError)&&t.messages.push(i)});t.$on("AgentDataReady",function(n,i){t.connectToAgent(i)});t.$on("EnqueueChatFailure",function(n,i){t.failedConnect=!0;r.error("EunqueChatFailure was broadcast",JSON.stringify(i))});t.$on("ChatSessionEstablished",function(){t.waitingOnAgent=!1});t.$on("ChatSessionClosed",function(){t.displayChatScreenShare=!1;t.sharingScreen=!1});t.$on("ChatScreenShareRequest",function(){t.displayChatScreenShare=!0});t.$on("ChatScreenShareDenied",function(){t.displayChatScreenShare=!1});t.$on("ChatScreenShareClosed",function(){t.displayChatScreenShare=!1;t.sharingScreen=!1});t.$on("ChatScreenShareEstablished",function(){t.sharingScreen=!0});t.$on("ChatScreenShareConnectFailed",function(){t.displayChatScreenShare=!1});t.$on("MessageWindowTryAgain",function(){t.cancel()});t.$on("AgentDisconnected",function(){t.showClientReconnectingMessage||(t.showReconnectingMessage=!0);p()});t.$on("AgentReconnected",function(){t.showReconnectingMessage=!1;w()});t.$on("ChatChannelDisconnected",function(){t.showReconnectingMessage||(t.showClientReconnectingMessage=!0);p()});t.$on("ChatChannelReconnected",function(){t.showClientReconnectingMessage=!1;w()});t.$on("RATPhonePageTimeout",function(){t.isReady||n.$broadcast("500Error",{reason:"Timeout occurred on passcode page",data:t.status})});t.$on("$destroy",function(){u.isRatMode()&&u.toggleRatMode()});t.$watchCollection("status",function(n){t.isReady=n&&!Object.keys(n).some(function(t){return n[t]})});t.reset()}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).filter("timeslotDisplay",["$filter",function(n){return function(t){return t instanceof Date?n("date")(t,"shortTime"):t}}]),function(n){n.service("agentChatService",["$rootScope","contentApiService",function(n,t){this.lookupAgent=function(i){var r=t.getAgentById(i);r.then(function(t){t.data&&n.$broadcast("AgentDataReady",t.data)},function(){})}}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("autoScrollContent",["$document","$interval","$q","$timeout",function(n,t,i,r){function u(n,r,u){var f=i.defer(),e=(u-$(n).scrollTop())/r*33,o=t(function(){var i=$(n).scrollTop();$(n).scrollTop(i+e);(i>=u||i===$(n).scrollTop())&&(t.cancel(o),f.resolve())},33);return f.promise}function f(n,t){t[0].documentElement?t[0].documentElement.scrollTop=n.scrollHeight:t[0].body.scrollTop=n.scrollHeight}function e(n,t){var i=n[0].scrollHeight,r,e,u,f;if(t){r=t.split(";");for(e in r)if(u=n.find(r[e]),u.length){f=u.first();i=f.position()&&f.position().top-50||i;break}}return i}return{restrict:"A",link:function(t,i,o){function a(t){if(s.tagName==="BODY")f(s,n),h=null;else if(o.speed){var r=e(i,t);u(s,o.speed,r).then(function(){h=null})}else $(s).scrollTop(s.scrollHeight),h=null}var c=o.target&&$(o.target)||i,s=c[0],l=o.childSelector||"",h=null;t.$watch(function(){return s.offsetTop+s.scrollHeight+s.clientHeight},function(){h&&r.cancel(h);h=r(function(){a(l)},50)});t.$on("$destroy",function(){r.cancel(h)})}}}]);angular.module(microsoft.support.moduleName).directive("chatConnectingProgress",["$interval","$rootScope","compassService","chatStateService","clientConfig","waitTimeService","flightService","queueService","recurringOperationManagerService",function(n,t,i,r,u,f,e,o,s){function v(n){n.extendedWait=!1;n.positionStatus=o.getPositionStatus();n.timeRemaining=a.defaultWaitTime;n.useEWT=e.isUserInFlight("ewt-1")}function y(i,u){i.timeRemaining--;r.getChatEstablished()?n.cancel(u):i.timeRemaining<=0&&(t.$broadcast("ChatExtendedWait"),i.timeRemaining=0,i.extendedWait=!0,n.cancel(u))}var l=1e3,c=5e3,h=s.getInstance(),a={defaultWaitTime:u.ChatConfig.ChatDefaultWaitTime};return{restrict:"A",templateUrl:"/PartialViews/Contact/Chat/Connecting.html",scope:!0,link:function(i){function o(n){return e?n:(e=!0,t.$broadcast("ChatWaitTimeEstimate",n),n)}function s(n){return i&&(i.waitTimeText=f.getConnectingWaitTimeText(n)),n}function u(){r&&n.cancel(r);h.cleanup()}var e=!1,r;v(i);i.useEWT?h.recurUntilCleanedUp(function(){return f.getChatWaitTime().then(o).then(s)},c):h.recurUntilSuccessfulOrCleanedUp(function(){return f.getChatWaitTime().then(o).catch(function(){return-1}).then(s)},c,function(n){return n>-1});r=n(function(){y(i,r)},l);i.$on("ChatSessionEstablished",u);i.$on("500Error",u);i.$on("$destroy",u)}}}]),function(n){n.service("chatContextService",["$http",function(n){var t="/api/chatContext/set/";this.setValues=function(i){return n({method:"POST",url:t,data:{values:JSON.stringify(i)}})}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("ChatController",["$scope","$rootScope","$timeout","$log","$routeParams","$window","$location","authService","agentChatService","chatStateService","clientConfig","languageService","messageTypes","messageService","nativeAppService","compassService","sessionStorageService","qosTelemetryService","navigationService","flightService","emailTranscriptService","modalityTags","chatService","unauthNames","locationService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt){function ut(n,i,r){var u=v.createMessage({text:n,senderName:i},r);return t.$broadcast("ChatMessageReceived",u),u}function ht(){n.chat=p.getChat();n.status.waitingOnCompass=!n.chat}function at(){return n&&n.chat&&n.chat.chatting&&n.chat.chatting.sendFailure}function ct(){return n&&n.chat&&n.chat.chatting&&n.chat.chatting.userDisplayName}function et(){return n&&n.chat&&n.chat.chatting&&n.chat.chatting.systemDisplayName}function vt(){return n&&n.chat&&n.chat.chatting&&n.chat.chatting.agentTransferred}function lt(t,i){tt.init({isAuth:i,authType:t,typingBoxId:n.config.chatTypingBoxId,room:ft}).then(function(){return n.status.waitingOnRcc=!1,n.status.waitingOnHoops=!0,tt.isOpen()}).then(function(t){n.status.waitingOnHoops=!1;t?(tt.enqueueChat(),n.chatWizard.templateUrl=n.config.templateUrl):e.path("/hoops/chat/"+h.getSubject())})}var ot=microsoft.support.client.web.chat,ft,st;n.chatWizard={};n.config={MaxChatMsgChars:c.ChatConfig.ChatMaxMessageChars,timeout:c.ChatConfig.ChatDefaultTimeout,chatTypingBoxId:"chat-client-message-input-textbox",chatReconnectWaitTime:c.ChatConfig.ChatReconnectWaitTime,hoopsEnabled:c.ChatConfig.AllowHoursOfOperation,chatTranscriptEnabled:d.isUserInFlight("ct"),chatScreenShareEnabled:c.ChatConfig.AllowChatScreenShare&&y.hasCapability("ScreenSharing"),userPauseResumeEnabled:y.hasCapability("PauseSharing"),templateUrl:"/PartialViews/Contact/Chat/ChatControl.html"};n.senderTypes=a;n.isInNotificationFlight=d.isUserInFlight("chat-notifications-1");n.audioAlert=null;n.firstChatMessageRecieved=!1;ft="Chat-Room";st=d.isUserInFlight("aad-1");n.chatWizard.resetChat=function(){var f=l.langLocale(),r,i;n.isNative=y.isNative();n.displayChatScreenShare=!1;n.sharingScreen=!1;n.status={waitingOnHoops:!1,waitingOnRcc:!0,waitingOnCompass:!0};n.chatWizard.templateUrl="";n.chatWizard.agentInfo={};n.chatWizard.chatInitialized=!1;n.chatWizard.chatInputBoxText="";n.chatWizard.inputIsDisabled=!1;n.chatWizard.chatMessages=[];n.chatWizard.typingStatus=tt.getTypingStatus();n.chatWizard.showReconnectingMessage=!1;n.chatWizard.showClientReconnectingMessage=!1;n.chatWizard.showDisconnectMessage=!1;n.chatWizard.showCancelButton=y.isNative()&&rt.getReferrerDomain()||!k.isRoot();n.chatWizard.submitDisabled=!1;n.chatWizard.sendButtonIcon=null;n.chatWizard.chatEnded=!1;n.chatWizard.displayChatSurvey=!1;n.chatWizard.displayChatEndConfirmation=!1;n.longQueue=null;t.$broadcast("ChatReset");r=!w.get(it.storage)&&!u.unauth;i=o.getSupportedIDP();st?(u.useAAD?o.setPagePreference([i.AAD]):o.setPagePreference([i.MSA]),o.resolveAuthState().then(function(){lt(u.useAAD?i.AAD:i.MSA,r)})):lt(i.MSA,r);ht()};n.chatWizard.cancelChat=function(){t.$broadcast("ChatBack")};n.chatWizard.connectionFail=function(){n.chatWizard.templateUrl="/PartialViews/Contact/Chat/ConnectionFailed.html"};n.chatWizard.chatSubmitClick=function(t){if(n.chatWizard.chatInputBoxText!==""){n.chatWizard.chatInputBoxText=n.chatWizard.chatInputBoxText.replace(/(?:\r\n|\r|\n)/g,"<br />");var i=ut(n.chatWizard.chatInputBoxText,ct(),a.User);tt.sendMessage(i);n.chatWizard.chatInputBoxText="";t&&t.preventDefault()}};n.userEndChat=function(){t.$broadcast("ChatSessionClosed",{})};n.backToChat=function(){n.chatWizard.inputIsDisabled=!1;n.chatWizard.submitDisabled=!1;n.chatWizard.displayChatEndConfirmation=!1};n.showEndConfirmation=function(){n.chatWizard.chatEnded||(t.$broadcast("EndChatClicked"),n.chatWizard.inputIsDisabled=!0,n.chatWizard.submitDisabled=!0,n.chatWizard.displayChatEndConfirmation=!0)};n.endChat=function(){var i=u[ot.constants.flagKeys.surveyType];n.chatWizard.displayChatEndConfirmation=!1;n.chatWizard.displayChatSurvey=angular.isUndefined(i)||i.toString().toUpperCase()!==ot.surveyTypes.NONE;n.chatWizard.displayChatSurvey&&t.$broadcast("chatSurveyDisplayed");n.chatWizard.surveyData={agent:n.chatWizard.agentInfo.AgentId,chatId:h.getChatId()};n.chatWizard.inputIsDisabled=!0;n.chatWizard.submitDisabled=!0;n.chatWizard.chatEnded=!0;ut(n.chat.chatting.answerTechDisconnect,et(),a.SystemInfo);tt.endChat()};n.chatWizard.handleChatInterrupted=function(){n.chatWizard.submitDisabled=!0;n.chatWizard.inputIsDisabled=!0;n.chatReconnectTimer=i(function(){(n.chatWizard.showReconnectingMessage||n.chatWizard.showClientReconnectingMessage)&&(n.chatWizard.showReconnectingMessage=!1,n.chatWizard.showClientReconnectingMessage=!1,n.chatWizard.showDisconnectMessage=!0,n.displayChatScreenShare=!1,n.sharingScreen=!1,t.$broadcast("ChatScreenShareClosed"),b.createEvent(b.eventTypes.awasa.chatReconnectTimedOut).reject(),tt.endChat(),n.chatWizard.chatInitialized||t.$broadcast("500Error",{reason:"Disconnected in Queue"}))},n.config.chatReconnectWaitTime)};n.chatWizard.handleChatReconnected=function(){n.chatWizard.showDisconnectMessage||n.chatWizard.showReconnectingMessage||n.chatWizard.showClientReconnectingMessage||(n.chatReconnectTimer&&i.cancel(n.chatReconnectTimer),n.chatWizard.submitDisabled=!1,n.chatWizard.inputIsDisabled=!1)};n.$on("ChatScreenShareRequest",function(){n.displayChatScreenShare=!0});n.$on("ChatScreenShareDenied",function(){n.displayChatScreenShare=!1});n.$on("ChatScreenShareEstablished",function(){n.sharingScreen=!0});n.$on("ChatScreenShareClosed",function(){n.displayChatScreenShare=!1;n.sharingScreen=!1});n.$on("ChatScreenShareConnectFailed",function(){n.displayChatScreenShare=!1});n.$on("ChatSessionClosed",function(){n.displayChatScreenShare=!1;n.sharingScreen=!1});n.$on("CompassContentReady",function(){ht()});n.$on("ChatError",function(t,i){i.nextStep==="callback"?e.path("/contact/callback/"+h.getSubject()+"/"):i.nextStep==="fail"&&n.chatWizard.connectionFail(t,i)});n.$on("ChatMessageSendError",function(){ut(at(),et(),a.SystemError)});n.$on("EnqueueChatFailure",function(n,i){t.$broadcast("500Error",{reason:"Failed to enqueue chat",data:i})});n.$on("EnqueueChatSuccess",function(){n.longQueue=i(function(){t.$broadcast("ChatLongQueue")},c.ChatConfig.ChatLongQueue)});n.$on("DisplayCallback",function(){n.chatWizard.scheduleCallback()});n.$on("ChatSessionEstablished",function(t,r){if(i.cancel(n.longQueue),s.lookupAgent(r.agentId),h.setChatEstablished(!0),n.chatWizard.chatInitialized=h.getChatEstablished(),h.getProblemText()){var u=ut(h.getProblemText(),ct(),a.User);tt.sendMessage(u)}});n.$on("AgentDataReady",function(t,i){i&&i!=="null"&&(n.chatWizard.agentInfo=i)});n.$on("ChatMessageReceived",function(i,r){if(n.chatWizard.chatMessages=v.getMessages(ft),n.firstChatMessageRecieved==!1){if(t.$broadcast("ShowToast",r.chatMessage),n.isInNotificationFlight&&("Notification"in f?Notification.permission==="granted"||f.document.hasFocus()?Notification.permission==="granted"&&t.$broadcast("Html5Notification","HasPermission"):(t.$broadcast("Html5Notification","NotificationPermissionRequested"),Notification.requestPermission(function(n){n==="denied"?t.$broadcast("Html5Notification","NotificationPermissionDenied"):n==="default"?t.$broadcast("Html5Notification","NotificationPermissionDismissed"):t.$broadcast("Html5Notification","NotificationPermissionGranted")})):t.$broadcast("Html5Notification","NotSupported"),!f.document.hasFocus()&&"Notification"in f&&Notification.permission==="granted"))var u=new Notification(r.chatMessage);n.firstChatMessageRecieved=!0}f.document.hasFocus()||(!n.audioAlert&&n.chat&&n.chat.audioAlertLink&&(n.audioAlert=new Audio(n.chat.audioAlertLink)),n.audioAlert&&!!(n.audioAlert.canPlayType&&n.audioAlert.canPlayType("audio/mpeg;"))&&n.audioAlert.play())});n.$on("ChatSessionClosed",function(){n.endChat()});n.$on("ChatTransferred",function(n,t){t.agentId&&(s.lookupAgent(t.agentId),ut(vt(),et(),a.SystemInfo))});n.$on("$destroy",function(){(h.getChatEstablished()||h.getEnqueueId())&&tt.endChat();h.clearState();i.cancel(n.longQueue)});n.$on("AgentDisconnected",function(t,i){!i.agentId||n.chatWizard.showClientReconnectingMessage||n.chatWizard.showReconnectingMessage||(n.chatWizard.showReconnectingMessage=!0,n.chatWizard.handleChatInterrupted())});n.$on("AgentReconnected",function(t,i){i.agentId&&n.chatWizard.showReconnectingMessage&&(n.chatWizard.showReconnectingMessage=!1,n.chatWizard.handleChatReconnected())});n.$on("ChatChannelDisconnected",function(){n.chatWizard.showReconnectingMessage||n.chatWizard.showClientReconnectingMessage||(n.chatWizard.showClientReconnectingMessage=!0,n.chatWizard.handleChatInterrupted())});n.$on("ChatChannelReconnected",function(){n.chatWizard.showClientReconnectingMessage&&(n.chatWizard.showClientReconnectingMessage=!1,n.chatWizard.handleChatReconnected())});n.$on("MessageWindowTryAgain",function(){n.chatWizard.cancelChat()});n.$on("ChatPageTimeout",function(){n.isReady||t.$broadcast("500Error",{reason:"Timeout occurred on a chat page",data:n.status})});n.$watch("chatWizard.chatInputBoxText",function(){n.chatWizard.submitDisabled=n.chatWizard.chatInputBoxText===""?!0:!1});n.$watchCollection("status",function(t){n.isReady=t&&!Object.keys(t).some(function(n){return t[n]})});n.chatWizard.resetChat()}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("chatQueue",[function(){return{restrict:"A",templateUrl:"/PartialViews/Contact/Chat/ChatQueue.html",scope:{view:"="},link:function(n){n.positionInQueue=null;n.$on("ChatQueueStatus",function(t,i){n.positionInQueue=i.position})}}}]),function(n){n.controller("ChatScreenShareController",["$scope","$rootScope","nativeAppService","messageTypes","messageService","contactCommands","compassService",function(n,t,i,r,u,f,e){function o(n,i,r){var f=u.createMessage({text:n,senderName:i},r);t.$broadcast("ChatMessageReceived",f)}function a(){return n&&n.chat&&n.chat.error&&n.chat.error.genericError}function v(){return n&&n.chat&&n.chat.chatting&&n.chat.chatting.screenEnd}function y(){return n&&n.chat&&n.chat.chatting&&n.chat.chatting.annotationStart}function p(){return n&&n.chat&&n.chat.chatting&&n.chat.chatting.annotationStop}function w(){return n&&n.chat&&n.chat.chatting&&n.chat.chatting.screenError}function s(){return n&&n.chat&&n.chat.chatting&&n.chat.chatting.systemDisplayName}function b(){return n&&n.chat&&n.chat.chatting&&n.chat.chatting.screenShareDeny}function l(){n.chat=e.getChat()}function k(){n.sharingScreen&&o(v(),s(),r.SystemInfo);n.reset()}var h=0,c={Reserved:0,Annotation:1,View:2,Interactive:3};n.config={maxRetry:3,userPauseResumeEnabled:i.hasCapability("PauseSharing")};n.reset=function(){n.displayChatScreenShare=!1;n.sharingScreen=!1;n.screenSharePaused=!1;n.waitingForResponse=!1;n.currentMode=null;n.requestedMode=null;n.reconnecting=!1;n.agentCommands={beginsharing:null};h=0;l()};n.grantScreenShare=function(){n.agentCommands.beginsharing&&(t.$broadcast("ChatScreenShareAccept"),i.sendAppCommand(n.agentCommands.beginsharing),n.waitingForResponse=!0)};n.denyScreenShare=function(){n.displayChatScreenShare=!1;n.agentCommands.beginsharing=null;o(b(),s(),r.SystemInfo);t.$broadcast("ChatScreenShareDenied");i.sendAgentRequestResponse(f.beginSharing,!1,"The user denied the request for remote assistance","")};n.toggleScreenShare=function(){var t;t=n.screenSharePaused?f.resumeSharingByUser:f.pauseSharingByUser;i.sendAgentUserRequest(t);n.waitingForResponse=!0};n.$on("CompassContentReady",l);n.$on("ChatScreenShareRequest",function(t,i){n.agentCommands.beginsharing=i;n.displayChatScreenShare=!0});n.$on("ChatScreenShareReconnect",function(){n.sharingScreen&&(n.screenSharePaused?t.$broadcast("ChatScreenShareClosed"):(n.reconnecting=!0,n.waitingForResponse=!0))});n.$on("ChatScreenShareEstablished",function(){n.reconnecting||(n.sharingScreen=!0,n.currentMode=c.Interactive);n.waitingForResponse=!1;n.reconnecting=!1;n.agentCommands.beginsharing=null});n.$on("ChatScreenShareClosed",k);n.$on("SetSharingModeRequest",function(t,i){i!==n.currentMode&&(n.requestedMode=i)});n.$on("SetSharingMode",function(){n.requestedMode&&(n.currentMode===c.Annotation&&o(p(),s(),r.SystemInfo),n.currentMode=n.requestedMode,n.requestedMode=null,n.currentMode===c.Annotation&&o(y(),s(),r.SystemInfo))});n.$on("ToggleScreenShare",function(t,i){n.screenSharePaused=i;n.waitingForResponse=!1});n.$on("ChatScreenShareConnectFailed",function(){h>=n.config.maxRetry?(o(a(),s(),r.SystemError),n.reset(),i.sendAgentUserRequest(f.sharingSessionFailed)):(h++,n.grantScreenShare())});n.$on("ChatScreenShareError",function(){o(w(),s(),r.SystemError);n.waitingForResponse=!1});n.$on("ChatSessionClosed",function(){n.reset()});n.reset()}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("chatscreenshare",[function(){return{restrict:"A",templateUrl:"/PartialViews/Contact/Chat/ScreenShare.html",controller:"ChatScreenShareController"}}]),function(n){n.service("chatService",["$q","$log","$rootScope","rccService","modalityTags","chatStateService","messageService","agentChatService","supportLinkService","queueService",function(n,t,i,r,u,f,e,o,s){function p(){l.isAgentTyping=!1;h.isConnected=!1;h.agent=null;h.prevAgent=null;c.isConnected=!1}var a=null,v=null,y=null,l=Object.seal({isAgentTyping:!1}),h=Object.seal({agent:null,prevAgent:null,isConnected:!1}),c=Object.seal({isConnected:!1});this.getCurrentMessageRoom=function(){return a};this.setCurrentMessageRoom=function(n){a=n};this.init=function(t){var i=this;return v||(v=n(function(n){r.init(t.isAuth,t.authType,function(){t.typingBoxId&&r.setChatTypingBoxId(t.typingBoxId);t.room&&i.setCurrentMessageRoom(t.room);n()})}))};this.initLazy=function(t){var i=this;return y||(y=n(function(n){r.initLazy(function(){t.typingBoxId&&r.setChatTypingBoxId(t.typingBoxId);t.room&&i.setCurrentMessageRoom(t.room);n()})}))};this.checkHours=function(n,t){var u=angular.copy(n),e=s.getModalities(u),i=s.getHoopsModalities(u);return t=t||f.getSubject(),r.isWithinOperatingHours(t,Object.keys(i)).then(function(n){for(hoopsModality in i)i[hoopsModality].isOpen=n[hoopsModality].isOpen;return e})};this.isOpen=function(n){return n=n||f.getSubject(),r.isWithinOperatingHours(n,u.chat).then(function(n){return!!(n[u.chat]&&n[u.chat].isOpen)},function(){return!1})};this.postBotTranscript=function(n,t){return this.init(n).then(function(){return t.forEach(function(n){n.from=n.from==="User"?f.getVisitId():n.from;n.to=n.to==="User"?f.getVisitId():n.to}),r.postTranscript(t,!0)})};this.enqueueChat=function(n){return this.init(n).then(function(){return r.isWithinOperatingHours(f.getSubject(),u.chat).then(function(n){if(n[u.chat].isOpen)return i.$broadcast("ChatRequested"),r.enqueueChat()})})};this.endChat=function(){return f.clearState(),r.endChat()};this.sendMessage=function(n){return r.sendMessage(n).then(function(i){t.log("Message was sent:",n,i)},function(n){t.error("Message failed:",n)})};this.getTypingStatus=function(){return l};this.getAgentStatus=function(){return h};this.getChannelStatus=function(){return c};i.$on("ChatSessionClosed",function(){this.endChat()}.bind(this));i.$on("ChatMessageReceived",function(n,t){e.appendMessage(this.getCurrentMessageRoom(),t,t.messageType)}.bind(this));i.$on("ChatSessionEstablished",function(n,t){p();o.lookupAgent(t.agentId);f.setChatEstablished(!0);h.isConnected=!0;c.isConnected=!0});i.$on("AgentDataReady",function(n,t){f.setAgent(t);h.agent=t});i.$on("ChatTransferred",function(n,t){h.prevAgent=h.agent;o.lookupAgent(t.agentId)});i.$on("AgentTyping",function(n,t){l.isAgentTyping=t});i.$on("ChatMessageSendError",function(n,t){e.failedMessage(t,this.getCurrentMessageRoom())}.bind(this));i.$on("EnqueueChatFailure",function(n,i){t.error("Chat enqueue failed:",JSON.stringify(i));this.endChat()}.bind(this));i.$on("AgentDisconnected",function(){h.isConnected=!1});i.$on("AgentReconnected",function(){h.isConnected=!0});i.$on("ChatChannelDisconnected",function(){c.isConnected=!1});i.$on("ChatChannelReconnected",function(){c.isConnected=!0})}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("chatStateService",["$rootScope","$routeParams","$location","clientConfig","sessionStorageService",function(n,t,i,r,u){function h(){f=JSON.parse(JSON.stringify(s.defaultState));e()}function e(){u.set(s.chatStateKey,f)}function o(){var n=u.get(s.chatStateKey);return n?(f=n,!0):!1}var f,s={chatStateKey:"ChatState",defaultState:{visitId:null,token:null,agent:null,subject:null,validationKey:null,chatEstablished:!1,appStartContext:null,enqueueId:null,chatId:null,parentCv:null,survey:null,problem:null,wasRouted:null}};this.reset=function(){o()?(f.chatEstablished=!1,f.visitId=null,f.enqueueId=null,f.chatId=null,e()):h()};this.setParentCv=function(n){f.parentCv=n;e()};this.getParentCv=function(){return o(),f.parentCv};this.setVisitId=function(n){f.visitId=n;e()};this.getVisitId=function(){return o(),f.visitId};this.setEnqueueId=function(n){f.enqueueId=n;e()};this.getEnqueueId=function(){return o(),f.enqueueId};this.setChatId=function(n){f.chatId=n;e()};this.getChatId=function(){return o(),f.chatId};this.setToken=function(n){f.token=n;e()};this.getToken=function(){return o(),f.token};this.setAgent=function(n){f.agent=n;e()};this.getAgent=function(){return o(),f.agent};this.setSubject=function(n){f.subject=n;e()};this.getSubject=function(){var n=i.search().subject||t.subject;return n?parseInt(n,10):(o(),f.subject)};this.setValidationKey=function(n){f.validationKey=n;e()};this.getValidationKey=function(){return o(),f.validationKey};this.setChatEstablished=function(n){f.chatEstablished=n;e()};this.getChatEstablished=function(){return o(),f.chatEstablished};this.setAppStartContext=function(n){f.appStartContext=n;e()};this.getAppStartContext=function(){return o(),f.appStartContext};this.setPrechatSurvey=function(n){f.survey=n;e()};this.getPrechatSurvey=function(){return o(),f.survey};this.setProblemText=function(n){f.problem=n;e()};this.getProblemText=function(){return o(),f.problem};this.setUserRouted=function(n){f.wasRouted=n;e()};this.getUserRouted=function(){return o(),f.wasRouted};this.clearState=function(){var n=f.visitId,t=f.token,i=f.subject;h();f.visitId=n;f.token=t;f.subject=i;e()};this.isReconnectValid=function(){return!1};this.isValidSubject=function(n){return n&&n>0};this.reset()}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("chatSurvey",["$rootScope","$routeParams","compassService","chatStateService","flightService","emailTranscriptService","clientConfig","flightService","authService",function(n,t,i,r,u,f,e,u,o){function l(i){function l(n){return i.view.optional&&i.view.optional.indexOf(n)>=0}i=h(i);i.surveyId=s;s++;var a="";a=c?o.getUserInfo()&&o.getUserInfo().email?o.getUserInfo().email:"":e.authInfo&&e.authInfo.displayName?e.authInfo.displayName:"";i.survey={userFeedback:null,userChoice:0,sendTranscript:u.isUserInFlight("ct"),userEmail:a,question1:0,question2:0,question3:0,question4:0,freeForm:""};i.disableSend=function(){return!i.survey.userFeedback&&!i.survey.userChoice&&!l("resolved")||i.view.surveyRatingQuestion1&&!i.survey.question1&&!l("sr1")||i.view.surveyRatingQuestion2&&!i.survey.question2&&!l("sr2")||i.view.surveyRatingQuestion3&&!i.survey.question3&&!l("sr3")||i.view.surveyRatingQuestion4&&!i.survey.question4&&!l("sr4")};i.closeSurvey=function(t){i.displayChatSurvey&&(t?i.cancelAction&&i.cancelAction():i.submitAction&&i.submitAction(),i.displayChatSurvey=!1);n.$broadcast("ChatSurvey",!1)};i.submitSurvey=function(){var o=i.eventName||(u.isUserInFlight(/^survey-/g,!0)?"ChatFeedbackFlighted":"ChatFeedback");n.$broadcast(o,{id:"1",helped:i.survey.userFeedback,choice:parseInt(i.survey.userChoice),optional:i.view&&i.view.optional,question1:i.survey.question1,question2:i.survey.question2,question3:i.survey.question3,question4:i.survey.question4,labeled:!!(i.view&&i.view.question1Scales&&i.view.question1Scales.length),freeForm:i.survey.freeForm,flighted:i.view&&i.view.flighted,version:i.view&&i.view.version,agentId:i.chatData.agent,chatId:i.chatData.chatId,mode:typeof t.mode!="undefined"?t.mode:e.ChatConfig.Mode});i.survey.sendTranscript&&f.emailChatTranscript(r.getVisitId(),i.survey.userEmail,(new Date).getTimezoneOffset()).then(function(t){n.$broadcast("EmailTranscriptSuccess",t.data)},function(t){n.$broadcast("EmailTranscriptFailure",t)});i.closeSurvey()};i.$on("CompassContentReady",function(){i=h(i)})}function h(n){var t=i.getChat();return n.view=n.view||(t&&t.survey?t.survey:null),n}var c=u.isUserInFlight("aad-1"),s=0;return{restrict:"A",templateUrl:"/PartialViews/Contact/Chat/ChatSurvey.html",scope:{displayChatSurvey:"=visible",chatData:"=chat",view:"=?",submitAction:"&?",cancelAction:"&?",eventName:"=?"},replace:!0,link:l}}]),function(n){n.service("chatTokenService",["$http","$rootScope","chatStateService","authService",function(n,t,i,r){function f(t,i){var r={sessionId:i.sessionId};return i.phoneNumber&&(r.phoneNumber=i.phoneNumber),n.post(u.baseUrl+t,r)}var u={baseUrl:"/api/Token"};this.getTokenForUser=function(t){return t?n.get(u.baseUrl+"/GetRatToken/"):n.get(u.baseUrl+"/GetToken/")};this.getAADTokenForUser=function(){return n.get(u.baseUrl+"/GetAADToken/")};this.getUnauthTokenForUser=function(t){return n.post(u.baseUrl+"/GetUnauthenticatedToken/",t)};this.refreshToken=function(f,e,o){var h=r.getSupportedIDP(),s;return e?o==h.AAD?this.getAADTokenForUser():this.getTokenForUser(f):(s=i.getToken(),s!=null&&s.indexOf("PageController")>-1&&t.$broadcast("MalformedUnauthenticatedToken",s),n.post(u.baseUrl+"/RefreshUnauthenticatedToken/",{token:s}))};this.getEncryptedValueCookie=function(n,t){return f("/GetUserStateCookie/",{sessionId:n,phoneNumber:t})};this.getAADEncryptedValueCookie=function(n,t){return f("/GetAADUserStateCookie/",{sessionId:n,phoneNumber:t})};this.getUnauthEncryptedValueCookie=function(n,t){return f("/GetUnauthenticatedUserStateCookie/",{sessionId:n,phoneNumber:t})}}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("chatVideo",["$window","$document","$rootScope","$timeout","widgetService","messageTypes","flightService","chatStateService","chatService",function(n,t,i,r,u,f,e,o,s){function v(n,u,o){var w=t[0].createElement("script"),b=t[0].getElementsByTagName("script")[0],k=u.find(".video-section"),v=null,p=null;y(n);w.src=c;b.parentNode.insertBefore(w,b);n.view=n.view||o.view;n.videoId=n.videoId||o.videoId;n.isPlaylist=n.isPlaylist&&n.isPlaylist()||o.isPlaylist;n.videoDescription=n.videoDescription||o.videoDescription;n.agent=null;n.isWatchingVideo=!0;n.inChatWithAgent=!1;n.isAgentTyping=!1;n.numMessagesReceived=0;n.typingStatus=s.getTypingStatus();n.toggleVideo=function(t){n.isWatchingVideo=!n.isWatchingVideo;t?i.$broadcast("ChatVideoAutoToggle"):i.$broadcast("ChatVideoToggled",n.isWatchingVideo);n.numMessagesReceived>0&&(i.$broadcast("ChatVideoAlertResponse",(new Date).getTime()-p.getTime()),p=null);n.isWatchingVideo||(n.player.pauseVideo(),n.numMessagesReceived=0,n.isAgentTyping=!1);h(k,n.isWatchingVideo)};i.$broadcast("ChatVideoSession");v=r(function(){i.$broadcast("ChatVideoMinTimeEngaged")},a);n.$on("AgentDataReady",function(t,i){n.agent=i});n.$on("ChatSessionEstablished",function(){n.isWatchingVideo=!1;n.inChatWithAgent=!0;n.numMessagesReceived=0;h(k,n.isWatchingVideo);n.player.pauseVideo();r.cancel(v)});n.$on("ChatMessageReceived",function(t,i){n.isWatchingVideo&&i.chatSender!==f.User?e.isUserInFlight(l)?n.toggleVideo(!0):(n.numMessagesReceived===0&&(p=new Date),n.numMessagesReceived++):i.chatSender===f.User&&(n.numMessagesReceived=0)});n.$on("$destroy",function(){r.cancel(v)})}function h(n,t){n.removeClass("slidedown slideup");n[0].offsetWidth=n[0].offsetWidth;t?(n.toggleClass("slidedown"),n.css("display","block")):(n.toggleClass("slideup"),r(function(){n.css("display","none")},1e3))}function y(t){n.onYouTubeIframeAPIReady=function(){var n={enablejsapi:1,fs:0,modestbranding:1,disablekb:1,cc_load_policy:1,list:t.isPlaylist?t.videoId:""};t.player=new YT.Player("player",{playerVars:n,videoId:t.isPlaylist?"":t.videoId});t.player.addEventListener("onStateChange","onPlayerStateChange");t.player.addEventListener("onError","onPlayerError")};n.onPlayerStateChange=function(n){var u={videoUrl:t.player.getVideoUrl(),videoTime:t.player.getCurrentTime(),playListIndex:t.player.getPlaylistIndex()},r=o.getChatEstablished();n.data===YT.PlayerState.PLAYING?i.$broadcast("ChatVideoPlaying",r):n.data===YT.PlayerState.PAUSED?i.$broadcast("ChatVideoPaused",r):n.data===YT.PlayerState.ENDED&&i.$broadcast("ChatVideoEnded",r);i.$broadcast("ChatVideoInfo",u)};n.onPlayerError=function(n){i.$broadcast("ChatVideoError",n)}}var c="https://www.youtube.com/iframe_api",l="chv-at-1",a=1e4;return{restrict:"A",templateUrl:"/PartialViews/Contact/Chat/ChatVideo.html",scope:{view:"=?",videoId:"@?",videoDescription:"@?",isPlaylist:"&?"},replace:!0,link:function(n,t){u.getWidgetConfig("Chat-Video").then(function(r){n.isVideoEnabled=!!r;n.isVideoEnabled&&v(n,t,r);i.$broadcast("ChatVideoPresent",n.isVideoEnabled)})}}}]);angular.module(microsoft.support.moduleName).directive("imageFallback",[function(){return{restrict:"A",link:function(n,t,i){t.bind("error",function(){t.attr("src")!==i.imageFallback&&t.attr("src",i.imageFallback)})}}}]),function(n){var t=600,i=700;n.component("messageAnimation",{templateUrl:"/PartialViews/Contact/Chat/MessageAnimation.html",bindings:{delay:"<?",duration:"<?"},controller:function(){this.delay=this.delay||t;this.duration=this.duration||i;this.dot1Style={"animation-delay":2*this.delay+"ms","animation-duration":this.duration+"ms"};this.dot2Style={"animation-delay":this.delay+"ms","animation-duration":this.duration+"ms"};this.dot3Style={"animation-duration":this.duration+"ms"}}})}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("messageWindow",["compassService","messageTypes",function(n,t){function u(){return i&&i.chatting&&i.chatting.reconnectingMessage}function f(){return i&&i.chatting&&i.chatting.reconnectingClientMessage}function e(){return i&&i.error&&i.error.tryAgainButton}function o(){return i&&i.error&&i.error.chatDisconnected}function r(r){i=n.getChat();r.senderTypes=t;r.reconnectingAgent=u();r.reconnectingClient=f();r.tryAgain=e();r.disconnected=o()}var i;return{restrict:"A",templateUrl:"/PartialViews/Contact/Chat/MessageWindow.html",scope:{messages:"=",isClientReconnecting:"=",isAgentReconnecting:"=",isDisconnected:"="},replace:!0,link:function(n){n.retry=function(){n.$emit("MessageWindowTryAgain")};n.isMessageType=function(n,t){return n&&n.messageType===t};n.$on("CompassContentReady",function(){r(n)});r(n)}}}]);angular.module(microsoft.support.moduleName).directive("agentHeader",["compassService",function(n){function t(t){var i=n.getChat();i&&i.chatting&&(t.view=i.chatting)}return{restrict:"A",templateUrl:"/PartialViews/Contact/Chat/AgentHeader.html",scope:{agent:"="},replace:!0,link:function(n){n.$on("CompassContentReady",function(){t(n)});t(n)}}}]);angular.module(microsoft.support.moduleName).component("agentInfo",{templateUrl:"/PartialViews/Contact/Common/AgentInfo.html",bindings:{agent:"<",view:"<",isJoining:"<"},controller:[function(){this.$onChanges=function(n){!this.agentClone&&n.agent&&n.agent.currentValue&&(this.agentClone=angular.copy(this.agent))}}]});angular.module(microsoft.support.moduleName).component("agentTransfer",{templateUrl:"/PartialViews/Contact/Common/AgentTransfer.html",bindings:{oldAgent:"<",newAgent:"<",view:"<"},controller:function(){this.$onChanges=function(n){!this.oldAgentClone&&n.oldAgent&&n.oldAgent.currentValue&&(this.oldAgentClone=angular.copy(this.oldAgent));!this.newAgentClone&&n.newAgent&&n.newAgent.currentValue&&(this.newAgentClone=angular.copy(this.newAgent))}}}),function(n){n.directive("card",[function(){return{restrict:"A",templateUrl:"/PartialViews/Common/Card.html",scope:{header:"=",showCancel:"=",cancelAction:"&",cancelText:"="},transclude:!0,replace:!0}}])}(angular.module(microsoft.support.moduleName)),function(n){n.value("channelStatuses",{UNAVAILABLE:0,OPEN:1,CLOSED:2});n.service("channelReaderService",["$log","$filter","$routeParams","channelStatuses",function(n,t,i,r){function u(n){var t=n.split(" ")[0].split(":"),i=new Date,r=parseInt(t[0],10),u=parseInt(t[1],10),f=parseInt(t[2],10);return i.setUTCHours(r,u,f),i}function e(){var i=[],n=new Date,t;for(n.setDate(n.getDate()-n.getDay()),t=0;t<7;t++)i.push(new Date(n)),n.setDate(n.getDate()+1);return i}function o(n,t){var i=n.getMonth(),r=t.getMonth();return i===r?n.getDate()<t.getDate()?-1:n.getDate()>t.getDate()?1:0:i<r?-1:1}function s(n){var s=[],o;if(n&&n.length===7){var a=e(),i,r="",u="",f=[];for(o=1;o<8;o++){var l=o%7,h=n[l],c=t("date")(a[l],"EEE");i?i.join(", ")==h.join(", ")?u=c:(f=u==""?[r]:[r,u],s.push({days:f,shifts:i}),r=c,u="",i=h):(r=c,i=h)}f=u==""?[r]:[r,u];s.push({days:f,shifts:i})}return s}var f=this;this.getChannelOperations=function(n,t){var i={e2eSchedule:{}};return t.forEach(function(t){i[t]=f.getChannelOperation(n,t);i.e2eSchedule[t]=i[t].e2eSchedule}),i};this.getChannelOperation=function(t,i){t&&Array.isArray(t)||(t=t?[t]:[]);i!==""&&(i=i.toLowerCase(),t=t.filter(function(n){return n.Type&&(n.Type=n.Type.toLowerCase()),n&&n.Type===i}));t.length===0&&n.error("No channels found for channelType:",i);var r={e2eSchedule:null,isOpen:!0,isAvailable:!1,status:this.getStatus(!0,!1),schedule:[]};return t.some(function(n){return r=this.getOperationStatus(n),r.isOpen&&r.isAvailable}.bind(this)),r};this.getChannelOutages=function(n){var t=[];return Object.keys(n).forEach(function(i){n[i].status===r.UNAVAILABLE&&t.push(i)}),t};this.getStatus=function(n,t){return n?t||typeof i.scheduleAsOf!="undefined"?r.OPEN:r.UNAVAILABLE:r.CLOSED};this.getOperationStatus=function(i){var a,f,e;if(typeof i=="undefined"||typeof i.IsAvailable=="undefined"||typeof i.HOOPsStatus=="undefined")return n.error("malformatted status",JSON.stringify(i)),{e2eSchedule:null,isAvailable:!0,isOpen:!0,status:this.getStatus(!0,!0),schedule:[]};var h=i.HOOPsStatus!==r.CLOSED,c=i.Type==="phone"||i.IsAvailable,l=[];if(!h||!c){for(a=0;a<7;a++)l[a]=[];for(f=0;f<7;f++){if(e=i.HoopsSchedule[f],e&&!Array.isArray(e))return n.error("malformatted channel schedule",JSON.stringify(e)),{e2eSchedule:null,isAvailable:c,isOpen:h,status:this.getStatus(h,c),schedule:[]};e&&e.length>0&&e.forEach(function(n){var i=u(n.StartTime),r=u(n.EndTime),e=t("date")(i,"shortTime")+"-"+t("date")(r,"shortTime"),s;o(i,r)<0?(s=f-1<0?6:f-1,l[s].push(e)):l[f].push(e)})}}return{e2eSchedule:i.HoopsSchedule,isAvailable:c,isOpen:h,status:this.getStatus(h,c),schedule:s(l)}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("ContactDisplayController",["$scope","$rootScope","$window","$location","nativeAppService","navigationService","compassService","chatStateService","partnerDataService",function(n,t,i,r,u,f,e,o,s){function h(){n.isNative=u.isNative()}function c(){n.contactHeader=e.getContactHeader();n.msLogo=e.getMicrosoftLogo();n.msLogoAlt=e.getMicrosoftLogoAlt();n.comingSoon=e.getComingSoon()}function l(){return r.search()&&typeof r.search().disableassistedsupport!="undefined"&&r.search().disableassistedsupport==="true"}n.config={disableAssistedSupport:l()};n.reset=function(){c();h()};n.navInterruptCondition=function(){return!u.isNative()&&o.getChatEstablished()};n.navInterruptedMessage=function(){return e.getNavigationInterrupted()};n.$on("CompassContentReady",c);n.$on("NativeCookieUpdate",h);n.$on("$viewContentLoaded",f.update);n.$on("NativeSignInFailed",function(){i.document.referrer?i.history.back():t.$broadcast("500Error")});n.$on("ChatBack",function(){var n=s.returnUrl();n?i.open(n,"_self"):(!f.isRoot()||u.isNative())&&(i.document.referrer.indexOf("live.com")>=0?f.goToRoot():i.history.back())});n.$on("ChatVideoPresent",function(t,i){n.hasChatVideo=i});n.reset()}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("ContactFrameController",["$scope","$rootScope","$route","navigationService","compassService","languageService","partnerDataService",function(n,t,i,r,u,f,e){function h(){n.contactHeader=u.getContactHeader();n.backText=u.getBackText();n.icon=u.getContactSupportIcon()}function o(){n.headerText="";n.headerImage="";var t=i.current.data&&i.current.data.isLandingPage,u=r.isRoot(),f=e.returnUrl();n.showBackButton=!1;n.showIcon=!1;s||!f&&(t||u)?n.showIcon=!0:n.showBackButton=!0}var s=!1;n.reset=function(){n.chatSource="/"+f.langLocale()+"/contact/menu/";n.showBackButton=!0;n.isRTL=f.currentDirection()==="rtl";h();o()};n.backClick=function(){t.$broadcast("ChatBack")};n.requestSurvey=function(){t.$broadcast("ChatSurveyRequested")};n.endChat=function(){t.$broadcast("ChatSessionClosed",{})};n.startOver=function(){t.$broadcast("VirtualAgentReset")};n.$on("CompassContentReady",h);n.$on("ChatSessionEstablished",function(){s=!0;o()});n.$on("ChatSessionClosed",function(){s=!1;o()});n.$on("ChatFrameHeader",function(t,i){i&&(n.headerText=i.text||n.headerText,n.headerImage=i.image||n.headerImage,n.endText=i.endText||n.endText,n.resetLabel=i.resetLabel||n.resetLabel,n.survey=i.survey||n.survey,n.showIcon=i.showIcon,n.showEndChat=i.showEnd,n.showReset=i.showReset)});n.$on("$routeChangeSuccess",function(){o()});n.reset()}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("emailTranscriptService",["$http",function(n){this.emailChatTranscript=function(t,i,r){var u={params:{visitId:t,email:i,timeOffset:r}};return n.get("/api/emailTranscript",u)}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("HoopsController",["$rootScope","$scope","$location","compassService","chatStateService","rccService","clientConfig","modalityTags",function(n,t,i,r,u,f,e,o){function s(){var n=i.path().split("/");return n.length>=3?n[2]:""}function h(n){return n&&n.metaTags.indexOf(o.scheduleCallback)>-1}function c(){t.options=t.options||[];t.options=t.options.filter(h)}function l(){r.getHoursOfOperationView().then(function(n){t.hoursOfOperation=n;r.getMenuOptionsForId(u.getSubject()).then(function(n){t.options=n;c()});t.status.waitingOnCompass=!t.hoursOfOperation})}t.config={timeout:e.ChatConfig.ChatDefaultTimeout};t.reset=function(){t.status={waitingOnRcc:!0,waitingOnCompass:!0,waitingOnHoops:!0};f.initLazy(function(){t.status.waitingOnRcc=!1;var n=s();f.isWithinOperatingHours(u.getSubject(),n).then(function(i){t.status.waitingOnHoops=!1;t.hoopsSchedule=i[n].schedule})});l()};t.$on("HoopsMenuPageTimeout",function(){t.isReady||n.$broadcast("500Error",{reason:"Timeout occurred on a hours of operation page",data:t.status})});t.$watchCollection("status",function(n){t.isReady=n&&!Object.keys(n).some(function(t){return n[t]})});t.reset()}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("menuExtras",["$rootScope","$document","$location","$window",function(n,t,i,r){function u(n){n.wasButtonClicked=!1;n.wasElemClicked=!1;n.isMenuShown=!1}function f(n){n.wasButtonClicked||n.wasElemClicked||!n.isMenuShown||(n.isMenuShown=!1);n.wasButtonClicked=!1;n.wasElemClicked=!1}function e(n){n.wasButtonClicked||(n.wasElemClicked=!0)}return{restrict:"A",templateUrl:"/PartialViews/SupportMenu/MenuExtras.html",scope:{extras:"=",icon:"="},link:function(o,s){var h=function(){e(o);o.$apply()},c=function(){f(o);o.$apply()};o.menuExtraClick=function(t){t.externalLink?r.open(t.link.linkUrl):i.path(t.link.linkUrl);n.$broadcast("MenuExtraClicked",t)};o.toggleMenu=function(){o.isMenuShown=!o.isMenuShown;o.wasButtonClicked=!0};t.bind("click",c);s.bind("click",h);o.$on("$destroy",function(){t.unbind("click",c);s.unbind("click",h)});u(o)}}}]),function(n){function i(n,t){return Array.isArray(t)?t.some(function(t){return n.messageType===t}):n.messageType===t}var t=400;n.component("message",{templateUrl:"/PartialViews/Contact/Common/Message.html",bindings:{message:"<content"},controller:["$timeout","messageTypes","messageService",function(n,r,u){var o=this.message.loadingTime||0,e=null,f=this;this.$onInit=function(){this.messageTypes=r;this.isMessageType=i;this.messageStyle={};this.messageTextStyle={};typeof this.message.action=="function"&&(this.action=this.message.action);this.message.loadingType?this.loadMessage():(this.message.isVisible=!0,this.message.loadingType=null)};this.loadMessage=function(){this.message.isVisible=!1;u.delayMessage(this.message,o,function(n,t){f.message.loadingType==="message"&&(f.messageTextStyle={opacity:"0"});f.message.isVisible=!0;e=t},function(){f.message.loadingType==="message"&&(f.messageStyle={"animation-name":"message-slide-out","animation-duration":t+"ms","animation-fill-mode":"forwards"},e=n(function(){f.messageTextStyle={opacity:"1"}},t));f.message.loadingType=null})};this.$onDestroy=function(){n.cancel(e)}}]})}(angular.module(microsoft.support.moduleName)),function(n){n.value("messageTypes",{User:0,Agent:1,SystemInfo:2,SystemError:3,VirtualAgent:4,InstantAnswer:5,Results:6,ModalitySelection:7,AgentEnd:8,Survey:9,Transfer:10});n.service("messageService",["$timeout","messageTypes","localStorageService",function(n,t,i){function e(){return{messages:[]}}function s(n,t){n.index=t.messages.length;t.messages.push(n)}function o(t,i,r,e){var s=n(function(){if(e&&e(t),u.length>0){var n=u.shift();o(n.msg,n.delay,n.startCb,n.delayCb)}else f=!1},i);r&&r(t,s)}var r={},u=[],f=!1;this.createMessage=function(n,t){return angular.extend({},n,{messageType:t,timeStamp:(new Date).getTime(),reachedDestination:!0})};this.appendMessage=function(n,t,i){r[n]||(r[n]=e());var u=this.createMessage(t,i);return s(u,r[n]),u};this.getMessages=function(n){return r[n].messages};this.failedMessage=function(n,t){r[t]&&r[t].messages[n.index]&&(r[t].messages[n.index].reachedDestination=!1)};this.delayMessage=function(n,t,i,r){f?u.push({msg:n,delay:t,startCb:i,delayCb:r}):(f=!0,o(n,t,i,r))};this.clearMessages=function(n){if(n)r[n]=e();else for(room in r)r[room]=e()};this.restoreMessages=function(n){var t=i.getCacheContent("messages-"+n);return t&&t.messages&&(r[n]=t),r[n]&&r[n].messages};this.storeMessages=function(n){r[n]&&i.commit("messages-"+n,r[n])};this.removeMessagesFromStorage=function(n){i.commit("messages-"+n,{})}}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("modality",["$filter","$rootScope","$interval","widgetService","compassService","rccService","locationService","qosTelemetryService","modalityTags","chatStateService","channelStatuses","supportLinkService","waitTimeService","languageService","flightService","recurringOperationManagerService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){return{restrict:"A",templateUrl:"/PartialViews/ContactUs/Modality.html",scope:{view:"=?",links:"=?",oldFlow:"&?",fallbackUrl:"@?",hideTitle:"@?"},link:function(n){function tt(t){n.followLink=function(t){t.isModality=!0;t.fromOldFlow=n.oldFlow;l.followLink(t)};n.modalitiesReady=!!n.links;n.view=n.view||!n.oldFlow&&t.view;n.useChatEWT=y.isUserInFlight("ewt-1");k=!1;u.getHoursOfOperationView().then(function(n){i=n});n.links?(n.displayLinks=angular.copy(n.links),d()):u.getContactUsMenu(e.getPathSubset(2)).then(function(t){t&&t.hasModality&&(n.displayLinks=angular.copy(t.links),n.modalitiesReady=!0,d())})}function d(){f.initLazy(function(){var t=l.getHoopsModalities(n.displayLinks);Object.keys(t).length>0&&f.isWithinOperatingHours(h.getSubject(),Object.keys(t)).then(function(r){n.e2eSchedule=r.e2eSchedule;for(modality in t)r[modality]&&r[modality].status===c.CLOSED&&(t[modality].description=i&&i.currentlyClosed,t[modality].link.linkUrl=l.transformHoopsUrl(t[modality].link.linkUrl),t[modality].clickableLink=!0),r[modality]&&r[modality].status===c.UNAVAILABLE&&(o.createEvent(o.eventTypes.awasa.channelUnavailable).reject(JSON.stringify({modality:modality,channels:r})),t[modality].description=i&&i.outage,t[modality].link.linkUrl=i&&i.globalSupport,t[modality].externalLink=!0,t[modality].clickableLink=!0),t[modality].isOpen=r[modality].status===c.OPEN;it(l.getWaitTimeModalities(n.displayLinks))})})}function it(t){n.waitTimeText||(n.waitTimeText={chat:null,callback:null});t[s.chat]&&(n.useChatEWT?w.recurUntilCleanedUp(function(){return a.getChatWaitTime().then(g)},b):w.recurUntilSuccessfulOrCleanedUp(function(){return a.getChatWaitTime().then(g).catch(function(){return-1})},b,function(n){return n>-1}));t[s.callback]&&w.recurUntilCleanedUp(function(){return a.getCallbackWaitTime().then(rt)},b);n.$on("$destroy",function(){w.cleanup()})}function g(i){return k||(i>nt&&t.$broadcast("ChatLongEstimate",i),k=!0),n&&n.useChatEWT&&(n.waitTimeText.chat=a.getWaitTimeText(i)),i}function rt(t){return n&&n.waitTimeText&&(n.waitTimeText.callback=a.getWaitTimeText(t)),t}var i,b=15e3,nt=5,w=p.getInstance(),k;n.oldFlow=!!(n.oldFlow&&n.oldFlow());n.oldPath=n.oldFlow?"/"+v.langLocale()+"/contact"+e.getCurrentPath():null;n.hasWaitTime=function(t){return!n.useChatEWT&&l.getModalityName(t)===s.chat?!1:l.isWaitTimeModality(t)};n.getModality=function(n){return l.getModalityName(n)};r.getWidgetConfig("Modality",n.oldPath).then(function(i){n.isModalityEnabled=!!i;n.useGeoLocation=i&&i.useGeoLocation;n.onGeoContinue=function(i){i&&t.$broadcast("GeoContinue",v.langLocale());n.useGeoLocation=!1};n.onGeoSelection=function(i){n.modalitiesReady=!1;t.$broadcast("GeoAccess",i.locale);var r=e.switchLocale(i.locale,n.oldPath),f=n.oldFlow?u.getMenu(e.getPathSubset(3,r.length,r)):u.getContactUsMenu(e.getPathSubset(2,r.length,r));f.then(function(i){i&&i.hasModality&&i.links&&i.links.length>0?e.setPathAndReload(r):(t.$broadcast("GeoNotAvailable",r),e.setPathAndReload(n.fallbackUrl))})};n.isModalityEnabled&&tt(i)})}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("navigationService",["$window","sessionStorageService",function(n,t){var i="contactapphistory";this.update=function(){var r=t.get(i);r||(basePage=n.location.pathname,t.set(i,basePage))};this.isRoot=function(){this.update();var r=t.get(i);return!!(r&&r===n.location.pathname)};this.goToRoot=function(){var r=t.get(i);r&&(n.location.pathname=r)}}])}(angular.module(microsoft.support.moduleName)),function(n){n.value("oemParameters",{manufacturer:"manufacturer",deviceModel:"devicemodel",manufacturerSupportLink:"manufacturersupportlink",mobileOperatorSupportLink:"mobileoperatorsupportlink",mobileOperator:"mobileoperator"});n.factory("oemTags",["clientConfig",function(n){return{customDevice:"device-custom",anonManufacturer:"anon-oem",manufacturer:"manufacturer",msDevice:"ms-device",operator:"operator",msManufacturerID:n.AppConfig.MicrosoftManufacturerName}}]);n.service("oemService",["$rootScope","$filter","$routeParams","oemParameters","oemTags","nativeAppService","osService",function(n,t,i,r,u,f,e){function c(){return{manufacturerName:i[r.manufacturer]||"",deviceModel:i[r.deviceModel]||"",manufacturerLink:i[r.manufacturerSupportLink]||"",mobileOperatorLink:i[r.mobileOperatorSupportLink]||"",mobileOperator:i[r.mobileOperator]||""}}function l(n,t){var i=a(n);return h?(v(t,i)?s||t.deviceModel||(n.link.linkText=n.link.linkText.replace(/\(.+?\)/,"")):n.link.linkText="",n):(n.link.linkText="",n)}function a(n){var t=n.metaTags||"";return s?t.indexOf(u.operator)>-1?o.mobileOperator:t.indexOf(u.msDevice)>-1?o.msMobileOEM:t.indexOf(u.manufacturer)>-1?o.customMobileOEM:o.anonMobileOEM:t.indexOf(u.msDevice)>-1?o.msDesktopOEM:t.indexOf(u.anonManufacturer)>-1?o.anonDesktopOEM:o.customDesktopOEM}function v(n,t){if(t==o.msDesktopOEM&&n.manufacturerName!==u.msManufacturerID)return!1;if(t!=o.customDesktopOEM||n.manufacturerName&&n.manufacturerName!=u.msManufacturerID&&n.manufacturerLink){if(t==o.anonDesktopOEM&&(n.manufacturerName||!n.manufacturerLink))return!1;if(t!=o.mobileOperator||n.mobileOperator&&n.mobileOperatorLink)if(t!=o.msMobileOEM||n.manufacturerName===u.msManufacturerID&&n.deviceModel)if(t!=o.customMobileOEM||n.deviceModel&&n.manufacturerName&&n.manufacturerLink&&n.manufacturerName!=u.msManufacturerID){if(t==o.anonMobileOEM&&(n.deviceModel&&n.manufacturerName&&n.manufacturerLink||n.manufacturerName==u.msManufacturerID&&n.deviceModel))return!1}else return!1;else return!1;else return!1}else return!1;return!0}var h=f.isNative(),s=e.isMobile(),o={customDesktopOEM:"customDesktopOEM",anonDesktopOEM:"anonDesktopOEM",msDesktopOEM:"msDesktopOEM",mobileOperator:"mobileOperator",customMobileOEM:"customMobileOEM",anonMobileOEM:"anonMobileOEM",msMobileOEM:"msMobileOEM"};this.applyOEM=function(n){var i=c();n&&n.links&&i&&(n.header=t("compassFormat")(n.header,i),n.links=n.links.map(function(n){return n.metaTags.indexOf(u.customDevice)>-1&&(n=l(n,i),n.description=t("compassFormat")(n.description,i),n.link.linkText=t("compassFormat")(n.link.linkText,i),n.link.linkUrl=t("compassFormat")(n.link.linkUrl,i)),n}))}}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("passcode",["$rootScope","passcodeService","clientConfig",function(n,t,i){function u(n){n.config=r;n.code="";n.hasError=!1;n.hasValidPasscode=!1;n.waitingForResponse=!1;n.passcodeSuccess=n.passcodeSuccess||null;n.passcodeFailure=n.passcodeFailure||null}var r={passcodeLength:i.PasscodeConfig.PasscodeLength};return{restrict:"A",templateUrl:"/PartialViews/Passcode/Passcode.html",scope:{view:"=",passcodeSuccess:"@",passcodeFailure:"@"},link:function(i){i.sendCode=function(r){i.waitingForResponse=!0;t.getRatRequest(r).then(function(t){i.waitingForResponse=!1;t&&(i.hasValidPasscode=!0,i.passcodeSuccess&&n.$broadcast(i.passcodeSuccess,t))},function(t){i.waitingForResponse=!1;t.status===404?(i.hasError=!0,i.passcodeFailure&&n.$broadcast(i.passcodeFailure,r)):n.$broadcast("500Error",{reason:"Azure table down or multiple request objects made for same passcode"})})};i.isValid=function(n){return!isNaN(n)&&n.length===r.passcodeLength};i.resetError=function(){i.hasError=!1};u(i)}}}]),function(n){n.service("passcodeService",["$http",function(n){this.getRatRequest=function(t){var i={params:{passcode:t}};return n.get("/api/passcode/RatRequest/",i).then(function(n){return n.data})}}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).service("queueService",["$http","$rootScope","$window","$q","$log","$routeParams","clientConfig","chatStateService","languageService",function(n,t,i,r,u,f,e,o,s){function v(n){return{subject:o.getSubject(),language:s.lang(),country:s.locale(),mode:typeof f.mode!="undefined"?f.mode:e.ChatConfig.Mode,disability:!1,modality:n}}function b(n){var t=v(n);return t.position=l.position,t}function k(n,t){var i=v(n);switch(t){case"service":i.recordInfo={visitId:o.getVisitId(),waitTimeMins:c};break;default:u.error("invalid record type:",t)}return i.recordType=t,i}var a="/api/queue/",y=a+"report",p=a+"waittime",w=3,h=null,c=null,l=Object.seal({position:null});this.waitTime=function(t){var i=b(t),u;return!i||!o.isValidSubject(i.subject)?r.reject("Cannot call queueService.waitTime web service when a valid chatStateService.subject cannot be resolved"):(u="?"+$.param(i),n.get(p+u))};this.getPositionStatus=function(){return l};this.report=function(t,i){function f(){return n.post(y,k(t,i)).catch(function(n){return u<w?(u++,f()):r.reject(n)})}var u=0;return f()};t.$on("ChatQueueStatus",function(n,t){l.position=t.position});t.$on("ChatSessionEstablished",function(){c=h?((new Date).getTime()-h)/6e4:-1;this.report("chat","service");t.$broadcast("ChatWaitTimeActual",c)}.bind(this));t.$on("EnqueueChatSuccess",function(){h=(new Date).getTime()})}]);awasaServicesSettings=awasaServicesSettings||{},function(n){n.service("rccService",["$log","$window","$cookies","$interval","$q","$timeout","$rootScope","$routeParams","$location","clientConfig","languageService","channelReaderService","chatTokenService","messageService","chatStateService","messageTypes","qosTelemetryService","nativeAppService","correlationVectorService","flightService","authenticationHelperService","getScriptService","chatContextService","modalityTags","authService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt){function ti(){if(!ni&&bt.length>0){ni=!0;workItem=bt.shift();var t=function(){ni=!1;ti()};bi(workItem).then(t,function(i){n.error("Work queue item failed: "+workItem.command+".  Error: "+i);t()})}}function bi(n){var t=u.defer(),i=function(){n.callback&&n.callback();t.resolve()};return n.command==="init"?si(n.authReq,n.authType,i):n.command==="initlazy"?ki(i):t.reject("Unknown command type: "+n.command),t.promise}function si(n,t,i){if(ot=ot||n,ht=t,yt&&vt){at?i():pt.push(i);return}ot?ei?rt.resolveAuthState().then(function(n){n===t?ii(i):rt.loginUsingAccountType(t,!0)}):g.mobileSignIn(function(){ii(i)}):ii(i)}function ki(n){vt?si(!1,ht?ht:rt.getSupportedIDP().MSA,n):at?n():(gt.push(n),yt||(awasaServicesSettings.lazyLoad=!0,hi(),kt()))}function hi(){awasaServicesSettings.developerKey=st?h.ChatConfig.RatPartnerId:h.ChatConfig.PartnerId;awasaServicesSettings.language=c.lang();awasaServicesSettings.country=c.locale();awasaServicesSettings.messaging=!0;awasaServicesSettings.callback=di;awasaServicesSettings.chatTypingBoxId=wt.chatTypingBoxId;awasaServicesSettings.reset=!0;awasaServicesSettings.disableCookie=!0;awasaServicesSettings.correlationVector=k.getValue();yt=!0}function ii(n){pt.push(n);e.$broadcast("ChatInitStart");var i=rt.getSupportedIDP(),t;t=ot?ht===i.AAD?a.getAADTokenForUser():a.getTokenForUser(st):a.refreshToken(st,ot);t.then(function(n){yt?at&&!vt&&(awasaServicesSettings.session=!0,awasaServicesSettings.token=n.data,n!=null&&n.data!=null&&n.data.indexOf("PageController")>-1&&e.$broadcast("MalformedUnauthenticatedTokenRccAlreadyLoaded",n.data),y.setToken(n.data),vt=!0,et=w.createEvent(w.eventTypes.awasa.initialize),ut.load(y.getToken())):(awasaServicesSettings.token=n.data,awasaServicesSettings.session=!0,hi(),n!=null&&n.data!=null&&n.data.indexOf("PageController")>-1&&e.$broadcast("MalformedUnauthenticatedTokenInitialRccLoad",n.data),y.setToken(n.data),vt=!0,y.isReconnectValid()&&(awasaServicesSettings.reconnectChat=!0,awasaServicesSettings.restoreId=y.getVisitId()),o.visitId&&(awasaServicesSettings.restoreId=o.visitId,awasaServicesSettings.reconnect=!1),kt());gi()},function(n){n.status===401&&(ei?rt.loginUsingAccountType(ht,!0):e.$broadcast("ProcessUserSignIn",!0))})}function kt(){dt=!1;ct=w.createEvent(w.eventTypes.awasa.download);nt.addScript(h.ChatConfig.ChannelSdkServerPath).then(function(){n.log("Adding new channel-services-sdk");ct.resolve();ct=null;var t=awasaServicesSettings.lazyLoad?w.eventTypes.awasa.lazyInitialize:w.eventTypes.awasa.initialize;et=w.createEvent(t)},function(n){ct.reject(n);ct=null})}function ri(){k.extendCv();awasaServicesSettings.correlationVector=k.getValue()}function di(t,i){var s,o,r,u;switch(i.type){case"exception":s=w.createEvent(w.eventTypes.awasa.error);n.error("Exception received: Sender: "+JSON.stringify(t),i);oi.indexOf(i.errorCode)===-1&&s.reject(i);break;case"FacadeReady":et&&(et.resolve(),et=null);ut=ut?ut:i.instance;f(function(){gt.forEach(function(n){n()});gt=[];at=!0;e.$broadcast("ChatInitComplete")});break;case"loaded":if(n.log("Loaded callback received"),et&&(et.resolve(),et=null),ut=i.instance,o=ut.getVisitId(),e.$broadcast("awasaVisitId",o),y.setVisitId(o),ut.subscribe(ut.events.AgentTyping,ft.AgentTyping),ut.subscribe(ut.events.ChatMessageReceived,ft.ChatMessageReceived),ut.subscribe(ut.events.ChatQueueStatus,ft.ChatQueueStatus),ut.subscribe(ut.events.ChatQueued,ft.ChatQueued),ut.subscribe(ut.events.ChatRejected,ft.ChatRejected),ut.subscribe(ut.events.ChatSessionClosed,ft.ChatSessionClosed),ut.subscribe(ut.events.ChatSessionEstablished,ft.ChatSessionEstablished),ut.subscribe(ut.events.ChatSessionReconnected,ft.ChatSessionReconnected),ut.subscribe(ut.events.ChatTimeout,ft.ChatTimeout),ut.subscribe(ut.events.ChatTransferred,ft.ChatTransferred),ut.subscribe(ut.events.CommandMessageReceived,ft.CommandMessageReceived),ut.subscribe(ut.events.EstimatedWaitTime,ft.EstimatedWaitTime),ut.subscribe(ut.events.SessionRestored,ft.SessionRestored),ut.subscribe(ut.events.TransferSessionEstablished,ft.TransferSessionEstablished),ut.subscribe(ut.events.Validation,ft.Validation),ut.subscribe(ut.events.ChatChannelDisconnected,ft.ChatChannelDisconnected),ut.subscribe(ut.events.ChatChannelReconnected,ft.ChatChannelReconnected),ut.subscribe(ut.events.AgentDisconnected,ft.AgentDisconnected),ut.subscribe(ut.events.AgentReconnected,ft.AgentReconnected),i&&i.restored)for(r=0;r<i.attributes.length;r++)i.attributes[r].name=="AgentId"&&(u=y.getAgent(),u||(u={}),u.AgentId=i.attributes[r].value,y.setAgent(u));f(function(){y.getToken()&&(ut.setToken(y.getToken()),pt.forEach(function(n){n()}),pt=[],at=!0,e.$broadcast("ChatInitComplete"))})}}function ci(){lt&&r.cancel(lt)}function gi(){ci();lt=r(function(){nr()},wt.tokenRefreshInterval)}function nr(){var t=function(t){y.setToken(t);typeof ut=="undefined"?lt&&r.cancel(lt):(n.log("User token refreshed"),ut.setToken(y.getToken()))};a.refreshToken(st,ot,ht).then(function(n){n!=null&&n.data!=null&&n.data.indexOf("PageController")>-1&&e.$broadcast("MalformedUnauthenticatedTokenFromRefresh",n.data);t(n.data)})}function li(t){var i=w.createEvent(w.eventTypes.awasa.chat);return u(function(r,u){var f=ut.enqueue("chat",y.getSubject(),t,function(n){var t=wi.getEstimatedChatWaitTime();n.visitId=y.getVisitId();n.waitTimeEstimate=t?t.AverageWaitTime:0;n.enqueueId=f;i.resolve(n);e.$broadcast("EnqueueChatSuccess",n);r(n)},function(t){t.visitId=y.getVisitId();i.reject(t);n.error("Chat failed to enqueue",t);e.$broadcast("EnqueueChatFailure",t);u(t)});e.$broadcast("awasaEnqueueId",f);y.setEnqueueId(f)})}function ai(t,i,r,u){var o={test:h&&h.ChatConfig&&h.ChatConfig.UseTestCallbackQueue,attributes:t},f,s;u&&(o.timeslot=u);f=w.createEvent(w.eventTypes.awasa.callback);s=ut.enqueue("callback",i,o,function(n){n.visitId=y.getVisitId();n.locale=r;f.resolve(n);e.$broadcast("EnqueueCallbackSuccess",n)},function(t){t&&t.errorCode&&(oi.indexOf(t.errorCode)!=-1||(pi.indexOf(t.errorCode)!=-1?(t.status="400",f.reject(t)):f.reject(t)));n.error("Callback failed to enqueue"+JSON.stringify(t));t.locale=r;e.$broadcast("EnqueueCallbackFailure",t)});y.setEnqueueId(s)}function tr(n,t){for(var i in n)if(n[i].Id==t)return n[i].Name;return null}function vi(n,t,i){var u,r;for(u in n)if(n[u].Id==i)return r=n[u].Channels.filter(function(n){return n.Type==t})[0],r&&(r.AverageWaitTime=r.AverageWaitTime*1),r;return null}function ui(n){if(ut&&typeof ut.disengageChat=="function"){var t=w.createEvent(w.eventTypes.awasa.disengage);ut.disengageChat(function(i){return e.$broadcast("NotifyAppClosingComplete"),i.visitId=y.getVisitId(),e.$broadcast("ChatDisengageSuccess",i),t.resolve(i),n&&kt(),!0},function(i){return e.$broadcast("NotifyAppClosingComplete"),i.visitId=y.getVisitId(),e.$broadcast("ChatDisengageFailure",i),t.reject(i),n&&kt(),!0})}else e.$broadcast("NotifyAppClosingComplete");return!1}function fi(n){for(var i=[],t=0;t<n.length;t++)i.push({name:n[t].Key,value:n[t].Value,encrypted:!0});return i}function yi(){var r=i.get("ChatValues"),n,u;r&&(n={},u=r.split("&"),u.forEach(function(i){splitValue=i.match(/^(\w+?)\=(.*)/);splitValue&&splitValue.length===3&&(n[splitValue[1]]=t.atob(splitValue[2]))}),e.$broadcast("PrechatText",JSON.stringify(n)))}var ei=d.isUserInFlight("aad-1"),ut,lt,yt=!1,at=!1,dt=!1,gt=[],pt=[],wt={tokenRefreshInterval:18e4},oi=["CHAT_MESSAGE_ERROR","CHANNEL_CONTACTSCHEDULED"],pi=["CHANNEL_CONTACTINVALID","CHANNEL_APPTUNAVAILABLE"],ct,et,wi=this,st=!1,vt=!1,ot=!1,ht=null,bt=[],ni=!1,ft={AgentTyping:function(n){f(function(){e.$broadcast("AgentTyping",n.isTyping)})},ChatMessageReceived:function(t){f(function(){n.log("Chat Message Received"+JSON.stringify(t));e.$broadcast("ChatMessageReceived",{text:t.msg,senderName:y.getAgent()&&y.getAgent().DisplayName,messageType:p.Agent});e.$broadcast("AgentTyping",!1)})},ChatQueueStatus:function(t){f(function(){n.log("Chat Queue Status"+JSON.stringify(t));e.$broadcast("ChatQueueStatus",t)})},ChatQueued:function(t){n.log("Chat Queued"+JSON.stringify(t))},ChatRejected:function(t){n.log("Chat Rejected"+JSON.stringify(t))},ChatSessionClosed:function(t){f(function(){n.log("Chat Session Closed"+JSON.stringify(t));e.$broadcast("ChatSessionClosed",{})})},ChatSessionEstablished:function(t){f(function(){n.log("Chat Session Established"+JSON.stringify(t));e.$broadcast("awasaChatId",t.chatId);y.setChatId(t.chatId);e.$broadcast("ChatSessionEstablished",{agentId:t.agentId})})},ChatSessionReconnected:function(t){f(function(){n.log("Chat Session Reconnected"+JSON.stringify(t));e.$broadcast("ChatSessionRestored",t)})},ChatTimeout:function(t){n.log("Chat Timeout"+JSON.stringify(t))},ChatTransferred:function(t){f(function(){n.log("Chat Transferred"+JSON.stringify(t));e.$broadcast("awasaChatId",t.chatId);y.setChatId(t.chatId);ri();e.$broadcast("ChatTransferred",t)})},CommandMessageReceived:function(t){f(function(){n.log("Command Message Received"+JSON.stringify(t));e.$broadcast("CommandMessageReceived",t)})},EstimatedWaitTime:function(n){f(function(){e.$broadcast("ChatEstimateWaitTimeUpdate",n)})},SessionRestored:function(t){n.log("Session Restored"+JSON.stringify(t))},TransferSessionEstablished:function(t){n.log("Transfer Session Established"+JSON.stringify(t))},Validation:function(t){n.log("Validation"+JSON.stringify(t))},AgentReconnected:function(t){f(function(){w.createEvent(w.eventTypes.awasa.agentReconnect).resolve();n.log("Agent Connection Restored"+JSON.stringify(t));e.$broadcast("AgentReconnected",{agentId:t.agentId})})},AgentDisconnected:function(t){f(function(){w.createEvent(w.eventTypes.awasa.agentDisconnect).reject();n.log("Agent Connection Disconnected"+JSON.stringify(t));e.$broadcast("AgentDisconnected",{agentId:t.agentId})})},ChatChannelReconnected:function(){f(function(){w.createEvent(w.eventTypes.awasa.channelReconnect).resolve();n.log("Customer Connection Restored");e.$broadcast("ChatChannelReconnected")})},ChatChannelDisconnected:function(){f(function(){w.createEvent(w.eventTypes.awasa.channelDisconnect).reject();n.log("Customer Connection Disconnected");e.$broadcast("ChatChannelDisconnected")})}};this.toggleRatMode=function(){st=!st};this.isRatMode=function(){return st};this.init=function(n,t,i){bt.push({command:"init",authReq:n,authType:t,callback:i});ti()};this.initLazy=function(n){bt.push({command:"initlazy",callback:n});ti()};this.getChatTypingBoxId=function(){return wt.chatTypingBoxId};this.setChatTypingBoxId=function(n){awasaServicesSettings&&(awasaServicesSettings.chatTypingBoxId=n)};this.enqueueChat=function(t){var r,u,i,f;if(y.getChatEstablished()){e.$broadcast("DoubleChatEnqueued");n.error("Chat already exists. Can't enqueue again.",t);return}ri();t=t||{};t.attributes=t.attributes||[];t.mode=t.mode||(typeof o.mode!="undefined"?o.mode:h.ChatConfig.Mode);t.disability=t.disability||y.getSubject()==h.ChatConfig.DisabilityAnswerDeskId;t.accessibility=t.accessibility||y.getSubject()==h.ChatConfig.DisabilityAnswerDeskId;yi();y.getAppStartContext()&&t.attributes.push({name:"AppStartContext",value:JSON.stringify(y.getAppStartContext()),encrypted:!1});r="";try{r=parent&&parent.window&&parent.window.location&&parent.window.location.href}catch(l){}return t.attributes.push({name:"WebStartContext",value:JSON.stringify({url:window&&window.location&&window.location.href,parentUrl:r,userAgent:navigator&&navigator.userAgent}),encrypted:!1}),st?li(t):(o.rejoin==="true"&&(t.rejoin=!0,t.agentId=y.getAgent().AgentId),h.ChatConfig&&h.ChatConfig.ExplicitAgentId&&h.ChatConfig.ExplicitAgentId>0&&(t.agentId=h.ChatConfig.ExplicitAgentId),u=rt.getSupportedIDP(),i="/"+c.langLocale()+"/contact/chat/"+y.getSubject()+"/?visitId="+y.getVisitId()+"&rejoin=true",ot||(i+="&unauth=true"),ht===u.AAD&&(i+="&useAAD=true"),i=b.isNative()?"ms-contact-support://rejoin"+i+"&isNative=true":"https://"+s.host()+i,t.attributes.push({name:"rejoinurl",value:i,encrypted:!1}),f=ot?ht===u.AAD?a.getAADEncryptedValueCookie(y.getVisitId(),null):a.getEncryptedValueCookie(y.getVisitId(),null):a.getUnauthEncryptedValueCookie(y.getVisitId(),null),f.then(function(i){for(var u=fi(i.data),r=0;r<u.length;r++)n.log(u[r]),t.attributes.push(u[r]);return li(t)}))};this.getChatTypingBoxId=function(){return wt.chatTypingBoxId};this.getCallbackTime=function(t,i,r){var f={test:h&&h.ChatConfig&&h.ChatConfig.UseTestCallbackQueue,count:i},u=w.createEvent(w.eventTypes.awasa.times);ut.getCallbackTime(r,t,f,function(n){n.visitId=y.getVisitId();u.resolve(n);e.$broadcast("GetCallbackTimeSuccess",n)},function(t){t.visitId=y.getVisitId();u.reject(t);n.error("failure: "+t);e.$broadcast("GetCallbackTimeFailure",t)})};this.enqueueCallback=function(n,t,i,r){var u=this.validateNumber(n,i);ri();yi();e.$broadcast("CallbackPhoneValidation",u);u&&u.isValid&&(ot?a.getEncryptedValueCookie(y.getVisitId(),u.formattedContact).then(function(n){var u=fi(n.data);ai(u,t,i,r)}):a.getUnauthEncryptedValueCookie(y.getVisitId(),u.formattedContact).then(function(n){var u=fi(n.data);ai(u,t,i,r)}))};this.postTranscript=function(n,t){var i=w.createEvent(w.eventTypes.awasa.postChatTranscript),r={transcript:n,isBotConversation:t};return ut.postChatTranscript(r,i.resolve,i.reject),i.promise};this.validateNumber=function(n,t){return ut?ut.validate("callback",n,{country:t}):null};this.sendMessage=function(t){return u(function(i,r){var f,u;dt?(t.text=="agentend"?e.$broadcast("ChatSessionClosed",{}):(f=v.createMessage({text:"Echo: "+t.text,senderName:"Emulator Agent"},p.Agent),y.setAgent(),e.$broadcast("ChatMessageReceived",f)),i()):(u=w.createEvent(w.eventTypes.awasa.sendMessage),ut.sendChat(t.text,function(n){n.visitId=y.getVisitId();u.resolve();e.$broadcast("ChatMessageSendSuccess",n);i(n)},function(i){i.visitId=y.getVisitId();u.reject(i);n.error("Failed to send message"+JSON.stringify(i));e.$broadcast("ChatMessageSendError",t);r(i)}))})};this.getEstimatedCallbackWaitTime=function(n){var t=ut.getEstimatedWaitTime();return n||(n=y.getSubject()),vi(t,"Callback",n)};this.getEstimatedChatWaitTime=function(n){var t=ut.getEstimatedWaitTime();return n||(n=y.getSubject()),vi(t,"Chat",n)};this.getSubjectName=function(n){var t=ut&&ut.getEstimatedWaitTime();return n||(n=y.getSubject()),tr(t,n)};this.isWithinOperatingHours=function(n,t){var r=w.createEvent(w.eventTypes.awasa.channelStatus),e={mode:typeof o.mode!="undefined"?o.mode:h.ChatConfig.Mode},s={isOpen:!1,isAvailable:!1,status:l.getStatus(!1,!1),schedule:[]},f={},i={description:"",subjectId:n?n:" ",channels:[]};return(typeof o.scheduleAsOf!="undefined"&&(e.scheduleAsOf=o.scheduleAsOf),!t||t.length===0)?(i.description="no channels provided",i.status=400,r.reject(i),u.resolve(f)):(t=Array.isArray(t)?t:[t],t.forEach(function(n){f[n]=s}),i.channels=t.join("|"),!n)?(i.description="subject id is blank",i.status=400,r.reject(i),u.resolve(f)):u(function(u){ut.getChannelStatus(n,e,function(n){var e=l.getChannelOperations(n,t),f=l.getChannelOutages(e);f&&f.length>0?(i.description="The following are unavailable for this subject",i.channels=f.join("|"),r.reject(i)):(i.description="The following are available for this subject",r.resolve(i));u(e)},function(n){r.reject(n);u(f)})})};this.endChat=function(n){return ui(n)};e.$on("ChatSessionClosed",function(){ci()});e.$on("NativeAppClosing",function(){ui()});e.$on("ForwardToAgent",function(n,t){var i=w.createEvent(w.eventTypes.awasa.sendCommand);ut.sendCommand(t,function(n){i.resolve();e.$broadcast("ForwardToAgentSuccess",n)},function(n){i.reject(n);e.$broadcast("ForwardToAgentFailure",n)})});e.$on("ChatPageTimeout",function(){ct&&ct.reject("Chat page timed out while attempting to download the awasa sdk");et&&et.reject("Chat page timed out while attempting to initialize the awasa sdk")});h&&h.TestConfig&&h.TestConfig.AllowChatEmulator&&e.$on("ChatEmulate",function(){dt=!0;ui(!1);e.$broadcast("ChatSessionEstablished",{agentId:123456789})})}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).service("recurringOperationManagerService",["$timeout",function(n){function t(){function t(i,r){r&&(r.isSuccessfulFunction(i)||r.operationCancelled||(r.currentTimeoutPromise=n(r.operationFunction,r.delayInMilliseconds),r.currentTimeoutPromise.then(function(n){t(n,r)}).catch(function(){t(null,r)})))}function r(n,t,r){var u={operationFunction:n,delayInMilliseconds:t,isSuccessfulFunction:r,operationCancelled:!1,currentTimeoutPromise:null};return i.push(u),u}var i=[];this.recurUntilSuccessfulOrCleanedUp=function(n,i,u){var f=r(n,i,u);f.operationFunction().then(function(n){t(n,f)}).catch(function(){t(null,f)})};this.recurUntilCleanedUp=function(n,t){this.recurUntilSuccessfulOrCleanedUp(n,t,function(){return!1})};this.cleanup=function(){for(var t,r=0;r<i.length;r++)(t=i[r],t)&&(t.operationCancelled=!0,t.currentTimeoutPromise)&&(n.cancel(t.currentTimeoutPromise),t.currentTimeoutPromise=null)}}this.getInstance=function(){return new t}}]),function(n){n.service("relayService",["$http","clientConfig",function(n,t){this.getNearestRelay=function(){return n.get(t.ChatConfig.NearestRelayProbeUrl)}}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("selfHelp",["$rootScope","$timeout","virtualAgentService","searchResultsService","flightService","widgetService",function(n,t,i,r,u,f){function s(n,i){if(n.view=n.view||i.view,n.answer=null,n.selfHelpLinks=null,n.selfHelpReady=!1,n.searchResultsPageUrl=r.getSearchResultsUrl(n.query),!n.query||n.query.length===0){n.onReady({isPresent:!1});n.selfHelpReady=!0;return}var u={query:n.query,queryChannel:"contactus",page:1,shouldRequestErrorCrashExperience:!1};e=t(function(){n.onReady({isPresent:!1})},o.timeoutLength);r.fetchResults(u).then(h.bind(this,n)).catch(function(){n.onReady({isPresent:!1});n.selfHelpReady=!0})}function h(n,i){if(t.cancel(e),i.instantAnswer){n.answer=i.instantAnswer;c(i.instantAnswer);n.onReady({isPresent:!0})}else if(i.results&&i.results.length>0){n.selfHelpLinks=i.results.slice(0,o.maxSelfHelpLinks);n.onReady({isPresent:!0})}else n.onReady({isPresent:!1});n.selfHelpReady=!0}function c(t){t.problem&&t.problem.name&&t.problem.name.substr(t.problem.name.length-1)==="?"&&n.$broadcast("instantAnswerWithQuestion",{text:t.problem.name,sourceId:t.sourceId});t.solutions&&t.solutions[0].description&&t.solutions[0].description.substr(t.solutions[0].description.length-1)=="?"&&n.$broadcast("instantAnswerWithQuestion",{text:t.solutions[0].description,sourceId:t.sourceId})}var e,o={maxSelfHelpLinks:5,virtualAgentEnabled:!1,timeoutLength:3e3};return{restrict:"A",templateUrl:"/PartialViews/ContactUs/SelfHelp.html",scope:{query:"@",view:"=?",onReady:"&"},link:function(n){f.getWidgetConfig("Self-Help").then(function(t){n.isSelfHelpEnabled=!!t;n.isSelfHelpEnabled&&s(n,t)})}}}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).value("modalityTags",{callback:"callback",scheduleCallback:"schedule-call",chat:"chat",tollFree:"phone"}).factory("hoopsModalities",["modalityTags",function(n){return[n.chat,n.callback,n.tollFree]}]).factory("waitTimeModalities",["modalityTags",function(n){return[n.chat,n.callback]}]).service("supportLinkService",["$filter","$window","$log","$location","$rootScope","$cookies","languageService","clientConfig","chatStateService","modalityTags","hoopsModalities","waitTimeModalities","locationService","windowService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){function p(t){return t&&t.link&&t.link.linkUrl&&(t.link.linkUrl=n("compassFormat")(t.link.linkUrl,{"subject-id":s.getSubject()})),t}function w(n,t){return n&&n.metaTags&&n.metaTags.split(";").some(function(n){return n===t})}function b(n){return a.appendCurrentRouteParams("https://"+r.host()+"/"+e.langLocale().toLowerCase()+"/contact"+n)}var k="smcpartner",d="smc",y="/hoops",g="/chat/",nt="/callback/";this.extractSubject=function(n){if(this.isModality(n)){var t=n.link.linkUrl.split("/");if(t.length>=3&&t[2]!=="{subject-id}")return parseInt(t[2],10)}return-1};this.extractSubjectFromList=function(n){for(var i=-1,r=n&&n.length||0,t=0;t<r;t++)if((i=this.extractSubject(n[t]))>-1)return i;return-1};this.hasModality=function(n,t){var i=this.getModalities(n);return!!i[t]};this.hasAnyModalities=function(n,t){var i=this.getModalities(n);return t.some(function(n){return!!i[n]})};this.hasModalities=function(n,t){var i=this.getModalities(n);return!t.some(function(n){return!i[n]})};this.isModality=function(n,t){return t?w(n,t):Object.keys(h).some(function(t){return w(n,h[t])})};this.getModalities=function(n){var t={};return n&&n.forEach(function(n){this.isModality(n)&&(t[this.getModalityName(n)]=n)}.bind(this)),t};this.isHoopsModality=function(n){return c.some(function(t){return this.isModality(n,t)}.bind(this))};this.isWaitTimeModality=function(n){return l.some(function(t){return this.isModality(n,t)}.bind(this))};this.getWaitTimeModalities=function(n){var t=this.getModalities(n);return Object.keys(t).forEach(function(n){this.isWaitTimeModality(t[n])||delete t[n]}.bind(this)),t};this.getHoopsModalities=function(n){var t=this.getModalities(n);return Object.keys(t).forEach(function(n){this.isHoopsModality(t[n])||delete t[n]}.bind(this)),t};this.getLinkId=function(n){return n=p(n),n.link.linkUrl};this.getModalityName=function(n){for(var t in h)if(this.isModality(n,h[t]))return h[t];return null};this.openContactWindow=function(n,t){t=t||{};var i=b(n),r={width:t.width||o.ContactUsConfig.CadPopupWidth,height:t.height||o.ContactUsConfig.CadPopupHeight,resizable:"yes",scrollbars:"yes"};v.openPopupCenter(i,"contactSupport",r)};this.transformHoopsUrl=function(n){var t=n.match(/form\/(\d*?)\/(.*)/);return!t||t.length<2?y+n:t[2]&&(t[2].endsWith("call")||t[2].endsWith("call/"))?y+nt+t[1]:y+g+t[1]};this.followLink=function(n){if(!n||n.clickableLink&&(!n.link||!n.link.linkUrl))return i.error("Invalid Link: ",n);if(n.clickableLink){if(n.isModality&&(n=p(n)),n.externalLink)t.open(n.link.linkUrl,"_blank");else if(n.isModality&&!n.fromOldFlow)if(f.get(k)==d)u.$broadcast("setParentCv"),this.openContactWindow(n.link.linkUrl);else{var o=b(n.link.linkUrl);t.open(o,"_self")}else n.fromOldFlow?r.path(n.link.linkUrl):r.path("/"+e.langLocale().toLowerCase()+"/"+n.link.linkUrl);n.fromOldFlow?u.$broadcast("MenuLinkClicked",n):u.$broadcast("ContactUsLinkClicked",n)}};this.getSpecifiedModalities=function(n,t){var i={};return!t||!n?i:(angular.forEach(t,function(t){var r=n.filter(function(n){return n.metaTags.indexOf(t)!==-1})[0];r&&(i[t]=r,r.isOpen=!0)}),i)}}]),function(n){n.controller("SupportMenuController",["$scope","$rootScope","$location","$filter","$window","$route","$routeParams","compassService","clientConfig","chatStateService","osService","nativeAppService","supportLinkService","oemService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){function p(n){var t=n&&n.hasModality?o.getPageSubjectId(n):null;h.isValidSubject(t)&&h.setSubject(t)}function y(){var t=o.getServiceAgreement(),r=o.getMenuExtras();o.getMenu(i.path().substring(1)).then(function(t){t&&(n.menuWizard.page=t,n.status&&(n.status.waitingOnCompass=!1),p(t),v.applyOEM(t))});r&&(n.menuWizard.menuExtras=r);t&&(n.menuWizard.serviceAgreement=t.serviceAgreement,n.menuWizard.serviceAgreementLink=t.serviceAgreementLink)}n.config={timeout:s.ChatConfig.ChatDefaultTimeout};n.menuWizard={};n.menuWizard.reset=function(){n.status={waitingOnRcc:!1,waitingOnCompass:!0,waitingOnHoops:!1};n.isLandingPage=f.current.data.isLandingPage;n.isMobile=c.isMobile();n.isNative=l.isNative();y()};n.openServiceAgreement=function(){n.menuWizard.serviceAgreementLink&&n.menuWizard.serviceAgreementLink.linkUrl&&u.open(n.menuWizard.serviceAgreementLink.linkUrl)};n.followLink=function(n){n.fromOldFlow=!0;a.followLink(n)};n.getLinkId=a.getLinkId;n.$on("CompassContentReady",y);n.$on("SupportMenuPageTimeout",function(){n.isReady||t.$broadcast("500Error",{reason:"Timeout occurred on a support menu page",data:n.status})});n.$watchCollection("status",function(t){n.isReady=t&&!Object.keys(t).some(function(n){return t[n]})});n.menuWizard.reset()}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).service("waitTimeService",["$filter","$q","$timeout","$log","rccService","compassService","queueService",function(n,t,i,r,u,f,e){function s(n){return e.waitTime(n).then(function(n){return n.data.WaitTime&&n.data.WaitTime>0?Math.ceil(n.data.WaitTime/60):1}).catch(function(n){r.warn("Error calling WaitTime web service: "+n);throw n;})}function h(){return f.getWaitTimeText().then(function(n){o=n})}var o;this.reset=function(){o=null;h()};this.getChatWaitTime=function(){return s("chat")};this.getCallbackWaitTime=function(){return s("callback")};this.isValidWaitTimeResponse=function(n){return n>-1};this.getConnectingWaitTimeText=function(t){return t&&t>0?n("compassFormat")(o.connecting,{"wait-time":t}):n("compassFormat")(o.connecting,{"wait-time":1})};this.getWaitTimeText=function(t){return t&&t>1?n("compassFormat")(o.plural,{"wait-time":t}):o.singular};this.reset()}]),function(n){n.service("widgetService",["$location","$q","contentApiService",function(n,t,i){function e(){return u?u.then(function(n){return n}):(r||(r=i.getCompassContentForPage("widgetconfig")),r.then(s,h))}function s(n){n=n&&n.data;var i=n&&n.areaPathWidgetConfig;return u=i&&t.resolve(i),f=n&&n.defaultWidgets,i}function h(n){return r=null,t.reject(n)}function c(n,t){var i=null;return t.some(function(t){var r=new RegExp(t,"i").test(n);return r&&(i=t),r}),i}function o(n){return e().then(function(t){var i=c(n,Object.keys(t));return i&&t[i]})}var u=null,r=null,f=null;this.init=function(){e()};this.clearCaching=function(){u=null;r=null};this.hasWidgets=function(t,i){i=i&&i.toLowerCase()||n.path()&&n.path().toLowerCase();var r={},u=angular.isArray(t);return u||(t=[t]),t.forEach(function(n){r[n]=!1}),o(i).then(function(n){return t.forEach(function(t){r[t]=!!n&&!!n[t&&t.toLowerCase()]}),u?r:r[t[0]]},function(){return u?r:r[t[0]]})};this.getDefaultWidgets=function(){return e().then(function(){return f},function(){return null})};this.getWidgetConfig=function(t,i){return i=i&&i.toLowerCase()||n.path()&&n.path().toLowerCase(),o(i).then(function(n){return n&&n[t&&t.toLowerCase()]||f[t&&t.toLowerCase()]},function(){return null})};this.init()}])}(angular.module(microsoft.support.moduleName)),function(n){n.value("yesNoResults",{yes:"POSITIVE",weakYes:"POSITIVE-",maybe:"NEUTRAL",no:"NEGATIVE"});n.service("chatClassificationService",["$q","$http","$window","$location","$rootScope","contactUsMenuService","compassService","locationService","messageTypes","virtualAgentService",function(n,t,i,r,u,f,e,o,s,h){function a(n){return n&&n.Product&&l.indexOf(n.Product)==-1?n.Issue&&l.indexOf(n.Issue)==-1?{product:n.Product,issue:n.Issue}:{product:n.Product,issue:null}:{product:null,issue:null}}var c="/api/chatClassification",l=["other","n/a","bad","fraud","support"];this.getRoute=function(n,i,r,f){return t({url:c+"/Routing/",method:"POST",data:{query:n,referrer:r,product:f||"",sessionId:h.sessionId()||"",clientId:i||""}}).then(function(n){var t=a(n.data);return u.$broadcast("RoutingServiceResult",t),t})};this.getMenuLinksForRoute=function(t,i,r,u){return this.getRoute(t,i,r,u).then(f.getLinkForRoutingResult).then(function(t){return t.externalLink?n.reject(t):t.link&&t.link.linkUrl?e.getContactUsMenuLinks(t.link.linkUrl).then(function(n){return n.product=t,n}):n.reject(null)})};this.getYesNoForAnswer=function(n,i){return t({url:c+"/YesNo/",method:"POST",params:{query:n,question:i,sessionId:h.sessionId()}}).then(function(t){return u.$broadcast("VirtualAgentSolutionFeedback",{text:n,result:t.data}),t.data})}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("ContactUsController",["$scope","$rootScope","$location","$window","$route","$timeout","compassService","languageService","clientConfig","chatStateService","flightService","locationService","chatClassificationService","supportLinkService","oemService","contactUsMenuService","modalityTags","nativeAppService","virtualAgentLinkService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){function ot(){var n=l.getPathSubset(2);return n&&(n[n.length-1]!=="/"?n+"/":n)}function ct(n){return rt(n)&&"contactus/"+rt(n)+"/"}function st(){var t=n.mlProblemClassificationSupportedLocales,r,i;if(!t||t.length===0)return!1;for(r=o.langLocale().toLowerCase(),i=0;i<t.length;i++)if(r===t[i].toLowerCase())return!0;return!1}function lt(n){var t=n&&n.hasModality?e.getPageSubjectId(n):null;h.isValidSubject(t)&&h.setSubject(t)}function nt(n,t){n&&t&&(n.externalLink?i.path(t+n.metaTags+"/"):v.followLink(n))}function at(){wt(ot());e.getContactUsView().then(function(t){t&&(n.contactUsView=t);d()});e.getMLProblemClassificationSupportedLocales().then(function(t){t&&(n.mlProblemClassificationSupportedLocales=t);d()});e.getContactUsProducts().then(function(t){t&&(n.contactUsProducts=t);g?vt():(n.pageState.currentView=it.collection,d())})}function vt(){n.pageState.selectedProduct=p.getLinkByMetatag(g,n.contactUsProducts.links);n.pageState.selectedProduct?n.pageState.selectedProduct.externalLink?(n.pageState.currentView=it.result,n.externalLinkCard=!0,n.externalLink=n.pageState.selectedProduct,d()):e.getContactUsMenu(ct(i.path())).then(function(t){t?(n.pageState.currentView=it.result,n.productView=t,selectedIssueName?yt():n.productView&&n.productView.links&&n.productView.links.length===1&&n.selectIssue(n.productView.links[0]),d(),selectedIssueName||f(function(){try{r.document.getElementById("result-issue-selection").focus()}catch(n){r.console.log(n)}},50)):tt({status:404},!0)},function(n){tt(n,!0)}):(g=null,tt({status:404},!0))}function yt(){n.pageState.selectedIssue=p.getLinkByMetatag(selectedIssueName,n.productView.links);n.pageState.selectedIssue?n.pageState.selectedIssue.externalLink?(n.externalLinkCard=!0,n.externalLink=n.pageState.selectedIssue,d()):e.getContactUsMenu(ot()).then(function(t){t?(y.applyOEM(t),lt(t),n.issueView=t,d()):tt({status:404},!1)},function(n){tt(n,!1)}):(g=null,tt({status:404},!0))}function rt(n){return n&&/(?:contactus)\/(?!products).+?\//.test(n)&&n.match(/(?:contactus)\/(.+?)\//)[1]}function pt(n){return n&&/contactus\/(?!:products).+?\/.+?\//.test(n)&&n.match(/contactus\/.+?\/(.+?)\//)[1]}function wt(n){g=rt(n);selectedIssueName=pt(n)}function d(){n.pageState.currentView&&n.contactUsView&&n.mlProblemClassificationSupportedLocales&&n.contactUsProducts&&(!g||n.pageState.selectedProduct)&&(!selectedIssueName||n.pageState.selectedIssue&&n.status.selfHelpReady)&&(n.status.waitingOnCompass=!1)}function tt(r,u){r&&r.status==404&&t.$broadcast("404Error",{location:i.absUrl(),preventError:!0});u&&(g=null,selectedIssueName=null,n.changeProblem())}function ht(t){t&&t.link&&t.link.linkUrl!==l.getPathSubset(2)&&(n.pageState.selectedProduct=null,n.pageState.selectedIssue=null,n.productView=null,n.issueView=null)}var g,ut="contactus",ft="mseg_contactus",et="contactus-ml-training",it={collection:"/PartialViews/ContactUs/Collection.html",result:"/PartialViews/ContactUs/Result.html"};n.reset=function(){n.config={homePage:"/"+o.langLocale().toLowerCase()+"/"+ut+"/",productsPage:"/"+o.langLocale().toLowerCase()+"/"+ut+"/products/",isNative:b.isNative(),timeout:s.ChatConfig.ChatDefaultTimeout,viewMoreLinkNumber:s.ContactUsConfig.ViewMoreLinkNumber,virtualAgentUrl:"/virtual-agent"};n.status={loadingResults:!1,waitingOnCompass:!0,selfHelpReady:!1,selfHelpPresent:!1};n.pageState={currentView:null};n.externalLinkCard=!1;n.trainingData=h.getProblemText()||null;n.trainingData||(n.status.selfHelpReady=!0);n.showTextBox=!!n.trainingData||b.isNative();at()};n.startExp=function(){b.isNative()||o.langLocale().toLowerCase()!=="en-us"?(n.showTextBox=!0,n.focusProblemTextbox()):k.openPopup()};n.focusProblemTextbox=function(){n.showTextBox&&f(function(){var n=r.document.getElementById(et);n&&n.focus()})};n.selectProduct=function(t){if(ht(t),n.pageState.selectedProduct=t,!st()||!n.trainingData||h.getUserRouted()){nt(t,n.config.homePage);return}h.setUserRouted(!0);a.getRoute(n.trainingData+" "+n.pageState.selectedProduct.link.linkText,ft,l.getReferrerDomain()).then(function(i){p.getLinkForRoutingResult(i).then(function(t){nt(t,n.config.homePage)}).catch(function(){nt(t,n.config.homePage)})}).catch(function(){nt(t,n.config.homePage)})};n.selectIssue=function(t){ht(t);n.pageState.selectedIssue=t;nt(t,i.path().match(/(^.*?\/.*?\/.*?\/.*?\/).*/)[1])};n.openExternalLink=function(n){v.followLink(n)};n.changeProblem=function(){i.path(n.config.homePage)};n.changeProduct=function(){i.path(n.config.productsPage)};n.submitData=function(){var t=r.document.getElementById(et).value;if(n.trainingData=t,h.setProblemText(n.trainingData),!st()){n.changeProduct();return}n.status.loadingResults=!0;a.getRoute(t,ft,l.getReferrerDomain()).then(function(t){h.setUserRouted(t.product?!0:!1);p.getLinkForRoutingResult(t).then(function(t){nt(t,n.config.homePage)}).catch(function(){h.setUserRouted(!1);n.changeProduct()})}).catch(function(){h.setUserRouted(!1);n.changeProduct()}).finally(function(){n.status.loadingResults=!1})};n.showAllProducts=function(t){n.pageState.showAllProducts=t};n.selfHelpIsReady=function(t){n.status.selfHelpReady=!0;n.status.selfHelpPresent=t;d()};n.$on("ContactUsPageTimeout",function(){t.$broadcast("500Error",{reason:"Timeout occurred on the contact us page content",data:n.status})});n.$on("$routeChangeSuccess",function(){n.showProductsList=u.current&&u.current.data&&u.current.data.showProductsList==!0});n.reset()}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("contactUsMenuService",["$q","compassService",function(n,t){var i=this;this.getLinkByMetatag=function(n,t){for(var r,f,u=null,i=0;i<t.length;i++)r=t[i],f=r.metaTags.split(","),f.some(function(t){if(t.trim()===n)return u=r,!0});return u};this.getLinkForRoutingResult=function(r){return r.product?t.getContactUsProducts().then(function(u){var f=i.getLinkByMetatag(r.product,u.links);return f?f.externalLink||!r.issue?f:t.getContactUsMenu(f.link.linkUrl).then(function(n){var t=i.getLinkByMetatag(r.issue,n.links);return t?t:f}):n.reject()}):n.reject()}}])}(angular.module(microsoft.support.moduleName));WLSPHIP0={error:0,cssSet:{cssCdHIPInput:"form-control"},holder:"ispHIPHIP",scriptHolder:"ispHIPScript",type:"visual",postLoad:function(){},getSolution:function(){},reloadHIP:function(){},switchHIP:function(){},setFocus:function(){},clientValidation:function(){},verify:function(){}},function(n){n.value("hipFormObject",WLSPHIP0);n.service("hipService",["$rootScope","$http","rccService","chatTokenService","chatStateService","hipFormObject",function(n,t,i,r,u,f){function e(t,i){r.getUnauthTokenForUser(JSON.stringify({Solution:t,Token:i,Datacenter:f.dataCenter,FlowId:f.urlFid})).then(function(t){t!=null&&t.data!=null&&t.data.indexOf("PageController")>-1&&n.$broadcast("MalformedUnauthenticatedTokenFromHip",t.data);u.setToken(t.data);n.$broadcast("HipSuccess")},function(){f.reloadHIP();n.$broadcast("HipFailure")})}this.verifyHip=function(){f.verify(e,"")};this.cycleHip=function(){f.reloadHIP();f.setFocus()}}])}(angular.module(microsoft.support.moduleName)),function(n){n.value("unauthNames",{storage:"noAuth"});n.controller("UnauthFormController",["$scope","$rootScope","$location","$routeParams","chatStateService","rccService","compassService","sessionStorageService","flightService","hipService","clientConfig","chatContextService","unauthNames","authService",function(n,t,r,u,f,e,o,s,h,c,l,a,v,y){function g(t){var r={attributes:{},prechatSurvey:[]};for(i=0;i<t.length;i++)n.form.questions[i].contextName?r.attributes[n.form.questions[i].contextName]=t[i]:r.prechatSurvey.push({name:n.form.questions[i].questionText.text,value:t[i]});return r}function k(){var t=o.getUnauthForm();t&&(n.form=t[u.name],w())}function d(){var t=!0;for(i=0;i<n.form.questions.length;i++)n.form.questions[i].isRequired&&!n.responses[i]&&(t=!1,n.form.questions[i].hasError=!0);return t}function p(){u.modality==="call"?r.path("/callback/"+u.id+"/"):r.path("/chat/"+u.id+"/")}function w(){b?y.resolveAuthState().then(function(i){var r=y.getSupportedIDP();i===r.MSA?n.form&&n.form.authFallback?(t.$broadcast("UnauthAuthFallback"),s.set(v.storage,!1),p()):n.form&&(s.set(v.storage,!0),n.isReady=!0):n.form&&(s.set(v.storage,!0),n.isReady=!0)}):n.form&&n.form.authFallback&&l.authInfo.authStatus()===1?(t.$broadcast("UnauthAuthFallback"),s.set(v.storage,!1),p()):n.form&&l.authInfo.authStatus()!=2&&(s.set(v.storage,!0),n.isReady=!0)}var b=h.isUserInFlight("aad-1");n.config={timeout:l.ChatConfig.ChatDefaultTimeout};n.reset=function(){n.responses=[];n.wrongCaptcha=!1;n.awaitingResponse=!1;k()};n.removeError=function(t){n.form.questions[t].hasError=!1};n.submit=function(){d()&&(n.awaitingResponse=!0,c.verifyHip())};n.reset();n.$on("CompassContentReady",k);n.$on("HipSuccess",function(){var t,i;n.awaitingResponse=!1;d()?(t=g(n.responses),t.attributes&&t.attributes.length>0||t.prechatSurvey&&t.prechatSurvey.length>0?(i=t.attributes,i.prechatsurvey=JSON.stringify(t.prechatSurvey),a.setValues(i).then(function(){p()})):p()):c.cycleHip()});b?n.$on("UserSignedInMSA",w):n.$on("UserSignedIn",w);n.$on("UserSignedOut",w);n.$on("HipFailure",function(){n.awaitingResponse=!1;n.wrongCaptcha=!0})}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("iframeService",["$document","$location","$log","$rootScope","$timeout","$window","compassService",function(n,t,i,r,u,f,e){this.noHostsList="no hosts list - compass not ready";this.init=function(o,s){var c=!1,l=e.getContentIframe(),p,v,h,a,y;if(l&&l.iframeContentHosts)p=l.iframeContentHosts;else return this.noHostsList;if(v=!1,l.iframeTestEnvironments&&angular.forEach(l.iframeTestEnvironments,function(n){n==t.host()&&(v=!0)}),h=o,h=h.indexOf("://")>-1?h.split("/")[2]:h.split("/")[0],h=h.split(":")[0],v?(c=!0,h="*"):angular.forEach(p,function(n){n==h&&(c=!0,h=o)}),!c)return i.warn("Unknown iframe host: "+o),c;n.on("click","a:not(a[id])",function(){var t=$(this).attr("href"),n;t&&(n=this.href,n.protocol=="http"&&(n.protocol="https",$(this).attr("href",n)),$(this).attr("target","_parent"))});return a=null,y=function(n){a&&clearTimeout(a);a=u(function(){var t=n==0?n:n+1;s.postMessage(t,h)},5)},r.$watch(function(){return n[0].body.offsetHeight},function(){u(function(){y(n[0].body.offsetHeight)},0)}),angular.element(f).bind("resize",function(){y(n[0].body.offsetHeight)}),i.info("Page has been iframed by "+o),c}}])}(angular.module(microsoft.support.moduleName));app.directive("machineTranslation",["compassService","$routeParams","$location",function(n,t,i){return{scope:{},templateUrl:"/PartialViews/Content/MachineTranslation.html",link:function(r){var u=function(){var u=n.getMachineTranslation();u&&(r.machineTranslated=u,r.articleId=t.articleId,r.originalUrl=i.path().replace(t.langLocale,"en-us"),r.originalLink='<a href="view-original" href="'+r.originalUrl+'" target="_self">'+t.articleId+"<\/a>")};r.$on("CompassContentReady",function(){u()});u()}}}]),function(n){n.service("partnerDataService",["$rootScope","$cookies","$location","$q","chatStateService","contentApiService","resourceLoaderService","flightService","sessionStorageService","chatContextService",function(n,t,i,r,u,f,e,o,s,h){function y(){var n=t.get("smcpartner");return(i.search().partnerId&&(n=i.search().partnerId,t.put("smcpartner",n)),!l)?f.getCompassContentForPage("partnerconfig").then(function(t){var i=t.data&&t.data.configList&&t.data.configList[n]&&t.data.configList[n].partnerDefinition;return l=i&&r.resolve(i),i},function(n){return l=null,r.reject(n)}):l.then(function(n){return n})}var a="blue",l=null,c=i.search(),v="returnUrl",p,w;if(this.init=function(){y()},this.getPartnerData=function(n){return y().then(function(t){return t&&(n?t[n]:t)})},this.loadTheme=function(){return c&&angular.isString(c.theme)?e.loadCSS("/content/themes/"+c.theme+".css"):this.getPartnerData("theme").then(function(n){return e.loadCSS("/content/themes/"+(n||a)+".css")},function(){return e.loadCSS("/content/themes/"+a+".css")})},this.returnUrl=function(){return s.get(v)},this.decodeContext=function(n){return decodeURIComponent(n)!==n?decodeURIComponent(n):n},c&&angular.isString(c.context))try{p=this.decodeContext(c.context);w=angular.fromJson(p);h.setValues({prechatsurvey:JSON.stringify(w)}).then(function(){i.search("context",null).replace()})}catch(b){console.log(b)}i.search().return&&(s.set(v,i.search().return),i.search("return",null).replace());this.init()}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("AddPaymentController",["$scope","$window","$routeParams",function(n,t,i){i.errorCode!=null&&(i.errorCode==20&&t.parent&&t.parent.postMessage(JSON.stringify({type:"$broadcast",name:"AddPaymentCPStatusError",args:i.errorCode}),"*"),i.errorCode==10&&t.parent&&t.parent.postMessage(JSON.stringify({type:"$broadcast",name:"AddPaymentCPStatusCancel",args:i.errorCode}),"*"));i.piid!=null&&t.parent&&t.parent.postMessage(JSON.stringify({type:"$broadcast",name:"AddPaymentCPStatusSuccess",args:i.errorCode}),"*")}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("DevicesController",["$scope","$window","$location","$uibModal","$routeParams","$sce","$rootScope","geographyService","hardwareService","orderService","flightService","clientConfig","authenticationHelperService","languageService","compassService","profileService","paymentService","authService",function(n,t,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){var g=l.isUserInFlight("aad-1"),it;if(n.devicesflightEnabled=l.isUserInFlight("odc-1"),it=2,n.userSignedIn=null,n.viewReady=!1,n.devicesflightEnabled){g?n.$on("UserSignedInMSA",function(){n.userSignedIn=!0;n.reset()}):n.$on("UserSignedIn",function(){a.authInfo.authState==1&&(n.userSignedIn=!0,n.reset())});f.incidentNumber&&c.getSerialNumberForIncident(f.incidentNumber).then(function(n){r.url("/devices/"+n)});var d="Fulfillment",nt="Repair",ft="AdvancedExchange",et="VMF",ot="VMF(Metadata)",st="CP",ht="CalculateTax",rt="Controller35mm",ct="Controller",ut="Headset35mm",lt="Headset",at="Other",vt="PaymentOnDelivery",yt="COD",tt="BRA",pt=/^\d{3}[.]\d{3}[.]\d{3}[-]\d{2}$/;n.HasMaxInWarrantyReached=!0;n.HasMaxOutWarrantyReached=!0;n.chkDeviceOrderCheckAcceptTerms=!1;n.chkDeviceOrderPaymentTerms=!1;n.deviceNewOrderInformation=c.getNewDeviceOrder();n.cancelServiceOrderDetails=c.getDeviceCancelOrder();n.deviceWicLocationInfo=c.getWicLocationInformation();n.displayWicLocations=!1;n.currentCreateOrderStep=0;n.showWicLocations=!1;n.wicAllowedStates=[];n.deviceActiveOrderSummary=[];n.ChargebackFee=0;n.showDescriptionText=!1;n.pid={};n.pid.pidValue="";n.paymentCardNumber=null;n.paymentCardType=null;n.problemTypessList="";n.surfaceStudioSupportMessage=null;n.deviceShippingEmail=null;n.deviceOrderConfirmation={};n.deviceOrderConfirmation.problemTypeDevice=null;n.deviceSpecialAddress=[];n.deviceSpecialAddress.HouseNumber="";n.deviceSpecialAddress.Complement="";n.deviceSpecialAddress.Neighbourhood="";n.getWicLocations=function(t){c.getHardwareWicLocations(t).then(function(t){var i,r,u;if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}for(n.wicLocaleValue=y.langLocale(),n.wicLocations=t,n.wicAllowedStates=[],i=0;i<n.statesList.length;i++)for(r=0;r<n.wicLocations.length;r++)if(n.statesList[i].code==n.wicLocations[r].State){u={};u.code=n.statesList[i].code;u.name=n.statesList[i].name;n.wicAllowedStates.push(u);break}})};n.changeWicStateName=function(t){n.wicSelectedState=t};n.getDeviceRepairOffers=function(t,i,r,u,f,e,o){c.getHardwareRepiarOffers(t,i,r,u,f,e,o).then(function(t){if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.deviceAccessoryOffers=t;n.deviceNewOrderInformation.Currency=t.Currency})};n.getAccessoryFulfillmentOffers=function(t,i,r,u,f,e){n.xboxAccessoryType&&(u=n.xboxAccessoryType);c.getHardwareAccessoryFulfillmentOffers(t,i,r,u,f,n.pidWarrantyStartDate,n.pidWarrantyEndDate,e).then(function(t){if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.deviceAccessoryOffers=t;n.deviceNewOrderInformation.Currency=t.Currency})};n.getDeviceShippingOffers=function(t,i,r,u,f,e,o){c.getHardwareShippingOffers(t,i,r,u,f,e,o).then(function(t){if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.deviceAccessoryShippingOffers=t})};n.getFulfillmentShippingOffers=function(t,i,r,u,f,e,o){c.getHardwareFulfillmentShippingOffers(t,i,r,u,f,e,o).then(function(t){if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.deviceAccessoryShippingOffers=t})};n.getHardwareProfileInformation=function(){w.getUserHardwareProfile().then(function(t){n.userProfileInformation=t.Message&&t.Message.length>0?null:t;n.customerDetailsInfo();n.allDevicesList(f.deviceId)})};n.customerDetailsInfo=function(){n.deviceNewOrderInformation.Shipments[0].ShipTo.Email=[];n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number="";a.authInfo!=null&&(g?(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerName.First=k.getUserInfo().firstName,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerName.Last=k.getUserInfo().lastName,n.deviceNewOrderInformation.Puid=JSON.stringify(parseInt(k.getUserInfo().puid,16)),n.deviceNewOrderInformation.Shipments[0].ShipTo.Email.push(k.getUserInfo().email)):(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerName.First=a.authInfo.firstName,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerName.Last=a.authInfo.lastName,n.deviceNewOrderInformation.Puid=JSON.stringify(parseInt(a.authInfo.puid,16)),n.deviceNewOrderInformation.Shipments[0].ShipTo.Email.push(a.authInfo.displayName)),n.userProfileInformation&&(n.userProfileInformation.ContactNumbers[0].CountryCode!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number=n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number+n.userProfileInformation.ContactNumbers[0].CountryCode),n.userProfileInformation.ContactNumbers[0].AreaCode!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number=n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number+" ("+n.userProfileInformation.ContactNumbers[0].AreaCode+") "),n.userProfileInformation.ContactNumbers[0].Number!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number=n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number!=null?n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number+n.userProfileInformation.ContactNumbers[0].Number:n.userProfileInformation.ContactNumbers[0].Number),n.userProfileInformation.ContactNumbers[0].Extension!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number=n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number+" x"+n.userProfileInformation.ContactNumbers[0].Extension),n.userProfileInformation.Addresses[0].Address1!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address1=n.userProfileInformation.Addresses[0].Address1),n.userProfileInformation.Addresses[0].Address2!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address2=n.userProfileInformation.Addresses[0].Address2),n.userProfileInformation.Addresses[0].City!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.City=n.userProfileInformation.Addresses[0].City),n.userProfileInformation.Addresses[0].RegionCode!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.StateOrProvince=n.userProfileInformation.Addresses[0].RegionCode),n.userProfileInformation.Addresses[0].CountryCode!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country=n.userProfileInformation.Addresses[0].CountryCode,n.updateStateList()),n.userProfileInformation.Addresses[0].PostalCode!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.PostalCode=n.userProfileInformation.Addresses[0].PostalCode)))};n.fillAccessorydata=function(t){n.xboxAccessoryType=t};n.fillShippingdata=function(t){n.selectWicLocation=!0;t.VirtualSku==et?(n.showWicLocations=!0,n.getWicLocations(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country),n.deviceNewOrderInformation.LineItems[0].ItemAttributes=nt,n.selectWicLocation=!1):n.showWicLocations=!1;n.deviceNewOrderInformation.Shipments[0].Sku=t.Sku;n.deviceNewOrderInformation.Shipments[0].Price=t.Price;n.deviceNewOrderInformation.Shipments[0].Description=t.Name};n.isWicOrder=function(n){return n==ot};n.fillWicData=function(t){n.selectWicLocation=!0;n.deviceNewOrderInformation.Payments[0].BillTo==null&&(n.deviceNewOrderInformation.Payments[0].BillTo=angular.copy(n.deviceNewOrderInformation.Shipments[0].ShipTo));n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address1=t.AddressLine1;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address2=t.AddressLine2;n.deviceNewOrderInformation.Shipments[0].ShipTo.Email=[];n.deviceNewOrderInformation.Shipments[0].ShipTo.Email.push(t.EmailAddress);n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.City=t.City;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.StateOrProvince=t.State;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.PostalCode=t.Zipcode;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country=t.Country;n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number=t.PhoneNumber};n.fillOffersdata=function(t){n.deviceNewOrderInformation.LineItems[0].Sku=t.Sku;n.deviceNewOrderInformation.LineItems[0].Price=t.Price;n.deviceNewOrderInformation.LineItems[0].Description=t.Name;n.ChargebackFee=t.ChargebackFee;n.deviceNewOrderInformation.LineItems[0].ItemAttributes=nt;n.deviceNewOrderInformation.LineItems[0].ServiceContract=t.MatchedServiceContract;n.deviceNewOrderInformation.Payments[0].PaymentOption=t.PaymentOptions;n.deviceNewOrderInformation.Payments[0].PaymentOption==vt&&(n.deviceNewOrderInformation.Payments[0].Gateway=yt);t.ItemAttributes==nt||t.ItemAttributes==ft?n.getDeviceShippingOffers(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.deviceNewOrderInformation.Brand,n.deviceNewOrderInformation.LineItems[0].DeviceKey.Key,n.deviceNewOrderInformation.LineItems[0].ProblemCode,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.PostalCode,n.deviceNewOrderInformation.LineItems[0].Sku,y.langLocale()):t.ItemAttributes==d&&(n.deviceNewOrderInformation.LineItems[0].ItemAttributes=d,n.getFulfillmentShippingOffers(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.deviceNewOrderInformation.Brand,n.deviceNewOrderInformation.LineItems[0].DeviceKey.Key,n.deviceNewOrderInformation.LineItems[0].ProblemCode,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.PostalCode,n.deviceNewOrderInformation.LineItems[0].Sku,y.langLocale()))};n.fillPaymentdata=function(t){n.showAddPaymentInstrument=!1;n.deviceNewOrderInformation.Payments[0].AccountId=t.AccountId;n.deviceNewOrderInformation.Payments[0].InstrumentId=t.Id;n.deviceNewOrderInformation.Payments[0].Gateway=st;n.paymentCardNumber=t.AccountNumberLastFour;n.paymentCardType=t.CardType;n.createOrderErrorMessage="";n.calculateTaxInfo()};n.getWarrantyString=function(t){for(var i=0;i<n.ordersView.orderResources.deviceWarranty.length;i++)if(t==n.ordersView.orderResources.deviceWarranty[i].key)return n.ordersView.orderResources.deviceWarranty[i].value;return t};n.calculateTaxInfo=function(){n.ChargebackFee>0&&n.deviceNewOrderInformation.LineItems[0].Price==0&&n.deviceNewOrderInformation.Shipments[0].Price==0||(n.deviceNewOrderInformation.OrderOperation=ht,n.calculateTaxCompleted=!1,c.calculateTax(n.deviceNewOrderInformation).then(function(t){if(n.calculateTaxCompleted=!0,t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.taxation=t;t.LineItems!=null&&(n.deviceNewOrderInformation.LineItems[0].Tax=t.LineItems[0].Tax);t.Shipments!=null&&(n.deviceNewOrderInformation.Shipments[0].Tax=t.Shipments[0].Tax,n.deviceNewOrderInformation.Shipments[0].Name=t.Shipments[0].Name,n.deviceNewOrderInformation.Shipments[0].LineItemRef=t.Shipments[0].LineItemRef);t.Payments!=null&&(n.deviceNewOrderInformation.Payments[0].Amount=t.Payments[0].Amount)}))};n.getPaymentsList=function(){b.getCommercePayments(n.selectedCountryShortCode).then(function(t){if(n.iFrameSuccessMessage="",t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;n.iFrameSuccessMessage=t.Message;return}n.paymentInformation=[];for(var i=0;i<t.length;i++)t[i].AccountNumberLastFour&&n.paymentInformation.push(t[i])})};n.getProblemTypesDescriptionList=function(t,i){c.getHardwareProblemTypes(t,i).then(function(t){if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.problemDescriptionsList=t;n.changeproductType(n.problemTypesFromCompass[0])})};n.getAccessoriesList=function(t,i){c.getHardwaregetAccessories(t,i).then(function(t){if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.accessoriesList=[];for(var i=0;i<t.length;i++)t[i].Name&&t[i].Name.trim()!=""&&n.accessoriesList.push(t[i]);n.changeproductType(n.problemTypesFromCompass[0])})};n.changeproductType=function(t){t&&(n.deviceOrderConfirmation.problemTypeDevice=t.value,t.name.toLowerCase()=="accessories"?(n.showDescriptionText=!1,n.deviceNewOrderInformation.LineItems[0].ItemAttributes=d,n.problemTypessList=n.accessoriesList):(n.showDescriptionText=!0,n.deviceNewOrderInformation.LineItems[0].ItemAttributes=nt,n.problemTypessList=n.problemDescriptionsList),n.deviceNewOrderInformation.LineItems[0].ProblemCode=null)};n.reset=function(){n.viewReady=!0;g?k.resolveAuthState().then(function(t){var i=k.getSupportedIDP();t===i.MSA&&(n.userSignedIn=!0,f.deviceId!=null&&n.getHardwareProfileInformation())}):(n.userSignedIn=a.authInfo.authStatus()==it?null:a.authInfo.isLoggedIn(),f.deviceId!=null&&n.userSignedIn==!0&&n.getHardwareProfileInformation())};g||(n.signInUrl=v.getUpdatedAuthenticationUrl(!0,!1));n.deviceRegistered=!1;n.seeAllDevices=function(){var n="SeeAllDevices",t=u.open({templateUrl:"/PartialViews/Devices/SeeAllDevicesModal.html",controller:"DevicesModalController",windowClass:"device-modal-seeall",resolve:{currentDevice:function(){return n}}})};n.abortRepairOrder=function(){var t="AbortRepairOrder",i=u.open({templateUrl:"/PartialViews/Devices/AbortRepairOrderModal.html",controller:"DevicesModalController",windowClass:"device-modal-seeall",resolve:{currentDevice:function(){return t}}});i.result.then(function(){n.createorderSteps(0,0);n.deviceAccessoryOffers=null;n.deviceAccessoryShippingOffers=null;n.deviceNewOrderInformation.Shipments[0].Price=0;n.deviceNewOrderInformation.Shipments[0].Tax=0;n.deviceNewOrderInformation.LineItems[0].Tax=0;n.deviceNewOrderInformation.LineItems[0].Price=0;n.deviceNewOrderInformation.Payments[0].Amount=0;n.deviceNewOrderInformation.LineItems[0].Sku=null;n.deviceNewOrderInformation.Shipments[0].Sku=null;n.paymentCardNumber=null;n.deviceNewOrderInformation.LineItems[0].ProblemCode=null;n.deviceAccessoryShippingOffers=null;n.deviceAccessoryOffers=null;n.paymentInformation=null;n.showPIDInfo=!1;n.pid.pidValue="";n.problemTypeSelected=null;n.deviceTempProblemTypes=null;n.xboxController=!1;n.xboxHeadset=!1;n.changeproductType(n.problemTypesFromCompass[0])})};n.toggleAddPaymentInstrument=function(){var t,i;n.showAddPaymentInstrument=!0;t=n.getUpdatedPcsIframePath(a.CommercePlatformConfig.PcsIFrameUrlFormat);t=n.getUpdatedPcsIframePath(t);n.pcsIframePath=e.trustAsResourceUrl(t);i=$("#device-center-pcs-iframe");i.show();i.attr("src",n.pcsIframePath);n.iFrameSuccessMessage=""};n.getUpdatedPcsIframePath=function(n){var t=n.replace(/hostUrlToReplace/g,r.host());return t.replace(/cpLocaleToReplace/g,y.langLocale())};n.BacktoDevicePage=function(){n.createorderSteps(0,0)};n.getDeviceFulfillmentEligibility=function(t,i,r){h.getHardwareFulfillmentEligibility(t,i,r).then(function(t){if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.bundleEligible=t[0].IsEligible;n.bundleContract=t[0].MatchedServiceContract!=null?!0:!1;switch(t[0].Reason){case"IWCount":n.HasMaxInWarrantyReached=!1;break;case"OWCount":n.HasMaxOutWarrantyReached=!1;break;case"IWOWCount":n.HasMaxInWarrantyReached=!1;n.HasMaxOutWarrantyReached=!1}n.HasMaxInWarrantyReached||t[0].MatchedServiceContract==null||(n.pidWarrantyStartDate=t[0].MatchedServiceContract.StartDate,n.pidWarrantyEndDate=t[0].MatchedServiceContract.EndDate);n.getAccessoryFulfillmentOffers(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.deviceNewOrderInformation.Brand,n.deviceNewOrderInformation.LineItems[0].DeviceKey.Key,n.deviceNewOrderInformation.LineItems[0].ProblemCode,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.PostalCode,y.langLocale())})};n.getGAVSuggestions=function(){n.userEnteredAddress=n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress;n.userEnteredAddress.CountryCode=n.userEnteredAddress.Country;c.getAddressSuggestions(n.userEnteredAddress.Address1,n.userEnteredAddress.Address2,n.userEnteredAddress.City,n.userEnteredAddress.StateOrProvince,n.userEnteredAddress.PostalCode,n.userEnteredAddress.Country).then(function(t){t.AutoCorrected===!1||t.AutoCorrected===!0&&t.AddressMatches.length==0?n.userAddressesGAVSuggestions(n.userEnteredAddress):t.AutoCorrected===!0&&t.AddressMatches.length>0?n.openGavModal():t.AutoCorrected===undefined&&t.Success===undefined?n.userAddressesGAVSuggestions(n.userEnteredAddress):n.openGavModal()})};n.openGavModal=function(){n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country==tt&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address1+=" "+n.deviceSpecialAddress.HouseNumber,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address2=n.deviceSpecialAddress.Neighbourhood+" "+n.deviceSpecialAddress.Complement);var t={Address1:n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address1,Address2:n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address2,City:n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.City,StateOrProvince:n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.StateOrProvince,PostalCode:n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.PostalCode,CountryCode:n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country},i=u.open({templateUrl:"/PartialViews/Devices/GavModal.html",controller:"DevicesModalController",windowClass:"device-modal-seeall",resolve:{currentDevice:function(){return t}}});i.result.then(function(t){n.userAddressesGAVSuggestions(t)})};n.userAddressesGAVSuggestions=function(t){n.deviceAccessoryOffers=null;n.deviceAccessoryShippingOffers=null;n.selectedGavAddressValue=t;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address1=t.Address1;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address2=t.Address2;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.City=t.City;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.State=t.State;t.State==null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.State=t.StateOrProvince);n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.PostalCode=t.PostalCode;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.ExtendedPostalCode=t.ExtendedPostalCode;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country=t.CountryCode;n.deviceNewOrderInformation.LineItems[0].ItemAttributes==d?n.pid.pidValue.length>0?n.problemTypeSelected.AccessorySku=="CustomController"?n.verifyPidData(n.currentDevice.Brand,n.deviceNewOrderInformation.LineItems[0].ProblemCode,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.pid.pidValue,!0):n.verifyPidData(n.currentDevice.Brand,n.deviceNewOrderInformation.LineItems[0].ProblemCode,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.pid.pidValue,!1):n.getDeviceFulfillmentEligibility(n.deviceNewOrderInformation.LineItems[0].DeviceKey.Key,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.deviceNewOrderInformation.LineItems[0].ProblemCode):n.getDeviceRepairOffers(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.deviceNewOrderInformation.Brand,n.deviceNewOrderInformation.LineItems[0].DeviceKey.Key,n.deviceNewOrderInformation.LineItems[0].ProblemCode,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.PostalCode,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.State,y.langLocale());n.wicSelectedState=n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.State;n.createorderSteps(1,2)};n.createorderSteps=function(t,i){n.createOrderErrorMessage=null;n.showWicLocations=!1;n.currentCreateOrderStep=i;t==3&&(n.showAddPaymentInstrument=!1,n.getPaymentsList());t==5&&i==4&&n.deviceNewOrderInformation.LineItems[0].Price==0&&n.deviceNewOrderInformation.Shipments[0].Price==0&&(n.currentCreateOrderStep=3);t==3&&i==4&&n.ChargebackFee==0&&n.deviceNewOrderInformation.LineItems[0].Price==0&&n.deviceNewOrderInformation.Shipments[0].Price==0&&(n.currentCreateOrderStep=5);(t==3&&i==2||t==1&&i==2)&&(n.deviceNewOrderInformation.LineItems[0].Sku=null);(t==4&&i==3||t==2&&i==3)&&(n.deviceNewOrderInformation.Shipments[0].Sku=null);(t==5&&i==4||t==3&&i==4)&&(n.paymentCardNumber=null)};n.allDevicesList=function(t){h.getHardwareForUser(t).then(function(i){if(i.Message&&i.Message.length>0){n.createOrderErrorMessage=i.Message;return}n.myDevicesList=i;n.myDevicesList.SerialNumber===t?(n.currentDevice=n.myDevicesList,n.deviceNewOrderInformation.LineItems[0].DeviceKey.Key=n.currentDevice.DeviceType=="IMEI"?n.currentDevice.DeviceType+":"+n.currentDevice.SerialNumber:n.currentDevice.SerialNumber,n.getDeviceEligibilities(n.currentDevice.SerialNumber,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country),n.getDeviceFulfillmentEligibilities(n.currentDevice.SerialNumber,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country),n.deviceNewOrderInformation.LineItems[0].DeviceKey.Type=n.currentDevice.ProductSku,n.deviceNewOrderInformation.Brand=n.currentDevice.Brand,n.deviceNewOrderInformation.ProductName=n.currentDevice.ProductName,n.deviceNewOrderInformation.Description=n.currentDevice.Description,n.deviceNewOrderInformation.Name=n.currentDevice.Name,n.getProblemTypesDescriptionList(n.currentDevice.ProductSku,y.langLocale()),n.cannotCreateOrderHelpLink=n.getProductHelpLink(n.currentDevice.Brand),n.getAccessoriesList(n.currentDevice.ProductSku,y.langLocale()),n.orderRefresh(n.currentDevice.DeviceType+":"+n.currentDevice.SerialNumber),n.selectDevice(n.currentDevice.SerialNumber,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,y.langLocale())):r.url("/devices/")})};n.canCreateOrder=n.isOpenDeviceRepairOrder&&n.accessoriesAvailable&&n.problemDescriptionsList&&n.accessoriesList&&!n.createOrderErrorMessage;n.getDeviceEligibilities=function(t,i){h.getHardwareRepairEligibility(t,i).then(function(t){if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.isOpenDeviceRepairOrder=!t[0].IsEligible;for(var i=0;i<n.problemTypesFromCompass.length;i++)n.isOpenDeviceRepairOrder==!0&&(n.problemTypesFromCompass[i].name=="hardware-and-drivers"&&n.problemTypesFromCompass.splice(i,1),n.problemTypesFromCompass[i].name=="accessories"&&(n.problemTypeDevice=n.problemTypesFromCompass[i],n.changeproductType(n.problemTypeDevice)));n.problemTypeDevice=n.problemTypesFromCompass[0]})};n.getDeviceFulfillmentEligibilities=function(t,i){h.getHardwareFulfillmentEligibility(t,i,"").then(function(t){if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.accessoriesAvailable=!t[0].IsEligible})};n.getProductHelpLink=function(t){if(n.ordersView){for(var i=0;i<n.ordersView.orderResources.productHelpLinks.length;i++)if(n.ordersView.orderResources.productHelpLinks[i].product==t)return n.ordersView.orderResources.productHelpLinks[i].helpUrl;return null}};n.selectDevice=function(t,i,r){h.getHardwareWarranty(t,i,r).then(function(t){if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.currentDeviceWarranty=t});n.updateSurfaceStudioCallbackMessage()};n.updateSurfaceStudioCallbackMessage=function(){var t=s.getCountryInfo(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.devicesView.geographiesXml);c.getSurfaceStudioModalities(t.ISOCountryShortCode).then(function(t){n.surfaceStudioSupportMessage=t&&t.tollfree&&t.tollfree.Phone?n.ordersView.orderDeviceStrings.surfaceStudioSupportedMessage+" "+t.tollfree.Phone:n.ordersView.orderDeviceStrings.surfaceStudioNotSupportedMessage})};n.orderRefresh=function(t){n.userSignedIn&&c.getOrderForDevice(t).then(function(t){if(t.Message&&t.Message.length>0)n.createOrderErrorMessage=t.Message;else{var r=[];for(n.deviceActiveOrderSummary=[],i=0;i<t.length;i++)r=[],n.deviceOrderDetails=t[i],t[i].LineItems[0].DeviceKey.Key==n.currentDevice.SerialNumber&&(n.deviceOrderDetails&&n.deviceActiveOrderSummary.push(n.deviceOrderDetails),t[i].LineItems[0].ItemAttributes==d&&(n.isOpenAccessoryRepairOrder=!0))}n.serviceOrderComplete=!0})};n.filteredOrderValues=function(){return n.ordersView.orderResources.filterOrderSteps?n.ordersView.orderResources.filterOrderSteps:[]};n.changeProblemTypes=function(t){if(t){if(n.descriptionMandatory=!1,n.canCreateOrder=!0,n.showPIDInfo=!1,n.xboxController=!1,n.xboxHeadset=!1,t.RequiresAssistance==!0){n.canCreateOrder=!1;return}if(n.problemTypeSelected=t,n.deviceNewOrderInformation.LineItems[0].ItemAttributes==d){t.Identifier!=null&&t.Identifier.ImageUrl!=""&&(n.showPIDInfo=!0);for(var i=0;i<n.accessoriesList.length;i++)n.accessoriesList[i].AccessorySku==rt&&(n.containsController35mm=!0),n.accessoriesList[i].AccessorySku==ut&&(n.containsHeadset35mm=!0);n.containsController35mm&&(t.AccessorySku==rt||t.AccessorySku==ct)&&(n.xboxController=!0);n.containsHeadset35mm&&(t.AccessorySku==ut||t.AccessorySku==lt)&&(n.xboxHeadset=!0);n.deviceNewOrderInformation.LineItems[0].ProblemCode=t.AccessorySku;n.deviceOrderConfirmation.ProblemName=t.Name}else t.Name==at&&(n.descriptionMandatory=!0),n.deviceNewOrderInformation.LineItems[0].ProblemCode=t.ProblemTypeId,n.deviceOrderConfirmation.ProblemName=t.Name}};n.canCancelOrder=function(t){return c.isStandardExchangeOrder(t)&&c.shippingEventRecieved(t,n.ordersView.orderResources)?!0:!1};n.getPrintShippingLabelApi=function(n){return"/api/devices/shippinglabel?incidentNumber="+n.IncidentNumber};n.isCpfIdPatternValid=function(){return n.deviceNewOrderInformation.CpfId.length>0&&!pt.test(n.deviceNewOrderInformation.CpfId)};n.shippingAddressComplete=function(){var t=n.deviceNewOrderInformation.Shipments[0].ShipTo;return t.CustomerName.First&&t.CustomerName.Last&&t.CustomerAddress.Address1&&(t.CustomerAddress.PostalCode||n.hideZipcodeStatus)&&(t.CustomerAddress.City||n.hideCityStatus)&&(t.CustomerAddress.StateOrProvince||n.hideStateStatus)&&t.CustomerAddress.Country&&t.PhoneNumber.Number&&t.Email?t.CustomerAddress.Country==tt?n.deviceNewOrderInformation.CpfId.length>0&&!n.isCpfIdPatternValid()&&n.deviceSpecialAddress.Neighbourhood.length>0&&n.deviceSpecialAddress.Complement.length>0&&n.deviceSpecialAddress.HouseNumber.length>0?!1:!0:!1:!0};n.getOrderDetails=function(t){n.userSignedIn&&c.getOrderDetailsForIncident(t).then(function(r){var f,u;if(r.Message&&r.Message.length>0)n.createOrderErrorMessage=r.Message;else for(i=0;i<n.deviceActiveOrderSummary.length;i++)if(n.deviceActiveOrderSummary[i].IncidentNumber==t){for(n.deviceActiveOrderSummary[i].ShippLabel=r.ShippLabel,n.deviceActiveOrderSummary[i].OrderSequence=[],n.deviceActiveOrderSummary[i].OrderSequence.push(n.updateOrderStepDescriptions(r.OrderSequence)),n.deviceActiveOrderSummary[i].OrderSequence[0].CurrentStep<0&&(n.deviceActiveOrderSummary[i].OrderSequence[0].CurrentStep=0),f=n.deviceActiveOrderSummary[i].OrderSequence[0].OrderSteps[n.deviceActiveOrderSummary[i].OrderSequence[0].CurrentStep],u=r.OrderSequence.OrderSteps.length-1;u>=0;u--)n.filteredOrderValues().indexOf(r.OrderSequence.OrderSteps[u].StepId)>=0&&(n.deviceActiveOrderSummary[i].OrderSequence[0].OrderSteps.splice(u,1),f.StepId==n.deviceActiveOrderSummary[i].OrderSequence[0].OrderSteps[u].StepId&&n.deviceActiveOrderSummary[i].OrderSequence[0].CurrentStep--);for(u=0;u<n.deviceActiveOrderSummary[i].OrderSequence[0].OrderSteps.length;u++)f.StepId==n.deviceActiveOrderSummary[i].OrderSequence[0].OrderSteps[u].StepId&&(n.deviceActiveOrderSummary[i].OrderSequence[0].CurrentStep=u)}})};n.updateOrderStepDescriptions=function(t){for(var r,i=0;i<t.OrderSteps.length;i++)for(r=0;r<n.ordersView.orderResources.orderSequenceSteps.length;r++)t.OrderSteps[i].StepId==n.ordersView.orderResources.orderSequenceSteps[r].stepId&&(t.OrderSteps[i].Description=n.ordersView.orderResources.orderSequenceSteps[r].description);return t};n.isSurfaceStudio=function(t){if(n.surfaceStudioProdcutTypeList.indexOf(t)>-1)return!0};n.cancelServiceOrder=function(t){var i=u.open({templateUrl:"/PartialViews/Devices/CancelRepairOrderModal.html",controller:"DevicesModalController",windowClass:"device-modal-seeall",resolve:{currentDevice:function(){return{incidentNumber:t,hardwareId:n.userProfileInformation.HardwareCustomerId}}}});i.result.then(function(){n.orderRefresh(f.deviceId)})};n.Signin=function(){if(g){var n=k.getSupportedIDP();k.login(n.MSA)}else t.location.href=v.getUpdatedAuthenticationUrl(!0,!1)};n.$on("UserSignedOut",function(){n.userSignedIn=!1});n.processCreateorder=function(){n.deviceNewOrderInformation.LineItems[0].ItemAttributes==d&&(n.deviceNewOrderInformation.LineItems[0].ProblemCode="");n.deviceNewOrderInformation.OrderOperation=null;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country!=tt&&(n.deviceNewOrderInformation.CpfId="");n.createOrderProcessCompleted=!1;c.createNewOrder(n.deviceNewOrderInformation).then(function(t){if(n.createOrderProcessCompleted=!0,t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.orderResponseObject=t;n.currentCreateOrderStep=6})};n.updateStateList=function(){var i,t;if(n.devicesView&&n.devicesView.geographiesXml){for(n.selectedCountryInformation=s.getCountryInfo(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.devicesView.geographiesXml),n.selectedCountryShortCode=n.selectedCountryInformation.ISOCountryShortCode,n.statesList=s.getStates(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.devicesView.geographiesXml),i=!1,t=0;t<n.statesList.length;t++)n.statesList[t].code==n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.StateOrProvince&&(i=!0);i||(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.StateOrProvince=null)}};n.hideState=function(t){return(n.hideStateStatus=!1,s.isStateRequired(t,n.devicesView.geographiesXml))?!1:(n.hideStateStatus=!0,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.StateOrProvince=null,n.wicSelectedState=null,!0)};n.verifyPidData=function(t,i,r,u,f){f?(documentNumber=u.substring(0,u.length-6),itemNumber=u.substring(u.length-6,u.length),n.deviceNewOrderInformation.SalesDocument={},n.deviceNewOrderInformation.SalesDocument.DocumentNumber=documentNumber,n.deviceNewOrderInformation.SalesDocument.ItemNumber=itemNumber,h.getCustomControllerWarranty(t,i,r,u,documentNumber,itemNumber).then(function(t){if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.accessorywarrantyInformation=t;n.pidWarrantyStartDate=t[0].StartDate;n.pidWarrantyEndDate=t[0].EndDate;n.getAccessoryFulfillmentOffers(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.deviceNewOrderInformation.Brand,n.deviceNewOrderInformation.LineItems[0].DeviceKey.Key,n.deviceNewOrderInformation.LineItems[0].ProblemCode,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.PostalCode,y.langLocale())})):h.getAccessoryWarranty(t,i,r,u).then(function(t){if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.accessorywarrantyInformation=t;n.pidWarrantyStartDate=t[0].StartDate;n.pidWarrantyEndDate=t[0].EndDate;n.getAccessoryFulfillmentOffers(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.deviceNewOrderInformation.Brand,n.deviceNewOrderInformation.LineItems[0].DeviceKey.Key,n.deviceNewOrderInformation.LineItems[0].ProblemCode,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.PostalCode,y.langLocale())})};n.hideCity=function(t){return(n.hideCityStatus=!1,s.isCityRequired(t,n.devicesView.geographiesXml))?!1:(n.hideCityStatus=!0,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.City=null,!0)};n.hideZipcode=function(t){return(n.hideZipcodeStatus=!1,s.isZipcodeRequired(t,n.devicesView.geographiesXml))?!1:(n.hideZipcodeStatus=!0,!0)};n.showBrazilData=function(n){return n!=tt?!1:!0};o.$on("AddPaymentCPStatusError",function(){var i=$("#device-center-pcs-iframe"),t;i.hide();n.iFrameSuccessMessage=n.ordersView.failedToAddCard;t=n.getUpdatedPcsIframePath(a.CommercePlatformConfig.PcsIFrameUrlFormat);t=n.getUpdatedPcsIframePath(t);n.pcsIframePath=e.trustAsResourceUrl(t)});o.$on("AddPaymentCPStatusCancel",function(){var i=$("#device-center-pcs-iframe"),t;i.hide();n.iFrameSuccessMessage=n.ordersView.canceledAddingNewCard;t=n.getUpdatedPcsIframePath(a.CommercePlatformConfig.PcsIFrameUrlFormat);t=n.getUpdatedPcsIframePath(t);n.pcsIframePath=e.trustAsResourceUrl(t)});o.$on("AddPaymentCPStatusSuccess",function(){var t=$("#device-center-pcs-iframe");t.hide();n.iFrameSuccessMessage="**Added new card Successfully..!";n.getPaymentsList()});n.$on("CompassContentReady",function(){var t=p.getDevicesView(),i,r;t&&(n.devicesView=t);i=p.getOrdersView();i&&(n.ordersView=i,n.problemTypesFromCompass=n.ordersView.deviceProblemList.issueTypes,n.changeproductType(n.problemTypesFromCompass[0]));r=p.getDeviceRegistrationView();r&&(n.deviceRegistrationView=r);t&&t.geographiesXml&&(n.countriesListForRegistration=s.getCountries(t.geographiesXml,"register",n.ordersView.orderResources),n.countriesListForOrder=s.getCountries(t.geographiesXml,"order",n.ordersView.orderResources),n.surfaceStudioProdcutTypeList=n.devicesView.surfaceStudioProducttypeList)});n.reset()}}])}(angular.module(microsoft.support.moduleName)),function(n){n.factory("devicesErrorInterceptor",["$rootScope","$q",function(n,t){var i={},r=[/api\/devices\/PaymentInstruments/i];return i.response=function(n){var i=r.filter(function(t){return n&&n.config&&n.config.url.match(t)!==null}).length>0;return i&&n&&n.data&&n.data.Message&&n.data.Message.indexOf("Error Code")>-1?t.reject(n):n},i}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("devicesErrorMessageService",["clientConfig","compassService","correlationVectorService",function(n,t,i){this.getErrorMessage=function(n){for(var f=t.getOrdersView(),u=f.orderResources.errors,r=0;r<u.length;r++)if(u[r].code==n)return u[r].message+" ("+i.getValue()+")";return f.errorMessage+" ("+i.getValue()+")"}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("DevicesModalController",["$scope","$uibModal","$location","$uibModalInstance","$window","filterFilter","languageService","hardwareService","orderService","currentDevice","geographyService","compassService",function(n,t,i,r,u,f,e,o,s,h,c,l){n.currentDevice=h;n.AcceptedEspTerms=!1;n.chkAcceptTerms=!1;n.enableRegisterDevice=!1;n.registerDeviceInProgress=!1;n.helpFindSerialNumberCollapsed=!0;var a="Band",v="PersonalDevices";n.init=function(){var t=l.getDevicesView(),i,r;t&&(n.devicesView=t);i=l.getOrdersView();i&&(n.ordersView=i);r=l.getDeviceRegistrationView();r&&(n.deviceRegistrationView=r);n.countriesListForRegistration=c.getCountries(t.geographiesXml,"register",n.ordersView.orderResources);o.getHardwareForUser().then(function(t){n.myDevicesList=t});n.getGAVSuggestions=function(){n.userEnteredAddress=n.currentDevice;s.getAddressSuggestions(n.userEnteredAddress.Address1,n.userEnteredAddress.Address2,n.userEnteredAddress.City,n.userEnteredAddress.StateOrProvince,n.userEnteredAddress.PostalCode,n.userEnteredAddress.CountryCode).then(function(t){n.addressValidation=t})}};n.productFamiliesList=function(){for(var i=[],r=n.deviceRegistrationView.serialNumberImages,t=0;t<r.length;t++)i.indexOf(r[t].productFamily)>-1||i.push(r[t].productFamily);return i};n.deviceTypeList=function(t){for(var u=[],r=n.deviceRegistrationView.serialNumberImages,i=0;i<r.length;i++)r[i].productFamily!=t||u.indexOf(r[i].productSku)>-1||u.push(r[i].productSku);return u};n.getSerialNumberImage=function(t,i){for(var u=n.deviceRegistrationView.serialNumberImages,r=0;r<u.length;r++)if(u[r].productFamily==t&&u[r].productSku==i)return u[r].serialNumberImage.url;return null};n.registerDeviceEnable=function(){return n.selectedCountryName&&n.chkAcceptTerms&&n.registerSerialNumber&&n.selectedProductFamily?!0:(n.registerErrorMessage="",!1)};n.$watch("selectedProductFamily",function(){n.selectedDeviceType=""});n.checkEspEligiblity=function(){brand=n.selectedProductFamily==a?v:n.selectedProductFamily;n.getDeviceEspEligibility(n.registerSerialNumber,n.selectedCountryName,brand)};n.getDeviceEspEligibility=function(t,i,r){n.registerDeviceInProgress=!0;o.getHardwareEspWarranty(t,i,r).then(function(t){if(n.registerDeviceInProgress=!1,t.Message&&t.Message.length>0){n.registerErrorMessage=t.Message;return}n.espEligibleDevice=f(t,{WarrantyType:"ExtendedServicePlan"});n.espEligibleDevice.length>0&&!n.espEligibleDevice[0].TermsFulfilled?n.openEspTermsModal():n.registerDevice()})};n.openEspTermsModal=function(){var i=t.open({templateUrl:"/PartialViews/Devices/EspTermsModal.html",controller:"EspModalController"});i.result.then(function(){n.AcceptedEspTerms=!0;n.registerDevice()},function(){n.AcceptedEspTerms=!1})};n.cancel=function(){r.dismiss("cancel")};n.openUnregisterModal=function(i){var r=t.open({templateUrl:"/PartialViews/Devices/UnregisterDeviceModal.html",controller:"DevicesModalController",windowClass:"device-modal-window",resolve:{currentDevice:function(){return i}}});r.result.then(function(){n.init()})};n.closeAbortRepairOrder=function(){r.close()};n.closeCancelRepairOrder=function(t){n.cancelServiceOrderDetails=s.getDeviceCancelOrder();n.registerDeviceInProgress=!0;n.cancelServiceOrderDetails.IncidentNumber=t.incidentNumber;n.cancelServiceOrderDetails.HardwareCustomerId=t.hardwareId;s.cancelOrder(t.hardwareId,t.incidentNumber).then(function(t){if(n.registerDeviceInProgress=!1,t.Message&&t.Message.length>0){n.cancelOrderErrorMessage=t.Message;return}n.cancelOrderStatus=t;r.close()})};n.closeGavModal=function(){r.close(n.selectedAddress)};n.selectGavAddress=function(t){n.selectedAddress=t};n.unregisterDevice=function(t,i){n.registerDeviceInProgress=!0;o.unregisterHardwareForUser(t,i).then(function(t){if(n.registerDeviceInProgress=!1,t.Message&&t.Message.length>0){n.unregisterErrorMessage=t.Message;return}n.unRegisterStatus=t;r.close()})};n.registerDevice=function(){registerSerialNumber=n.registerSerialNumber;countryName=n.selectedCountryName;brand=n.selectedProductFamily==a?v:n.selectedProductFamily;n.registerDeviceInProgress=!0;o.registerHardwareForUser(registerSerialNumber,countryName,brand).then(function(t){if(n.registerDeviceInProgress=!1,n.registerDeviceStatus=t,t.Message&&t.Message.length>0){n.showInvalidSerialNumber=!0;n.registerErrorMessage=t.Message;return}n.deviceRegistered=!1;r.close()},function(){n.registerErrorMessage=strInvalidSerialNumber})};n.SelectDevice=function(n){r.close();i.path("/"+e.langLocale().toLowerCase()+"/products/"+n.Brand+"/")};n.helpFindSerialNumber=function(){n.helpFindSerialNumberCollapsed=!n.helpFindSerialNumberCollapsed;n.selectedProductFamily=="Phones"?u.open(n.deviceRegistrationView.lumiaSerialNumberLink.linkUrl,"_blank"):n.deviceRegistered=!n.deviceRegistered};n.init()}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("EspModalController",["$scope","$uibModal","$uibModalInstance","compassService",function(n,t,i,r){n.init=function(){var t=r.getDeviceRegistrationView();t&&(n.deviceRegistrationView=t)};n.acceptEspTerms=function(){n.AcceptedEspTerms=!0;i.close()};n.cancel=function(){i.dismiss("cancel")};n.init()}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("geographyService",["clientConfig",function(){function n(n,t){for(var i,r=0;r<t.xmlDocument.Geographies.Geography.length;r++)if(i=t.xmlDocument.Geographies.Geography[r],i.ISOType=="country"&&i.ISOCode==n)return i;return null}function t(n,t){for(var i,r=0;r<t.xmlDocument.Geographies.Geography.length;r++)if(i=t.xmlDocument.Geographies.Geography[r],i.ISOType=="country"&&i.ISOCode==n)return i.ISOCountryNumber;return null}this.getCountries=function(n,t,i){for(var e=[],r,u,f=0;f<n.xmlDocument.Geographies.Geography.length;f++)r=n.xmlDocument.Geographies.Geography[f],r.ISOType=="country"&&(u={},u.code=r.ISOCode,u.name=r.ISOName,u.shortCode=r.ISOCountryShortCode,(t!="order"||i.supportedCountries.indexOf(r.ISOCountryShortCode)>-1)&&e.push(u));return e};this.getKinectAdapterCountries=function(n,t,i,r){for(var o=[],u,f,e=0;e<n.xmlDocument.Geographies.Geography.length;e++)u=n.xmlDocument.Geographies.Geography[e],u.ISOType=="country"&&(f={},f.code=u.ISOCode,f.name=u.ISOName,f.shortCode=u.ISOCountryShortCode,r.indexOf(f.code)>-1&&(t!="order"||i.supportedCountries.indexOf(u.ISOCountryShortCode)>-1)&&o.push(f));return o};this.getStates=function(n,i){for(var o=["state","union territories","province","metropolitan city","capital metropolitan city","city","territory","federal lander","district","region","department","federal district","administrative unit","counsel area","municipality","autonomous Geography","capital district","county","metropolitan department","metropolitan region","overseas territory","overseas region/department","territorial collective","lander","administrative region","special administrative region","city of county right","parish","prefecture","commune","local council","special territory","indigenous region","capital","constitutional province","autonomous region","republic","autonomous district","administrative territory","autonomous city","autonomous community","major north african location","canton","emirate","district counsel area","unitary authority","counsel area","federal dependency"],e=[],r,u,s=t(n,i),f=0;f<i.xmlDocument.Geographies.Geography.length;f++)r=i.xmlDocument.Geographies.Geography[f],parseInt(r.ISOCountryNumber,10)==parseInt(s,10)&&o.indexOf(r.ISOType)>-1&&r.ISOName&&(u={},u.code=r.ISOCode,u.name=r.ISOName,e.push(u));return e};this.isCityRequired=function(t,i){var r=n(t,i);return r&&r["@displayCity"]&&r["@displayCity"]=="false"?!1:!0};this.isStateRequired=function(t,i){var r=n(t,i);return r&&r["@displayState"]&&r["@displayState"]=="false"?!1:!0};this.isZipcodeRequired=function(t,i){var r=n(t,i);return r&&(r["@displayZipcode"]&&r["@displayZipcode"]=="false"||r["@optionalZipcode"]&&r["@optionalZipcode"]=="true")?!1:!0};this.getCountryInfo=function(t,i){return n(t,i)}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("hardwareService",["$http","$q","$log","clientConfig","devicesErrorMessageService",function(n,t,i,r,u){function o(n){return n.data}function e(n){try{return JSON.parse(n.data)}catch(i){return f(n.data)}}function f(n){var i={},t={};try{n.data!=null&&(t=JSON.parse(n.data).ErrorCode)}catch(r){t=0}return i.Message=u.getErrorMessage(t),i}function s(n){var t=JSON.parse(n.data);return t!=null&&t.forEach(function(n){var t,u;if(n!=null){var i=new Date(n.EndDate),f=new Date(n.StartDate),r=i-(new Date).getTime();r<=0?(n.RemainingYears=0,n.RemainingMonths=0):(t=Math.round(r/864e5),n.RemainingYears=i.getFullYear()-f.getFullYear(),n.RemainingMonths=t/30,n.RemainingDays=t,u=100-n.RemainingMonths*100/12,n.progressPercentage="width: "+u+"%")}}),t}this.getHardwareForUser=function(t){var i={params:{serialNumber:t,dateParam:(new Date).getTime()}};return n.get("/api/devices/hardware/",i).then(e,f)};this.getHardwareWarranty=function(t,i,r){var u={params:{serialNumber:t,country:i,language:r}};return n.get("/api/devices/HardwareWarranty/",u).then(s,f)};this.getHardwareEspWarranty=function(t,i,r){var u={params:{serialNumber:t,country:i,brand:r}};return n.get("/api/devices/HardwareEspWarranty/",u).then(e,f)};this.getHardwareRepairEligibility=function(t,i){var r={params:{serialNumber:t,country:i}};return n.get("/api/devices/DeviceRepairEligibility/",r).then(e,f)};this.getHardwareFulfillmentEligibility=function(t,i,r){var u={params:{serialNumber:t,country:i,accessoryType:r}};return n.get("/api/devices/DeviceFulfillmentEligibility/",u).then(e,f)};this.getAccessoryWarranty=function(t,i,r,u){var o={params:{brand:t,accessoryType:i,country:r,serialNumber:u}};return n.get("/api/devices/AccessoryWarranty/",o).then(e,f)};this.getCustomControllerWarranty=function(t,i,r,u,o,s){var h={params:{brand:t,accessoryType:i,country:r,deviceSerialNumber:u,documentNumber:o,itemNumber:s}};return n.get("/api/devices/CustomControllerWarranty/",h).then(e,f)};this.unregisterHardwareForUser=function(t,i){var r={params:{serialNumber:t,country:i}};return n.delete("/api/devices/UnregisterHardware/",r).then(e,f)};this.registerHardwareForUser=function(t,i,r){var u={params:{serialNumber:t,country:i,brand:r}};return n.put("/api/devices/RegisterHardware/",u.params).then(o,f)}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("KinectAdapterController",["$scope","$window","$location","$uibModal","$routeParams","$sce","$rootScope","geographyService","hardwareService","orderService","flightService","clientConfig","authenticationHelperService","languageService","compassService","profileService","paymentService","authService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){var tt;if(n.kinectAdapterFlightEnabled=c.isUserInFlight("fka-1"),n.kinectAdapterFlightEnabled){var k=c.isUserInFlight("aad-1"),d="Fulfillment",g="BRA",it="NCA(Metadata)",nt="81212(Products)";n.strAdapterAccessorySkuName="WindowsHub";tt=2;n.userSignedIn=null;n.viewReady=!1;n.selecteddevice=[];n.selecteddevice.deviceInfo=null;n.selecteddevice.selectedXboxOneS=null;n.selecteddevice.selectedXboxOne=null;n.selecteddevice.selectedKinect=null;n.selecteddevice.FreeAdapterOfferAlreadyUsed=null;n.selecteddevice.myDevicesList=[];n.chkDeviceOrderCheckAcceptTerms=!1;n.chkDeviceOrderPaymentTerms=!1;n.deviceNewOrderInformation=h.getNewDeviceOrder();n.cancelServiceOrderDetails=h.getDeviceCancelOrder();n.deviceWicLocationInfo=h.getWicLocationInformation();n.currentCreateOrderStep=1;n.showWicLocations=!1;n.deviceActiveOrderSummary=[];n.showDescriptionText=!1;n.pid={};n.pid.pidValue="";n.paymentCardNumber=null;n.paymentCardType=null;n.problemTypessList="";n.deviceShippingEmail=null;n.deviceOrderConfirmation={};n.deviceOrderConfirmation.problemTypeDevice=null;n.deviceSpecialAddress=[];n.deviceSpecialAddress.HouseNumber="";n.deviceSpecialAddress.Complement="";n.deviceSpecialAddress.Neighbourhood="";k?n.$on("UserSignedInMSA",function(){n.userSignedIn=!0;n.reset()}):n.$on("UserSignedIn",function(){l.authInfo.authState==1&&(n.userSignedIn=!0,n.reset())});n.getAccessoryFulfillmentOffers=function(t,i,r,u,f){h.getHardwareAccessoryFulfillmentOffers(t,i,r,u,f).then(function(t){if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}if(t.Messages.length>0&&t.Offers.length<=0){n.selecteddevice.offersNotReturnedFromSOM=!0;return}for(var i=0;i<t.Offers.length;i++)t.Offers[i].Sku==nt&&(n.deviceNewOrderInformation.LineItems[0].Sku=t.Offers[i].Sku,n.deviceNewOrderInformation.Currency=t.Offers[i].Currency,n.deviceNewOrderInformation.LineItems[0].Description=t.Offers[i].Name,n.deviceNewOrderInformation.Payments[0].PaymentOption=t.Offers[i].PaymentOption,n.deviceNewOrderInformation.LineItems[0].ItemAttributes=d,n.getFulfillmentShippingOffers(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.deviceNewOrderInformation.Brand,n.deviceNewOrderInformation.LineItems[0].DeviceKey.Key,n.deviceNewOrderInformation.LineItems[0].ProblemCode,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.PostalCode,n.deviceNewOrderInformation.LineItems[0].Sku))})};n.getFulfillmentShippingOffers=function(t,i,r,u,f,e){h.getHardwareFulfillmentShippingOffers(t,i,r,u,f,e).then(function(t){if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}if(t.Messages.length>0&&t.Offers.length<=0){n.selecteddevice.offersNotReturnedFromSOM=!0;return}for(var i=0;i<t.Offers.length;i++)t.Offers[i].Sku==it&&(n.deviceNewOrderInformation.Shipments[0].Sku=t.Offers[i].Sku)})};n.getHardwareProfileInformation=function(){p.getUserHardwareProfile().then(function(t){if(!t.Message||!(t.Message.length>0)){for(var i=0;i<n.countriesListForOrder.length;i++)if(n.countriesListForOrder[i].code==t.Addresses[0].CountryCode){n.userProfileInformation=t;n.customerDetailsInfo();return}n.NotSupportedCountry=!0;n.currentUserCountry=t.Addresses[0].CountryName}})};n.customerDetailsInfo=function(){l.authInfo!=null&&(k?(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerName.First=b.getUserInfo().firstName,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerName.Last=b.getUserInfo().lastName,n.deviceNewOrderInformation.Puid=JSON.stringify(parseInt(b.getUserInfo().puid,16)),n.deviceNewOrderInformation.Shipments[0].ShipTo.Email.push(b.getUserInfo().email)):(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerName.First=l.authInfo.firstName,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerName.Last=l.authInfo.lastName,n.deviceNewOrderInformation.Puid=JSON.stringify(parseInt(l.authInfo.puid,16)),n.deviceNewOrderInformation.Shipments[0].ShipTo.Email.push(l.authInfo.displayName)),n.userProfileInformation.ContactNumbers[0].CountryCode!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number=n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number+n.userProfileInformation.ContactNumbers[0].CountryCode),n.userProfileInformation.ContactNumbers[0].AreaCode!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number=n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number+" ("+n.userProfileInformation.ContactNumbers[0].AreaCode+") "),n.userProfileInformation.ContactNumbers[0].Number!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number=n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number!=null?n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number+n.userProfileInformation.ContactNumbers[0].Number:n.userProfileInformation.ContactNumbers[0].Number),n.userProfileInformation.ContactNumbers[0].Extension!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number=n.deviceNewOrderInformation.Shipments[0].ShipTo.PhoneNumber.Number+" x"+n.userProfileInformation.ContactNumbers[0].Extension),n.userProfileInformation.Addresses[0].Address1!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address1=n.userProfileInformation.Addresses[0].Address1),n.userProfileInformation.Addresses[0].Address2!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address2=n.userProfileInformation.Addresses[0].Address2),n.userProfileInformation.Addresses[0].City!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.City=n.userProfileInformation.Addresses[0].City),n.userProfileInformation.Addresses[0].RegionCode!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.StateOrProvince=n.userProfileInformation.Addresses[0].RegionCode),n.userProfileInformation.Addresses[0].CountryCode!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country=n.userProfileInformation.Addresses[0].CountryCode,n.updateStateList()),n.userProfileInformation.Addresses[0].PostalCode!=null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.PostalCode=n.userProfileInformation.Addresses[0].PostalCode))};n.getAccessoriesList=function(t){h.getHardwaregetAccessories(t).then(function(t){if(t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}for(var i=0;i<t.length;i++)t[i].AccessorySku==n.strAdapterAccessorySkuName&&(n.accessoryFound=!0,n.deviceNewOrderInformation.LineItems[0].ProblemCode=t[i].AccessorySku,n.getAccessoryFulfillmentOffers(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.deviceNewOrderInformation.Brand,n.deviceNewOrderInformation.LineItems[0].DeviceKey.Key,n.deviceNewOrderInformation.LineItems[0].ProblemCode,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.PostalCode));n.accessoryFound||(n.selecteddevice.offersNotReturnedFromSOM=!0)})};n.reset=function(){n.viewReady=!0;k?b.resolveAuthState().then(function(t){var i=b.getSupportedIDP();n.userSignedIn=t===i.MSA?!0:!1}):n.userSignedIn=l.authInfo.authStatus()==tt?null:l.authInfo.isLoggedIn();n.userSignedIn==!0&&(n.getHardwareProfileInformation(),n.orderRefresh(""))};n.abortRepairOrder=function(){var t="AbortRepairOrder",i=r.open({templateUrl:"/PartialViews/Devices/AbortRepairOrderModal.html",controller:"DevicesModalController",windowClass:"device-modal-seeall",resolve:{currentDevice:function(){return t}}});i.result.then(function(){n.createorderSteps(0,0);n.deviceAccessoryOffers=null;n.deviceAccessoryShippingOffers=null;n.deviceNewOrderInformation.Shipments[0].Price=0;n.deviceNewOrderInformation.Shipments[0].Tax=0;n.deviceNewOrderInformation.LineItems[0].Tax=0;n.deviceNewOrderInformation.LineItems[0].Price=0;n.deviceNewOrderInformation.Payments[0].Amount=0;n.deviceNewOrderInformation.LineItems[0].Sku=null;n.deviceNewOrderInformation.Shipments[0].Sku=null;n.paymentCardNumber=null;n.deviceNewOrderInformation.LineItems[0].ProblemCode=null;n.deviceAccessoryShippingOffers=null;n.deviceAccessoryOffers=null;n.paymentInformation=null;n.showPIDInfo=!1;n.pid.pidValue="";n.problemTypeSelected=null;n.deviceTempProblemTypes=null;n.changeproductType(n.problemTypeDevice)})};n.openGavModal=function(){n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country==g&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address1+=" "+n.deviceSpecialAddress.HouseNumber,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address2=n.deviceSpecialAddress.Neighbourhood+" "+n.deviceSpecialAddress.Complement);var t={Address1:n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address1,Address2:n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address2,City:n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.City,StateOrProvince:n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.StateOrProvince,PostalCode:n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.PostalCode,CountryCode:n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country},i=r.open({templateUrl:"/PartialViews/Devices/GavModal.html",controller:"DevicesModalController",windowClass:"device-modal-seeall",resolve:{currentDevice:function(){return t}}});i.result.then(function(t){n.deviceAccessoryOffers=null;n.deviceAccessoryShippingOffers=null;n.selectedGavAddressValue=t;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address1=t.Address1;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Address2=t.Address2;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.City=t.City;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.State=t.State;t.State==null&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.State=t.StateOrProvince);n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.PostalCode=t.PostalCode;n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country=t.CountryCode;n.deviceNewOrderInformation.LineItems[0].ItemAttributes=d;n.createorderSteps(1,2)},function(){n.shippingAddressComplete()})};n.createorderSteps=function(t,i){if(n.createOrderErrorMessage=null,n.showWicLocations=!1,n.previousCreateOrderStep=i-1,n.currentCreateOrderStep=i,n.nextCreateOrderStep=i+1,i==2&&(n.selecteddevice.myDevicesList.length=0,n.productSkuName=n.strXboxOneSSkuName),t==2&&i==3){if(n.currentUserOrders)for(var r=0;r<n.currentUserOrders.length;r++)if(n.currentUserOrders[r].LineItems[0].DeviceKey.Key==n.selecteddevice.deviceInfo.SerialNumber&&nt.indexOf(n.currentUserOrders[r].LineItems[0].Sku)>-1){n.selecteddevice.FreeAdapterOfferAlreadyUsed=n.ordersView.oneAdapterClaimAlert;n.selecteddevice.selectedXboxOneS=!1;n.currentCreateOrderStep=2;return}n.selecteddevice.myDevicesList.length=0;n.productSkuName=n.strXboxOneSkuName;n.kinectAdapterAccessory=n.getAccessoriesList(n.selecteddevice.deviceInfo.ProductSku);n.deviceNewOrderInformation.Brand=n.selecteddevice.deviceInfo.Brand;n.deviceNewOrderInformation.LineItems[0].DeviceKey.Key=n.selecteddevice.deviceInfo.SerialNumber;n.deviceNewOrderInformation.LineItems[0].DeviceKey.Type=n.selecteddevice.deviceInfo.ProductSku}t!=2&&i==3&&(n.selecteddevice.myDevicesList.length=0,n.productSkuName=n.strXboxOneSkuName,n.deviceNewOrderInformation.Brand=n.selecteddevice.deviceInfo.Brand,n.deviceNewOrderInformation.LineItems[0].DeviceKey.Key=n.selecteddevice.deviceInfo.SerialNumber,n.deviceNewOrderInformation.LineItems[0].DeviceKey.Type=n.selecteddevice.deviceInfo.ProductSku);i==4&&(n.selecteddevice.myDevicesList.length=0,n.productSkuName=n.strKinectSkuName);n.previousCreateOrderStep==1&&n.nextCreateOrderStep==3&&(n.selecteddevice.selectedXboxOneS=!1);n.previousCreateOrderStep==2&&n.nextCreateOrderStep==4&&(n.selecteddevice.selectedXboxOne=!1);n.previousCreateOrderStep==3&&n.nextCreateOrderStep==5&&(n.selecteddevice.selectedKinect=!1)};n.orderRefresh=function(t){n.userSignedIn&&h.getKinectAdapterOrderForDevice(t).then(function(t){if(n.serviceOrderComplete=!0,t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.currentUserOrders=t})};n.shippingAddressComplete=function(){var t=n.deviceNewOrderInformation.Shipments[0].ShipTo;return t.CustomerName.First&&t.CustomerName.Last&&t.CustomerAddress.Address1&&(t.CustomerAddress.PostalCode||n.hideZipcodeStatus)&&(t.CustomerAddress.City||n.hideCityStatus)&&(t.CustomerAddress.StateOrProvince||n.hideStateStatus)&&t.CustomerAddress.Country&&t.PhoneNumber.Number&&t.Email[0]?!1:!0};n.Signin=function(){if(k){var n=b.getSupportedIDP();b.login(n.MSA)}else t.location.href=a.getUpdatedAuthenticationUrl(!0,!1)};n.$on("UserSignedOut",function(){n.userSignedIn=!1});n.processCreateorder=function(){n.deviceNewOrderInformation.LineItems[0].ItemAttributes==d&&(n.deviceNewOrderInformation.LineItems[0].ProblemCode="");n.deviceNewOrderInformation.OrderOperation=null;n.createOrderProcessCompleted=!1;h.createNewOrder(n.deviceNewOrderInformation).then(function(t){if(n.createOrderProcessCompleted=!0,t.Message&&t.Message.length>0){n.createOrderErrorMessage=t.Message;return}n.orderResponseObject=t;n.currentCreateOrderStep=6})};n.updateStateList=function(){n.devicesView&&n.devicesView.geographiesXml&&(n.selectedCountryInformation=o.getCountryInfo(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.devicesView.geographiesXml),n.selectedCountryShortCode=n.selectedCountryInformation.ISOCountryShortCode,n.statesList=o.getStates(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.Country,n.devicesView.geographiesXml),n.selectedCountryShortCode!=n.userProfileInformation.Addresses[0].Iso2CountryCode&&(n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.StateOrProvince=null))};n.hideState=function(t){return t?(n.hideStateStatus=!1,o.isStateRequired(t,n.devicesView.geographiesXml))?!1:(n.hideStateStatus=!0,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.StateOrProvince=null,n.wicSelectedState=null,!0):!1};n.hideCity=function(t){return t?(n.hideCityStatus=!1,o.isCityRequired(t,n.devicesView.geographiesXml))?!1:(n.hideCityStatus=!0,n.deviceNewOrderInformation.Shipments[0].ShipTo.CustomerAddress.City=null,!0):!1};n.hideZipcode=function(t){return t?(n.hideZipcodeStatus=!1,o.isZipcodeRequired(t,n.devicesView.geographiesXml))?!1:(n.hideZipcodeStatus=!0,!0):!1};n.showBrazilData=function(n){return n?n!=g?!1:!0:!1};n.$on("CompassContentReady",function(){var t=y.getDevicesView(),i,r;t&&(n.devicesView=t,n.strXboxOneSSkuName=n.devicesView.xboxOneSProductSkuList,n.strXboxOneSkuName=n.devicesView.xboxOneProductSkuList,n.strKinectSkuName=n.devicesView.kinectSensorProductSkuList);i=y.getOrdersView();i&&(n.ordersView=i);r=y.getDeviceRegistrationView();r&&(n.deviceRegistrationView=r);t&&t.geographiesXml&&(n.countriesListForRegistration=o.getCountries(t.geographiesXml,"register",n.ordersView.orderResources),n.countriesListForOrder=o.getKinectAdapterCountries(t.geographiesXml,"register",n.ordersView.orderResources,n.ordersView.freeAdapterCountries))});n.reset()}}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("kinectadapter",["$rootScope","$uibModal","$location","$route","$routeParams","languageService","clientConfig","hardwareService","authenticationHelperService","flightService","authService","compassService",function(n,t,i,r,u,f,e,o,s,h,c,l){return{restrict:"EA",templateUrl:"/PartialViews/Devices/KinectAdapterAllDevices.html",scope:{selecteddevice:"="},link:function(i,r,u){if(i.selecteddevice.myDevicesList=null,i.selecteddevice.FreeAdapterOfferAlreadyUsed=null,i.kinectAdapterFlightEnabled=h.isUserInFlight("fka-1"),i.kinectAdapterFlightEnabled){var f=h.isUserInFlight("aad-1");i.devicesRefresh=function(){var t=l.getDevicesView(),n;t&&(i.devicesView=t);n=l.getOrdersView();n&&(i.ordersView=n);i.strXboxOneSSkuName=i.devicesView.xboxOneSProductSkuList;i.strXboxOneSkuName=i.devicesView.xboxOneProductSkuList;i.strKinectSkuName=i.devicesView.kinectSensorProductSkuList;o.getHardwareForUser().then(function(n){if(n.Message&&n.Message.length>0){i.getDevicesErrorMessage=n.Message;return}if(i.myDevicesList=[],i.selecteddevice.myDevicesList=[],i.productskuname=u.productskuname,u.productskuname!=null)for(var t=0;t<n.length;t++)u.productskuname.indexOf(n[t].ProductSku)>-1&&(i.myDevicesList.push(n[t]),i.selecteddevice.myDevicesList=i.myDevicesList)})};i.selectXboxDevice=function(n){i.selecteddevice.FreeAdapterOfferAlreadyUsed=null;i.selecteddevice.deviceInfo=n;i.strXboxOneSSkuName.indexOf(n.ProductSku)>-1&&(i.selecteddevice.selectedXboxOneS=!0,i.selecteddevice.offersNotReturnedFromSOM=null);i.strXboxOneSkuName.indexOf(n.ProductSku)>-1&&(i.selecteddevice.selectedXboxOne=!0);i.strKinectSkuName.indexOf(n.ProductSku)>-1&&(i.selecteddevice.selectedKinect=!0)};i.openRegisterModal=function(){var n="RegisterDevice",r=t.open({templateUrl:"/PartialViews/Devices/RegisterDeviceModal.html",controller:"DevicesModalController",windowClass:"device-modal-window",resolve:{currentDevice:function(){return n}}});r.result.then(function(){i.devicesRefresh()})};i.signInUrl=s.getUpdatedAuthenticationUrl(!0,!1);f?n.$on("UserSignedInMSA",function(){i.userSignedIn=!0;i.devicesRefresh()}):n.$on("UserSignedIn",function(){i.userSignedIn=!0;i.devicesRefresh()});n.$on("UserSignedOut",function(){i.userSignedIn=!1});f?c.resolveAuthState().then(function(n){var t=c.getSupportedIDP();n===t.MSA&&(i.userSignedIn=!0,i.devicesRefresh())}):e.authInfo.authStatus()==1&&(i.userSignedIn=!0,i.devicesRefresh());u.devicesperpage&&(i.devicesPageLimit=u.devicesperpage)}}}}]),function(n){n.service("orderService",["$http","$q","devicesErrorMessageService","languageService",function(n,t,i,r){function e(n){return n.data}function f(n){try{return JSON.parse(n.data)}catch(i){return u(n.data)}}function u(n){var r={},t={};try{n.data!=null&&(t=JSON.parse(n.data).ErrorCode)}catch(u){t=0}return r.Message=i.getErrorMessage(t),r}var o="Indeterminate",h="CancelOrder",c="NC",l="NotSubmitted",s="00000000-0000-0000-0000-000000000000";this.getOrderForDevice=function(t){var i={params:{serialNumber:t}};return n.get("/api/devices/Orders/",i).then(f,u)};this.getOrderDetailsForIncident=function(t){var i={params:{incidentNumber:t}};return n.get("/api/devices/OrderDetails/",i).then(f,u)};this.getSerialNumberForIncident=function(t){var i={params:{incidentNumber:t}};return n.get("/api/devices/SerialNumberForIncident/",i).then(e,u)};this.getKinectAdapterOrderForDevice=function(){return n.get("/api/devices/KinectAdapterOrders/").then(f,u)};this.getDeviceCancelOrder=function(){var n={};return n.IncidentNumber="",n.HardwareCustomerId="",n.SerialNumber="",n.Puid="",n.Brand="",n.Name=null,n.DisplayName=null,n.OrderStatus=o,n.Indeterminate="",n.Currency=null,n.Date=new Date,n.LastModified=new Date,n.ModifiedBy=null,n.TradeScreened=!1,n.DataCenter=null,n.Number=null,n.LineItems=[],n.Shipments=[],n.Payments=[],n.Receipt=null,n.OrderSequence=null,n.ShippLabel=null,n.OrderOperation=h,n};this.getWicLocationInformation=function(){var n={};return n.AddressLine1="",n.AddressLine2="",n.CenterID="",n.City="",n.Country="",n.District="",n.EmailAddress="",n.HoursOfOperation="",n.Locale="",n.LocationId="",n.LocationType="",n.PhoneNumber="",n.State="",n.ZipCode="",n};this.getNewDeviceOrder=function(){var n={};return n.IncidentNumber="",n.HardwareCustomerId="",n.SerialNumber="",n.Puid="",n.CpfId="",n.Brand="",n.Name=null,n.DisplayName=null,n.OrderStatus=o,n.Currency=null,n.Date=new Date,n.LastModified=new Date,n.ModifiedBy=null,n.TradeScreened=!1,n.DataCenter=null,n.Number=null,n.LineItems=[],n.LineItems.push({Description:null,Comments:null,Number:0,EstimatedCompletion:null,Sku:null,VirtualSku:null,Status:null,Price:0,Tax:0,ItemAttributes:null,DeviceKey:{Key:null,Type:null},ServiceContract:null,ProofOfPurchaseId:s,ReturnedDeviceKey:null,ProblemCode:null,ServiceCenter:null,ServiceDisposition:null,SerialNumberUnreadable:!1}),n.Shipments=[],n.Shipments.push({Description:null,SpecialInstructions:null,Carrier:{ShipmentMethod:null,TrackingUrl:null,AirWaybillNumber:null,Name:null,TrackingNumber:null},ShipTo:{CustomerName:{Honorific:null,First:null,Middle:null,Last:null,GenerationalTitle:null,Suffix:null},CustomerAddress:{Address1:"",Address2:"",Address3:null,City:null,StateOrProvince:null,StateId:null,PostalCode:null,Country:null,CountryCode:null,CountryName:null,ExtendedPostalCode:null,ISO2CountryCode:null,Region:null,RegionCode:null,RegionName:null,RegionType:null,State:null,CountryNumber:null,ISO2RegionCode:null},PhoneNumber:{CountryCode:null,AreaCode:null,Number:null,Extension:null},Email:[]},LineItemRef:null,Sku:null,Id:s,VirtualSku:null,Status:null,Price:0,Tax:0}),n.Payments=[],n.Payments.push({BillTo:null,Tax:0,Amount:0,PaymentStatus:l,PaymentOption:null,TransactionNumber:null,InstrumentId:null,Gateway:c,AccountId:null,Date:new Date}),n.PageIndex="0",n.Receipt=null,n.OrderSequence=null,n.ShippLabel=null,n.OrderOperation=null,n};this.getHardwareProblemTypes=function(t,i){var r={params:{productSku:t,language:i}};return n.get("/api/devices/ProblemTypes/",r).then(f,u)};this.getHardwaregetAccessories=function(t,i){var r={params:{productSku:t,language:i}};return n.get("/api/devices/Accessories/",r).then(f,u)};this.getHardwareRepiarOffers=function(t,i,r,e,o,s,h){var c={params:{country:t,brand:i,serialNumber:r,problemCode:e,postalCode:o,state:s,language:h}};return n.get("/api/devices/RepairOffers/",c).then(f,u)};this.getHardwareWicLocations=function(t){var i={params:{country:t}};return n.get("/api/devices/WicLocations/",i).then(f,u)};this.getHardwareShippingOffers=function(t,i,r,e,o,s,h){var c={params:{country:t,brand:i,serialNumber:r,problemCode:e,postalCode:o,offersku:s,language:h}};return n.get("/api/devices/RepairShippingOffers/",c).then(f,u)};this.getHardwareFulfillmentShippingOffers=function(t,i,r,e,o,s,h){var c={params:{country:t,brand:i,serialNumber:r,accessoryType:e,postalCode:o,offersku:s,language:h}};return n.get("/api/devices/FulfillmentShippingOffers/",c).then(f,u)};this.getHardwareAccessoryFulfillmentOffers=function(t,i,r,e,o,s,h,c){var l={params:{country:t,brand:i,serialNumber:r,accessoryType:e,postalCode:o,startDate:s,endDate:h,language:c}};return n.get("/api/devices/AccessoryFulfillmentOffers/",l).then(f,u)};this.getAddressSuggestions=function(t,i,r,e,o,s){var h={params:{address1:t,address2:i,city:r,stateOrProvince:e,postalCode:o,country:s}};return n.get("/api/devices/VerifyAddress/",h).then(f,u)};this.createNewOrder=function(t){return n({url:"/api/devices/CreateOrder/",method:"POST",data:{request:JSON.stringify(t)}}).then(f,u)};this.cancelOrder=function(t,i){var r={params:{hardwareCustomerId:t,incidentNumber:i}};return n.put("/api/devices/CancelOrder/",r.params).then(e,u)};this.calculateTax=function(t){var i={params:{request:JSON.stringify(t)}};return n.put("/api/devices/CalculateTax/",i.params).then(f,u)};this.getShippingLabel=function(t){var i={params:{incidentNumber:t}};return n.get("/api/devices/ShippingLabel/",i).then(e,u)};this.getSurfaceStudioModalities=function(t){var i=r.getSupportedLanguageForGivenCountry(t),e={params:{product:"surfaceStudio",issue:"tech-services",country:t,language:i,fallback:!1}};return n.get("/api/devices/Modalities/",e).then(f,u)};this.hasSupportedShipCode=function(n){return["OSI","OSX","SOI","POI"].indexOf(n.Shipments[0].VirtualSku)>-1};this.shippingEventRecieved=function(n){return["InitiateRepairOrder","OrderSubmitted","PackingMaterialinTransit","PackingMaterialShipped","PackingMaterial"].indexOf(n.LineItems[0].Status)>-1};this.isStandardExchangeOrder=function(n){if(n.LineItems)return n.LineItems[0].ItemAttributes=="Repair"?!0:!1};this.isSelfPrintLabelOrder=function(n){if(n.Shipments)return n.Shipments[0].Description=="Self-Print Label"?!0:!1}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("paymentService",["$http",function(n){function r(n){return n.data}function u(n){var r=n.data;return n.data=="An error has occurred"?r.Message=n.data:r.Message&&(r.Message=r.Message.slice(r.Message.indexOf(t),r.Message.indexOf(i))),r}var t="Error Message:",i=", StackTrace";this.getCommercePayments=function(t){var i={params:{countryCode:t}};return n.get("/api/devices/PaymentInstruments/",i).then(r,u)}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("profileService",["$http","devicesErrorMessageService",function(n,t){function i(n){return JSON.parse(n.data)}function r(n){var r={},i={};try{n.data!=null&&(i=JSON.parse(n.data).ErrorCode)}catch(u){i=0}return r.Message=t.getErrorMessage(i),r}this.getUserHardwareProfile=function(){return n.get("/api/devices/Profiles/").then(i,r)}}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("showdevices",["$rootScope","$uibModal","$location","$route","$routeParams","languageService","clientConfig","hardwareService","authenticationHelperService","flightService","authService",function(n,t,i,r,u,f,e,o,s,h,c){return{restrict:"A",templateUrl:"/PartialViews/Devices/ShowDevices.html",link:function(l,a,v){var y=h.isUserInFlight("aad-1");l.devicesRefresh=function(){o.getHardwareForUser().then(function(n){if(n.Message&&n.Message.length>0){l.getDevicesErrorMessage=n.Message;return}l.myDevicesList=n})};l.openUnregisterModal=function(n){var i=t.open({templateUrl:"/PartialViews/Devices/UnregisterDeviceModal.html",controller:"DevicesModalController",windowClass:"device-modal-window",resolve:{currentDevice:function(){return n}}});i.result.then(function(){l.devicesRefresh()})};l.openRegisterModal=function(){var n="RegisterDevice",i=t.open({templateUrl:"/PartialViews/Devices/RegisterDeviceModal.html",controller:"DevicesModalController",windowClass:"device-modal-window",resolve:{currentDevice:function(){return n}}});i.result.then(function(){l.devicesRefresh()})};l.signInUrl=s.getUpdatedAuthenticationUrl(!0,!1);y?n.$on("UserSignedInMSA",function(){l.userSignedIn=!0;l.devicesRefresh()}):n.$on("UserSignedIn",function(){l.userSignedIn=!0;l.devicesRefresh()});n.$on("UserSignedOut",function(){l.userSignedIn=!1});y?c.resolveAuthState().then(function(n){var t=c.getSupportedIDP();n===t.MSA&&(l.userSignedIn=!0,l.devicesRefresh())}):e.authInfo.authStatus()==1&&(l.userSignedIn=!0,l.devicesRefresh());l.reset=function(){l.userSignedIn&&u.deviceId!=null&&l.SelectDevice(u.deviceId)};l.SelectDevice=function(n){var t=r.current.$$route.originalPath;t.match("/devices")?i.path("/devices/"+n.SerialNumber+"/"):i.path("/"+f.langLocale().toLowerCase()+"/products/"+n.Brand+"/")};v.devicesperpage&&(l.devicesPageLimit=v.devicesperpage);l.reset()}}}]),function(n){n.controller("LifecycleController",["$scope","$rootScope","$route","locationService","compassService","compassFormatFilter","metatagService","lifecycleService",function(n,t,i,r,u,f,e,o){function s(t){if(t&&t.lifecycleTopics&&(n.categories=t.lifecycleTopics,n.categoryParam=t.lifecycleTopics[0].sectionId,t.lifecycleTopicsTitle=t.lifecycleTopicsTitle,t.policyDisclaimerText=f(t.heroSection.policyDisclaimerStatementFormat,{"policy-disclaimer-link-html":f(t.heroSection.policyDisclaimerAnchorFormat,{"policy-disclaimer-url":t.heroSection.policyDisclaimerLink})}),n.homePageView=t,t&&t.metaTagsList&&t.metaTagsList.metaTags)){var i=e.fetchMetaTags(t.metaTagsList.metaTags);i&&c(i)}}function h(){var i=[];o.getSortedProductsList().then(function(t){for(var u,f="A".charCodeAt(0),r=0;r<26;r++)u={},u.key=String.fromCharCode(f+r),u.productList=t[r].ProductList,u.hasProductList=t[r].ProductList.length>0,i.push(u);i.push({key:n.homePageView.lifecycleIndex.other,productList:t[26].ProductList,hasProductList:t[26].ProductList.length>0});n.sortedProductList=i},function(n){t.$broadcast("500Error",{reason:"Error occurred on a lifecycle index page load while getting sorted product list",data:n})})}n.waitingOnCompass=!0;n.$on("$routeChangeSuccess",function(){n.isLifeSelectIndex=i.current.data&&i.current.data.isLifeSelectIndex==!0;u.getlifecycleHomepageView().then(function(t){s(t);n.waitingOnCompass=!1;n.isLifeSelectIndex&&h()})});var c=function(n){n.metaTagTitle&&t.$broadcast("UpdateTitle",n.metaTagTitle);n.pageMetaTags&&t.$broadcast("AddMetaTags",n.pageMetaTags)};n.scrollTo=function(n){r.scrollTo(n)};n.$on("LifecycleLandingPageLoadTimeout",function(){t.$broadcast("500Error",{reason:"Timeout occurred on a lifecycle landing page load",data:{}})})}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("LifecycleSearchController",["$scope","$rootScope","$q","$filter","$location","$httpParamSerializerJQLike","$routeParams","compassService","compassFormatFilter","metatagService","lifecycleService","wedcsService",function(n,t,i,r,u,f,e,o,s,h,c){function b(t){if(!n.serviceRequestFailedOrTimedOut&&t)if(t.length>0){n.searchResults=t;n.sortByProperty="Name";n.sortReverse=!1;n.displayNoResultsMessage=!1;var i=c.getSearchParams(n.searchCriteria,!0),r=JSON.stringify(i),u=f(r);n.exportLink="/api/lifecycle/GetProductsLifecycle?query"+u}else n.displayNoResultsMessage=!0}function a(){n.serviceRequestFailedOrTimedOut=!0}function y(t){var i=[],u;return n.products&&t&&(t=t.trim(),u=t.split(/[\s]+/),angular.forEach(n.products,function(n){var r,f,t,e;if(n.Name){for(r=n.Name,f=!0,t=0;t<u.length;t++)if(e=new RegExp("("+u[t]+")","i"),e.test(r))r=r.replace(u[t],"");else{f=!1;break}f&&i.push(n)}})),i=r("limitTo")(i,10),{suggestions:i}}function k(){c.getProductsList().then(function(t){l.resolve();n.products=t},function(n){l.reject();a(n)})}var l=i.defer(),v,p,w;n.search=function(i){var r=v();r&&(i?(n.searchRequest=c.getProductsLifecycle(n.searchCriteria).then(b,a),t.$broadcast("LifecycleSearch",{searchCriteria:n.searchCriteria,searchByProductName:n.displayProductNameInFilter})):u.url(c.getSearchResultsUrl(n.searchCriteria)))};v=function(){var t=!1,i;return n.searchCriteria.gdsId&&n.searchCriteria.gdsId!=""?t=!0:!t&&n.searchCriteria.selectedTimeRange.configValue&&n.searchCriteria.selectedTimeRange.configValue!="0"?t=!0:t||(i=c.getProductNamesFromCriteria(n.searchCriteria),i&&i.length>0&&(t=!0)),t};n.addQuery=function(){n.searchCriteria.productNames.push({productName:""})};n.removeQuery=function(t){n.searchCriteria.productNames.length>1&&n.searchCriteria.productNames.splice(t,1)};n.getCompleteText=function(n){return n.Name};n.getSuggestions=function(t){var r=i.defer();return t?n.products!=undefined?r.resolve(y(t)):l.promise.then(function(){r.resolve(y(t))}):r.reject("empty query"),r.promise};n.changeSearchType=function(t){n.displayProductNameInFilter=t.configValue=="0"?!0:!1;n.selectedSearchCategory=t;n.searchCriteria={productNames:[{productName:""}],selectedTimeRange:n.searchPageView.selectTimeRangeCriteriaValues[0]}};n.reset=function(){var r,t,i,f;n.waitingOnCompass=!0;n.searchResults=[];n.searchCriteria={productNames:[],selectedTimeRange:{}};n.searchPageView={};n.displayNoResultsMessage=!1;n.serviceRequestFailedOrTimedOut=!1;n.displayProductNameInFilter=!0;n.selectedSearchCategory={};r=u.search();t={};angular.forEach(r,function(n,i){t[i.toLowerCase()]=n});i=t.p1||t.c2||e.gdsId;t.alpha?(f=t.alpha.split(","),angular.forEach(f,function(t){t&&n.searchCriteria.productNames.length<3&&n.searchCriteria.productNames.push({productName:t})})):n.searchCriteria.productNames.push({productName:""});i&&(n.searchCriteria.gdsId=i);k();o.getlifecycleSearchPageView().then(function(i){if(i){if(i.metaTagsList&&i.metaTagsList.metaTags){var r=h.fetchMetaTags(i.metaTagsList.metaTags);r&&w(r)}n.searchPageView=i;n.waitingOnCompass=!1;p(t.ts);(n.searchCriteria.gdsId||t.alpha||t.ts)&&n.search(!0)}})};p=function(t){if(t)for(var i=0,r=n.searchPageView.selectTimeRangeCriteriaValues.length;i<r;i++)if(n.searchPageView.selectTimeRangeCriteriaValues[i]&&n.searchPageView.selectTimeRangeCriteriaValues[i].configValue===t){n.searchCriteria.selectedTimeRange=n.searchPageView.selectTimeRangeCriteriaValues[i];n.selectedSearchCategory=n.searchPageView.searchCategories[1];n.displayProductNameInFilter=!1;return}n.selectedSearchCategory=n.searchPageView.searchCategories[0];n.searchCriteria.selectedTimeRange=n.searchPageView.selectTimeRangeCriteriaValues[0]};w=function(n){n.metaTagTitle&&t.$broadcast("UpdateTitle",n.metaTagTitle);n.pageMetaTags&&t.$broadcast("AddMetaTags",n.pageMetaTags)};n.sortBy=function(t){n.sortReverse=t!==null&&n.sortByProperty===t?!n.sortReverse:!1;n.sortByProperty=t};n.$on("LifecycleSearchPageLoadTimeout",function(){t.$broadcast("500Error",{reason:"Timeout occurred on a lifecycle search page",data:{}})});n.$on("LifecycleSearchRequestTimeout",function(){a()})}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("lifecycleService",["$http","languageService",function(n,t){this.getProductsLifecycle=function(t,i){var r=this.getSearchParams(t,i),u=JSON.stringify(r);return n.get("/api/lifecycle/GetProductsLifecycle",{params:{query:u},httpAppOptions:{qosOperation:{name:"LifecycleAPI.GetProductsLifecycle",description:"Get products lifecyle"}}}).then(function(n){return n.data})};this.getProductsList=function(){return n.get("/api/lifecycle/GetProductsList",{httpAppOptions:{qosOperation:{name:"LifecycleAPI.GetProductsList",description:"Get product list with limited properties id and name"}}}).then(function(n){return n.data})};this.getSearchResultsUrl=function(n){var u="/"+t.langLocale()+"/lifecycle/search",i="",f,r;return(n&&(f=this.getProductNamesFromCriteria(n),r=f.join(","),r&&r!=""?i="?alpha="+r:n.selectedTimeRange&&(i="?ts="+encodeURIComponent(n.selectedTimeRange.configValue))),i!="")?u+i:u};this.getSortedProductsList=function(){return n.get("/api/lifecycle/GetSortedProductsListByIndex",{httpAppOptions:{qosOperation:{name:"LifecycleAPI.GetSortedProductsListByIndex",description:"Get sorted product list"}}}).then(function(n){return n.data})};this.getProductNamesFromCriteria=function(n){var t=[];return angular.forEach(n.productNames,function(n){n&&n.productName!=""&&t.push(encodeURIComponent(n.productName))}),t};this.getSearchParams=function(n,t){return{names:this.getProductNamesFromCriteria(n),years:n.selectedTimeRange.configValue,gdsId:n.gdsId||"","export":angular.isDefined(t)?t:!1}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("lifecycleTelemetryService",["$rootScope","wedcsService",function(n,t){var i="lifecycleSearchAction";n.$on("LifecycleSearch",function(n,r){if(r)if(r.searchByProductName){var u=0;angular.forEach(r.searchCriteria.productNames,function(n){n&&n.productName!=""&&(t.logCustomEvent("search-by-product-name",i,{"ms.scnum":"product-picker-"+u,"ms.scvalue":n.productName}),u++)})}else r.searchCriteria&&r.searchCriteria.selectedTimeRange&&r.searchCriteria.selectedTimeRange.configValue&&t.logCustomEvent("search-by-time-range",i,{"ms.scnum":"select-time-range","ms.scvalue":r.searchCriteria.selectedTimeRange.configValue})})}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("VerifymeController",["$scope","$rootScope","authenticationHelperService","compassService","compassFormatFilter","clientConfig","flightService","authService","metatagService","verifymeService",function(n,t,i,r,u,f,e,o,s,h){function v(){r.getVerifyMePageView().then(function(t){if(n.view=t,n.waitingOnCompass=!1,c?(n.isAuthenticated=null,o.resolveAuthState().then(function(t){var i=o.getSupportedIDP();t===i.MSA?a():n.isAuthenticated=!1},function(){n.isAuthenticated=null})):n.isAuthenticated=f.authInfo.isLoggedIn(),t&&t.metaTagsList&&t.metaTagsList.metaTags){var i=s.fetchMetaTags(t.metaTagsList.metaTags);i&&l(i)}})}function a(){n.isAuthenticated=!0;y()}function y(){n.isGetCodeRequestInProgress=!0;n.getVerifymeCodeRequest=h.getVerifymeCode().then(function(t){t&&n.view&&(n.view.formatedMessageWithCode=u(n.view.codeWithFormatedText,{"verify-me-code":t.generatedCode}))},function(n){t.$broadcast("500Error",{reason:"Error occurred on a retrieving code from servicedesk",data:n})})["finally"](function(){n.isGetCodeRequestInProgress=!1})}var c=e.isUserInFlight("aad-1"),l;c||(n.$on("UserSignedIn",function(){a()}),n.$on("UserSignedOut",function(){n.isAuthenticated=!1}));l=function(n){n.metaTagTitle&&t.$broadcast("UpdateTitle",n.metaTagTitle);n.pageMetaTags&&t.$broadcast("AddMetaTags",n.pageMetaTags)};n.signIn=function(){if(c){var n=o.getSupportedIDP();o.loginUsingAccountType(n.MSA)}else i.signIn()};n.reset=function(){n.waitingOnCompass=!0;n.isAuthenticated=null;n.isGetCodeRequestInProgress=null;v()};n.$on("verifymePageLoadTimeout",function(){t.$broadcast("500Error",{reason:"Timeout occurred on a verify page load",data:{}})});n.reset()}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("verifymeService",["$http","languageService",function(n){this.getVerifymeCode=function(){return n.get("/api/verifyme/getcode",{httpAppOptions:{qosOperation:{name:"verifymeAPI.getcode",description:"Get code for verifyme"}}}).then(function(n){return n.data})}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("FreController",["$scope","$route","$rootScope","$location","$routeParams","compassService",function(n,t,i,r,u,f){n.reset=function(){f.getFrePage(u.productId).then(function(t){n.fre=t})};n.reset()}])}(angular.module(microsoft.support.moduleName));app.controller("InstantAnswerController",["$rootScope","$scope","$routeParams","contentApiService","compassService",function(n,t,i,r){function u(n){var i=!1,r=0;for(var t in n)n.hasOwnProperty(t)&&(r++,angular.isObject(n[t])&&(n[t]=u(n[t])),i=t==="value");return i&&r===1?n.value:n}function f(n,t){return{name:n,content:t}}t.reset=function(){t.showFeedback=!1;t.contentReady=!1;i.iaId!=null&&(r.getCompassContentForPage("searchresults").then(function(n){n&&n.data&&n.data.searchResults&&(t.view=n.data.searchResults.instantAnswer)})["finally"](function(){t.contentReady=!0}),r.getInstantAnswer(i.iaId).then(function(i){t.instantAnswer=u(i.data);var r=[];t.instantAnswer&&(t.instantAnswer.solutions&&t.instantAnswer.solutions.length>0&&r.push(f("description",t.instantAnswer.solutions[0].description)),r.push(f("ms.iaPartnerId",t.instantAnswer.partnerId)),n.$broadcast("AddMetaTags",r));n.$broadcast("PageResourcesDownloaded")}))};t.reset()}]),function(n){n.directive("comscore",["clientConfig",function(n){return{restrict:"A",link:function(t,i){n&&n.ComScore&&n.ComScore.ComScoreEnabled&&i.append($("<script>",{Src:n.ComScore.SurveySource,Async:"",Type:"text/javascript"}))}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("LinkFarmController",["$rootScope","$scope","compassService","flightService",function(n,t,i){function r(){var n=i.getLinkFarm();n&&(t.view=n)}t.reset=function(){r()};t.reset();t.$on("CompassContentReady",function(){r()})}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("metatags",["$rootScope","$window","$interval","$cookies","nativeAppService","metaTagsService","guidGenerator",function(n,t,i,r,u,f,e){return{restrict:"A",link:function(o){function s(o,s,h){if(f.addOrUpdateMetaTag("ms.vlid",e.newGuid()),f.setMetaTag("ms.refView",h!==s&&h||""),f.setMetaTag("ms.pageType",s),f.doesMetaTagExist("ms.isNative")&&f.setMetaTag("ms.isNative",(!!u.isNative()).toString()),f.doesMetaTagExist("ms.partnerId")&&f.setMetaTag("ms.partnerId",r.get("smcpartner")||""),f.doesMetaTagExist("ms.flightId")&&f.setMetaTag("ms.flightId",r.get("smc_f")||""),f.doesMetaTagExist("ms.cV")&&t&&t.Asimov&&t.Asimov.cv&&f.setMetaTag("ms.cV",t.Asimov.cv.getValue()||""),f.doesMetaTagExist("ms.muid")&&f.setMetaTag("ms.muid",r.get("MUID")||""),f.doesMetaTagExist("ms.auth"))if(f.getMetaTagContent("ms.auth"))n.$broadcast("metaTagsUpdated");else var c=i(function(){f.getMetaTagContent("ms.auth")&&(n.$broadcast("metaTagsUpdated"),i.cancel(c))},250,20);else n.$broadcast("metaTagsUpdated")}o.reset=function(){};o.$on("$locationChangeSuccess",s);o.$on("UserSignedIn",function(){f.setMetaTag("ms.auth","1")});o.$on("UserSignedOut",function(){f.setMetaTag("ms.auth","0")});o.$on("UpdateMetaTag",function(n,t){f.addOrUpdateMetaTag(t.name,t.value)});o.$on("RemoveMetaTag",function(n,t){f.setMetaTag(t.name,"")});o.$on("awasaChatId",function(n,t){f.setMetaTag("ms.chatId",t.toString())});o.$on("awasaVisitId",function(n,t){f.setMetaTag("ms.visitId",t.toString())});o.$on("awasaEnqueueId",function(n,t){f.setMetaTag("ms.enqueueId",t.toString())});o.reset()}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("metaTagsService",[function(){this.addOrUpdateMetaTag=function(n,t){this.doesMetaTagExist(n)||$("head").append($('<meta name="'+n+'" content="" />'));this.setMetaTag(n,t)};this.setMetaTag=function(n,t){$('meta[name="'+n+'"]').attr("content",t)};this.doesMetaTagExist=function(n){return $('meta[name="'+n+'"]').attr("name")};this.getMetaTagContent=function(n){return $('meta[name="'+n+'"]').attr("content")}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("LanguageController",["$window","$rootScope","$scope","$location","$document","languageService","clientConfig","compassService",function(n,t,r,u,f,e,o,s){var a=e.langLocale();r.displayLanguageSelector=!1;var h=function(){e.languages().then(function(n){r.languages=n;r.languagesListForLargeScreens=l()});r.currentLanguage=e.currentLanguage();r.currentTextDirection=e.currentDirection();r.languageSelectorTitle=s.getLanguageSelectorTitle()},c=function(){t.$digest();n.scrollTo(0,f[0].body.scrollHeight)},l=function(){var n=[],t=[];for($.each(r.languages,function(t,i){n.push(i)}),n=n.sort(function(n,t){return n.displayName<=t.displayName?-1:n.displayName>t.displayName?1:0}),i=0;i<=Math.floor(n.length/4);i++)t[i*4]=n[i];for(i=Math.floor(n.length/4)+1,j=0;i<=Math.floor(n.length/2);i++,j++)t[j*4+1]=n[i];for(i=Math.floor(n.length/2)+1,j=0;i<=Math.floor(n.length*(3/4));i++,j++)t[j*4+2]=n[i];for(i=Math.floor(n.length*(3/4))+1,j=0;i<=n.length;i++,j++)t[j*4+3]=n[i];return t};r.setLanguage=function(n){e.set(n)};r.closeClick=function(){r.displayLanguageSelector=!1;c()};r.$on("languageSelectorClicked",function(){o&&o.SiteContentConfig&&o.SiteContentConfig.LanguageSelectorEnabled&&(r.displayLanguageSelector=r.displayLanguageSelector?!1:!0,c())});r.$on("CompassContentReady",function(){h()});h()}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("NotificationBannerController",["$scope","$rootScope","$route","$location","compassService","flightService","osService","browserService","notificationBannerService","productPagesService",function(n,t,i,r,u,f,e,o,s,h){function l(){var t,i;c?(n.bannerPlacement="",t=u.getNotificationBannersList(),t&&(n.bannersList=t,a())):(n.bannerPlacement="",i=u.getNotificationBanner(),i&&(n.banner=i,y()))}function v(){a()}function a(){var i,t;n.hasBanner=!1;n.bannersList||(i=u.getNotificationBannersList(),n.bannersList=i);t=s.filterRelevantBanner(n.osVersion,n.browser,n.bannersList);t&&(n.hasBanner=!0,n.isRight=t.alignment&&t.alignment=="right"?!0:!1,n.banner=t.banner,n.bannerPlacement=s.getBannerPlacement(n.bannersList.notificationBannerLayout))}function y(){var u,f,e,s,o,t;if(n.hasBanner=!1,u=!0,n.banner&&n.banner.exclusionPageList)for(f=n.banner.exclusionPageList,t=0;t<f.length;t++)r.path().search(f[t])>-1&&(u=!1);if(e=!1,n.banner&&n.banner.associatedOSList)for(s=h.getVersionValue(n.osVersion),o=n.banner.associatedOSList,t=0;t<o.length;t++)s==o[t]&&(e=!0);e==!0&&u==!0&&(n.hasBanner=!0,n.isRight=!0,n.bannerPlacement=i&&i.current&&i.current.data&&i.current.data.isLandingPage&&i.current.data.isLandingPage==!0?"above-search":"below-search")}var c=!1;n.reset=function(){n.osVersion=e.getOS();n.browser=o.determineBrowser();c=f.isUserInAnyFlight(["mnb-1"]);l()};n.$on("$routeChangeSuccess",function(){v()});n.$on("CompassContentReady",function(){l()});n.reset()}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("notificationBannerService",["$rootScope","$log","$location","$window","compassService","languageService","osService","browserService","productPagesService",function(n,t,i,r,u,f,e,o,s){var h=s.getVersionValue(e.getOS()),c=o.determineBrowser(),l=f.langLocale();this.filterRelevantBanner=function(n,t,r){var u,a,v,y,p,w,f,e,b;if(r)for(u=0;u<r.notificationBannerList.length;u++){var o=!1,s=!1,c=!1,k=r.notificationBannerList[u];if(r.notificationBannerList[u].associatedOSList)if(a=r.notificationBannerList[u].associatedOSList.length,a==0)o=!0;else for(f=0;f<a;f++)h==r.notificationBannerList[u].associatedOSList[f]&&(o=!0);if(r.notificationBannerList[u].associatedBrowsersList)if(v=r.notificationBannerList[u].associatedBrowsersList.length,v==0)s=!0;else for(f=0;f<v;f++)t==r.notificationBannerList[u].associatedBrowsersList[f]&&(s=!0);if(r.notificationBannerList[u].associatedLocalesList)if(y=r.notificationBannerList[u].associatedLocalesList.length,y==0)c=!0;else for(f=0;f<y;f++)l==r.notificationBannerList[u].associatedLocalesList[f]&&(c=!0);if(p=!0,r.notificationBannerList[u].exclusionPageList)for(w=r.notificationBannerList[u].exclusionPageList,f=0;f<w.length;f++)i.path().search(w[f])>-1&&(p=!1);if(o==!0&&p==!0&&c==!0&&s==!0)return e=r.notificationBannerList[u],b=this.getimageClassName(e.productImageLocation),e.productImageLocation=b.imageClassName,{banner:e,alignment:b.alignment}}};this.getimageClassName=function(n){var t="",i="";n.indexOf("banner-image")>-1&&(n=n.substring(13,n.length));switch(n){case"top-right":t="banner-image-top-right";i="right";break;case"bottom-right":t="banner-image-bottom-right";i="right";break;case"right":t="banner-image-right";i="right";break;case"top-left":t="banner-image-top-left";i="left";break;case"bottom-left":t="banner-image-bottom-left";i="left";break;case"left":t="banner-image-left";i="left"}return{imageClassName:t,alignment:i}};this.getBannerPlacementFromCompass=function(){var n=u.getNotificationBannersList(),t="",i;return n&&n.notificationBannerList&&n.notificationBannerLayout&&(i=this.filterRelevantBanner(h,c,n),i&&(t=this.getBannerPlacement(n.notificationBannerLayout),t==""&&(t="above-search"))),t};this.getBannerPlacement=function(n){var u="",t,r;if(n)for(t=0;t<n.length;t++)for(r=0;r<n[t].assosicatedPagesList.length;r++)if(i.path().search(n[t].assosicatedPagesList[r])>-1){u=n[t].bannerLayout;break}return u};this.getLegacyBanner=function(){var n=u.getNotificationBanner();n}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("StoreLocationsController",["$rootScope","$scope","contentApiService","languageService",function(n,t,i,r){t.updating=!0;t.countryList=[];t.storeLocations=[];t.filter={};t.filter.countrySelection="";t.filter.fieldSelection="";t.countryStores=[];var u="CARE_LOCATION";t.filter.storeType=u.toLowerCase();initCountryList=function(n){for(var i,u,f,o=r.locale(),e=0;e<n.length;e++){if(i=n[e],u=i.countryNames.split(","),u.length>0)for(f=0;f<u.length;f++)t.countryList.push({name:u[f],id:i.countryName});o==i.countryCode&&(t.filter.countrySelection={name:i.countryName,id:i.countryName},t.applyCountryFilter())}};initStoreLocations=function(n){for(var i,r=0;r<n.length;r++)i=n[r],n[r].region=[i.state,i.city,i.town,i.zipcode].filter(function(n){return n}).join(", "),n[r].address=[i.street,i.town,i.city,i.state,i.zipcode].filter(function(n){return n}).join(", "),i.service&&i.service.length>0&&(n[r].serviceType=i.service.split(","),n[r].serviceType.forEach(function(n,i,r){r[i]=n==u?t.page.searchView.deviceCareType:t.page.searchView.recyclingType}),n[r].serviceType=n[r].serviceType?n[r].serviceType.join(", "):"");t.storeLocations=n};t.applyCountryFilter=function(){t.filter.countrySelection&&t.filter.countrySelection.name&&(t.countryStores=t.storeLocations.filter(function(n){return n.countryName==t.filter.countrySelection.id}))};t.applyFieldFilter=function(){t.filter.fieldSelection&&t.filter.fieldSelection.region&&(t.countryStores=t.storeLocations.filter(function(n){return n.region==t.filter.fieldSelection.region}))};t.$watch("filter.fieldSelection",function(){t.filter.fieldSelection||t.applyCountryFilter()});i.getCompassContentForPage("lumialocations").then(function(i){t.page=i.data.locationsView;n.$broadcast("UpdateTitle",t.page.title);t.page.locations&&t.page.locations.length>0&&(initStoreLocations(JSON.parse(t.page.locations)),initCountryList(JSON.parse(t.page.localeDictionary)))}).finally(function(){t.updating=!1})}])}(angular.module(microsoft.support.moduleName));app.filter("storeLocationsFilter",function(){return function(n,t,i){return n&&i?n.filter(function(n){return n[t]?n[t].toUpperCase().indexOf(i.toUpperCase())>=0:!0}):n}}),function(n){n.controller("AllProductsController",["$scope","$window","compassService","languageService",function(n,t,i){function r(){var t=i.getAllProducts();t&&(n.allProducts=t,n.allProducts.productCategories=n.allProducts.productCategories.filter(function(n){return n.links=n.links.filter(function(n){return n.linkUrl!==""&&n.linkUrl!=="tbd"&&n.linkText!==""}),n.links.length>0}))}n.reset=function(){r();n.showColumns=[]};n.showMore=function(t){n.showColumns[t]=!0};n.showLess=function(t){n.showColumns[t]=!1};n.display=function(t,i,r){return r<t.collapseCount||n.showColumns[i]?!0:!1};n.isExternal=function(n){return t&&t.location&&t.location.origin&&typeof n=="string"&&!(n.indexOf(t.location.origin)>0||n.indexOf("://")==-1)};n.$on("CompassContentReady",function(){r()});n.reset()}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("ProductHubController",["$rootScope","$scope","$routeParams","$location","$window","$log","$uibModal","clientConfig","locationService","languageService","compassService","contentApiService","productPagesService","smoothScrollService","osService","flightService","authService","metatagService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){function g(){var u,e,o,s,r,l,h;if(t.ChevronDown="E70D",t.ChevronUp="E70E",t.limitProducts=t.minLimit,t.limitAccessories=t.minLimit,t.hasBreadCrumb=!1,t.productPath)u=c.getProductDetails(t.productPath),u&&(t.currentProductView=u.ProductHubPages,t.ProductPageTitles=u.ProductCommonView),t.ProductPageTitles&&t.ProductPageTitles.productTitle&&(t.productTitleTemplate=t.ProductPageTitles.productTitle),t.currentProductView&&t.currentProductView.productItem&&(t.versionselected=t.currentProductView,t.productName=t.currentProductView.productItem.name,t.productTitleTemplate&&t.productName&&(t.pageTitle=t.productTitleTemplate.replace("{product_name}",t.productName)),t.currentProductView.parentProductName&&t.currentProductView.parentProductName!=""&&(t.hasBreadCrumb=!0));else return f.error("Invalid Product Path: ",t.productPath);if(t.currentProductView&&t.currentProductView.pageType&&(t.versionselected=t.currentProductView,t.status&&(t.status.waitingOnCompass=!1),ut(t.currentProductView.pageType.toLowerCase()),t.isProductSelectorPage||t.currentProductView&&t.currentProductView.productHubSelfHelpLinks&&(t.categories=t.currentProductView.productHubSelfHelpLinks,(t.categories||t.categories.length>0)&&(t.selfHelpTitle=t.currentProductView.productHubSelfHelpTitle,e=i.category,t.categoryParam=e?e:t.currentProductView.productHubSelfHelpLinks[0].sectionId||t.categoryParam))),t.subProductViews=[],t.accessoriesViews=[],t.hasSubProducts=!1,t.accessoriesLength=0,t.subProductsLength=0,t.currentProductView&&t.currentProductView.subProductsList&&(t.subproductsList=t.currentProductView.subProductsList,t.subproductsList.length>0)){for(t.accessoriesLength=t.subproductsList.filter(it).length,t.subProductsLength=t.subproductsList.filter(rt).length,t.hasSubProducts=!0,t.productsSectionTitle=t.ProductPageTitles.productPageProductSelectionTitle,t.accessorySectionTitle=t.ProductPageTitles.productPageAccessorySelectionTitle,t.seeAllTitle=t.ProductPageTitles.seeAll,t.seeLessTitle=t.ProductPageTitles.seeLess,t.seeMoreProductsTitle=t.seeAllTitle,t.seeMoreAccessoryTitle=t.seeAllTitle,t.selectedSubVersion=t.subproductsList[0],o=0,s=0,r=0;r<t.subproductsList.length;r++)t.subproductsList[r].isAccessory=="false"?(t.subProductViews[s]=t.subproductsList[r],s++):(t.accessoriesViews[o]=t.subproductsList[r],o++);l=a.getVersionValue(t.osVersion);t.isProductSelectorPage||ot(l)}t.currentProductView&&t.currentProductView.productPromotionsList&&t.currentProductView.productPromotionsList.promotionSectionList&&(t.promotionSectionTitle=t.currentProductView.productPromotionsList.promotionSectionTitle,t.associatedProductsList=t.currentProductView.productPromotionsList.promotionSectionList);t.currentProductView&&t.currentProductView.metaTagsList&&t.currentProductView.metaTagsList.metaTags&&(h=b.fetchMetaTags(t.currentProductView.metaTagsList.metaTags),t.productHubMetaTags=h.pageMetaTags,t.metaTagTitle=h.metaTagTitle||t.pageTitle);t.metaTagTitle&&n.$broadcast("UpdateTitle",t.metaTagTitle);t.productHubMetaTags&&n.$broadcast("AddMetaTags",t.productHubMetaTags);t.currentProductView&&t.currentProductView.pageType&&n.$broadcast("PageResourcesDownloaded",{"ms.scnct":t.currentProductView.pageType})}function ft(){var n=s.getPathSubset(2),r;return n=n[n.length-1]!=="/"?n+"/":n,t.osParam=i.os,r=k(),r&&!t.hasAppendedParam&&(t.productPath=t.productPath+"?os="+t.osParam,n=n+"?os="+t.osParam,t.hasAppendedParam=!0),n}function et(){var i=s.getPathSubset(2),n=a.getParentPath(i),f=n[n.length-1]!=="/"?n+"/":n,r=h.langLocale().toLowerCase()+"/"+f,e=i.split("/"),u;return e.length-2!=0&&(t.parentProductUrl=r),u=k(),u&&(t.parentProductUrl=r),n}function k(){return t.osParam&&t.osParam!="NA"&&t.osParam!=""?!0:!1}function ot(n){var h=k(),o,s,u,f,e;if(h)for(u=0;u<t.subproductsList.length;u++)f=t.subproductsList[u].version,f==i.os&&(t.selectedSubVersion=t.subproductsList[u]);else{for(t.currentProductView&&t.currentProductView.oSMappingsList&&(o=t.currentProductView.oSMappingsList,o[n]&&(n=o[n])),s=!1,u=0;u<t.subproductsList.length;u++)f=t.subproductsList[u].version,f==n&&(e=t.subproductsList[u].url,r.url(e).replace(),t.selectedSubVersion=t.subproductsList[u],s=!0);s||(e=t.subproductsList[0].url,r.url(e).replace(),t.selectedSubVersion=t.subproductsList[0])}}var d=p.isUserInFlight("aad-1");t.minLimit=6;t.reset=function(){t.isProductSelectorPage=!1;t.isProductHubPage=!1;t.isTopicHubPage=!1;t.seeAllProducts=!1;t.seeAllAccessories=!1;t.limitProducts=t.minLimit;t.limitAccessories=t.minLimit;t.status={waitingOnCompass:!0};var n=navigator.appVersion,i=navigator.appName;t.hasBreadCrumb=!1;t.osVersion=y.getOS();t.categoryParam="NA";gotDevices=!1;g()};t.categoryParam="NA";t.osParam="NA";t.hasAppendedParam=!1;t.productPath=ft();t.parentProductPath=et();var st=function(n){if(!n||!n.url)return f.error("Invalid Link: ",n)},it=function(n){return n.isAccessory=="true"?!0:!1},rt=function(n){return n.isAccessory=="false"?!0:!1},nt=function(){var f,n,i,r,u;if(myDevices&&!(myDevices.length<=0)){for(f=!1,n=0;n<myDevices.length;n++)if(i=myDevices[n],i.FormFactor==="Phone"){for(r=0;r<t.view.length;r++)if(u=i.OSVersion.substring(0,t.view[r].versionNumber.length)===t.view[r].versionNumber,u===!0)break;u===!0?(i.FriendlyName===defaultFriendlyName?(myDevices[n].version=i.Manufacturer+" "+i.Model,t.versionselected=t.view[n]):(myDevices[n].FriendlyName=i.FriendlyName,myDevices[n].version=i.FriendlyName),myDevices[n].sectionList=t.view[r].sectionList,myDevices[n].versionNumber=t.view[r].versionNumber,i.Warranty||(t.view[n].Warranty="Warranty: "+i.Warranty)):(myDevices.splice(n,1),n--)}else myDevices.splice(n,1),n--;t.view=myDevices;t.versionselected=t.view[0]}},tt=function(){if(!gotDevices)if(d)w.resolveAuthState().then(function(n){var t=w.getSupportedIDP();n===t.MSA&&o.DevicesUIConfiguration.DevicesEnabled&&l.getDevices().then(function(n){n!=null&&(gotDevices=!0,myDevices=n.data,nt())},function(){})});else{var n=o.authInfo.isLoggedIn();o.DevicesUIConfiguration.DevicesEnabled&&n&&l.getDevices().then(function(n){n!=null&&(gotDevices=!0,myDevices=n.data,nt())},function(){})}},ut=function(n){t.isProductSelectorPage=!1;t.isProductHubPage=!1;t.isTopicHubPage=!1;switch(n){case"selector":t.isProductSelectorPage=!0;break;case"hub":t.isProductHubPage=!0;break;case"topic":t.isTopicHubPage=!0}};t.scrollToStep=function(n){s.scrollTo("#products-right-section-"+n)};t.followLink=function(n){if(!n||!n.pageUrl||!n.pageUrl.linkUrl)return f.error("Invalid Link: ",n);var t=n.pageUrl.linkUrl;a.checkUrlandFollowPath(t)};t.seeMoreProducts=function(n,i){var r={product:n,isAccessory:i};i?t.seeAllAccessories?(t.seeAllAccessories=!1,t.seeMoreAccessoryTitle=t.seeAllTitle,t.limitAccessories=t.minLimit):(t.seeAllAccessories=!0,t.seeMoreAccessoryTitle=t.seeLessTitle,t.limitAccessories=t.subproductsList.length):t.seeAllProducts?(t.seeAllProducts=!1,t.seeMoreProductsTitle=t.seeAllTitle,t.limitProducts=t.minLimit):(t.seeAllProducts=!0,t.seeMoreProductsTitle=t.seeLessTitle,t.limitProducts=t.subproductsList.length)};t.$on("CompassContentReady",function(){g()});t.$on("ProductPagesTimeout",function(){n.$broadcast("500Error",{reason:"Timeout occurred on a product page",data:t.status})});n.$on("404Error",function(n,i){t.errorStatus||i&&i.preventError||(t.errorStatus="404",t.status.waitingOnCompass=!1)});d?t.$on("UserSignedInMSA",function(){tt()}):t.$on("UserSignedIn",function(){tt()});t.reset()}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("ProductListController",["$rootScope","$scope","$location","$window","$log","clientConfig","languageService","compassService","contentApiService","flightService","productPagesService","authService",function(n,t,r,u,f,e,o,s,h,c,l){var p=c.isUserInFlight("aad-1"),v,y,w=function(){if(!y&&!p){var n=e.authInfo.isLoggedIn();n&&k()}},k=function(){h.getDevices().then(function(n){n!=null&&(y=!0,v=n.data,d())},function(){})},d=function(){for(i=0;i<v.length;i++){var n=v[i];n.FormFactor==="Phone"?a("17947",n):n.FormFactor==="Tablet"?a("17688",n):n.FormFactor==="PC"||n.FormFactor==="Laptop"?a("509",n):n.FormFactor==="Console"&&a("7230",n)}},b=function(){var r,n,i,u;if(t.productLimit=12,r=s.getProductView(),r){if(t.view=r,n=r,n.products&&n.products.length>0){for(i=0;i<n.products.length;i++)n.products[i].subversions.length>0&&(u=l.checkProductforOSDetection(n.products[i]),n.products[i].pageUrl.linkUrl=u,n.products[i].url=u);t.view=n}w()}},a=function(n,i){var r=g(n);r[0]&&t.view.products.unshift({name:i.FriendlyName,model:i.Model,url:r[1],isUserDevice:!0,image:{url:i.IconSource},ecoId:n})},g=function(n){var i,r;if(t.view&&t.view.products)for(j=0;j<t.view.products.length;j++)if(i=t.view.products[j].ecoId.split(","),$.inArray(n,i)>-1&&!t.view.products[j].isUserDevice)return r=t.view.products[j].url,t.view.products.splice(j,1),[!0,r];return!1};t.followLink=function(n){if(!n||!n.url)return f.error("Invalid Link: ",n);var t=n.url;l.checkUrlandFollowPath(t)};t.reset=function(){y=!1;b()};t.reset();t.$on("CompassContentReady",function(){b()});p||t.$on("UserSignedIn",function(){w()})}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("ProductModalController",["$rootScope","$scope","$log","$uibModal","compassService","contentApiService","currentProduct",function(n,t,i,r,u,f,e){var o,h,s;if(t.config={},o=e.product,t.isAccessory=e.isAccessory,!o||!o.productItem||!o.productItem.url)return i.error("Invalid Link: ",o);h=o.productItem.url;s=u.getProductDetails(h);s&&(t.modalProductView=s);t.close=function(){t.$close(t.config)};t.cancel=function(){t.$dismiss("cancel")};t.assets={}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("productPagesService",["$rootScope","$log","$location","$window","languageService","locationService","osService",function(n,t,i,r,u,f,e){this.checkProductforOSDetection=function(n){var i,h,r,t,o,s;if(n&&n.url){if(i=n.url,h="products/",n.subversions.length>0){var c=e.getOS(),l=this.getVersionValue(c),f="/?os=",u=!1;for(r=0;r<n.subversions.length;r++)if(t=n.subversions[r],o=i.search(f),o!=-1){t=i;u=!0;break}else if(s=t.substring(f.length-1,t.length),s===l){t=i+n.subversions[r];u=!0;break}return u||(t=i+n.subversions[0]),t}return n.url}};this.getParentPath=function(n){var r=n.split("/"),u,t,i;if(r.length-2!=0){for(u=r.length-1,t="products/",i=1;i<u;i++)t=t+r[i]+"/";return t}return n[n.length-1]!=="/"?n+"/":n};this.getVersionValue=function(n){if(n){var t=n.toLowerCase();return t.split(" ").join("-")}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.config(["$httpProvider",function(n){n.interceptors.push("devicesErrorInterceptor")}]).run(["virtualAgentTelemetryService","lifecycleTelemetryService",function(){}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("autoSuggest",["$rootScope","$timeout","$document",function(n,t,i){return{restrict:"A",templateUrl:function(n,t){return t.templateUrl},scope:{queryFunction:"&",submitHandler:"&",queryModelMapper:"&?",suggestionHtmlGenerator:"&?",inputQuery:"=",selectedSuggestion:"=?"},link:function(r,u,f){function v(n){if(s==0||n&&n.length>=s){e=n;var t=r.queryFunction({query:n});t.then(function(n){r.result=n})}}function a(){t(function(){r.isVisible=!1},0)}function y(){r.isVisible=!0;r.$digest()}function p(n,t){var u=r.result.suggestions.indexOf(r.selected),i=Math.abs(t-n);i=i==0?0:i/(t-n);u===-1?(r.selected=r.result.suggestions[n],r.selectedSuggestion&&(r.selectedSuggestion.selected=r.result.suggestions[n])):u===t?(r.selected=null,r.selectedSuggestion&&(r.selectedSuggestion.selected=null)):(r.selected=r.result.suggestions[u+i],r.selectedSuggestion&&(r.selectedSuggestion.selected=r.result.suggestions[u+i]));b()}function k(t){if(r.result&&r.result.suggestions&&r.result.suggestions.length)if(t.which===27)a();else{if(r.isVisible==!1&&y(),t.which===40)return p(0,r.result.suggestions.length-1),r.$digest(),!1;if(t.which===38)return p(r.result.suggestions.length-1,0),r.$digest(),!1;t.which===13&&(r.selected&&h&&n.$broadcast(h,{suggestion:r.selected,query:e}),r.result&&(r.result.suggestions=[]),r.$digest())}}function w(n){angular.equals(i[0].activeElement,o[0])&&(r.selected&&n===c(r.selected)||n===e||l||(l=!0,v(n),t(function(){l=!1;w(r.inputQuery)},300)))}function b(){r.inputQuery=r.selected!==null?c(r.selected):e}function c(n){if(r.queryModelMapper&&typeof r.queryModelMapper=="function")return r.queryModelMapper({suggestion:n});if(typeof n=="string")return n;throw new Error("queryModelMapper function missing");}var o=$(f.inputSource),e="",l=!1,h=f.telemetryEventName,s=f.minimumLetters?parseInt(f.minimumLetters,10):0;s=s<0?0:s;r.isVisible=!1;r.generateSuggestionHtml=function(n){if(r.suggestionHtmlGenerator&&typeof r.suggestionHtmlGenerator=="function"){var t=e.toLowerCase();return r.suggestionHtmlGenerator({query:t,suggestion:c(n)})}return c(n)};r.isSelected=function(n){return n===r.selected};r.clickSuggestion=function(i){r.selected=i;r.selectedSuggestion&&(r.selectedSuggestion.selected=i);b();a();t(function(){h&&n.$broadcast(h,{suggestion:r.selected,query:e});r.submitHandler({})},0)};t(function(){o=$(f.inputSource);r.$watch("inputQuery",w);o.keydown(k);o.focus(y);o.blur(a);v("")},0)}}}]),function(n){n.factory("autoSuggestFactory",["$injector","clientConfig",function(n,t){var i=t.AutosuggestConfig;return i&&i.Utility&&i.Utility==="DGPS"?n.get("dgpsAutoSuggestService"):n.get("bingAutoSuggestService")}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("bingAutoSuggestService",["$http","$rootScope","clientConfig","languageService",function(n,t,i,r){var u=i.AutosuggestConfig;this.getSuggestions=function(t){if(t===""||!u.Enabled)return null;var r=e(t),i={};return n.get(r).then(function(n){f(n.data)||o(i,n.data)}),i};var f=function(n){return!n||!n.AS||!n.AS.Results?(t.$broadcast("AutoSuggestBadResults",n),!0):!1},e=function(n){var t=u.ServiceUri,i=u.AppId;return t.replace("{0}",i).replace("{1}",n).replace("{2}",r.langLocale())},o=function(n,t){var i=t.AS.Results.filter(function(n){return n.Type==="AS"})[0].Suggests;n.suggestions=i.map(function(n){return n.Txt})}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("dgpsAutoSuggestService",["$http","$q","$filter","$log","clientConfig","languageService","osService","qosTelemetryService",function(n,t,i,r,u,f,e,o){function s(n){return!n||n==="null"?!0:n.AutoSuggestions?!1:!0}function h(n){var t=u.AutosuggestConfig.ServiceUri;return t=t.replace("{0}",encodeURIComponent(n)),t=t.replace("{1}",f.langLocale()),t.replace("{2}",e.getOS())}function c(n){return i("limitTo")(n.AutoSuggestions,10)}this.getSuggestions=function(i){var f=t.defer(),a=e.isCorsEnabled(),l;return!u.AutosuggestConfig.Enabled||!a?f.promise:(l=h(i),n.get(l).then(function(n){var t=n.data,i;s(t)?(t&&t!=="null"&&(r.error("Improperly structured Dynamic GPS result set",t),o.createEvent(o.eventTypes.dgps.invalid).reject({results:t})),f.reject(t)):(i=c(t),f.resolve({suggestions:i}))},function(n){f.reject(n)}),f.promise)}}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("instantAnswer",["$sce","$timeout","$rootScope","virtualAgentFeedbackService","focusContentService","smoothScrollService",function(n,t,i,r,u,f){return{restrict:"A",templateUrl:"/PartialViews/Search/InstantAnswer.html",scope:{answer:"=instantAnswer",view:"=",feedbackAction:"&?",target:"=?",displaySurvey:"=?hasSurvey",displayFeedback:"=?hasFeedback",maxHeight:"=?"},link:function(e,o){function s(){e.instantAnswerStyle={};e.hasShowMoreButton=!1;e.inShowMoreState=!1}e.reset=function(){e.target=e.target||"_blank";e.displayFeedback===undefined&&(e.displayFeedback=!0);e.solution=e.solution||{active:e.answer&&e.answer.solutions&&e.answer.solutions.length>0?e.answer.solutions[0]:null};e.instantAnswerFeedbackName="instant-answer-feedback";e.feedbackSuccessActive=!1;e.feedbackFailureActive=!1;e.maxHeight&&e.setShowMoreLessState();$(o).find("a").on("mousedown",function(){e.pingbackUrl=r.getClickUrl({resultId:e.answer.resultId,link:this.href});e.$digest()})};e.setShowMoreLessState=function(){s();t(function(){e.hasShowMoreButton=o.prop("offsetHeight")>e.maxHeight;e.toggleShowMoreLess(e.hasShowMoreButton);e.hasShowMoreButton&&i.$broadcast("InstantAnswerCollapsable",{name:e.answer.problem.name,resultId:e.answer.resultId,sourceId:e.answer.sourceId,maxHeight:e.maxHeight,elemHeight:o.prop("offsetHeight")})})};e.toggleShowMoreLess=function(n){e.inShowMoreState=n;n?e.instantAnswerStyle["max-height"]=e.maxHeight:e.instantAnswerStyle={}};e.trustSrc=function(t){return n.trustAsResourceUrl(t)};e.provideFeedback=function(n){e.feedbackProvided=!0;e.feedbackResult=n;u.focus(e.instantAnswerFeedbackName);f.scroll(e.instantAnswerFeedbackName);e.feedbackAction&&e.feedbackAction({feedback:n,id:e.answer.resultId})};e.setFeedbackSuccessActiveState=function(n){e.feedbackSuccessActive=n};e.setFeedbackFailureActiveState=function(n){e.feedbackFailureActive=n};e.reset()}}}])}(angular.module(microsoft.support.moduleName));angular.module(microsoft.support.moduleName).directive("paginator",["$document",function(n){return{restrict:"A",require:"ngModel",templateUrl:"/PartialViews/Search/Paginator.html",scope:{maxCount:"=",view:"="},link:function(t,i,r,u){function e(n){var o,i,e,u;for(t.lastPage=!1,o=n<f+1?1:n-f,i=n+f,i>t.maxCount/r.itemsPerPage&&(i=Math.ceil(t.maxCount/r.itemsPerPage),t.lastPage=n==i),e=[],u=o;u<=i;++u)e.push(u);return e}var f=4;t.ngModel=u;t.lastPage=!1;t.selectPage=function(i){u.$setViewValue(i);t.pages=e(i);n[0]&&n[0].activeElement&&n[0].activeElement.blur()};t.$watch("maxCount",function(){t.selectPage(u.$viewValue||1)})}}}]),function(n){n.controller("SearchController",["$scope","$rootScope","$route","$location","compassService","languageService","osService","clientConfig","flightService","autoSuggestFactory","searchResultsService","supportLinkService","authenticationHelperService","osService","browserService","productPagesService","notificationBannerService","authService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,e,v,y,p,w){function k(){var i=u.getSearchView(),t,r;i&&(n.view=i);t=u.getPremierHomeView();r=u.getPremierHomeView2();t&&(n.alerts=t.siteAlerts,n.view.premierQuickNavLinks=r.quickNavLinks);g()}function d(){n.displayAllContent=i.current&&i.current.data&&i.current.data.isLandingPage==!0;n.isCommercial=i.current&&i.current.data&&i.current.data.isCommercial==!0;n.enablePremierAlert=i.current&&i.current.data&&i.current.data.enablePremierAlert==!0;n.isSkylightNavFlight=s.isUserInFlight("vac-16")&&i.current&&i.current.data&&i.current.data.hasSkylightEntry;g()}function g(){var i,f,e,o,h,s,t;if(b.notificationBanner)n.bannerPlacement="",n.bannerPlacement=p.getBannerPlacementFromCompass();else if(i=u.getNotificationBanner(),n.bannerPlacement="",i){if(n.hasBanner=!1,n.banner=i,f=!0,n.banner&&n.banner.exclusionPageList)for(e=n.banner.exclusionPageList,t=0;t<e.length;t++)r.path().search(e[t])>-1&&(f=!1);if(o=!1,n.banner&&n.banner.associatedOSList)for(h=y.getVersionValue(n.osVersion),s=n.banner.associatedOSList,t=0;t<s.length;t++)h==s[t]&&(o=!0);o==!0&&f==!0&&(n.hasBanner=!0,n.isRight=!0,n.bannerPlacement=n.displayAllContent?"above-search":"below-search")}}var tt=s.isUserInFlight("aad-1"),nt=h,b={};n.reset=function(){n.userQuery=r.search().query||"";n.userQuery=unescape(n.userQuery);n.osVersion=e.getOS();n.browser=v.determineBrowser();t.isEnterprisePage=!1;d();k();b={notificationBanner:s.isUserInAnyFlight(["mnb-1"])}};n.primarySearchClicked=function(){n.userQuery&&(t.$broadcast("SearchPrimaryClicked",{Location:"Primary",SearchString:n.userQuery}),r.url(c.getSearchResultsUrl(n.userQuery)))};n.linkClick=function(n,t){switch(t){case"contact-support":var i=f.langLocale()+"/contactus/";r.path(i);n.preventDefault()}};n.getCompleteText=function(n){return n.CompletionText};n.getSuggestions=function(n){return nt.getSuggestions(n)};n.generateSuggestionHtml=function(n,t){return n!=undefined&&t!=undefined?(n=n.toLowerCase(),!n.length)?t:(n+=n==="b"?" ":"",t="<b>"+t.toLowerCase()+"<\/b>",t.replace(n,"<\/b>"+n+"<b>")):""};n.$on("$routeChangeSuccess",function(){d()});n.$on("CompassContentReady",function(){k()});n.checkVisibility=function(t){return t&&(t.key==="contact-support"&&n.isEnterprisePage||t.key==="microsoft-account"&&w.isSignedInAAD()||t.key==="work-account"&&!w.isSignedInAAD())?!0:!1};n.userLocale=f.langLocale();n.reset()}])}(angular.module(microsoft.support.moduleName)),function(n){n.directive("searchResult",["virtualAgentFeedbackService",function(n){return{restrict:"A",templateUrl:"/PartialViews/Search/SearchResult.html",scope:{result:"=searchResult",id:"=",size:"=?",target:"=?",showLink:"=?"},link:function(t){t.size=t.size||"medium";t.target=t.target||"_self";t.selectResult=function(){t.pingbackUrl=t.result.pingbackUrl;t.result.resultId&&(t.pingbackUrl=n.getClickUrl(t.result))}}}}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("SearchResultsController",["$scope","$routeParams","$window","osService","searchResultsService","compassService","clientConfig","locationService",function(n,t,i,r,u,f,e,o,s){function c(){if(n.userQuery.length){n.results=[];n.answer=null;n.isSearching=!0;var t={query:n.userQuery,queryChannel:"search",page:n.currentPage};u.fetchResults(t).then(l,a)}}function l(t){n.count=t.totalCount;n.results=t.results;n.answer=t.instantAnswer;n.isSearching=!1;r.isMobile()&&s.scrollTo("search-results-container")}function a(){n.isSearching=!1}function h(){var t=f.getSearchResultsView();t&&(n.view=t)}n.reset=function(){n.userQuery=t.query||"";n.userQuery=unescape(n.userQuery);n.currentPage=1;n.results=[];n.answer=null;n.isSearching=!1;n.devicesEnabled=e.SearchConfig.DeviceRefinementEnabled;h()};n.generalSearch=function(){i.location.href=n.view.generalSearchLink.linkUrl.replace("{0}",encodeURIComponent(n.userQuery))};n.$watch("currentPage",function(){c()});n.$on("SearchResultsTimeout",function(){n.isSearching=!1});n.$on("CompassContentReady",function(){h()});n.reset()}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("searchResultsService",["$http","$rootScope","languageService","virtualAgentService","flightService",function(n,t,i,r,u){function e(n){if(n&&n.HelpContent){helpContent=n.HelpContent.replace(new RegExp(String.fromCharCode(57356),"g"),"<strong>").replace(new RegExp(String.fromCharCode(57344),"g"),"<strong>").replace(new RegExp(String.fromCharCode(57357),"g"),"<\/strong>").replace(new RegExp(String.fromCharCode(57345),"g"),"<\/strong>");return f(JSON.parse(helpContent))}return null}function f(n){var i=!1,r=0;for(var t in n)n.hasOwnProperty(t)&&(r++,angular.isObject(n[t])&&(n[t]=f(n[t])),i=t==="value");return i&&r===1?n.value:n}function o(n){var t=n.Title.replace(/\<\/?strong\>/g,"");return{simpleTitle:t,title:n.Title,description:n.Description,link:n.Link,displayLink:n.DisplayLink,pingbackUrl:n.PingbackUrl}}this.fetchResults=function(i){if(r.isEnabled()&&!(u.isUserInFlight("vac-5")&&i.queryChannel=="contactus"))return r.fetchContent(i);var f={params:{query:encodeURIComponent(i.query),page:i.page}};return i.shouldRequestErrorCrashExperience!==undefined&&(f.params.shouldRequestErrorCrashExperience=i.shouldRequestErrorCrashExperience),n.get("/api/search/index",f).then(function(n){var r=n.data.Results.map(o),i={};return i.results=r,i.totalCount=n.data.TotalCount,i.instantAnswer=e(n.data),t.$broadcast("SearchResponse",{item:i,caller:"search"}),i})};this.getSearchResultsUrl=function(n){return"/"+i.langLocale()+"/search?query="+encodeURIComponent(n)}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("appCommandQosTelemetryService",["$rootScope","$timeout","clientConfig","qosTelemetryService","contactCommands","nativeAppService",function(n,t,i,r,u,f){function s(n){return h.some(function(t){return n===t})}function c(t){var i,r;f.isUnderstoodCommand(t)?(i="//app/command-error",r="Command: "+t+" failed"):(i="//app/unknown-command",r="Unknown command: "+t+" failed");n.$broadcast("Qos",{operation:i,status:500,custom:r})}var h=[u.beginSharing,u.pauseSharingByUser,u.resumeSharingByUser,u.endSharingByUser],e=this,o={timeout:i.AppConfig&&i.AppConfig.AppCommandTimeoutInMilliseconds};this.qosActions={};n.$on("AppActionStart",function(n,i){if(s(i)){e.qosActions[i]?e.qosActions[i].length>=1&&r.createEvent(r.eventTypes.app.dupeCommandError).reject(i):e.qosActions[i]=[];var u=r.createEvent(i);e.qosActions[i].push({promise:u,timer:t(function(){u.reject(i+" timed out after "+o.timeout+" milliseconds.")},o.timeout)})}});n.$on("AppActionEnd",function(n,i){var r=i.command,u;s(r)?e.qosActions[r]&&e.qosActions[r].length>0&&(u=e.qosActions[r].shift(),t.cancel(u.timer),i.success?u.promise.resolve():u.promise.reject(r)):c(r)})}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("callbackTelemetryService",["$rootScope","$cookies","clientConfig","clientTelemetryService","nativeAppService","languageService","rccService","serverInfo","phoneNumberService","chatStateService","wedcsService","virtualAgentService",function(n,t,i,r,u,f,e,o,s,h,c,l){var y="callbackAction",a={unknown:"unknown",EnqueueImmediateCallback:"enqueueImmediateCallback",EnqueueScheduledCallback:"enqueueScheduledCallback",EnqueueCallback:"enqueueCallback"},v=function(n,i){var u={name:"Microsoft.Mac.SelfAssist.CallbackAction",content:{"Microsoft.Mac.SelfAssist.CallbackAction":{actionName:n,callbackTime:i&&i.timeslot?i.timeslot:"",errorCode:i&&i.errorCode?i.errorCode:"",immediateCallbackDelay:i&&!(i.immediateCallbackDelay==null)?i.immediateCallbackDelay:1,subjectName:e.getSubjectName()?e.getSubjectName():"",countryCode:i.locale?s.selectCountryCode(i.locale).code:"",subjectId:h.getSubject()?h.getSubject().toString():"",visitId:h.getVisitId()?h.getVisitId():"",enqueueId:h.getEnqueueId()?h.getEnqueueId().toString():"",skylightId:l.sessionId()||"",interactionId:i&&i.interactionId?i.interactionId:"",wedcsId:t.get("MSFPC"),context:i?JSON.stringify(i):""}}};u=r.populateDefaultFields(u);r.pushEvent(u)};n.$on("EnqueueCallbackFailure",function(n,t){v(a.EnqueueCallback,t)});n.$on("EnqueueCallbackSuccess",function(n,t){var i,r;c.logCustomEvent("callback-requested",y);i=JSON.parse(t.methodParameters.context);i.timeslot?(t.timeslot=i.timeslot,v(a.EnqueueScheduledCallback,t)):(r=e.getEstimatedCallbackWaitTime(t.methodParameters.subject),r&&(t.immediateCallbackDelay=r.AverageWaitTime),v(a.EnqueueImmediateCallback,t))})}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("chatTelemetryService",["$rootScope","$window","$cookies","clientConfig","serverInfo","chatStateService","clientTelemetryService","rccService","wedcsService","metaTagsService","virtualAgentService",function(n,t,i,r,u,f,e,o,s,h,c){function v(n,t){h.addOrUpdateMetaTag("ms.subjectId",f.getSubject()||"");var i={};t&&(i["ms.scvalue"]=t);s.logCustomEvent(n,y,i)}var y="chatAction",l={unknown:"unknown",chatFeedback:"chatFeedback",chatFeedbackFlighted:"chatFeedbackFlighted",chatRequested:"chatRequested",chatEnded:"chatEnded",endChatClicked:"endChatClicked",chatMessageSent:"chatMessageSent",chatMessageRecieved:"chatMessageRecieved",chatSessionEstablished:"chatSessionEstablished",agentDataReady:"agentDataReady",chatInitComplete:"chatInitComplete",enqueueChat:"enqueueChat",dequeueChat:"dequeueChat",chatExtendedWait:"chatExtendedWait",chatQueueStatus:"chatQueueStatus",chatTransferred:"chatTransferred",chatLongQueue:"chatLongQueue",chatScreenShareAccept:"chatScreenShareAccept",chatScreenShareDenied:"chatScreenShareDenied",chatScreenShareEstablished:"chatScreenShareEstablished",chatScreenShareRequest:"chatScreenShareRequest",chatScreenShareError:"chatScreenShareError",chatScreenShareConnectFailed:"chatScreenShareConnectFailed",html5Hotification:"html5Hotification",chatSurveyDisplayed:"chatSurveyDisplayed",cvExtention:"cvExtention",awasaVisitId:"awasaVisitId",awasaEnqueueId:"awasaEnqueueId",awasaChatId:"awasaChatId",chatReset:"chatReset",doubleChatEnqueued:"doubleChatEnqueued",passcodeSuccess:"passcodeSuccess",passcodeFailure:"passcodeFailure",prechatText:"prechatText",chatVideoPresent:"chatVideoPresent",chatVideoToggled:"chatVideoToggled",chatVideoPlaying:"chatVideoPlaying",chatVideoPaused:"chatVideoPaused",chatVideoEnded:"chatVideoEnded",chatVideoError:"chatVideoError",chatVideoSession:"chatVideoSession",chatVideoMinTimeEngaged:"chatVideoMinTimeEngaged",chatVideoAlertResponse:"chatVideoAlertResponse",chatVideoInfo:"chatVideoInfo",chatVideoAutoToggle:"chatVideoAutoToggle",malformedUnauthenticatedToken:"malformedUnauthenticatedToken",malformedUnauthenticatedTokenFromHip:"malformedUnauthenticatedTokenFromHip",malformedUnauthenticatedTokenFromRefresh:"malformedUnauthenticatedTokenFromRefresh",malformedUnauthenticatedTokenInitialRccLoad:"malformedUnauthenticatedTokenInitialRccLoad",malformedUnauthenticatedTokenRccAlreadyLoaded:"malformedUnauthenticatedTokenRccAlreadyLoaded",chatWaitTimeEstimate:"chatWaitTimeEstimate",chatWaitTimeActual:"chatWaitTimeActual",chatLongEstimate:"chatLongEstimate",unauthAuthFallback:"unauthToAuthFallback"},a=function(n,r,u){r=typeof r!="undefined"?r:"";u=u?u.toString():f.getEnqueueId()?f.getEnqueueId().toString():"";var s={name:"Microsoft.Mac.SelfAssist.ChatAction",content:{"Microsoft.Mac.SelfAssist.ChatAction":{actionName:n,agentID:f.getAgent()&&f.getAgent().AgentId?f.getAgent().AgentId.toString():"",activityID:f.getVisitId()?f.getVisitId():"",subjectName:o.getSubjectName()?o.getSubjectName():"",subjectId:f.getSubject()?f.getSubject().toString():"",visitId:f.getVisitId()?f.getVisitId():"",enqueueId:u,chatId:f.getChatId()?f.getChatId().toString():"",skylightId:c.sessionId()||"",pageHasFocus:t.document.hasFocus(),isRatMode:o.isRatMode(),wedcsId:i.get("MSFPC"),custom1:r,wedcsSessionId:i.get("MS0")}}};s=e.populateDefaultFields(s);e.pushEvent(s)};n.$on("ChatReset",function(){a(l.chatReset)});n.$on("DoubleChatEnqueued",function(){a(l.doubleChatEnqueued)});n.$on("ChatRequested",function(){a(l.chatRequested);v("chat-requested")});n.$on("AgentDataReady",function(){a(l.agentDataReady)});n.$on("ChatSessionEstablished",function(){a(l.chatSessionEstablished);v("chat-established")});n.$on("ChatInitComplete",function(){a(l.chatInitComplete)});n.$on("ChatMessageReceived",function(){a(l.chatMessageRecieved)});n.$on("EndChatClicked",function(){a(l.endChatClicked)});n.$on("ChatSessionClosed",function(){a(l.chatEnded);v("chat-ended")});n.$on("ChatMessageSendSuccess",function(){a(l.chatMessageSent)});n.$on("ChatExtendedWait",function(){a(l.chatExtendedWait)});n.$on("ChatQueueStatus",function(n,t){a(l.chatQueueStatus,t.position+"")});n.$on("ChatFeedback",function(n,t){a(l.chatFeedback,JSON.stringify(t));v("chat-feedback",t)});n.$on("ChatFeedbackFlighted",function(n,t){a(l.chatFeedbackFlighted,JSON.stringify(t))});n.$on("EnqueueChatSuccess",function(n,t){a(l.enqueueChat,t.waitTimeEstimate+"",t.enqueueId)});n.$on("ChatScreenShareAccept",function(){a(l.chatScreenShareAccept)});n.$on("ChatScreenShareDenied",function(){a(l.chatScreenShareDenied)});n.$on("ChatScreenShareEstablished",function(){a(l.chatScreenShareEstablished)});n.$on("ChatScreenShareRequest",function(){a(l.chatScreenShareRequest)});n.$on("ChatScreenShareError",function(n,t){a(l.chatScreenShareError,t.command+"")});n.$on("ChatScreenShareConnectFailed",function(){a(l.chatScreenShareConnectFailed)});n.$on("ChatDisengageSuccess",function(){a(l.dequeueChat)});n.$on("ChatTransferred",function(){a(l.chatTransferred);v("chat-transfer")});n.$on("ChatLongQueue",function(){a(l.chatLongQueue)});n.$on("setParentCv",function(){t&&t.Asimov&&t.Asimov.cv&&f.setParentCv(t.Asimov.cv.getValue())});n.$on("chatSurveyDisplayed",function(){a(l.chatSurveyDisplayed)});n.$on("Html5Notification",function(n,t){a(l.html5Hotification,t)});n.$on("cvExtention",function(n,t){a(l.cvExtention,t)});n.$on("awasaVisitId",function(n,t){a(l.awasaVisitId,t.toString())});n.$on("awasaEnqueueId",function(n,t){a(l.awasaEnqueueId,t.toString())});n.$on("awasaChatId",function(n,t){a(l.awasaChatId,t.toString())});n.$on("PasscodeSuccess",function(){a(l.passcodeSuccess)});n.$on("PasscodeFailure",function(n,t){a(l.passcodeFailure,t)});n.$on("PrechatText",function(n,t){a(l.prechatText,t)});n.$on("ChatVideoPresent",function(n,t){a(l.chatVideoPresent,t+"")});n.$on("ChatVideoToggled",function(n,t){a(l.chatVideoToggled,t+"")});n.$on("ChatVideoPlaying",function(n,t){a(l.chatVideoPlaying,t+"")});n.$on("ChatVideoPaused",function(n,t){a(l.chatVideoPaused,t+"")});n.$on("ChatVideoEnded",function(n,t){a(l.chatVideoEnded,t+"")});n.$on("ChatVideoInfo",function(n,t){a(l.chatVideoInfo,JSON.stringify(t))});n.$on("ChatVideoError",function(n,t){a(l.chatVideoError,JSON.stringify(t))});n.$on("ChatVideoSession",function(){a(l.chatVideoSession)});n.$on("ChatVideoMinTimeEngaged",function(){a(l.chatVideoMinTimeEngaged)});n.$on("ChatVideoAlertResponse",function(n,t){a(l.chatVideoAlertResponse,t+"")});n.$on("ChatVideoAutoToggle",function(){a(l.chatVideoAutoToggle)});n.$on("MalformedUnauthenticatedToken",function(n,t){a(l.malformedUnauthenticatedToken,t+"")});n.$on("MalformedUnauthenticatedTokenFromHip",function(n,t){a(l.malformedUnauthenticatedTokenFromHip,t+"")});n.$on("MalformedUnauthenticatedTokenFromRefresh",function(n,t){a(l.malformedUnauthenticatedTokenFromRefresh,t+"")});n.$on("MalformedUnauthenticatedTokenInitialRccLoad",function(n,t){a(l.malformedUnauthenticatedTokenInitialRccLoad,t+"")});n.$on("MalformedUnauthenticatedTokenRccAlreadyLoaded",function(n,t){a(l.malformedUnauthenticatedTokenRccAlreadyLoaded,t+"")});n.$on("ChatWaitTimeEstimate",function(n,t){a(l.chatWaitTimeEstimate,t+"")});n.$on("ChatWaitTimeActual",function(n,t){a(l.chatWaitTimeActual,t+"")});n.$on("ChatLongEstimate",function(n,t){a(l.chatLongEstimate,t+"")});n.$on("UnauthAuthFallback",function(){a(l.unauthAuthFallback)})}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("clientTelemetryService",["clientConfig","$window","$location","$cookies","nativeAppService","languageService","chatStateService","osService","flightService","$injector",function(n,t,i,r,u,f,e,o,s,h){var l=s.isUserInFlight("aad-1"),c;t&&t.Asimov&&(t.Asimov.appId="JS:"+i.host());this.pushEvent=function(n){t&&t.Asimov&&t.Asimov.writeEvent&&t.Asimov.writeEvent(n)};this.populateDefaultFields=function(i){var a,c,s;return i.content[i.name].userAgent=t.navigator.userAgent,i.content[i.name].server=n.UserPropertyConfig&&n.UserPropertyConfig.EnvironmentType!==undefined?n.UserPropertyConfig.EnvironmentType:"",i.content[i.name].muid=r.get("MUID"),l?(a=h.get("authService"),a?(c=a.getUserInfo(),i.content[i.name].puid=c&&c.puid?c.puid:"0"):i.content[i.name].puid="0"):i.content[i.name].puid=n.authInfo&&n.authInfo.puid!==undefined?n.authInfo.puid:"0",i.content[i.name].language=f.lang()?f.lang():"",i.content[i.name].locale=f.locale()?f.locale():"",i.content[i.name].isNative=u.isNative()?!0:!1,i.content[i.name].isMobile=o.isMobile(),i.content[i.name].partnerId=r.get("smcpartner"),i.content[i.name].flightId=r.get("smc_f"),i.content[i.name].parentCv=e.getParentCv()?e.getParentCv().toString():"",s=r.get("ANON"),s!=null&&s.length>2&&(i.content[i.name].anid=s.substring(2,s.indexOf("&"))),i};n&&n.ClientLogConfig&&n.ClientLogConfig.ScriptErrorLogging&&(t.onerror=function(n,t,i,r,u){var f;return f=u?u.stack:(new Error).stack,!0});c=r.get("MS-CV");t&&t.Asimov&&t.Asimov.CorrelationVector&&(c!==null&&t.Asimov.CorrelationVector.isValid(c)?t.Asimov.cv.setValue(c):t.Asimov.CorrelationVector.init&&(c=t.Asimov.CorrelationVector.init()),r.put("MS-CV",c,{domain:"microsoft.com",path:"/"}));t&&t.location&&t.location.host&&t.location.host.indexOf("partner")<0&&(u.isNative()?r.put("smcpartner","csapp"):r.put("smcpartner","smc")),function(){if(t&&t.Asimov){var n=t.Asimov._validateAndTranslateEvent;t.Asimov._validateAndTranslateEvent=function(i){var r;return r=n.call(t.Asimov,i),t.Asimov.appId!=null&&(r.event.appId=self.Asimov.appId),r}}}()}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("commercialTelemetryService",["$rootScope","wedcsService","clientTelemetryService",function(n,t,i){function e(n,t){var r={name:n,content:{}};r.content[n]=t;r=i.populateDefaultFields(r);i.pushEvent(r)}var u="commercialAction",f="premierIncidentCreation",r={incidentCreation:{productPicked:f+"ProductPicked",noSupportTopicOffered:f+"NoSupportTopicOffered",primarySupportTopicPicked:f+"PrimarySupportTopicPicked",secondarySupportTopicPicked:f+"SecondarySupportTopicPicked",productNotFound:f+"ProductNotFound",disclaimerDisplayed:f+"DisclaimerDisplayed",selectedEntitlementType:f+"SelectedEntitlementType",selectedSeverityValue:f+"SelectedSeverityValue",scopingQuestionsDisplayed:f+"ScopingQuestionsDisplayed",fileAttached:f+"FileAttached",fileMaxSizeError:f+"FileMaxSizeError",fileMaxNumberError:f+"FileMaxNumberError",selectedContactMethod:f+"SelectedContactMethod",userLanguage:f+"UserLanguage",newCaseId:f+"NewCaseId",hasDiagnosticLink:f+"HasDiagnosticLink"}};this.logUpdateIncident=function(n,t,i,r){e("Microsoft.Mac.SelfAssist.CommercialIncidentAction",{incidentId:n,fileCount:i,timeInMs:t,actionName:"UpdateIncidentInclusive",actionResult:r})};this.logCreateIncident=function(n,t,i,r){e("Microsoft.Mac.SelfAssist.CommercialIncidentAction",{incidentId:n,fileCount:i,timeInMs:t,actionName:"CreateIncidentInclusive",actionResult:r})};n.$on(r.incidentCreation.productPicked,function(n,i){t.logCustomEvent(r.incidentCreation.productPicked,u,{"ms.scvalue":i.pesId,"wcs.cid":i.elementId})});n.$on(r.incidentCreation.noSupportTopicOffered,function(n,i){t.logCustomEvent(r.incidentCreation.noSupportTopicOffered,u,{"ms.scvalue":i})});n.$on(r.incidentCreation.primarySupportTopicPicked,function(n,i){t.logCustomEvent(r.incidentCreation.primarySupportTopicPicked,u,{"ms.scvalue":i.primarySupportTopicId,"wcs.cid":i.elementId})});n.$on(r.incidentCreation.secondarySupportTopicPicked,function(n,i){t.logCustomEvent(r.incidentCreation.secondarySupportTopicPicked,u,{"ms.scvalue":i.secondarySupportTopicId,"wcs.cid":i.elementId})});n.$on(r.incidentCreation.productNotFound,function(n,i){t.logCustomEvent(r.incidentCreation.productNotFound,u,{"ms.scvalue":i})});n.$on(r.incidentCreation.disclaimerDisplayed,function(n,i){t.logCustomEvent(r.incidentCreation.disclaimerDisplayed,u,{"ms.scvalue":i})});n.$on(r.incidentCreation.selectedEntitlementType,function(n,i){t.logCustomEvent(r.incidentCreation.selectedEntitlementType,u,{"ms.scvalue":i})});n.$on(r.incidentCreation.selectedSeverityValue,function(n,i){t.logCustomEvent(r.incidentCreation.selectedSeverityValue,u,{"ms.scvalue":i})});n.$on(r.incidentCreation.scopingQuestionsDisplayed,function(n,i){t.logCustomEvent(r.incidentCreation.scopingQuestionsDisplayed,u,{"ms.scvalue":i})});n.$on(r.incidentCreation.fileAttached,function(n,i){t.logCustomEvent(r.incidentCreation.fileAttached,u,{"ms.scvalue":i})});n.$on(r.incidentCreation.fileMaxSizeError,function(n,i){t.logCustomEvent(r.incidentCreation.fileMaxSizeError,u,{"ms.scvalue":i})});n.$on(r.incidentCreation.fileMaxNumberError,function(n,i){t.logCustomEvent(r.incidentCreation.fileMaxNumberError,u,{"ms.scvalue":i})});n.$on(r.incidentCreation.selectedContactMethod,function(n,i){t.logCustomEvent(r.incidentCreation.selectedContactMethod,u,{"ms.scvalue":i})});n.$on(r.incidentCreation.userLanguage,function(n,i){t.logCustomEvent(r.incidentCreation.userLanguage,u,{"ms.scvalue":i})});n.$on(r.incidentCreation.newCaseId,function(n,i){t.logCustomEvent(r.incidentCreation.newCaseId,u,{"ms.scvalue":i})});n.$on(r.incidentCreation.hasDiagnosticLink,function(n,i){t.logCustomEvent(r.incidentCreation.hasDiagnosticLink,u,{"ms.scvalue":i})})}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("contactUsTelemetryService",["$rootScope","clientTelemetryService","wedcsService",function(n,t,i){n.$on("RoutingServiceResult",function(n,t){i.logCustomEvent("cadworkflow","machinelearning",{"ms.scvalue":JSON.stringify(t)})})}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("correlationVectorService",["$window","$rootScope","$cookies",function(n,t,i){this.extendCv=function(){if(n&&n.Asimov&&n.Asimov.cv){n.Asimov.cv.extend();var r=i.get("MS-CV");r&&n.Asimov.CorrelationVector.isValid(r)&&i.put("MS-CV",n.Asimov.cv.getValue(),{domain:"microsoft.com",path:"/"});t.$broadcast("cvExtention",n.Asimov.cv.getValue())}};this.getValue=function(){return n&&n.Asimov&&n.Asimov.cv?n.Asimov.cv.getValue():""}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("geoTelemetryService",["$rootScope","wedcsService",function(n,t){var i={geoOptionsPresented:"geoOptionsPresented",geoAccess:"geoAccess",geoContinue:"geoContinue",geoNotAvailable:"geoNotAvailable"},r="geoAction";n.$on("GeoOptionsPresented",function(n,u){t.logCustomEvent(i.geoOptionsPresented,r,{"ms.scvalue":u})});n.$on("GeoContinue",function(n,u){t.logCustomEvent(i.geoContinue,r,{"ms.scvalue":u})});n.$on("GeoAccess",function(n,u){t.logCustomEvent(i.geoAccess,r,{"ms.scvalue":u})});n.$on("GeoNotAvailable",function(n,u){t.logCustomEvent(i.geoNotAvailable,r,{"ms.scvalue":u})})}])}(angular.module(microsoft.support.moduleName)),function(n){var t=function(n,t,i,r,u){var f={name:"Microsoft.Mac.SelfAssist.KbArticleAction",content:{"Microsoft.Mac.SelfAssist.KbArticleAction":{actionName:t,title:i,locale:r,articleId:u}}};return n.populateDefaultFields(f)},i={machineTranslatedArticleLoaded:"machineTranslatedArticleTranslated",machineTranslationFailed:"machineTranslationFailed"};n.service("kbTelemetryService",["clientTelemetryService",function(n){this.logMtArticleTranslated=function(r,u,f){var e="translation of articleId "+r+" succeeded in "+f+"ms",o=t(n,i.machineTranslatedArticleLoaded,e,u,r);n.pushEvent(o)};this.logMtArticleTranslationFailed=function(r,u,f){angular.isString(u)&&u.length!=0||(u="unspecified");var e="translation of articleId "+r+" failed for reason "+u,o=t(n,i.machineTranslationFailed,e,f,r);n.pushEvent(o)}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("logMeInTelemetryService",["$rootScope","$cookies","clientTelemetryService",function(n,t,i){var r={lmiEulaAccept:"lmiEulaAccept",lmiEulaReject:"lmiEulaReject",lmiPincodeError:"lmiPincodeError",lmiEulaFormSubmit:"lmiEulaFormSubmit"},u=function(n,r){r=typeof r!="undefined"?r:"";var u={name:"Microsoft.Mac.SelfAssist.LogMeInAction",content:{"Microsoft.Mac.SelfAssist.LogMeInAction":{actionName:n,wedcsId:t.get("MSFPC"),custom1:r}}};u=i.populateDefaultFields(u);i.pushEvent(u)};n.$on("LMIEulaAccept",function(){u(r.lmiEulaAccept)});n.$on("LMIEulaReject",function(){u(r.lmiEulaReject)});n.$on("LMIPincodeError",function(n,t){u(r.lmiPincodeError,t)});n.$on("LMIEulaFormSubmit",function(){u(r.lmiEulaFormSubmit)})}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("menuTelemetryService",["$window","$rootScope","$location","clientConfig","clientTelemetryService","nativeAppService","languageService","serverInfo",function(n,t,i,r,u){var f={unknown:"unknown",menuLinkClicked:"menuLinkClicked",menuExtraClicked:"menuExtraClicked"},e={nativeAppClosing:"nativeAppClosing",notifyAppClosingComplete:"notifyAppClosingComplete"},o=function(n,t){var i={name:"Microsoft.Mac.SelfAssist.SupportMenuAction",content:{"Microsoft.Mac.SelfAssist.SupportMenuAction":{actionName:n,link:t&&t.link&&t.link.linkUrl?t.link.linkUrl:""}}};i=u.populateDefaultFields(i);u.pushEvent(i)},l=function(n,t){var i={name:"Microsoft.Mac.SelfAssist.ContactUsAction",content:{"Microsoft.Mac.SelfAssist.ContactUsAction":{actionName:n,link:t&&t.link&&t.link.linkUrl?t.link.linkUrl:""}}};i=u.populateDefaultFields(i);u.pushEvent(i)},c=function(n){var t={name:"Microsoft.Mac.SelfAssist.SiteFeedback",content:{"Microsoft.Mac.SelfAssist.SiteFeedback":{actionName:"SiteFeedback",type:n&&n.type?n.type:"",comment:n&&n.comment?n.comment:""}}};t=u.populateDefaultFields(t);u.pushEvent(t)},s=function(){var n={name:"Microsoft.Mac.SelfAssist.PageAction",content:{"Microsoft.Mac.SelfAssist.PageAction":{actionName:"PageUnload",custom1:i.absUrl()}}};n=u.populateDefaultFields(n);u.pushEvent(n)},h=function(n){var t={name:"Microsoft.Mac.SelfAssist.SupportAppAction",content:{"Microsoft.Mac.SelfAssist.SupportAppAction":{actionName:n}}};t=u.populateDefaultFields(t);u.pushEvent(t)};t.$on("MenuLinkClicked",function(n,t){o(f.menuLinkClicked,t)});t.$on("MenuExtraClicked",function(n,t){o(f.menuExtraClicked,t)});t.$on("SiteFeedback",function(n,t){c(t)});t.$on("NativeAppClosing",function(){h(e.nativeAppClosing)});t.$on("NotifyAppClosingComplete",function(){h(e.notifyAppClosingComplete)});$(n).bind("unload",s);$(n).bind("onunload",s)}])}(angular.module(microsoft.support.moduleName)),function(n){n.factory("qosTelemetryInterceptor",["$q","$rootScope","$log",function(n,t,i){function u(n){return e.some(function(t){return t.test(n)})}function f(n){var i={};i.latency=(new Date).getTime()-n.config.startTime;i.status=n.status;i.operation=n.config.url;n.config&&n.config.httpAppOptions&&n.config.httpAppOptions.qosOperation&&(i.qosOperation=n.config.httpAppOptions.qosOperation);t.$broadcast("QoS",i)}function o(n){var i={};i.operation="//app/invalid-request";i.status=500;i.latency=0;i.custom=JSON.stringify(n);t.$broadcast("QoS",i)}var r={},e=[/html$/,/^\/\/caribe/];return r.request=function(n){return n.startTime=(new Date).getTime(),n},r.response=function(n){return n&&n.config&&!u(n.config.url)&&f(n),n},r.responseError=function(t){return t&&t.config&&!u(t.config.url)?f(t):o(t),i.error("Error occurred during http request",JSON.stringify(t)),n.reject(t)},r}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("qosTelemetryService",["$rootScope","$q","$window","$location","clientTelemetryService","chatStateService",function(n,t,i,r,u,f){function c(n){var t=n.operation.replace(/[?].*/,"");return t.match(/^\/api/)?t=t.split("/").splice(0,4).join("/"):t.match(/^https:\/\/dgps/)&&(t=o.dgps.suggest),t===o.awasa.error&&n.custom&&n.custom.errorCode&&(t=t+"/"+n.custom.errorCode.toLowerCase()),t}function l(n){return n.latency="latency"in n?n.latency:-1,n.operation="operation"in n?n.operation:"",n.status="status"in n?n.status+"":"",n.error="error"in n?n.error:-1,n.custom="custom"in n?n.custom:"",n.subject=f.getSubject()||"",n}function s(n,t){var i,o,n;t=l(t);i=t.qosOperation!=null?t.qosOperation.name:c(t);o=t.qosOperation!=null?t.qosOperation.description:e[i]?e[i].description:"";angular.isObject(t.custom)&&(t.custom=JSON.stringify(t.custom));n={name:"Ms.Webi.OutgoingRequest",content:{"Ms.Qos.OutgoingServiceRequest":{operationName:i,dependencyName:"SelfAssistWeb",dependencyType:"WebService",dependencyOperationName:i,latencyMs:t.latency,targetUri:t.operation,succeeded:t.status>=200&&t.status<400,serviceErrorCode:t.error,protocolStatusCode:t.status},"Ms.Webi.OutgoingRequest":{description:o,route:r.url(),visitId:f.getVisitId(),custom1:t.custom}}};n=u.populateDefaultFields(n);u.pushEvent(n)}var h=this,o={app:{exception:"//app/exception",error:"//app/error",unknownRoute:"//app/unknown-route",unknownCommand:"//app/unknown-command",commandError:"//app/command-error",dupeCommandError:"//app/dupe-command-error",invalidRequest:"//app/invalid-request",beginsharing:"//app/begin-sharing",pausesharingbyuser:"//app/pause-sharing-by-user",resumesharingbyuser:"//app/resume-sharing-by-user",endsharingbyuser:"//app/end-sharing-by-user",downloadCSS:"//app/download-css"},awasa:{error:"//awasa/error",callback:"//awasa/callback",chat:"//awasa/chat",times:"//awasa/times",sendMessage:"//awasa/message",disengage:"//awasa/disengage",download:"//awasa/download",initialize:"//awasa/initialize",lazyInitialize:"//awasa/initialize-lazy",channelDisconnect:"//awasa/channel-disconnect",channelReconnect:"//awasa/channel-reconnect",channelUnavailable:"//awasa/channel-unavailable",agentDisconnect:"//awasa/agent-disconnect",agentReconnect:"//awasa/agent-reconnect",sendCommand:"//awasa/send-command",channelStatus:"//awasa/channel-status",chatReconnectTimedOut:"//awasa/chat-reconnect-timeout",getQueueLength:"//awasa/get-queue-length",postChatTranscript:"//awasa/post-chat-transcript"},dgps:{suggest:"//dgps/suggestions",unknownLocale:"//dgps/unknownlocale",invalid:"//dgps/invalid"},"native":{appStartContext:"//app/appStartContext"},dbs:{invalid:"//dbs/invalid"},hip:{download:"//hip/download"},geo:{init:"//geo/init",changes:"//geo/changes"},auth:{unknownSilentAuth:"//auth/unknown-silent-auth",aadSilentAuth:"//auth/aad-silent-auth",aadStateMismatch:"//auth/aad-state-mismatch",meControlLoad:"//auth/me-control-loaded",meControlState:"//auth/me-control-partial-state"}},e;this.eventTypes=o;e={};e["/api/content/GetAgent"]={description:"Event triggered when agent information is requested from Awasa."};e["/api/content/GetCompassContentForPage"]={description:"Event triggered when resources such as strings and images are requested from Compass."};e["/api/content/GetCompassContentForProductPages"]={description:"Event triggered when resources such as strings and images for Product Pages are requested from Compass and or Portico."};e["/api/content/GetCompassContentForPartner"]={description:"Event triggered when resources such as strings are requested from Compass for a partner."};e["/api/Devices/Index"]={description:"Event triggered when device information associated with the user is requested from DDS."};e["/api/kb/GetKbArticle"]={description:"Event triggered when a KB article is requested."};e["/api/search/index"]={description:"Event triggered to provide search results for a given search term"};e["/api/Token/GetToken"]={description:"Event triggered when a security token to allow the user to use the chat and callback functionality is requested from the Awasa Security service."};e["/api/Token/GetUserState"]={description:"Event triggered when encryption of user information is requested from Awasa."};e["/api/v1/AutoSuggestion"]={description:"Event triggered when autosuggestions are requested from DGPS. This request goes directly to the DGPS endpoint."};e["/app/ScheduleCallbackTimesTimeout"]={description:"Event triggered when a timeout occurs while waiting for the times available to schedule a call."};e[o.app.error]={description:"Event triggered when an error occurs in the code running on the client side."};e[o.app.exception]={description:"Event triggered when exception is caught by the AngularJS exception handler."};e[o.app.unknownRoute]={description:"Event triggered when the user attempts to go to a route not rendered by support.microsoft.com"};e[o.app.unknownCommand]={description:"Event triggered when the a command received from the native app is not understood or is unknown to web"};e[o.app.commandError]={description:"Event triggered when a command received from the native app has failed"};e[o.app.dupeCommandError]={description:"Event triggered when a duplicate command is sent to the app for processing, only one of a type should fire at a time."};e[o.app.beginsharing]={description:"Event triggered when beginsharing command is sent from web to app"};e[o.app.pausesharingbyuser]={description:"Event triggered when pausesharingbyuser command is sent from web to app"};e[o.app.resumesharingbyuser]={description:"Event triggered when resumesharingbyuser command is sent from web to app"};e[o.app.endsharingbyuser]={description:"Event triggered when endsharingbyuser command is sent from web to app"};e[o.app.downloadCSS]={description:"Event triggered when CSS is downloaded"};e[o.awasa.callback]={description:"Event triggered when a callback (either schedule or immediate) is requested from Awasa. This request goes directly to the Awasa endpoint."};e[o.awasa.chat]={description:"Event triggered when a chat is queued. This request goes directly to the Awasa endpoint."};e[o.awasa.disengage]={description:"Event triggered when a chat is ended or a user leaves the queue. This request goes directly to the Awasa endpoint."};e[o.awasa.error]={description:"Event triggered when an error occurs in the client-side Awasa framework."};e[o.awasa.sendMessage]={description:"Event triggered when a message is sent or received from the chat experience. This request goes directly to the Awasa endpoint."};e[o.awasa.times]={description:"Event triggered when a user request to see the open time slots to schedule a call. This request goes directly to the Awasa endpoint."};e[o.awasa.download]={description:"Event triggered when the Awasa SDK is downloaded to the client"};e[o.awasa.initialize]={description:"Event triggered when the 'loaded' callback is called from the Awasa SDK. Indicates that the Awasa SDK has successfully been initialized."};e[o.awasa.channelReconnect]={description:"Event triggered from the Awasa SDK when the user reconnects to the chat after being disconnected"};e[o.awasa.channelDisconnect]={description:"Event triggered from the Awasa SDK when a connection issue occurs on the user side of a chat"};e[o.awasa.channelUnavailable]={description:"Event triggerd when a modality is in HOOPs but unavailable for other reasons"};e[o.awasa.agentDisconnect]={description:"Event triggered from the Awasa SDK when a connection issue occurs on the agent side of a chat"};e[o.awasa.agentReconnect]={description:"Event triggrered from the Awasa SDK when the agent reconnects to the chat after being disconnected"};e[o.awasa.sendCommand]={description:"Event triggered when a command is sent to the agent via the Awasa SDK."};e[o.awasa.channelStatus]={description:"Event triggered when chat and callback status is requested from the Awasa SDK."};e[o.awasa.chatReconnectTimedOut]={description:"Event triggered when attempting to reconnect chat times out."};e[o.native.appStartContext]={description:"Event triggered when the app starts and sends back context on how the app was launched."};e[o.awasa.getQueueLength]={description:"Event triggered from the Awasa SDK when it fails to retrieve the queue position."};e[o.awasa.postChatTranscript]={description:"Event triggered when a request to the Awasa post transcript API occurs."};e["//awasa/callback/channel_error"]={description:"Event triggered when there is an issue with the Awasa callback channel."};e["//awasa/callback/channel_contactinvalid"]={description:"Event triggered when the contact number is rejected as invalid by the telephony service"};e["//awasa/callback/request_unauthorized"]={description:"Event triggered when a callback API call is made with an invalid token"};e[o.geo.init]={description:"Event triggered by geoComponent when it is instantiated/used"};e[o.geo.changes]={description:"Event triggered by geoComponent when bindings are changed/updated"};e[o.auth.unknownSilentAuth]={description:"Event triggered when resolve auth state times out without resolving"};e[o.auth.aadSilentAuth]={description:"Event triggered when we are having issues with completing AAD silent auth flow"};e[o.auth.aadStateMismatch]={description:"Event triggered by auth service when we are having state mismatch issues with silent AAD auth"};e[o.auth.meControlLoad]={description:"Event triggered by auth service when we are having issues loading me control shell - when this happens we use the fallback L0Header as Universal Header is not available at all"};e[o.auth.meControlState]={description:"Event triggered by auth service me control is having issues and is in a partial working state i.e sign in/out works, dropdown and user pic does not"};this.createEvent=function(n){var i={operation:n},r=(new Date).getTime(),u=t.defer();return u.promise.then(function(n){i.latency=(new Date).getTime()-r;i.status=200;i.custom=n||"";s({},i)},function(n){i.latency=(new Date).getTime()-r;i.status=n&&n.status||500;i.custom=n||"";s({},i)}),u};n.$on("QoS",s);n.$on("AutoSuggestBadResults",function(){h.createEvent(o.dgps.invalid).reject()});n.$on("500Error",function(n,t){t&&s(n,{operation:o.app.error,status:"500",custom:t})});n.$on("404Error",function(n,t){t&&s(n,{operation:o.app.unknownRoute,status:"404",custom:t})});n.$on("AppStartContext",function(n,t){s(n,{operation:o.native.appStartContext,status:"200",custom:t})})}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("searchTelemetryService",["$rootScope","$location","clientTelemetryService","wedcsService",function(n,t,i,r){var u={unknown:"unknown",searchPrimaryClicked:"searchPrimaryClicked",emptySearchResponse:"emptySearchResponse",instantAnswerFound:"instantAnswerFound",instantAnswerWithQuestion:"instantAnswerWithQuestion"},e="searchAction",f=function(n,t,r){t=t||"";r=r||"";var u={name:"Microsoft.Mac.SelfAssist.SearchAction",content:{"Microsoft.Mac.SelfAssist.SearchAction":{actionName:n,custom1:t,custom2:r}}};u=i.populateDefaultFields(u);i.pushEvent(u)};n.$on("SearchPrimaryClicked",function(n,i){f(u.searchPrimaryClicked,i.Location,i.SearchString);r.logCustomEvent("search",e,{"ms.scnum":t.absUrl(),"ms.searchquery":i.SearchString})});n.$on("SearchResponse",function(n,t){t.item&&t.item.results&&t.item.results.length!==0||f(u.emptySearchResponse,t.caller);t.item&&t.item.instantAnswer&&(f(u.instantAnswerFound),r.logCustomEvent("instant-answer-found",e,{"ms.scvalue":t.item.instantAnswer.sourceId||""}))});n.$on("AutoSuggestSelected",function(n,t){r.logCustomEvent("auto-suggest-selected",e,{"ms.sctype":t.suggestion.AutoSuggestionType,"ms.scvalue":t.suggestion.CompletionText,"ms.searchquery":t.query})});n.$on("instantAnswerWithQuestion",function(n,t){f(u.instantAnswerWithQuestion,JSON.stringify(t))})}])}(angular.module(microsoft.support.moduleName)),function(n){n.run(["chatTelemetryService","searchTelemetryService","geoTelemetryService","callbackTelemetryService","menuTelemetryService","qosTelemetryService","wedcsService","authenticationHelperService","seoService","appCommandQosTelemetryService","navigationOverrideService","contactUsTelemetryService","commercialTelemetryService","logMeInTelemetryService",function(){}]);n.config(["$httpProvider",function(n){n.interceptors.push("qosTelemetryInterceptor");n.interceptors.push("errorInterceptor");n.interceptors.push("httpAppOptionsInterceptor")}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("virtualAgentTelemetryService",["$rootScope","wedcsService","virtualAgentService","metaTagsService",function(n,t,i,r){function e(n){r.addOrUpdateMetaTag("ms.skylightId",i.sessionId());n&&n.flight&&r.addOrUpdateMetaTag("ms.skyefId",n.flight)}var u={response:"virtual-agent-dialog-user-response",content:"virtual-agent-dialog-content",feedback:"virtual-agent-dialog-feedback",flow:"virtual-agent-flow-definition",iaCollapse:"virtual-agent-ia-collapse",survey:"virtual-agent-dialog-survey"},f="virtualAgentAction";i.sessionId()&&e();n.$on("VirtualAgentDialogResponse",function(n,i){e({flight:i.engineFlight});t.logCustomEvent(u.content,f,{"ms.scvalue":JSON.stringify({sourceId:i.sourceId||"",question:!i.dialogQuestion?0:1,answer:!i.instantAnswer?0:1,chitchat:!i.chitChat?0:1,results:!i.results?0:1,status:i.engineStatus})})});n.$on("InstantAnswerCollapsable",function(n,r){i.sessionId()&&(e(),t.logCustomEvent(u.iaCollapse,f,{"ms.scvalue":JSON.stringify(r)}))});n.$on("VirtualAgentFlowChange",function(n,i){r.addOrUpdateMetaTag("ms.flowId",i);t.logCustomEvent(u.flow,f)});n.$on("VirtualAgentDialogUserResponse",function(n,i){e();t.logCustomEvent(u.response,f,{"ms.scvalue":i.searchText})});n.$on("VirtualAgentSolutionFeedback",function(n,i){e();t.logCustomEvent(u.feedback,f,{"ms.scvalue":JSON.stringify({text:i.text,result:i.result.Result})})});n.$on("VirtualAgentSurvey",function(n,i){e();t.logCustomEvent(u.survey,f,{"ms.scvalue":JSON.stringify(i)})})}])}(angular.module(microsoft.support.moduleName));app.directive("scrollTrack",["$window","wedcsService",function(n,t){return{restrict:"A",link:function(i){var r=!1;angular.element(n).off("scroll");angular.element(n).on("scroll",function(){!r&&n&&n.scrollY&&n.innerHeight&&(n.scrollY>n.innerHeight||n.scrollY+n.innerHeight+1>=$(document).height())&&(r=!0,t.logCustomEvent("fullview-scroll"))});i.$on("destroy",function(){angular.element(n).off("scroll")})}}}]),function(n){n.service("wedcsService",["$rootScope","$window","$location","$timeout","$route","rccService",function(n,t,i,r,u){function h(n){return n.type=="checkbox"?n.checked+"_"+n.value:n.nodeName=="A"?n.href:n.value}function c(n){var t="";return n.id&&(t="elemId_"+n.id),n.name&&(t=t+"_elemName_"+n.name),n.parentNode&&n.parentNode.id&&(t=t+"_parId_"+n.parentNode.id),n.parentNode&&n.parentNode.name&&(t=t+"_parName_"+n.parentNode.name),n.parentNode&&n.parentNode.parentNode&&n.parentNode.parentNode.id&&(t=t+"_parParId_"+n.parentNode.parentNode.id),n.parentNode&&n.parentNode.parentNode&&n.parentNode.parentNode.name&&(t=t+"_parParName_"+n.parentNode.parentNode.name),n.parentNode&&n.parentNode.parentNode&&n.parentNode.parentNode.parentNode&&n.parentNode.parentNode.parentNode.id&&(t=t+"_parParParId_"+n.parentNode.parentNode.parentNode.id),n.parentNode&&n.parentNode.parentNode&&n.parentNode.parentNode.parentNode&&n.parentNode.parentNode.parentNode.name&&(t=t+"_parParParName_"+n.parentNode.parentNode.parentNode.name),n.className&&(t=t+"_elemClass_"+n.className),n.type&&(t=t+"_elemType_"+n.type),t}function e(n){n.hasAttribute("data-nolog")||t&&t.MscomCustomEvent&&t.MscomCustomEvent("ms.scn",c(n),"ms.scvalue",h(n),"ms.scnct","userAction")}function o(n,i,r){if(n&&t&&t.MscomCustomEvent){var u=[];r=r||{};r["ms.scn"]=n;i&&(r["ms.scnct"]=i);angular.forEach(r,function(n,t){u.push(t+"="+n)});t.MscomCustomEvent.apply(t,u)}}var s=!1,f;this.logWEDCS=e;this.logCustomEvent=o;$(document).ready(function(){$(document).on("click","input[type='radio'], input[type='checkbox'], button, a:not(a[id]), li",function(){e(this)});$(document).on("change","textarea, select",function(){e(this)})});n.$on("ButtonClickedAndDisabled",function(n,t){e(t.target)});n.$on("ChatMessageReceived",function(){t&&t.MscomCustomEvent&&t.MscomCustomEvent("ms.scn","agent-chat-post","ms.scnct","chatAction")});n.$on("ChatMessageSendSuccess",function(){t&&t.MscomCustomEvent&&t.MscomCustomEvent("ms.scn","customer-chat-post","ms.scnct","chatAction")});n.$on("$routeChangeSuccess",function(){u.current.controller!=="SupportMenuController"||s||(t&&t.MscomCustomEvent&&t.MscomCustomEvent("ms.scnct","CAD-Displayed"),s=!0)});n.$on("$routeChangeStart",function(){if(t&&t.MscomCustomEvent){n&&r.cancel(n);var n=r(function(){o("route-change-start","viewLoad",{cot:"0"})},250)}f&&r.cancel(f)});n.$on("PageResourcesDownloaded",function(n,t){r(function(){o("page-resources-downloaded","",t)},250);f=r(function(){o("no-bounce","",t);f=null},8e3)})}])}(angular.module(microsoft.support.moduleName)),function(n){n.controller("KbController",["$rootScope","$timeout","$scope","$log","$window","$routeParams","$sce","$rootScope","$location","contentApiService",function(n,t,i,r,u,f,e,n,o,s){i.reset=function(){if(f.articleId!=null){var t=s.getKbArticle(f.articleId,o.search());t.then(function(t){i.kbArticle=t.kbArticle;t.noIndex&&n.$broadcast("NoIndex");n.$broadcast("PageResourcesDownloaded")})}};i.reset()}])}(angular.module(microsoft.support.moduleName)),function(n){n.constant("virtualAgentConstants",{messageSlideOutTime:400,messageThinkingTime:1500,contentThinkingTime:3e3,maxMessageLength:1024,instantAnswerMaxHeight:280})}(angular.module(microsoft.support.moduleName)),function(n){n.controller("VirtualAgentController",["$scope","$timeout","$rootScope","$routeParams","$cookies","virtualAgentDialogService","messageService","messageTypes","chatService","chatStateService","clientConfig","flightService","chatContextService","virtualAgentResetModalService","virtualAgentFeedbackService","authenticationHelperService","modalityTags","authService","virtualAgentConstants","virtualAgentSurveyModalService","virtualAgentService",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g){function lt(t){n.isSearching=!0;n.virtualAgentRequest=f.fetchDialogContentAsMessage({query:t,cacheKey:n.messages[0].text,augments:ut,queryChannel:u.get("smcpartner")||"dialog"},n.view).then(function(r){if(i.$broadcast("VirtualAgentDialogUserResponse",{searchText:t}),n.placeholder=n.view.introduction.placeholder,l.isUserInFlight("vac-12")){var u=n.view.followUpMessages[r.status]!==undefined;ft(r);n.placeholder=u?n.view.introduction.followUpPlaceholder:n.view.introduction.followUpDialogPlaceholder}r.forEach(function(t){t.view=n.view;t.messageType===o.InstantAnswer&&(t.hasSurvey=!0,t.feedbackAction=n.reportIAFeedback,t.maxHeight=k.instantAnswerMaxHeight);nt(t,t.messageType)});l.isUserInFlight("vac-12")||ft(r)},function(){i.$broadcast("VirtualAgentDialogUserResponse",{searchText:t});ot()})["finally"](function(){n.isSearching=!1})}function ft(i){var r=i.followUps[i.status]||n.view.followUpMessages[i.status],u=i.status,e={};u===f.classifications.followWithSurvey.key&&(e.customClass="virtual-agent-talk-to-agent-message");st.indexOf(u)>-1?et(r,e):r&&nt({text:r},o.VirtualAgent);u===f.classifications.agentRequested.key&&t(rt,k.messageThinkingTime)}function et(t,i){l.isUserInFlight("vac-12")?nt({fragments:[{text:t},{text:n.view.results.followUpAction,action:n.view.results.followUpActionUrl||rt,actionIsUrl:!!n.view.results.followUpActionUrl,id:"virtual-agent-talk-to-agent"}],customClass:i.customClass},o.VirtualAgent):nt({text:t,actionText:n.view.results.followUpAction,action:n.view.results.followUpActionUrl||rt,actionIsUrl:!!n.view.results.followUpActionUrl,view:n.view},o.VirtualAgent)}function rt(){n.pingbackUrl=y.getContactUsUrl();nt({view:n.view,modalityAction:n.selectModality,context:f.packageUserMessages(n.messages),phoneNumber:r.phoneNumber&&r.phoneNumber.trim()||""},o.ModalitySelection);n.isInputDisabled=!0;t(function(){n.messages.forEach(function(n){n.actionDisabled=!0})})}function nt(t,i){(i===o.InstantAnswer||i===o.Results)&&(t.loadingType="spinner",t.loadingTime=k.contentThinkingTime);i===o.VirtualAgent&&(t.loadingType=typeof t.loadingType=="undefined"?"message":t.loadingType,t.loadingTime=k.messageThinkingTime);var r=e.appendMessage(tt,t,i);return n.messages=e.getMessages(tt),r}function at(){return n.view&&n.view.resetModal&&n.view.resetModal.resetButtonLabel}function ot(){if(n.view.results.followUpActionUrl){et(n.view&&n.view.introduction&&n.view.introduction.errorResponse);return}nt({text:n.view&&n.view.introduction&&n.view.introduction.errorResponse},o.VirtualAgent);rt()}var it=l.isUserInFlight("aad-1"),tt="Virtual-Agent",ut,st=[f.classifications.noResults.key,f.classifications.followWithSurvey.key,f.classifications.failure.key],ht=["message:nth-last-child(1) .card.virtual-agent-modalities","message:nth-last-child(2) .content-spinner","message:nth-last-child(2) .card","message:nth-last-child(2) .virtual-agent-talk-to-agent-message","message:nth-last-child(1) .content-spinner","message:nth-last-child(1) .card"],ct={maxLength:k.maxMessageLength};n.reset=function(){n.config=ct;r.partnerId&&u.put("smcpartner",r.partnerId);n.isInputDisabled=!1;n.agentStatus=s.getAgentStatus();n.channelStatus=s.getChannelStatus();n.typingStatus=s.getTypingStatus();n.messageTypes=o;n.scrollSelectors=ht.join(";");n.userName="";s.setCurrentMessageRoom(tt);n.messages=e.restoreMessages(tt);e.removeMessagesFromStorage(tt);ut={TalkToHumanEnabled:r["aug.TalkToHumanEnabled"]||!0};g.engineFlightId(r["sky.engineFlight"]||"");f.bindModalityCallbacks(n.messages,n.selectModality);f.getContent(r.flowId,r.partnerId).then(function(u){n.view=u;var f=!0;n.messages||(r.userInput?n.submit(null,r.userInput):(f=!1,n.placeholder=u.introduction.exampleQuestion,nt({text:n.view.introduction.message,loadingType:""},o.VirtualAgent)));t(function(){i.$broadcast("ChatFrameHeader",{text:n.view.introduction.header,image:n.view.introduction.headerIcon,resetLabel:at(),endText:n.view.chat.endChat,showReset:f,survey:{visible:l.isUserInAnyFlight(["vac-20","vac-21"]),label:n.view.header.surveyLabel,icon:n.view.header.surveyIcon}})})});it&&b.resolveAuthState()};n.triggerDigestOnInputClick=function(){t(250)};n.selectModality=function(t,i){n.isInputDisabled=!0;i==w.chat?n.initChat(t):i==w.callback||i==w.scheduleCallback?n.initCallback(t):i=="email"&&(n.onChatSurveyCompleted(),n.isInputDisabled=!1)};n.initChat=function(t){it?b.resolveAuthState().then(function(i){var o=f.packageMessages(n.messages),r=b.getSupportedIDP(),u;i===r.MSA?(u={isAuth:!0,authType:r.MSA},s.postBotTranscript(u,o),s.enqueueChat(u)):t&&t.isRestart||(e.storeMessages(tt),f.storeSession(),b.loginUsingAccountType(r.MSA))}):p.getSignInState().then(function(){var i=f.packageMessages(n.messages),t={isAuth:!0};s.postBotTranscript(t,i);s.enqueueChat(t)},function(){t&&t.isRestart||(e.storeMessages(tt),f.storeSession(),p.signIn())})};n.initCallback=function(n){it?b.resolveAuthState().then(function(t){var i=b.getSupportedIDP();t!==i.MSA&&(n&&n.isRestart||(e.storeMessages(tt),f.storeSession(),b.loginUsingAccountType(i.MSA)))}):p.getSignInState().then(function(){},function(){n&&n.isRestart||(e.storeMessages(tt),f.storeSession(),p.signIn())})};n.onChatSurveyCompleted=function(){nt({text:n.view.chat.followUp},o.VirtualAgent)};n.submit=function(t,r){if(t&&t.preventDefault(),r){var u=nt({text:r,errorView:n.view&&n.view.chat&&n.view.chat.error&&n.view.chat.error.failedMessage},o.User);n.userInput="";h.getChatEstablished()?s.sendMessage(u):(i.$broadcast("ChatFrameHeader",{showReset:!0}),lt(r))}};n.reportIAFeedback=function(t,i){n.pingbackUrl=y.getIAFeedback(t,i)};n.$on("AgentDataReady",function(t,r){n.isInputDisabled=!1;n.agentStatus.prevAgent&&nt({header:n.view.chat.agent.agentTransferHeader,view:n.view.chat.agent,oldAgent:n.agentStatus.prevAgent,newAgent:r},o.Transfer);i.$broadcast("ChatFrameHeader",{text:r.DisplayName,image:{url:r.ImageUrl},showEnd:!0,showReset:!1})});n.$on("ChatSessionClosed",function(){nt({header:n.view.chat.endingText,view:n.view.chat.agent,agent:n.agentStatus.agent,isJoining:!1},o.AgentEnd);i.$broadcast("ChatFrameHeader",{text:n.view.introduction.header,image:n.view.introduction.headerIcon,showEnd:!1,showReset:!0});nt({header:n.view.chat.survey.surveyTitle,view:n.view.chat.survey,surveyData:{agent:n.agentStatus.agent.AgentId,chatId:h.getChatId()},surveyAction:n.onChatSurveyCompleted},o.Survey)});n.$on("EnqueueCallbackSuccess",function(){n.isInputDisabled=!1;nt({text:n.view.modalities.callbackFollowUp},o.VirtualAgent)});n.$on("VirtualAgentReset",function(){v.confirmReset().then(function(){n.isInputDisabled=!1;var t=n.view&&n.view.introduction&&n.view.introduction.resetMessage;f.clearHistory();e.clearMessages(tt);nt({text:t,loadingType:""},o.VirtualAgent);i.$broadcast("ChatFrameHeader",{showReset:!1});n.placeholder=n.view.introduction.exampleQuestion;s.endChat()})});n.$on("ChatSurveyRequested",function(){d.requestSurvey({header:n.view.chat.survey.surveyTitle,view:n.view.chat.survey,surveyData:{}}).then(function(){nt({text:n.view.followUpMessages.FeedbackProvided},o.VirtualAgent)})});it?n.$on("UserSignedInMSA",function(){var t=b.getUserInfo();t&&t.firstName&&(n.userName=t.firstName||"")}):n.$on("UserSignedIn",function(){n.userName=c&&c.authInfo&&c.authInfo.firstName||""});n.$on("VirtualAgentDialogTimeout",function(){ot()});$(window).focus(function(){n.pingbackUrl=y.getPageFocusUrl()||n.pingbackUrl;n.$digest()});n.reset()}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("virtualAgentDialogService",["$http","$q","$rootScope","virtualAgentService","delayService","localStorageService","messageTypes","flightService","compassService",function(n,t,i,r,u,f,e,o,s){function v(n){var t={};return!n||!n.results||!n.results.followUpMessages?t:(n.results.followUpMessages.forEach(function(n){t[n.messageType]=n.messageText}),t)}function y(r,u,f){return r?(i.$broadcast("VirtualAgentFlowChange",r),n.get("/api/content/GetVirtualAgentFlowDefinition",{params:{id:r}}).then(function(n){return h=n.data,f.introduction.message=h.introductionOverride||f.introduction.message,f.introduction.image=h.imageOverride||f.introduction.image,f.introduction.headerIcon=h.headerIconOverride||f.introduction.headerIcon,f.introduction.placeholder=h.placeholderOverride||f.introduction.placeholder,f.results.followUpAction=h.nextAction&&h.nextAction.linkText||f.results.followUpAction,f.results.followUpActionUrl=h.nextAction&&h.nextAction.linkUrl||f.results.followUpActionUrl,h.followUpMessageOverrides&&h.followUpMessageOverrides.forEach(function(n){f.followUpMessages[n.messageType]=n.messageText}),u&&(h.routingClientId=a+u),f},function(n){return n.status===404?f:t.reject(n)})):t.resolve(f)}function p(n,t){var i=[],r,u;return i.status={},r=n.chitChat&&(n.chitChat.problem.name||n.chitChat.solutions[0].description),i.status=w(n),n.instantAnswer&&!i.status?i.push({messageType:e.InstantAnswer,instantAnswer:n.instantAnswer,header:t.results.answerHeader}):r&&!i.status?i.push({messageType:e.VirtualAgent,text:r}):i.status||n.dialogQuestion||!n.results.length||i.push({messageType:e.Results,results:n.results,header:t.results.resultsHeader||t.results.answerHeader}),n.dialogQuestion&&!i.status&&i.push({messageType:e.VirtualAgent,text:n.dialogQuestion}),u=n.metaData.some(function(n){return n.key=="modality"&&n.value=="none"}),i.status=i.status||i.some(function(n){return n.messageType!==e.VirtualAgent})&&i.length===1&&!u&&c.classifications.followWithSurvey.key,i.followUps={},i.followUps[c.classifications.success.key]=i.status===c.classifications.success.key&&r,i}function w(n){if(!n.engineStatus)return"";var t="";return angular.forEach(c.classifications,function(i){t=i.values.indexOf(n.engineStatus)!==-1?i.key:t}),t}function b(){var n=f.getCacheContent(l);r.sessionId(n&&n.sessionId);f.commit(l,{})}function k(n){if(n.text)return n.text.replace(/<.*?>/g,"");if(n.messageType==e.Results)return"**Self help links shown to user**";if(n.messageType==e.InstantAnswer){var t=["**Instant Answer Displayed**"];return n.instantAnswer&&n.instantAnswer.problem&&n.instantAnswer.problem.name&&t.push("Title: "+n.instantAnswer.problem.name.replace(/<.*?>/g,"")),n.instantAnswer&&n.instantAnswer.solutions&&n.instantAnswer.solutions[0]&&n.instantAnswer.solutions[0].relatedHelpUrl&&t.push("URL: "+n.instantAnswer.solutions[0].relatedHelpUrl),t.join(", ")}return""}var c=this,a="skylight_",h,l;this.classifications={failure:{key:"Fail",values:["Fail"]},success:{key:"Success",values:["FinalAnswer.Chitchat"]},noResults:{key:"NoResults",values:["Chitchat.RestrictedWords","NoResult","NotUnderstanding"]},agentRequested:{key:"AgentRequested",values:["TalkToAPerson"]},followWithSurvey:{key:"AnswerContent",values:[]}};h={routingClientId:"mseg_skylight"};l="virtual-agent-session";b();this.fetchDialogContentAsMessage=function(n,t){var i={page:1,withDialog:!0,queryChannel:"dialog",forceRefresh:!0,delay:300,areaId:h.areaId||""},f;return angular.extend(i,n),f=r.fetchContent(i).then(function(n){return p(n,t)}),u.delay(f,i.delay)};this.bindModalityCallbacks=function(n,t){n&&n.forEach(function(n){n.messageType==e.ModalitySelection&&(n.modalityAction=t)})};this.getContent=function(n,t){return s.getVirtualAgent().then(function(i){return i.followUpMessages=v(i),i.instantAnswer=i&&i.results&&i.results.instantAnswer,y(n,t,i)})};this.getFlowDefinition=function(){return h};this.clearHistory=function(){r.sessionId("")};this.storeSession=function(){f.commit(l,{sessionId:r.sessionId()})};this.packageMessages=function(n){return n&&n.map(function(n){return{from:n.messageType===e.User?"User":"Bot",to:n.messageType!==e.User?"User":"Bot",timestamp:new Date(n.timeStamp).toJSON(),message:k(n)}})||[]};this.packageUserMessages=function(n){return n.map(function(n){return n.messageType===e.User?n.text:""}).join(" . ")}}])}(angular.module(microsoft.support.moduleName)),function(n){var i="smc-entry-chrome",t="va-entry-seen";n.component("virtualAgentEntry",{templateUrl:"/PartialViews/VirtualAgent/VirtualAgentEntry.html",bindings:{view:"<",messageDelay:"<?",messageDuration:"<?"},controller:["$timeout","$window","virtualAgentLinkService","sessionStorageService","virtualAgentConstants",function(n,r,u,f,e){function h(){n.cancel(s)}var s=null,o=this;this.toggleBubble=function(n){this.hasSeenSlideOutAnim&&(n?(this.isThinking=!1,this.isMessageTextVisible=!0,this.isMessageVisible=!0):this.isMessageVisible=!1)};this.messageBubbleStart=function(t,i){return i=i||0,(s=n(function(){o.isThinking=!0;o.isMessageVisible=!0},t)).then(function(){return s=n(function(){o.isThinking=!1;o.enableSlideOutAnim=!0},e.messageThinkingTime)}).then(function(){return s=n(function(){o.isMessageTextVisible=!0;o.enableSlideOutAnim=!1;o.hasSeenSlideOutAnim=!0},e.messageSlideOutTime)}).then(function(){return s=n(function(){o.toggleBubble(!1)},i)})};this.$onInit=function(){this.messageDelay=this.messageDelay||0;this.messageDuration=this.messageDuration||5e3;this.isThinking=!1;this.isMessageVisible=!1;this.isMessageTextVisible=!1;this.enableSlideOutAnim=!1;this.hasSeenSlideOutAnim=!1};this.openVirtualAgent=function(){h();u.openPopup({flowId:i})};this.$onDestroy=h;r.onload=function(){o.hasSeenSlideOutAnim=!!f.get(t);o.hasSeenSlideOutAnim||(o.messageBubbleStart(o.messageDelay,o.messageDuration),f.set(t,!0))}}]})}(angular.module(microsoft.support.moduleName)),function(n){n.service("virtualAgentFeedbackService",["virtualAgentService",function(n){function i(t){var r=n.feedbackUrl(),i;return r?(i=[],angular.forEach(t,function(n,t){i.push(t+"="+n)}),r+"?"+i.join("&")):""}var t="";this.getClickUrl=function(r){var u={s:n.sessionId(),r:r.resultId,e:"click",d:r.link};return t=r.resultId,i(u)};this.getContactUsUrl=function(){var t={s:n.sessionId(),e:"contactus"};return i(t)};this.getIAFeedback=function(t,r){var u={s:n.sessionId(),r:r,e:"survey",d:t?"yes":"no"};return i(u)};this.getPageFocusUrl=function(){if(!t)return"";var r={s:n.sessionId(),e:"clickreturn",r:t};return t="",i(r)}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("virtualAgentLinkService",["supportLinkService","locationService","clientConfig",function(n,t,i){var r="/virtual-agent/?";this.openPopup=function(u){u=u||{};u.params=u.params||{};u.params.referrer=u.referrer||t.getReferrerDomain();u.params.flowId=u.flowId||"";var f=Object.keys(u.params).map(function(n){return u.params[n]?n+"="+u.params[n]:""}).filter(function(n){return!!n}).join("&"),e=r+f;n.openContactWindow(e,{width:i.ContactUsConfig.VirtualAgentWidth})}}])}(angular.module(microsoft.support.moduleName)),function(n){n.value("virtualAgentModalityStates",{Selecting:0,Connecting:1,Chatting:2,Callback:3,Error:4});n.directive("virtualAgentModality",["$location","chatClassificationService","supportLinkService","modalityTags","virtualAgentModalityStates","chatService","compassService","chatStateService","authenticationHelperService","authService","flightService","virtualAgentDialogService",function(n,t,i,r,u,f,e,o,s,h,c,l){function w(n){o.setSubject(n.message.engaged.subjectId);n.selectModality(n.message.engaged.modality,n.message.engaged.link,{isRestart:!0})}function b(n,t){t&&t.link&&t.link.linkUrl?n.externalLink=t:e.getContactUsProducts().then(function(t){n.products=t&&t.links})}function k(n,t){e.getContactUsProducts().then(function(i){if(n.products=i&&i.links,t.product)for(var r in n.products)t.product.link.linkText==n.products[r].link.linkText&&(n.selections.selectedProduct=n.products[r]);n.linkOptions=t;n.linkOptions.length==1&&(n.selections.selectedOption=n.linkOptions[0],n.selectOption(n.linkOptions[0]))})}function a(n,t){t&&t.length&&(i.hasAnyModalities(t,y)||n.selections.selectedOption?(o.setSubject(i.extractSubjectFromList(t)),f.initLazy({typingBoxId:"virtual-agent-chat-client-message-input-textbox"}).then(function(){return f.checkHours(t)}).then(function(u){angular.extend(u,i.getSpecifiedModalities(t,p));n.modalities=u;u[r.callback]&&(u[r.callback].icon="E717");u[r.scheduleCallback]&&(u[r.scheduleCallback].icon="E787")})):k(n,t))}var v=n.search().referrer,y=[r.chat,r.callback,r.tollFree,r.scheduleCallback],p=[r.scheduleCallback,"email","community","tweet","reset-password"];return{restrict:"A",templateUrl:"/PartialViews/VirtualAgent/VirtualAgentModality.html",scope:{message:"=",view:"=",modalityAction:"&"},link:function(y){var p=c.isUserInFlight("aad-1");y.selections={};y.showCancel=!1;y.loadingModalities=!0;y.states=u;y.state=u.Selecting;y.contactUsLink="https://"+n.host()+"/{lang-locale}/contactus/";y.agentStatus=f.getAgentStatus();y.reset=function(){y.message.engaged&&w(y);var n=l.getFlowDefinition(),i=n.routingProduct,r=n.routingClientId;t.getMenuLinksForRoute(y.message.context,r,v,i).then(function(n){a(y,n)},function(n){b(y,n)})["finally"](function(){y.loadingModalities=!1})};y.selectLink=function(n){n.fromOldFlow=!0;i.followLink(n)};y.selectOption=function(n,t){n&&(y.modalities=null,y.externalLink="",t&&(y.selections.selectedOption=null,y.linkOptions=null),n&&n.externalLink?y.externalLink=n:n&&e.getContactUsMenuLinks(n.link.linkUrl).then(function(n){a(y,n)}))};y.selectModality=function(n,t,u){y.message.engaged={link:t,subjectId:o.getSubject(),modality:n};n==r.chat?y.chat(u):n==r.callback?y.callback(t,u,!1):n==r.scheduleCallback?y.callback(t,u,!0):i.followLink(t);y.modalityAction()(u,n)};y.retryAction=function(){y.selectModality(y.message.engaged.modality,y.message.engaged.link)};y.chat=function(){p?h.resolveAuthState().then(function(n){var t=h.getSupportedIDP();n===t.MSA&&(y.state=u.Connecting,y.showCancel=!0,y.cancelAction=function(){y.state=u.Selecting;f.endChat();y.showCancel=!1})}):s.getSignInState().then(function(){y.state=u.Connecting;y.showCancel=!0;y.cancelAction=function(){y.state=u.Selecting;f.endChat();y.showCancel=!1}})};y.callback=function(n,t,i){p?h.resolveAuthState().then(function(t){var r=h.getSupportedIDP();t===r.MSA&&(e.fetchContent(n.link.linkUrl.substring(1)),y.state=u.Callback,y.isScheduleCallback=i,y.showCancel=!0,y.cancelAction=function(){y.state=u.Selecting;y.showCancel=!1})}):s.getSignInState().then(function(){e.fetchContent(n.link.linkUrl.substring(1));y.state=u.Callback;y.isScheduleCallback=i;y.showCancel=!0;y.cancelAction=function(){y.state=u.Selecting;y.showCancel=!1}})};y.showModalities=function(){y.state=u.Selecting;y.showCancel=!1};y.$on("ChatSessionEstablished",function(){y.state=u.Chatting});y.$on("ChatFrameHeader",function(n,t){t.showEnd&&(y.showCancel=!1)});y.$on("EnqueueCallbackSuccess",function(){y.showCancel=!1});y.$on("EnqueueChatFailure",function(){y.state=u.Error});y.$on("EnqueueCallbackFailure",function(){y.state=u.Error});y.reset()}}}])}(angular.module(microsoft.support.moduleName)),function(n){var t="smc-entry-nav";n.component("virtualAgentNavEntry",{templateUrl:"/PartialViews/VirtualAgent/VirtualAgentNavEntry.html",bindings:{view:"<",collapsed:"<"},controller:["virtualAgentLinkService",function(n){this.openVirtualAgent=function(){n.openPopup({flowId:t})}}]})}(angular.module(microsoft.support.moduleName)),function(n){n.service("virtualAgentResetModalService",["$uibModal",function(n){this.confirmReset=function(){var t=n.open({templateUrl:"/PartialViews/VirtualAgent/ResetConfirmationModal.html",backdropClass:"smc-modal-backdrop",controller:["$scope","$uibModalInstance","compassService",function(n,t,i){i.getVirtualAgent().then(function(t){n.view=t&&t.resetModal});n.confirm=function(){t.close()};n.cancel=function(){t.dismiss()}}]});return t.result}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("virtualAgentService",["$http","$q","$rootScope","messageTypes","languageService",function(n,t,i,r,u){function a(n,r){if(!n.data.content||!n.data.content.webResults)return t.reject({error:"Invalid property values"});var u=v(n.data.content);return f.feedbackUrl(n.data.feedbackUrlBase),f.sessionId(n.data.sessionId),results=angular.extend({results:n.data.content.webResults.items.map(p),totalCount:n.data.content.webResults.totalEstimatedMatches,summarizedQuery:n.data.content.webResults.query,engineStatus:n.data.content.engineStatus,engineFlight:n.data.content.flightId},u),r||n.data.content.engineStatus==="FinalAnswer"||i.$broadcast("instantAnswerWithQuestion",{results:results,sessionId:n.data.sessionId}),r?i.$broadcast("VirtualAgentDialogResponse",results):i.$broadcast("SearchResponse",{item:results,caller:"virtualagent"}),results}function v(n){var t={instantAnswer:null,dialogQuestion:null,metaData:[]},r,i,u,f;return n.answers?(answersText=JSON.stringify(n.answers).replace(new RegExp(String.fromCharCode(57356),"g"),"<strong>").replace(new RegExp(String.fromCharCode(57357),"g"),"<\/strong>"),r=JSON.parse(answersText),r&&r.length&&(i=r.filter(function(n){return n.type==="InstantAnswer"})[0],u=r.filter(function(n){return n.type==="Dialog"&&!n.isChitChat})[0],i=i||u,f=r.filter(function(n){return n.type==="Dialog"&&n.isChitChat})[0],t.dialogQuestion=u&&u.question&&u.question.text,t.instantAnswer=i&&i.content&&i.content[0],t.instantAnswer&&(t.instantAnswer.sourceId=i.sourceId,t.instantAnswer.resultId=i.resultId,t.metaData=y(i.metadata)||[]),t.chitChat=f&&f.content&&f.content[0],t.sourceId=r[0].sourceId||""),t):t}function y(n){return n&&n.split(",").map(function(n){var t=n.split("=");return{key:t[0],value:t[1]}})}function p(n){return{simpleTitle:n.title.replace(/\<\/?b\>/g,""),title:n.title,description:n.description,link:n.url,displayLink:n.displayUrl,resultId:n.resultId}}var o,s,e={},h,c=["en-us"],l={TalkToHumanEnabled:!0},f=this;this.fetchContent=function(i){var r,u;return i.forceRefresh!==!0&&e[i.query]?t.when(e[i.query]):(r={withDialog:!1,augments:l,sessionId:f.sessionId(),backEndFlightId:f.engineFlightId()},angular.extend(r,i),r.query=encodeURIComponent(r.query),u={params:{}},r.withDialog&&(u.params.shouldRequestErrorCrashExperience=!1),n.post("/api/search/virtualagent",r,u).then(function(n){return a(n,r.withDialog)}).then(function(n){return i.cacheKey&&(e[i.cacheKey]=n),n}))};this.sessionId=function(n){return n!==undefined&&(o=n),o};this.engineFlightId=function(n){return n!==undefined&&(s=n),s};this.feedbackUrl=function(n){return n!==undefined&&(h=n),h};this.isEnabled=function(){return c.indexOf(u.langLocale())!==-1}}])}(angular.module(microsoft.support.moduleName)),function(n){n.service("virtualAgentSurveyModalService",["$uibModal",function(n){this.requestSurvey=function(t){var i=n.open({templateUrl:"/PartialViews/VirtualAgent/SurveyModal.html",backdropClass:"smc-modal-backdrop",windowTopClass:"virtual-agent-modal",controller:["$scope","$uibModalInstance",function(n,i){n.config=t;n.config.surveyData.forVirtualAgent=!0;n.submit=function(){i.close()};n.cancel=function(){i.dismiss()}}]});return i.result}}])}(angular.module(microsoft.support.moduleName))